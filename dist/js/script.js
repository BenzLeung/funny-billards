function regionCreate(){var t=regionPool.pop();return t||(t=new Region),t}function regionRelease(t){regionPool.push(t)}function unionArea(t,e){var i=t._minX<e._minX?t._minX:e._minX,n=t._minY<e._minY?t._minY:e._minY,r=t._maxX>e._maxX?t._maxX:e._maxX,c=t._maxY>e._maxY?t._maxY:e._maxY;return(r-i)*(c-n)}var cc=cc||{};cc._tmp=cc._tmp||{},cc._LogInfos={};var _p=window;_p.gl,_p.WebGLRenderingContext,_p.DeviceOrientationEvent,_p.DeviceMotionEvent,_p.AudioContext,_p.AudioContext||_p.webkitAudioContext,_p.mozAudioContext,_p=Object.prototype,_p._super,_p.ctor,_p=null,cc.ORIENTATION_PORTRAIT=0,cc.ORIENTATION_PORTRAIT_UPSIDE_DOWN=1,cc.ORIENTATION_LANDSCAPE_LEFT=2,cc.ORIENTATION_LANDSCAPE_RIGHT=3,cc._drawingUtil=null,cc._renderContext=null,cc._supportRender=!1,cc._canvas=null,cc.container=null,cc._gameDiv=null,cc.newElement=function(t){return document.createElement(t)},cc.each=function(t,e,i){if(t)if(t instanceof Array){for(var n=0,r=t.length;n<r;n++)if(e.call(i,t[n],n)===!1)return}else for(var c in t)if(e.call(i,t[c],c)===!1)return},cc.extend=function(t){var e=arguments.length>=2?Array.prototype.slice.call(arguments,1):[];return cc.each(e,function(e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])}),t},cc.isFunction=function(t){return"function"==typeof t},cc.isNumber=function(t){return"number"==typeof t||"[object Number]"===Object.prototype.toString.call(t)},cc.isString=function(t){return"string"==typeof t||"[object String]"===Object.prototype.toString.call(t)},cc.isArray=function(t){return Array.isArray(t)||"object"==typeof t&&"[object Array]"===Object.prototype.toString.call(t)},cc.isUndefined=function(t){return"undefined"==typeof t},cc.isObject=function(t){return"object"==typeof t&&"[object Object]"===Object.prototype.toString.call(t)},cc.isCrossOrigin=function(t){if(!t)return cc.log("invalid URL"),!1;var e=t.indexOf("://");if(e===-1)return!1;var i=t.indexOf("/",e+3),n=i===-1?t:t.substring(0,i);return n!==location.origin},cc.AsyncPool=function(t,e,i,n,r){var c=this;c._srcObj=t,c._limit=e,c._pool=[],c._iterator=i,c._iteratorTarget=r,c._onEnd=n,c._onEndTarget=r,c._results=t instanceof Array?[]:{},c._errors=t instanceof Array?[]:{},cc.each(t,function(t,e){c._pool.push({index:e,value:t})}),c.size=c._pool.length,c.finishedSize=0,c._workingSize=0,c._limit=c._limit||c.size,c.onIterator=function(t,e){c._iterator=t,c._iteratorTarget=e},c.onEnd=function(t,e){c._onEnd=t,c._onEndTarget=e},c._handleItem=function(){var t=this;if(!(0===t._pool.length||t._workingSize>=t._limit)){var e=t._pool.shift(),i=e.value,n=e.index;t._workingSize++,t._iterator.call(t._iteratorTarget,i,n,function(e,i){if(t.finishedSize++,t._workingSize--,e?t._errors[this.index]=e:t._results[this.index]=i,t.finishedSize!==t.size)t._handleItem();else if(t._onEnd){var n=0===t._errors.length?null:t._errors;t._onEnd.call(t._onEndTarget,n,t._results)}}.bind(e),t)}},c.flow=function(){var t=this;if(0===t._pool.length)return void(t._onEnd&&t._onEnd.call(t._onEndTarget,null,[]));for(var e=0;e<t._limit;e++)t._handleItem()}},cc.async={series:function(t,e,i){var n=new cc.AsyncPool(t,1,function(t,e,n){t.call(i,n)},e,i);return n.flow(),n},parallel:function(t,e,i){var n=new cc.AsyncPool(t,0,function(t,e,n){t.call(i,n)},e,i);return n.flow(),n},waterfall:function(t,e,i){var n=[],r=[null],c=new cc.AsyncPool(t,1,function(e,c,o){n.push(function(e){n=Array.prototype.slice.call(arguments,1),t.length-1===c&&(r=r.concat(n)),o.apply(null,arguments)}),e.apply(i,n)},function(t){if(e)return t?e.call(i,t):void e.apply(i,r)});return c.flow(),c},map:function(t,e,i,n){var r=e;"object"==typeof e&&(i=e.cb,n=e.iteratorTarget,r=e.iterator);var c=new cc.AsyncPool(t,0,r,i,n);return c.flow(),c},mapLimit:function(t,e,i,n,r){var c=new cc.AsyncPool(t,e,i,n,r);return c.flow(),c}},cc.path={normalizeRE:/[^\.\/]+\/\.\.\//,join:function(){for(var t=arguments.length,e="",i=0;i<t;i++)e=(e+(""===e?"":"/")+arguments[i]).replace(/(\/|\\\\)$/,"");return e},extname:function(t){var e=/(\.[^\.\/\?\\]*)(\?.*)?$/.exec(t);return e?e[1]:null},mainFileName:function(t){if(t){var e=t.lastIndexOf(".");if(e!==-1)return t.substring(0,e)}return t},basename:function(t,e){var i=t.indexOf("?");i>0&&(t=t.substring(0,i));var n=/(\/|\\\\)([^(\/|\\\\)]+)$/g,r=n.exec(t.replace(/(\/|\\\\)$/,""));if(!r)return null;var c=r[2];return e&&t.substring(t.length-e.length).toLowerCase()===e.toLowerCase()?c.substring(0,c.length-e.length):c},dirname:function(t){return t.replace(/((.*)(\/|\\|\\\\))?(.*?\..*$)?/,"$2")},changeExtname:function(t,e){e=e||"";var i=t.indexOf("?"),n="";return i>0&&(n=t.substring(i),t=t.substring(0,i)),i=t.lastIndexOf("."),i<0?t+e+n:t.substring(0,i)+e+n},changeBasename:function(t,e,i){if(0===e.indexOf("."))return this.changeExtname(t,e);var n=t.indexOf("?"),r="",c=i?this.extname(t):"";return n>0&&(r=t.substring(n),t=t.substring(0,n)),n=t.lastIndexOf("/"),n=n<=0?0:n+1,t.substring(0,n)+e+c+r},_normalize:function(t){var e=t=String(t);do e=t,t=t.replace(this.normalizeRE,"");while(e.length!==t.length);return t}},cc.loader=function(){var t={},e={},i={},n={},r={},c=new RegExp("^(?:(?:https?|ftp)://)(?:\\S+(?::\\S*)?@)?(?:(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[1-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)(?:\\.(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)*(?:\\.(?:[a-z\\u00a1-\\uffff]{2,}))|(?:localhost))(?::\\d{2,5})?(?:/\\S*)?$","i");return{resPath:"",audioPath:"",cache:{},getXMLHttpRequest:function(){return window.XMLHttpRequest?new window.XMLHttpRequest:new ActiveXObject("MSXML2.XMLHTTP")},_getArgs4Js:function(t){var e=t[0],i=t[1],n=t[2],r=["",null,null];if(1===t.length)r[1]=e instanceof Array?e:[e];else if(2===t.length)"function"==typeof i?(r[1]=e instanceof Array?e:[e],r[2]=i):(r[0]=e||"",r[1]=i instanceof Array?i:[i]);else{if(3!==t.length)throw new Error("arguments error to load js!");r[0]=e||"",r[1]=i instanceof Array?i:[i],r[2]=n}return r},isLoading:function(t){return void 0!==r[t]},loadJs:function(e,i,n){var r=this,c=r._getArgs4Js(arguments),o=c[0],s=c[1],a=c[2];navigator.userAgent.indexOf("Trident/5")>-1?r._loadJs4Dependency(o,s,0,a):cc.async.map(s,function(e,i,n){var c=cc.path.join(o,e);return t[c]?n(null):void r._createScript(c,!1,n)},a)},loadJsWithImg:function(t,e,i){var n=this,r=n._loadJsImg(),c=n._getArgs4Js(arguments);this.loadJs(c[0],c[1],function(t){if(t)throw new Error(t);r.parentNode.removeChild(r),c[2]&&c[2]()})},_createScript:function(e,i,n){var r=document,c=this,o=document.createElement("script");o.async=i,t[e]=!0,cc.game.config.noCache&&"string"==typeof e?c._noCacheRex.test(e)?o.src=e+"&_t="+(new Date-0):o.src=e+"?_t="+(new Date-0):o.src=e,o.addEventListener("load",function(){o.parentNode.removeChild(o),this.removeEventListener("load",arguments.callee,!1),n()},!1),o.addEventListener("error",function(){o.parentNode.removeChild(o),n("Load "+e+" failed!")},!1),r.body.appendChild(o)},_loadJs4Dependency:function(t,e,i,n){if(i>=e.length)return void(n&&n());var r=this;r._createScript(cc.path.join(t,e[i]),!1,function(c){return c?n(c):void r._loadJs4Dependency(t,e,i+1,n)})},_loadJsImg:function(){var t=document,e=t.getElementById("cocos2d_loadJsImg");if(!e){e=document.createElement("img"),cc._loadingImage&&(e.src=cc._loadingImage);var i=t.getElementById(cc.game.config.id);i.style.backgroundColor="transparent",i.parentNode.appendChild(e);var n=getComputedStyle?getComputedStyle(i):i.currentStyle;n||(n={width:i.width,height:i.height}),e.style.left=i.offsetLeft+(parseFloat(n.width)-e.width)/2+"px",e.style.top=i.offsetTop+(parseFloat(n.height)-e.height)/2+"px",e.style.position="absolute"}return e},loadTxt:function(t,e){if(cc._isNodeJs){var i=require("fs");i.readFile(t,function(t,i){t?e(t):e(null,i.toString())})}else{var n=this.getXMLHttpRequest(),r="load "+t+" failed!";n.open("GET",t,!0),/msie/i.test(navigator.userAgent)&&!/opera/i.test(navigator.userAgent)?(n.setRequestHeader("Accept-Charset","utf-8"),n.onreadystatechange=function(){4===n.readyState&&(200===n.status?e(null,n.responseText):e({status:n.status,errorMessage:r},null))}):(n.overrideMimeType&&n.overrideMimeType("text/plain; charset=utf-8"),n.onload=function(){4===n.readyState&&(200===n.status?e(null,n.responseText):e({status:n.status,errorMessage:r},null))},n.onerror=function(){e({status:n.status,errorMessage:r},null)}),n.send(null)}},_loadTxtSync:function(t){if(cc._isNodeJs){var e=require("fs");return e.readFileSync(t).toString()}var i=this.getXMLHttpRequest();return i.open("GET",t,!1),/msie/i.test(navigator.userAgent)&&!/opera/i.test(navigator.userAgent)?i.setRequestHeader("Accept-Charset","utf-8"):i.overrideMimeType&&i.overrideMimeType("text/plain; charset=utf-8"),i.send(null),4===!i.readyState||200!==i.status?null:i.responseText},loadCsb:function(t,e){var i=new XMLHttpRequest,n="load "+t+" failed!";i.open("GET",t,!0),i.responseType="arraybuffer",i.onload=function(){var t=i.response;t&&(window.msg=t),4===i.readyState&&(200===i.status?e(null,i.response):e({status:i.status,errorMessage:n},null))},i.onerror=function(){e({status:i.status,errorMessage:n},null)},i.send(null)},loadJson:function(t,e){this.loadTxt(t,function(i,n){if(i)e(i);else{try{var r=JSON.parse(n)}catch(e){throw new Error("parse json ["+t+"] failed : "+e)}e(null,r)}})},_checkIsImageURL:function(t){var e=/(\.png)|(\.jpg)|(\.bmp)|(\.jpeg)|(\.gif)/.exec(t);return null!=e},loadImg:function(t,e,i){var n={isCrossOrigin:!0};void 0!==i?n.isCrossOrigin=void 0===e.isCrossOrigin?n.isCrossOrigin:e.isCrossOrigin:void 0!==e&&(i=e);var o=this.getRes(t);if(o)return i&&i(null,o),o;var s=r[t];if(s)return s.callbacks.push(i),s.img;o=new Image,n.isCrossOrigin&&"file://"!==location.origin&&(o.crossOrigin="Anonymous");var a=function(){this.removeEventListener("load",a,!1),this.removeEventListener("error",l,!1),c.test(t)||(cc.loader.cache[t]=o);var e=r[t];if(e){for(var i=e.callbacks,n=0;n<i.length;++n){var s=i[n];s&&s(null,o)}e.img=null,delete r[t]}},h=this,l=function(){if(this.removeEventListener("error",l,!1),o.crossOrigin&&"anonymous"===o.crossOrigin.toLowerCase())n.isCrossOrigin=!1,h.release(t),cc.loader.loadImg(t,n,i);else{var e=r[t];if(e){for(var c=e.callbacks,s=0;s<c.length;++s){var a=c[s];a&&a("load image failed")}e.img=null,delete r[t]}}};return r[t]={img:o,callbacks:i?[i]:[]},o.addEventListener("load",a),o.addEventListener("error",l),o.src=t,o},_loadResIterator:function(t,i,n){var r=this,o=null,s=t.type;s?(s="."+s.toLowerCase(),o=t.src?t.src:t.name+s):(o=t,s=cc.path.extname(o));var a=r.getRes(o);if(a)return n(null,a);var h=null;if(s&&(h=e[s.toLowerCase()]),!h)return cc.error("loader for ["+s+"] not exists!"),n();var l=o;if(!c.test(o)){var u=h.getBasePath?h.getBasePath():r.resPath;l=r.getUrl(u,o)}cc.game.config.noCache&&"string"==typeof l&&(l+=r._noCacheRex.test(l)?"&_t="+(new Date-0):"?_t="+(new Date-0)),h.load(l,o,t,function(t,e){t?(cc.log(t),r.cache[o]=null,delete r.cache[o],n({status:520,errorMessage:t},null)):(r.cache[o]=e,n(null,e))})},_noCacheRex:/\?/,getUrl:function(t,n){var r=this,c=cc.path;if(void 0!==t&&void 0===n){n=t;var o=c.extname(n);o=o?o.toLowerCase():"";var s=e[o];t=s&&s.getBasePath?s.getBasePath():r.resPath}if(n=cc.path.join(t||"",n),n.match(/[\/(\\\\)]lang[\/(\\\\)]/i)){if(i[n])return i[n];var a=c.extname(n)||"";n=i[n]=n.substring(0,n.length-a.length)+"_"+cc.sys.language+a}return n},load:function(t,e,i){var n=this,r=arguments.length;if(0===r)throw new Error("arguments error!");3===r?"function"==typeof e&&(e="function"==typeof i?{trigger:e,cb:i}:{cb:e,cbTarget:i}):2===r?"function"==typeof e&&(e={cb:e}):1===r&&(e={}),t instanceof Array||(t=[t]);var c=new cc.AsyncPool(t,0,function(t,i,r,c){n._loadResIterator(t,i,function(t){var i=Array.prototype.slice.call(arguments,1);e.trigger&&e.trigger.call(e.triggerTarget,i[0],c.size,c.finishedSize),r(t,i[0])})},e.cb,e.cbTarget);return c.flow(),c},_handleAliases:function(t,e){var i=[];for(var r in t){var c=t[r];n[r]=c,i.push(c)}this.load(i,e)},loadAliases:function(t,e){var i=this,n=i.getRes(t);n?i._handleAliases(n.filenames,e):i.load(t,function(t,n){i._handleAliases(n[0].filenames,e)})},register:function(t,i){if(t&&i){if("string"==typeof t)return e[t.trim().toLowerCase()]=i;for(var n=0,r=t.length;n<r;n++)e["."+t[n].trim().toLowerCase()]=i}},getRes:function(t){return this.cache[t]||this.cache[n[t]]},_getAliase:function(t){return n[t]},release:function(t){var e=this.cache,i=r[t];i&&(i.img=null,delete r[t]),delete e[t],delete e[n[t]],delete n[t]},releaseAll:function(){var t=this.cache;for(var e in t)delete t[e];for(var e in n)delete n[e]}}}(),cc.formatStr=function(){var t=arguments,e=t.length;if(e<1)return"";var i=t[0],n=!0;"object"==typeof i&&(n=!1);for(var r=1;r<e;++r){var c=t[r];if(n)for(;;){var o=null;if("number"==typeof c&&(o=i.match(/(%d)|(%s)/))){i=i.replace(/(%d)|(%s)/,c);break}o=i.match(/%s/),o?i=i.replace(/%s/,c):i+="    "+c;break}else i+="    "+c}return i},function(){function t(t){var e=cc.game.CONFIG_KEY,i=parseInt(t[e.renderMode])||0;(isNaN(i)||i>2||i<0)&&(t[e.renderMode]=0),cc._renderType=cc.game.RENDER_TYPE_CANVAS,cc._supportRender=!1,0===i?cc.sys.capabilities.opengl?(cc._renderType=cc.game.RENDER_TYPE_WEBGL,cc._supportRender=!0):cc.sys.capabilities.canvas&&(cc._renderType=cc.game.RENDER_TYPE_CANVAS,cc._supportRender=!0):1===i&&cc.sys.capabilities.canvas?(cc._renderType=cc.game.RENDER_TYPE_CANVAS,cc._supportRender=!0):2===i&&cc.sys.capabilities.opengl&&(cc._renderType=cc.game.RENDER_TYPE_WEBGL,cc._supportRender=!0)}function e(t,i,n){if(a[i])return null;n=n||"";var r=[],c=t[i];if(!c)throw new Error("can not find module ["+i+"]");for(var o=cc.path,s=0,h=c.length;s<h;s++){var l=c[s];if(!a[l]){var u=o.extname(l);if(u)".js"===u.toLowerCase()&&r.push(o.join(n,l));else{var _=e(t,l,n);_&&(r=r.concat(_))}a[l]=1}}return r}function i(t){cc._initDebugSetting&&cc._initDebugSetting(t[cc.game.CONFIG_KEY.debugMode]),cc._engineLoaded=!0,cc.log(cc.ENGINE_VERSION),l&&l()}function n(t){var n=cc.game.CONFIG_KEY,r=t[n.engineDir],c=cc.loader;if(cc.Class)i(t);else{var o=cc.path.join(r,"moduleConfig.json");c.loadJson(o,function(n,c){if(n)throw new Error(n);var o=t.modules||[],s=c.module,a=[];cc.sys.capabilities.opengl&&o.indexOf("base4webgl")<0?o.splice(0,0,"base4webgl"):o.indexOf("core")<0&&o.splice(0,0,"core");for(var h=0,l=o.length;h<l;h++){var u=e(s,o[h],r);u&&(a=a.concat(u))}cc.loader.loadJsWithImg(a,function(e){if(e)throw e;i(t)})})}}function r(){this.removeEventListener("load",r,!1),n(cc.game.config)}var c=document.createElement("canvas"),o=document.createElement("canvas");cc.create3DContext=function(t,e){for(var i=["webgl","experimental-webgl","webkit-3d","moz-webgl"],n=null,r=0;r<i.length;++r){try{n=t.getContext(i[r],e)}catch(t){}if(n)break}return n};var s=function(){cc.sys={};var t=cc.sys;t.LANGUAGE_ENGLISH="en",t.LANGUAGE_CHINESE="zh",t.LANGUAGE_FRENCH="fr",t.LANGUAGE_ITALIAN="it",t.LANGUAGE_GERMAN="de",t.LANGUAGE_SPANISH="es",t.LANGUAGE_DUTCH="du",t.LANGUAGE_RUSSIAN="ru",t.LANGUAGE_KOREAN="ko",t.LANGUAGE_JAPANESE="ja",t.LANGUAGE_HUNGARIAN="hu",t.LANGUAGE_PORTUGUESE="pt",t.LANGUAGE_ARABIC="ar",t.LANGUAGE_NORWEGIAN="no",t.LANGUAGE_POLISH="pl",t.LANGUAGE_UNKNOWN="unkonwn",t.OS_IOS="iOS",t.OS_ANDROID="Android",t.OS_WINDOWS="Windows",t.OS_MARMALADE="Marmalade",t.OS_LINUX="Linux",t.OS_BADA="Bada",t.OS_BLACKBERRY="Blackberry",t.OS_OSX="OS X",t.OS_WP8="WP8",t.OS_WINRT="WINRT",t.OS_UNKNOWN="Unknown",t.UNKNOWN=-1,t.WIN32=0,t.LINUX=1,t.MACOS=2,t.ANDROID=3,t.IPHONE=4,t.IPAD=5,t.BLACKBERRY=6,t.NACL=7,t.EMSCRIPTEN=8,t.TIZEN=9,t.WINRT=10,t.WP8=11,t.MOBILE_BROWSER=100,t.DESKTOP_BROWSER=101,t.BROWSER_TYPE_WECHAT="wechat",t.BROWSER_TYPE_ANDROID="androidbrowser",t.BROWSER_TYPE_IE="ie",t.BROWSER_TYPE_QQ="qqbrowser",t.BROWSER_TYPE_MOBILE_QQ="mqqbrowser",t.BROWSER_TYPE_UC="ucbrowser",t.BROWSER_TYPE_360="360browser",t.BROWSER_TYPE_BAIDU_APP="baiduboxapp",t.BROWSER_TYPE_BAIDU="baidubrowser",t.BROWSER_TYPE_MAXTHON="maxthon",t.BROWSER_TYPE_OPERA="opera",t.BROWSER_TYPE_OUPENG="oupeng",t.BROWSER_TYPE_MIUI="miuibrowser",t.BROWSER_TYPE_FIREFOX="firefox",t.BROWSER_TYPE_SAFARI="safari",t.BROWSER_TYPE_CHROME="chrome",t.BROWSER_TYPE_LIEBAO="liebao",t.BROWSER_TYPE_QZONE="qzone",t.BROWSER_TYPE_SOUGOU="sogou",t.BROWSER_TYPE_UNKNOWN="unknown",t.isNative=!1;var e=window,i=e.navigator,n=document,r=n.documentElement,s=i.userAgent.toLowerCase();t.isMobile=s.indexOf("mobile")!==-1||s.indexOf("android")!==-1,t.platform=t.isMobile?t.MOBILE_BROWSER:t.DESKTOP_BROWSER;var a=i.language;a=a?a:i.browserLanguage,a=a?a.split("-")[0]:t.LANGUAGE_ENGLISH,t.language=a;var h=!1,l=!1,u="",_=0,d=/android (\d+(?:\.\d+)+)/i.exec(s)||/android (\d+(?:\.\d+)+)/i.exec(i.platform);d&&(h=!0,u=d[1]||"",_=parseInt(u)||0),d=/(iPad|iPhone|iPod).*OS ((\d+_?){2,3})/i.exec(s),d&&(l=!0,u=d[2]||"",_=parseInt(u)||0);var f=t.OS_UNKNOWN;i.appVersion.indexOf("Win")!==-1?f=t.OS_WINDOWS:l?f=t.OS_IOS:i.appVersion.indexOf("Mac")!==-1?f=t.OS_OSX:i.appVersion.indexOf("X11")!==-1&&i.appVersion.indexOf("Linux")===-1?f=t.OS_UNIX:h?f=t.OS_ANDROID:i.appVersion.indexOf("Linux")!==-1&&(f=t.OS_LINUX),t.os=f,t.osVersion=u,t.osMainVersion=_,t.browserType=t.BROWSER_TYPE_UNKNOWN,function(){var e=/mqqbrowser|sogou|qzone|liebao|micromessenger|ucbrowser|360 aphone|360browser|baiduboxapp|baidubrowser|maxthon|mxbrowser|trident|miuibrowser/i,i=/qqbrowser|chrome|safari|firefox|opr|oupeng|opera/i,n=e.exec(s);n||(n=i.exec(s));var r=n?n[0]:t.BROWSER_TYPE_UNKNOWN;"micromessenger"===r?r=t.BROWSER_TYPE_WECHAT:"safari"===r&&s.match(/android.*applewebkit/)?r=t.BROWSER_TYPE_ANDROID:"trident"===r?r=t.BROWSER_TYPE_IE:"360 aphone"===r?r=t.BROWSER_TYPE_360:"mxbrowser"===r?r=t.BROWSER_TYPE_MAXTHON:"opr"===r&&(r=t.BROWSER_TYPE_OPERA),t.browserType=r}(),t.browserVersion="",function(){var e=/(micromessenger|qq|mx|maxthon|baidu|sogou)(mobile)?(browser)?\/?([\d.]+)/i,i=/(msie |rv:|firefox|chrome|ucbrowser|oupeng|opera|opr|safari|miui)(mobile)?(browser)?\/?([\d.]+)/i,n=s.match(e);n||(n=s.match(i)),t.browserVersion=n?n[4]:""}();var p=window.innerWidth||document.documentElement.clientWidth,g=window.innerHeight||document.documentElement.clientHeight,m=window.devicePixelRatio||1;if(t.windowPixelResolution={width:m*p,height:m*g},t._checkWebGLRenderMode=function(){if(cc._renderType!==cc.game.RENDER_TYPE_WEBGL)throw new Error("This feature supports WebGL render mode only.")},t._supportCanvasNewBlendModes=function(){var t=c;t.width=1,t.height=1;var e=t.getContext("2d");e.fillStyle="#000",e.fillRect(0,0,1,1),e.globalCompositeOperation="multiply";var i=o;i.width=1,i.height=1;var n=i.getContext("2d");return n.fillStyle="#fff",n.fillRect(0,0,1,1),e.drawImage(i,0,0,1,1),0===e.getImageData(0,0,1,1).data[0]}(),cc.sys.isMobile){var v=document.createElement("style");v.type="text/css",document.body.appendChild(v),v.textContent="body,canvas,div{ -moz-user-select: none;-webkit-user-select: none;-ms-user-select: none;-khtml-user-select: none;-webkit-tap-highlight-color:rgba(0,0,0,0);}"}try{var T=t.localStorage=e.localStorage;T.setItem("storage",""),T.removeItem("storage"),T=null}catch(e){var y=function(){cc.warn("Warning: localStorage isn't enabled. Please confirm browser cookie or privacy option")};t.localStorage={getItem:y,setItem:y,removeItem:y,clear:y}}var S=!!c.getContext("2d"),C=!1;if(e.WebGLRenderingContext){var E=document.createElement("CANVAS");try{var b=cc.create3DContext(E,{stencil:!0});if(b&&(C=!0),C&&t.os===t.OS_ANDROID){var x=parseFloat(t.browserVersion);switch(t.browserType){case t.BROWSER_TYPE_MOBILE_QQ:case t.BROWSER_TYPE_BAIDU:case t.BROWSER_TYPE_BAIDU_APP:C=x>=6.2;break;case t.BROWSER_TYPE_CHROME:C=x>=30;break;case t.BROWSER_TYPE_ANDROID:t.osMainVersion&&t.osMainVersion>=5&&(C=!0);break;case t.BROWSER_TYPE_UNKNOWN:case t.BROWSER_TYPE_360:case t.BROWSER_TYPE_MIUI:case t.BROWSER_TYPE_UC:C=!1}}}catch(t){}E=null}var A=t.capabilities={canvas:S,opengl:C};(void 0!==r.ontouchstart||void 0!==n.ontouchstart||i.msPointerEnabled)&&(A.touches=!0),void 0!==r.onmouseup&&(A.mouse=!0),void 0!==r.onkeyup&&(A.keyboard=!0),(e.DeviceMotionEvent||e.DeviceOrientationEvent)&&(A.accelerometer=!0),t.garbageCollect=function(){},t.dumpRoot=function(){},t.restartVM=function(){},t.cleanScript=function(t){},t.isObjectValid=function(t){return!!t},t.dump=function(){var t=this,e="";e+="isMobile : "+t.isMobile+"\r\n",e+="language : "+t.language+"\r\n",e+="browserType : "+t.browserType+"\r\n",e+="browserVersion : "+t.browserVersion+"\r\n",e+="capabilities : "+JSON.stringify(t.capabilities)+"\r\n",e+="os : "+t.os+"\r\n",e+="osVersion : "+t.osVersion+"\r\n",e+="platform : "+t.platform+"\r\n",e+="Using "+(cc._renderType===cc.game.RENDER_TYPE_WEBGL?"WEBGL":"CANVAS")+" renderer.\r\n",cc.log(e)},t.openURL=function(t){window.open(t)}};s(),c=null,o=null,cc.log=cc.warn=cc.error=cc.assert=function(){};var a={},h=!1,l=null;cc._engineLoaded=!1,cc.initEngine=function(e,i){if(h){var c=l;return void(l=function(){c&&c(),i&&i()})}l=i,!cc.game.config&&e?cc.game.config=e:cc.game.config||cc.game._loadConfig(),e=cc.game.config,t(e),document.body?n(e):cc._addEventListener(window,"load",r,!1),h=!0}}(),cc.game={DEBUG_MODE_NONE:0,DEBUG_MODE_INFO:1,DEBUG_MODE_WARN:2,DEBUG_MODE_ERROR:3,DEBUG_MODE_INFO_FOR_WEB_PAGE:4,DEBUG_MODE_WARN_FOR_WEB_PAGE:5,DEBUG_MODE_ERROR_FOR_WEB_PAGE:6,EVENT_HIDE:"game_on_hide",EVENT_SHOW:"game_on_show",EVENT_RESIZE:"game_on_resize",EVENT_RENDERER_INITED:"renderer_inited",RENDER_TYPE_CANVAS:0,RENDER_TYPE_WEBGL:1,RENDER_TYPE_OPENGL:2,_eventHide:null,_eventShow:null,CONFIG_KEY:{width:"width",height:"height",engineDir:"engineDir",modules:"modules",debugMode:"debugMode",showFPS:"showFPS",frameRate:"frameRate",id:"id",renderMode:"renderMode",jsList:"jsList"},_paused:!0,_prepareCalled:!1,_prepared:!1,_rendererInitialized:!1,_renderContext:null,_intervalId:null,_lastTime:null,_frameTime:null,frame:null,container:null,canvas:null,config:null,onStart:null,onStop:null,setFrameRate:function(t){var e=this,i=e.config,n=e.CONFIG_KEY;i[n.frameRate]=t,e._intervalId&&window.cancelAnimationFrame(e._intervalId),e._paused=!0,e._setAnimFrame(),e._runMainLoop()},step:function(){cc.director.mainLoop()},pause:function(){this._paused||(this._paused=!0,cc.audioEngine&&(cc.audioEngine.stopAllEffects(),cc.audioEngine.pauseMusic()),this._intervalId&&window.cancelAnimationFrame(this._intervalId),this._intervalId=0)},resume:function(){this._paused&&(this._paused=!1,cc.audioEngine&&cc.audioEngine.resumeMusic(),this._runMainLoop())},isPaused:function(){return this._paused},restart:function(){cc.director.popToSceneStackLevel(0),cc.audioEngine&&cc.audioEngine.end(),cc.game.onStart()},end:function(){close()},prepare:function(t){var e=this,i=e.config,n=e.CONFIG_KEY;if(this._loadConfig(),this._prepared)return void(t&&t());if(!this._prepareCalled){if(cc._engineLoaded){this._prepareCalled=!0,this._initRenderer(i[n.width],i[n.height]),cc.view=cc.EGLView._getInstance(),cc.director=cc.Director._getInstance(),cc.director.setOpenGLView&&cc.director.setOpenGLView(cc.view),cc.winSize=cc.director.getWinSize(),this._initEvents(),this._setAnimFrame(),this._runMainLoop();var r=i[n.jsList];return void(r?cc.loader.loadJsWithImg(r,function(i){if(i)throw new Error(i);e._prepared=!0,t&&t()}):t&&t())}cc.initEngine(this.config,function(){e.prepare(t)})}},run:function(t,e){"function"==typeof t?cc.game.onStart=t:(t&&("string"==typeof t?(cc.game.config||this._loadConfig(),cc.game.config[cc.game.CONFIG_KEY.id]=t):cc.game.config=t),"function"==typeof e&&(cc.game.onStart=e)),this.prepare(cc.game.onStart&&cc.game.onStart.bind(cc.game))},_setAnimFrame:function(){this._lastTime=new Date,this._frameTime=1e3/cc.game.config[cc.game.CONFIG_KEY.frameRate],cc.sys.os===cc.sys.OS_IOS&&cc.sys.browserType===cc.sys.BROWSER_TYPE_WECHAT||60!==cc.game.config[cc.game.CONFIG_KEY.frameRate]?(window.requestAnimFrame=this._stTime,window.cancelAnimationFrame=this._ctTime):(window.requestAnimFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||this._stTime,window.cancelAnimationFrame=window.cancelAnimationFrame||window.cancelRequestAnimationFrame||window.msCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.webkitCancelRequestAnimationFrame||window.msCancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.oCancelAnimationFrame||this._ctTime)},_stTime:function(t){var e=(new Date).getTime(),i=Math.max(0,cc.game._frameTime-(e-cc.game._lastTime)),n=window.setTimeout(function(){t()},i);return cc.game._lastTime=e+i,n},_ctTime:function(t){window.clearTimeout(t)},_runMainLoop:function(){var t,e=this,i=e.config,n=e.CONFIG_KEY,r=cc.director;r.setDisplayStats(i[n.showFPS]),t=function(){e._paused||(r.mainLoop(),e._intervalId&&window.cancelAnimationFrame(e._intervalId),e._intervalId=window.requestAnimFrame(t))},window.requestAnimFrame(t),e._paused=!1},_loadConfig:function(){if(this.config)return void this._initConfig(this.config);if(document.ccConfig)this._initConfig(document.ccConfig);else{var t={};try{for(var e=document.getElementsByTagName("script"),i=0;i<e.length;i++){var n=e[i].getAttribute("cocos");if(""===n||n)break}var r,c,o;i<e.length&&(r=e[i].src,r&&(o=/(.*)\//.exec(r)[0],cc.loader.resPath=o,r=cc.path.join(o,"project.json")),c=cc.loader._loadTxtSync(r)),c||(c=cc.loader._loadTxtSync("project.json")),t=JSON.parse(c)}catch(t){cc.log("Failed to read or parse project.json")}this._initConfig(t)}},_initConfig:function(t){var e=this.CONFIG_KEY,i=t[e.modules];t[e.showFPS]="undefined"==typeof t[e.showFPS]||t[e.showFPS],t[e.engineDir]=t[e.engineDir]||"frameworks/cocos2d-html5",null==t[e.debugMode]&&(t[e.debugMode]=0),t[e.frameRate]=t[e.frameRate]||60,null==t[e.renderMode]&&(t[e.renderMode]=0),null==t[e.registerSystemEvent]&&(t[e.registerSystemEvent]=!0),i&&i.indexOf("core")<0&&i.splice(0,0,"core"),i&&(t[e.modules]=i),this.config=t},_initRenderer:function(t,e){if(!this._rendererInitialized){if(!cc._supportRender)throw new Error("The renderer doesn't support the renderMode "+this.config[this.CONFIG_KEY.renderMode]);var i,n,r=this.config[cc.game.CONFIG_KEY.id],c=window,o=cc.$(r)||cc.$("#"+r);"CANVAS"===o.tagName?(t=t||o.width,e=e||o.height,this.canvas=cc._canvas=i=o,this.container=cc.container=n=document.createElement("DIV"),i.parentNode&&i.parentNode.insertBefore(n,i)):("DIV"!==o.tagName&&cc.log("Warning: target element is not a DIV or CANVAS"),t=t||o.clientWidth,e=e||o.clientHeight,this.canvas=cc._canvas=i=document.createElement("CANVAS"),this.container=cc.container=n=document.createElement("DIV"),o.appendChild(n)),n.setAttribute("id","Cocos2dGameContainer"),n.appendChild(i),this.frame=n.parentNode===document.body?document.documentElement:n.parentNode,i.addClass("gameCanvas"),i.setAttribute("width",t||480),i.setAttribute("height",e||320),i.setAttribute("tabindex",99),cc._renderType===cc.game.RENDER_TYPE_WEBGL&&(this._renderContext=cc._renderContext=cc.webglContext=cc.create3DContext(i,{stencil:!0,antialias:!cc.sys.isMobile,alpha:!1})),this._renderContext?(cc.renderer=cc.rendererWebGL,c.gl=this._renderContext,cc.renderer.init(),cc.shaderCache._init(),cc._drawingUtil=new cc.DrawingPrimitiveWebGL(this._renderContext),cc.textureCache._initializingRenderer(),cc.glExt={},cc.glExt.instanced_arrays=c.gl.getExtension("ANGLE_instanced_arrays"),cc.glExt.element_uint=c.gl.getExtension("OES_element_index_uint")):(cc._renderType=cc.game.RENDER_TYPE_CANVAS,cc.renderer=cc.rendererCanvas,this._renderContext=cc._renderContext=new cc.CanvasContextWrapper(i.getContext("2d")),cc._drawingUtil=cc.DrawingPrimitiveCanvas?new cc.DrawingPrimitiveCanvas(this._renderContext):null),cc._gameDiv=n,cc.game.canvas.oncontextmenu=function(){if(!cc._isContextMenuEnable)return!1},this.dispatchEvent(this.EVENT_RENDERER_INITED,!0),this._rendererInitialized=!0}},_initEvents:function(){var t,e,i=window;this._eventHide=this._eventHide||new cc.EventCustom(this.EVENT_HIDE),this._eventHide.setUserData(this),this._eventShow=this._eventShow||new cc.EventCustom(this.EVENT_SHOW),this._eventShow.setUserData(this),this.config[this.CONFIG_KEY.registerSystemEvent]&&cc.inputManager.registerSystemEvent(this.canvas),cc.isUndefined(document.hidden)?cc.isUndefined(document.mozHidden)?cc.isUndefined(document.msHidden)?cc.isUndefined(document.webkitHidden)||(t="webkitHidden",e="webkitvisibilitychange"):(t="msHidden",e="msvisibilitychange"):(t="mozHidden",e="mozvisibilitychange"):(t="hidden",e="visibilitychange");var n=function(){cc.eventManager&&cc.game._eventHide&&cc.eventManager.dispatchEvent(cc.game._eventHide)},r=function(){cc.eventManager&&cc.game._eventShow&&cc.eventManager.dispatchEvent(cc.game._eventShow)};t?document.addEventListener(e,function(){document[t]?n():r()},!1):(i.addEventListener("blur",n,!1),i.addEventListener("focus",r,!1)),navigator.userAgent.indexOf("MicroMessenger")>-1&&(i.onfocus=function(){r()}),"onpageshow"in window&&"onpagehide"in window&&(i.addEventListener("pagehide",n,!1),i.addEventListener("pageshow",r,!1)),cc.eventManager.addCustomListener(cc.game.EVENT_HIDE,function(){cc.game.pause()}),cc.eventManager.addCustomListener(cc.game.EVENT_SHOW,function(){cc.game.resume()})}},Function.prototype.bind=Function.prototype.bind||function(t){if(!cc.isFunction(this))throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var e=Array.prototype.slice.call(arguments,1),i=this,n=function(){},r=function(){return i.apply(this instanceof n&&t?this:t,e.concat(Array.prototype.slice.call(arguments)))};return n.prototype=this.prototype,r.prototype=new n,r},cc._urlRegExp=new RegExp("^(?:(?:https?|ftp)://)(?:\\S+(?::\\S*)?@)?(?:(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[1-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)(?:\\.(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)*(?:\\.(?:[a-z\\u00a1-\\uffff]{2,}))|(?:localhost))(?::\\d{2,5})?(?:/\\S*)?$","i"),cc.SimplePool=function(){this._pool=[]},cc.SimplePool.prototype={constructor:cc.SimplePool,size:function(){return this._pool.length},put:function(t){t&&this._pool.indexOf(t)===-1&&this._pool.unshift(t)},get:function(){var t=this._pool.length-1;if(t<0)return null;var e=this._pool[t];return this._pool.length=t,e},find:function(t,e){var i,n,r,c=this._pool,o=c.length-1;for(n=c.length;n>=0;--n)if(r=c[n],i=t(n,r))return c[n]=c[o],c.length=o,r;if(e){var s=e();if(s>=0)return c[s]=c[o],c.length=o,r}return null}},cc.EventHelper=function(){},cc.EventHelper.prototype={constructor:cc.EventHelper,apply:function(t){t.addEventListener=cc.EventHelper.prototype.addEventListener,t.hasEventListener=cc.EventHelper.prototype.hasEventListener,t.removeEventListener=cc.EventHelper.prototype.removeEventListener,t.dispatchEvent=cc.EventHelper.prototype.dispatchEvent},addEventListener:function(t,e,i){if("load"===t&&this._textureLoaded)return void setTimeout(function(){e.call(i)},0);void 0===this._listeners&&(this._listeners={});var n=this._listeners;void 0===n[t]&&(n[t]=[]),this.hasEventListener(t,e,i)||n[t].push({callback:e,eventTarget:i})},hasEventListener:function(t,e,i){if(void 0===this._listeners)return!1;var n=this._listeners;if(void 0!==n[t])for(var r=0,c=n.length;r<c;r++){var o=n[r];if(o.callback===e&&o.eventTarget===i)return!0}return!1},removeEventListener:function(t,e,i){if(void 0!==this._listeners){var n=this._listeners,r=n[t];if(void 0!==r)for(var c=0;c<r.length;){var o=r[c];o.eventTarget===i&&o.callback===e?r.splice(c,1):c++}}},removeEventTarget:function(t,e,i){if(void 0!==this._listeners){var n=this._listeners,r=n[t];if(void 0!==r)for(var c=0;c<r.length;){var o=r[c];o.eventTarget===i?r.splice(c,1):c++}}},dispatchEvent:function(t,e){if(void 0!==this._listeners){null==e&&(e=!0);var i=this._listeners,n=i[t];if(void 0!==n){for(var r=[],c=n.length,o=0;o<c;o++)r[o]=n[o];for(o=0;o<c;o++)r[o].callback.call(r[o].eventTarget,this);e&&(n.length=0)}}}},cc.EventHelper.prototype.apply(cc.game);var cc=cc||{};if(cc._loadingImage="data:image/gif;base64,R0lGODlhEAAQALMNAD8/P7+/vyoqKlVVVX9/fxUVFUBAQGBgYMDAwC8vL5CQkP///wAAAP///wAAAAAAACH/C05FVFNDQVBFMi4wAwEAAAAh+QQFAAANACwAAAAAEAAQAAAEO5DJSau9OOvNex0IMnDIsiCkiW6g6BmKYlBFkhSUEgQKlQCARG6nEBwOgl+QApMdCIRD7YZ5RjlGpCUCACH5BAUAAA0ALAAAAgAOAA4AAAQ6kLGB0JA4M7QW0hrngRllkYyhKAYqKUGguAws0ypLS8JxCLQDgXAIDg+FRKIA6v0SAECCBpXSkstMBAAh+QQFAAANACwAAAAACgAQAAAEOJDJORAac6K1kDSKYmydpASBUl0mqmRfaGTCcQgwcxDEke+9XO2WkxQSiUIuAQAkls0n7JgsWq8RACH5BAUAAA0ALAAAAAAOAA4AAAQ6kMlplDIzTxWC0oxwHALnDQgySAdBHNWFLAvCukc215JIZihVIZEogDIJACBxnCSXTcmwGK1ar1hrBAAh+QQFAAANACwAAAAAEAAKAAAEN5DJKc4RM+tDyNFTkSQF5xmKYmQJACTVpQSBwrpJNteZSGYoFWjIGCAQA2IGsVgglBOmEyoxIiMAIfkEBQAADQAsAgAAAA4ADgAABDmQSVZSKjPPBEDSGucJxyGA1XUQxAFma/tOpDlnhqIYN6MEAUXvF+zldrMBAjHoIRYLhBMqvSmZkggAIfkEBQAADQAsBgAAAAoAEAAABDeQyUmrnSWlYhMASfeFVbZdjHAcgnUQxOHCcqWylKEohqUEAYVkgEAMfkEJYrFA6HhKJsJCNFoiACH5BAUAAA0ALAIAAgAOAA4AAAQ3kMlJq704611SKloCAEk4lln3DQgyUMJxCBKyLAh1EMRR3wiDQmHY9SQslyIQUMRmlmVTIyRaIgA7",
cc._fpsImage="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAAgCAYAAAD9qabkAAAKQ2lDQ1BJQ0MgcHJvZmlsZQAAeNqdU3dYk/cWPt/3ZQ9WQtjwsZdsgQAiI6wIyBBZohCSAGGEEBJAxYWIClYUFRGcSFXEgtUKSJ2I4qAouGdBiohai1VcOO4f3Ke1fXrv7e371/u855zn/M55zw+AERImkeaiagA5UoU8Otgfj09IxMm9gAIVSOAEIBDmy8JnBcUAAPADeXh+dLA//AGvbwACAHDVLiQSx+H/g7pQJlcAIJEA4CIS5wsBkFIAyC5UyBQAyBgAsFOzZAoAlAAAbHl8QiIAqg0A7PRJPgUA2KmT3BcA2KIcqQgAjQEAmShHJAJAuwBgVYFSLALAwgCgrEAiLgTArgGAWbYyRwKAvQUAdo5YkA9AYACAmUIszAAgOAIAQx4TzQMgTAOgMNK/4KlfcIW4SAEAwMuVzZdL0jMUuJXQGnfy8ODiIeLCbLFCYRcpEGYJ5CKcl5sjE0jnA0zODAAAGvnRwf44P5Dn5uTh5mbnbO/0xaL+a/BvIj4h8d/+vIwCBAAQTs/v2l/l5dYDcMcBsHW/a6lbANpWAGjf+V0z2wmgWgrQevmLeTj8QB6eoVDIPB0cCgsL7SViob0w44s+/zPhb+CLfvb8QB7+23rwAHGaQJmtwKOD/XFhbnauUo7nywRCMW735yP+x4V//Y4p0eI0sVwsFYrxWIm4UCJNx3m5UpFEIcmV4hLpfzLxH5b9CZN3DQCshk/ATrYHtctswH7uAQKLDljSdgBAfvMtjBoLkQAQZzQyefcAAJO/+Y9AKwEAzZek4wAAvOgYXKiUF0zGCAAARKCBKrBBBwzBFKzADpzBHbzAFwJhBkRADCTAPBBCBuSAHAqhGJZBGVTAOtgEtbADGqARmuEQtMExOA3n4BJcgetwFwZgGJ7CGLyGCQRByAgTYSE6iBFijtgizggXmY4EImFINJKApCDpiBRRIsXIcqQCqUJqkV1II/ItchQ5jVxA+pDbyCAyivyKvEcxlIGyUQPUAnVAuagfGorGoHPRdDQPXYCWomvRGrQePYC2oqfRS+h1dAB9io5jgNExDmaM2WFcjIdFYIlYGibHFmPlWDVWjzVjHVg3dhUbwJ5h7wgkAouAE+wIXoQQwmyCkJBHWExYQ6gl7CO0EroIVwmDhDHCJyKTqE+0JXoS+cR4YjqxkFhGrCbuIR4hniVeJw4TX5NIJA7JkuROCiElkDJJC0lrSNtILaRTpD7SEGmcTCbrkG3J3uQIsoCsIJeRt5APkE+S+8nD5LcUOsWI4kwJoiRSpJQSSjVlP+UEpZ8yQpmgqlHNqZ7UCKqIOp9aSW2gdlAvU4epEzR1miXNmxZDy6Qto9XQmmlnafdoL+l0ugndgx5Fl9CX0mvoB+nn6YP0dwwNhg2Dx0hiKBlrGXsZpxi3GS+ZTKYF05eZyFQw1zIbmWeYD5hvVVgq9ip8FZHKEpU6lVaVfpXnqlRVc1U/1XmqC1SrVQ+rXlZ9pkZVs1DjqQnUFqvVqR1Vu6k2rs5Sd1KPUM9RX6O+X/2C+mMNsoaFRqCGSKNUY7fGGY0hFsYyZfFYQtZyVgPrLGuYTWJbsvnsTHYF+xt2L3tMU0NzqmasZpFmneZxzQEOxrHg8DnZnErOIc4NznstAy0/LbHWaq1mrX6tN9p62r7aYu1y7Rbt69rvdXCdQJ0snfU6bTr3dQm6NrpRuoW623XP6j7TY+t56Qn1yvUO6d3RR/Vt9KP1F+rv1u/RHzcwNAg2kBlsMThj8MyQY+hrmGm40fCE4agRy2i6kcRoo9FJoye4Ju6HZ+M1eBc+ZqxvHGKsNN5l3Gs8YWJpMtukxKTF5L4pzZRrmma60bTTdMzMyCzcrNisyeyOOdWca55hvtm82/yNhaVFnMVKizaLx5balnzLBZZNlvesmFY+VnlW9VbXrEnWXOss623WV2xQG1ebDJs6m8u2qK2brcR2m23fFOIUjynSKfVTbtox7PzsCuya7AbtOfZh9iX2bfbPHcwcEh3WO3Q7fHJ0dcx2bHC866ThNMOpxKnD6VdnG2ehc53zNRemS5DLEpd2lxdTbaeKp26fesuV5RruutK10/Wjm7ub3K3ZbdTdzD3Ffav7TS6bG8ldwz3vQfTw91jicczjnaebp8LzkOcvXnZeWV77vR5Ps5wmntYwbcjbxFvgvct7YDo+PWX6zukDPsY+Ap96n4e+pr4i3z2+I37Wfpl+B/ye+zv6y/2P+L/hefIW8U4FYAHBAeUBvYEagbMDawMfBJkEpQc1BY0FuwYvDD4VQgwJDVkfcpNvwBfyG/ljM9xnLJrRFcoInRVaG/owzCZMHtYRjobPCN8Qfm+m+UzpzLYIiOBHbIi4H2kZmRf5fRQpKjKqLupRtFN0cXT3LNas5Fn7Z72O8Y+pjLk722q2cnZnrGpsUmxj7Ju4gLiquIF4h/hF8ZcSdBMkCe2J5MTYxD2J43MC52yaM5zkmlSWdGOu5dyiuRfm6c7Lnnc8WTVZkHw4hZgSl7I/5YMgQlAvGE/lp25NHRPyhJuFT0W+oo2iUbG3uEo8kuadVpX2ON07fUP6aIZPRnXGMwlPUit5kRmSuSPzTVZE1t6sz9lx2S05lJyUnKNSDWmWtCvXMLcot09mKyuTDeR55m3KG5OHyvfkI/lz89sVbIVM0aO0Uq5QDhZML6greFsYW3i4SL1IWtQz32b+6vkjC4IWfL2QsFC4sLPYuHhZ8eAiv0W7FiOLUxd3LjFdUrpkeGnw0n3LaMuylv1Q4lhSVfJqedzyjlKD0qWlQyuCVzSVqZTJy26u9Fq5YxVhlWRV72qX1VtWfyoXlV+scKyorviwRrjm4ldOX9V89Xlt2treSrfK7etI66Trbqz3Wb+vSr1qQdXQhvANrRvxjeUbX21K3nShemr1js20zcrNAzVhNe1bzLas2/KhNqP2ep1/XctW/a2rt77ZJtrWv913e/MOgx0VO97vlOy8tSt4V2u9RX31btLugt2PGmIbur/mft24R3dPxZ6Pe6V7B/ZF7+tqdG9s3K+/v7IJbVI2jR5IOnDlm4Bv2pvtmne1cFoqDsJB5cEn36Z8e+NQ6KHOw9zDzd+Zf7f1COtIeSvSOr91rC2jbaA9ob3v6IyjnR1eHUe+t/9+7zHjY3XHNY9XnqCdKD3x+eSCk+OnZKeenU4/PdSZ3Hn3TPyZa11RXb1nQ8+ePxd07ky3X/fJ897nj13wvHD0Ivdi2yW3S609rj1HfnD94UivW2/rZffL7Vc8rnT0Tes70e/Tf/pqwNVz1/jXLl2feb3vxuwbt24m3Ry4Jbr1+Hb27Rd3Cu5M3F16j3iv/L7a/eoH+g/qf7T+sWXAbeD4YMBgz8NZD+8OCYee/pT/04fh0kfMR9UjRiONj50fHxsNGr3yZM6T4aeypxPPyn5W/3nrc6vn3/3i+0vPWPzY8Av5i8+/rnmp83Lvq6mvOscjxx+8znk98ab8rc7bfe+477rfx70fmSj8QP5Q89H6Y8en0E/3Pud8/vwv94Tz+4A5JREAAAAGYktHRAD/AP8A/6C9p5MAAAAJcEhZcwAACxMAAAsTAQCanBgAAAAHdElNRQfcAgcQLxxUBNp/AAAQZ0lEQVR42u2be3QVVZbGv1N17829eRLyIKAEOiISEtPhJTJAYuyBDmhWjAEx4iAGBhxA4wABbVAMWUAeykMCM+HRTcBRWkNH2l5moS0LCCrQTkYeQWBQSCAIgYRXEpKbW/XNH5zS4noR7faPEeu31l0h4dSpvc+t/Z199jkFWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhY/H9D/MR9qfKnLj/00U71aqfJn9+HCkCR/Wk36ddsgyJ/1wF4fkDfqqm9/gPsUeTnVr6a2xlQfnxdI7zs0W7irzD17Ytb2WT7EeNv/r4ox1O3Quf2QP2pgt9utwfout4FQE8AVBSlnaRmfvAURQkg2RlAbwB9AThlW5L0GaiKojhJhgOIBqDa7XaPrusdPtr5kQwF0BVAAoBIABRCKDd5aFUhRDAAw57eAOwAhKIoupft3zoqhB1AqLwuHIBut9uFt02qqvqRDJR2dAEQJj/BAOjn56dqmma+xiaECAEQAWAggLsB6A6HQ2iaZggBhBAqgEAAnQB0kzaEmT4hAITT6VQ8Ho/HJAKKECJQtr8LwD1y/A1/vcdfEUIEyfZ9AcQbYvZ942Px88L2UwlJR0dH0EMPPbRj5syZPUeNGrXR7Xb/641xIwJ1XY9NSUlZm52dfW+XLl1w8uRJzJ8//+OGhoYJqqqe1TSt1Wsm9NN1PSIqKmr12rVrR5WUlHy1bdu2AQCumWc3IYRD1/UwVVXnFRQUTIuNjUVzczN2797dWFJSkq8oymZd15sAGAEnFEUJ1nX9nzIzM1dnZmZGh4SE4OTJk5g5c+Zf29vbp9pstrMej6fVOyhIhgAYU1hY+B+hoaGoqKg4XVlZea+XTULTNFdCQsLGiRMnPuR2u3UhBOV9eeDAAWXTpk095DUe6WsoyRE5OTlr0tLSAux2O/bs2cO5c+e+pijKUpIXSHaQVAGkvPLKK++6XK4OksJLCFlXV2cvKSlJBFAjhU+x2WwhHo9nUHp6+urMzMy7wsLCUF9fjxdffPHjxsbGiTab7WuPx9NiEutOuq4PyMjI+M+srKyYqKgoHD58GDNmzNjq8XhyVFU9b/q+LH7hBAEYu3PnTlZVVRFAGgCX6f/tAHoOHDjwa0p27txp/JO9e/f+QM7cipw9nfL3kQBKt2zZQpJ87rnn6mQmoHilw2EACs+cOUOSrK+vZ1NTE0nyo48+IoBpxswoBcMJ4Ndjx471kOTFixe5d+9ekqTH42H//v13A4jyzpAURfEH0H/OnDnthu1z5sw558MmFUCPWbNmnaMP3nrrLZoyDmP8Hl68eDFJ8siRI9/Yc+zYMQKYKdtAztrTrl27xptRXV1NAKMAOAyBBBA/Y8aMdpLs6Ojgxx9//E37+++//29yvFXppwvAwMcee8xjtDHsuXLlCqOjo//ia3wsfpkoALqFhoZuIckJEyackimm3dQmEMDUmpoakmRISMhhAHOHDx/eQJIbN24kgKEyMAHAFRMTs2XXrl1saWkhSZ0kp0+ffhrAr3wEW/S8efOukORLL72kA1gKYMPWrVtJkk899dRJAHeYrgsEsIQkjx8/TgDvAPjd448/3kaSb7zxBmUa7vC6z53BwcFbSHL9+vU6Sc6aNes8gF5ewWAH0PfVV18lSQL4DMBGIcQ6AKtcLleBFC2jXtFt8ODBe0iyoqKCAJYByC8qKmJDQwOzsrK+MAmqo1OnTveHhoa+GRkZ+XZkZOSWiIiIvzgcjk9mzpypkWRmZuZpmbYbGV4AgPnNzc1sa2sjgN0A5iQmJtaSZHl5OQHcb/K3s81mW0uSTU1NBFAFYFbfvn1Pk+Tbb79NAA8IIVzW42/hByA+Pz/fLR/2ZXIda05NI/z9/TeR5J49ewhgqlxTrtI0jY2NjQQw3zTLuWJiYjaUlJToS5Ys6fjkk080kwDEeAmADcA9GzZsIElGRUW9CyAWwLApU6Y0kOSKFSsog9QICGdERMTGsrIyZmVlEcC9AB4IDw/fTpLbtm0jgN94CUAnAJmVlZVcs2aNZ/LkyRdJcvbs2b4EwAkgZfPmzTxw4AABFAN4BkC6vFeUSewcAO5duXIlSTIhIaEawGMAxgKYAmAGgCS73e5vrKVk/yGythANYEhCQsIhkly+fDkBpKqqGmL6DgIALDKN/3yZpVWQZGVlJQE8aPI3KiMjo5okV61aRQAjAPQBMPfIkSN0u90EUCBtsPiFEwpgbn19PdetW2fM5N4zQ9ekpKQqkty0aRMBpMjiWM6JEydIkoqirJUFJ6iq6pAPVy8A6cZMehMBUACEuVyuFwG8HBwcPEIWx367ZMkSjSQXLVrUJouTRorrkAHdA8BdQogsAOsKCwtJkmPGjDkvMw2bDDo/ADEjRoz4XylyFbm5uY0mAbjLyyZ/AOOrq6tZVlbWsWDBgo69e/eyoqKCgwcPPg4gSQaoIRbp27dvN7KF+tLSUr28vJwFBQXtMpvpYRIM7+wrAkDeqVOnePbsWQIoNKfzpiXPg8uXLydJJicnNwF4f+nSpW6STEtLq5fjYwhk1wkTJtSQ5Ouvv04AqTKj+N2xY8dIkgEBAW/Ie1v8wncRegwZMmQvSfbr12+3Ua33WqPfOWbMmP0kWVpaSgCDZAqcfejQIWNZsEGKgvnh9gfQb9myZd8nAEJVVZtMkUNk8CcNHTq0liR1XWdYWNhmH1mJIme80OnTp18x1rp5eXkEsNJms92Fb7e/IgEsvHz5Mp999tkmAI/l5uZeMC0B7vEqqAYAyL106RJJsra2lpWVld+sucePH38ZQG+5NncBeOrgwYMkqbe3t/Po0aOsra011wAWyl0H7x0JJ4DE+fPnu0kyPT29DsDdUrBuyNKEEAkAdpw/f/6GeoEM8GUmfwEgPCIiopwkGxsbabPZPgOw6L777vvm4p49e26VGYjFLxUhhD+ApLKyMp44ccIoVnXybgbgzkcfffRzklyzZg0BDJYCMMmoCwQFBXkLgLGWvvcWAgBToSsKwNPTp09vMR7UuLi4rwH0lgU8c/Db5ezbeeTIkRWzZ8++aMxu+fn5BPCADBwHgP4LFy701NXVEUAJgAnPP/98kyxMNgHo53A4zH77BQQETMvPz7+Um5vbBuAlAFMSExPPmdbVL0qh8Acw8fDhw5SCchVAEYAVb775JknyhRdeaJYztHfxMwLAaqNwCGC2FArv8x0hAHKNLGPKlCme5OTk/Zs3bzb7O0wKiiG8KXl5ed8IxenTp0mSR48e1UmyW7duWywBuD2xyQcgFECgoih+8H1gyJgZV5Lkyy+/3CbTRIePtl2HDBmyw1QBHyGDdXZdXR1JUghRKkXBjOMHCoBdpr0L3nvvPZLkF198wejo6O0A4lVVDTb74HQ6AwD8Wq7Jh8rgGgDgQ13XjVR8qaxJuADMbmlpYXl5uV5UVNRWUFDgfv/993Vj/ZydnU1c37eHXML4S3viAcQqitJD2l104cIFY8lTKsXSBWBMVVWVcd9yed2A1NTUQ6Zl00CvLMMOoHdubm6zFIlWOf5+PsY/Kj09vdrU11QAwwGsv3jxIk21m2DZr10I0RXAuAcffPBgaWkpV69eTYfDcdiwUxY0w6xw+flX8L1xApjevXv3lREREaW6rofB93aPDUDQpEmTMgHgtddeqwBwEd/utZvpqK6uPgEAcXFxkA94NwB9unfvjrNnz4LklwDcf08iIqv66Zs2bXrl4YcfxooVKxAbG7uqrq5uAYA2TdOEqqpGYIi2tjbl6aeffu/YsWPv5uTk7JaC1wHg4Pnz542MwoVvTx+21dbWYvjw4WLixIl+2dnZ9lGjRgmSTE1NRUpKCkwFTGiaxtTU1OXTpk3707Bhw/6g67pDipnT4biuj7qut+Lbk3Vf1tTUXI9qu91Pjq1QFEUBgJaWFgBo8yGOQ8eNGxcAAOvXr/8QwBUfYygAKL169eoCABcuXACAWtn2hOGv0+kMNO1KiPDw8F4A4rZv3/7R1KlTR0+bNu1ht9u9r1+/fqitrQXJgwDarRC6/QjPzs4+QJIffPCB9/aQmSAA43ft2mW0e1QGoi8CAPyLsZccExNTC2BlRkbGRdOyYJCP2csBIN6UAZzCd7cBbQCijYp/dXU1ExMTz6SmptaMHj36f9LS0vYlJCRsl6mxIWSdu3fv/g5J7t+/nwC2AShMTk6+SJKff/45AWRLYbD7+fndAeDf5BJnLoCCyZMnt5JkdnZ2C4B/F0KEm1Pu+Pj4rST55ZdfEsBWAK+mpaVdMo3raDn7KwDuSEpK+m+S3LBhAwG8DuCtHTt2UBbpjgC408vvcFVV15HkuXPnjMp+p5uMf0RcXNyHJNnQ0EBVVfcCWBQXF3fG+Jv0yxABPwB5LS0tRmFxN4BlTzzxxGWSXLx4sS5F3GGFy+1Hp5SUlJq6ujoWFxdTpsZ2H+0iIyMj/0iSWVlZX5mr5jfJFroPGzasxlhTnjp1iiTZ3NxMl8tlrCd9pfa9SkpKSJI5OTmnZOageLUZZqxvfVFWVkZcPwdgNwnSCKPqb17jkmR8fPzfZMDZ5CRsFBmNI7h95s2b1yhT7/MAYmStwCx4vy0uLqa3v5qmEcCfvSr1QQAeXb16NY3Cm3HQ55133iGAp+SxZTNhKSkpfzUddkrFjYevzAQCeGjp0qXfsYckY2NjTwD4leGDLCL2HTdunNtoY+zWSHFcIHdsFCtcfuZ1vO9Eqs3m7/F47sb1k2qX/f3997W2tl7BjWfpBYDOzzzzzIVJkyZh0KBBCwEsB3AJvl9AETabLcDj8dwRFRW1ctasWb8JCgpSzp07d62wsPC/Wltb8xRFadR1/ZqPXYbgAQMGbI2Pjw/+6quv9ldVVT0r01ezuPRJSUn5Y9euXXVd11WzDaqq6kePHm3+7LPPRgO4KlNuxWazhXo8nuTk5OSXMjIyEl0uFxoaGtqKior+dPXq1VdUVT0jj7r68ieoT58+vx8yZMjdx48fP1JVVTVF9m20VW02WyfZf97YsWPjXS4X6urqWvPy8jYCWCyEuEDS8FdVFKWzruv//OSTTy5OTk7uqWkaPv3007qysrJ8RVH+LI8ym8/rB3Tu3HnRI488knLo0KG2ffv2ZQI4C98vP6mqqoZqmpaclpa2cOTIkX39/f3R0NDQUVxc/G5TU9PLqqrWa5rWLH1QVFUN0TStX1JSUvH48eP7BwYG4uDBg1cKCgpeBbBe2u+2Qug2EwD5N5sMPuNtMe8XP4TT6Qxoa2sbIGeXvUKIK7d4IISiKC5d1wPljOfA9bPwzYqiXNV13dd6Uqiq6qdpml2mpe02m63d4/G4vcTF5fF47LJf71nJA6BZVVW3pmntuPHlmAD5wk6Q9NnbHp9vHaqq6tA0zU/64PZhk1FfCZB9G/23ALiqKEqzD39tpvbGUqoFwFUhRLP3yzpCCDtJpxyXDulfG27+pqRR3DXsUWVd4Yq0x/taVQjhIhksC8L+ABpM9ljBf5sKwI8pIBr75L5E4vvu+UNeG/a+hv+AL7yFH8qPtOfHjtOP6V/Bja8D6z/B2Nys/1u9Xv33tLf4GfF/LC4GCJwByWIAAAAASUVORK5CYII=",cc._loaderImage="data:image/jpeg;base64,/9j/4QAYRXhpZgAASUkqAAgAAAAAAAAAAAAAAP/sABFEdWNreQABAAQAAAAlAAD/4QMpaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLwA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/PiA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA1LjAtYzA2MCA2MS4xMzQ3NzcsIDIwMTAvMDIvMTItMTc6MzI6MDAgICAgICAgICI+IDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+IDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjM4MDBEMDY2QTU1MjExRTFBQTAzQjEzMUNFNzMxRkQwIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjM4MDBEMDY1QTU1MjExRTFBQTAzQjEzMUNFNzMxRkQwIiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCBDUzUgV2luZG93cyI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkU2RTk0OEM4OERCNDExRTE5NEUyRkE3M0M3QkE1NTlEIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOkU2RTk0OEM5OERCNDExRTE5NEUyRkE3M0M3QkE1NTlEIi8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+/+4ADkFkb2JlAGTAAAAAAf/bAIQADQkJCQoJDQoKDRMMCwwTFhENDREWGhUVFhUVGhkUFhUVFhQZGR0fIB8dGScnKionJzk4ODg5QEBAQEBAQEBAQAEODAwOEA4RDw8RFA4RDhQVERISERUfFRUXFRUfKB0ZGRkZHSgjJiAgICYjLCwoKCwsNzc1NzdAQEBAQEBAQEBA/8AAEQgAyACgAwEiAAIRAQMRAf/EALAAAAEFAQEAAAAAAAAAAAAAAAQAAgMFBgcBAQEAAwEBAAAAAAAAAAAAAAAAAQMEAgUQAAIBAgIEBwoLBgQGAwAAAAECAwAEEQUhMRIGQVFxsTITFGGBwdEiQlKSMzWRoeFicqKyI1NzFYJjJDQWB9KjVCbxwkNkJWXik3QRAAIBAgMFBQcDBQEAAAAAAAABAhEDIRIEMUFRcTJhwVIUBZGhsSJyEzOB0ULhYpIjUxX/2gAMAwEAAhEDEQA/AMJSpUqAVKlXuFAeUq9wpUB5XuFe4V6ooDzZHDox0CnGMinzwl7Z8NajaHeoO3vmTBZBtp9YUIqTEV5ROxHKnWRnaU8VRMhFBUjpV7hSoSeUq9pUB5Sr2lhQHlKvcK8oBV7hSFSRrtaKAZs07YNPM1pG2xJIAw1jSeandry/8X4m8VCKkWwaWwam7Xl/4v1W8VLtmX/i/VbxUoKkWwakSM407tmX/i/VbxUmzGwjQsjdY41IARie/U0IbZO0kNtCXnOCkEBeFu4KI3Bs7DNb27ya+jDx3kJeEnpJJEcQVbWDsk17u5urd591ucZkWhym2Vnd9RkCDEpFxDRpbw0bunu5mlp2De2FMLYXOD2wB2xbOeraUcYGJ72mlSUiqzzdzMd3Z3mixltA2yzcK/NlHM1DQyRXce1HocdNOEfJXZ88y9ZojOqhiBszIRiHQ8Y4cK5TvHuzLljHNMqxNoDjLFraHHnjPxcNCGVbxEUzYNTx5jZSxhpW6qTzlwJ+DCvO2Zf+L9VvFSgqyHYNLYNTdssPxfibxUu15f8Ai/VPiqCakOwa82DU/a8v/F+JvFTDdWPBL8R8VKCvYRYV5UzoMAy6QdIIqI0B4KJtxiRQwou16QoGUkntH5Tz0RbZbmF2hktraSVBo2lUkY8tDye0flPPXTslVUyiyVRsjqUOA4yMT8dW2ram2m6UVTNq9S7EIyUVJydMTn/6DnP+im9Wl+g5z/opvVrpteEhQWY4AaSTwAVf5WPiZh/9S5/zj7zltzlmYWkfWXNvJDGTgGcYDHirR7i7mSbwXParsFMrgb7w6jKw/wCmnc9I14kF3vpvCljbMyWMOJL4aEiB8qU/ObUK7HYWVrl1pFZWiCOCBQqKOLjPGTrNZZqKbUXVHq2nNwTuJRk1VpbgXN8s7Rk5ym0UQQzhIG2NAjhxHWbI+gCBVjBBFbwxwQqEiiUJGg1BVGAFe7dV28WYLYZFmF2Th1UD7JGjymGyn1iK5OyzIBGB1HgrLZhamzumQAGJwSqnSCh1q3GOCodxt4cxurdcpzuN4cyhiWaF5Bg09udUmnWw1H/jV9nFuJ7Quo+8h8peThFA+047vduyMtk7fYqTl07YFdfUufMPzT5p71UdtlmYXaGS2t3mQHAsgxANdadYJopLe4QS2867EsZ4QfCNYrCFbjdDPmgkYyWFxgVf04ifJf6ScNdRUW1XBb6FU5TjF5EpSSrGu/s5lN+g5z/opvVpfoOc/wCim9WtdHnatvObJXDW7xLGhB8nrPaY9/HCr+tEdPCVaSeDoYLnqF63lzW4/PFSW3ecxbI84VSzWUwUaSdg0DXXK5nvAipnd6qgKvWnQO7pri9ZUEmm3Vl2j1kr8pRlFRyquBNZjGxQ/S56Y1S2fu9OVueon11Szahoou06QoQUXadIVCD2FJJ7R+U89dMydv8Axdn+TH9muZye0flPPXQstlK5Tbka1gUjlC1q0vVLkeb6r+O3Tx9xcY1nt8c0NrZCyiOE1108NYjGv1joo7Js1jzKyScYLIvkzL6LDwHXVJksH9Sb49dKNq0tj1jA6uriOCL+02FWX7iVtZX1/AzaHTyeoauKn2MX9W79zebiZCuR5MjSrhfXuEtwTrUeZH+yNfdrRNcxI6IzhXlJEak6WIGJ2Rw4ChWnChndtlVBLMdQA0k1gbXNMzzDfDLs6mjaPKppJbWwJ1bOwwxw43OnHh71YT3DpfWUJmFlb5jHHDdeXBHIsrRea5TSqvxqG04cNN62vetoCS4tre5mgnkGE9q+3DKOkuI2WX6LDQRRHWDh1UCtwj7QRg2wdl8Djgw1qe7XvW0BQ3kfZ7mSLgU+T9E6RVbnuVrnWVSWqj+Lt8ZbRuHEdKPkYVcZ2MJY5fSGyeVar45+rkWQHAqccalPE5km1htWK5nK4Wnt5FuUBUwOMG4nGkA/BXUrW4S6torlOjMgcd/xVn7rLo7zKs0uEjCNeSvdwoBhgsZxX1l2j36k3Lu+uyprdj5Vs5A+i/lD48a0aaVJOPi7jB6lbzWozpjB48pf1NDXNN4vfl7+Z4BXS65pvF78vfzPAK71XTHmZ/S/yT+jvJ7L3fHytz1E+upbL+Qj5W56jfXWRnsIYKLtekKEFGWvSFQgyjk9o/Keet3YthlMP/5x9msJJ7R+U89biyb/AMXEv7gD6tadL1T+kwepRrC39ZkLDMbiwMvUHRPG0bjlGg8ore/23sxBldxfMPLupNhT8yL/AORNZbdzJ484scytxgLqJY5LZj6Q2sV5G1Vud1mjjyG0ij0NEGSZToKyhjtqw4waztuiXA3qKTbSxltfGhbZlE95ZtZqxVbgiOZhrER9ph3Svk9+pJILZ4Y4DGBFCUMKjRsGPobPFhUfW0NJmljE2xJcIrcI2vFUEln1lRXd6lrazXT9GCNpD+yNqoI7mOVduNw6nzlOIoPOUa6yye1XXcbMR5GdQ3xY0BSbj31/FcTQZirJ+q431q7anbHCTZ72Bw7lbPrKBMcBWNNgbMBBh+bsjBdni0VJ1lARZs6yWiupxCuMDy6KpS2IwOo6DTr3Mre3e5tZZVUM4ZBjqOOJoWO4jkXajcOOMHGgDISvWIrdAkKR80+TzVl908bPPL3LzxOuHdifxVfiTAg92qI/w+/8gGgSyN/mR7XPVlp0lF/3L3mbVKtu5Hjbk/8AHE2Fc03i9+Xv5ngFdKNc13i9+Xv5ngFaNV0x5nn+l/kn9HeEWXu+PlbnqJ9dS2Xu9OVueon11kZ7CGCjLXpCgxRlr0hUIPYUcntH5Tz1s8vb+Bt1/dqPirGSe0flPPWusG/g4Py15q06XqlyMWvVYQ+ruI9xJOqzO9hOto/sP8tbGOFIrmWeM7IuMDMnAXXQJOUjQeOsJk0nY96ip0CYunrjaHx1t+srPJUbXBm2LrFPikwTOb+T+VhbZxGMrDXp83x1QSy2tucJpUjPETp+Cn5/ftaRvKvtp3Kx48HG3erHMzOxZiWZtLMdJNQSbbL71Vk6yynViOkqnEEfOWtPbXi3EQkGg6mXiNckjeSJxJGxR10qw0GtxuxmvbImD4CZMFlA4fRfv0BqesqqzTMZNMEDbIHtHH2QeCiZJSqMQdOGiue53mz3czQwsRbIcNHnkec3c4qAMuriz68gTIToxwOOnlp0MjxMJYW741Gs3RVldtbygE/dMcHX/moDaxTiWNZB53B3arb8/wC+4SOF4sf/AKxU9kcBsfOGHfoUHtG/RbzY5Die5HHhXdvavqiZ9Q8Jdlq4/gbKua7xe/L38zwCuhpf2Uk/Zo50kmwJKIdogDjw1VzzeL35e/meAVp1LTgqY4nn+mRauzqmqwrjzCLL3fHytz1E+upLL+Qj5W56jfXWRnroYKLtekKEFF2vSFQg9hSSe0flPPWosm/hIfoLzVl5PaPynnrRWb/w0X0F5q06XqlyM2sVYx5gmbFre/t71NY2T+0h8VbSO5SWNJUOKSAMp7jDGspmMPaLRlXS6eWve1/FRO7WYdbZm1Y/eW/R7qHxHRXGojlm3ulid6aVbaW+OALvgCLq2Hm9WxHKWqjhj6xsK1e8dm15l4niG1LZkswGsxtrPeOmsvayBJA1VItlWjptLuTdPMo7LtjRDq9naK4+WF9IrUW7BaHOljGqVHB7w2hzVoZt87d8vaNYSLl02CcRsDEbJbj71Uu7UBkvJ7/D7q2QoDxySaAO8MTXdxRVMpRp5XZOWdF/ms7R5XdyKfKWJsO/5PhrG5XlNxmEywW6bTnTxAAcJNbGSMXkM1pjgbiNo1PziPJ+Os7u7m/6ReM00ZOgxSpqYYHT3wRXMKN4ll9zUG4bQfNshu8sZVuEA2hirA4qe/VOwwrVbzbww5mI44UKRRYkbWG0S3JWctbd7u5WFfOOLHiUdJqmaipfLsIsObhWe001lMkMVvJNjhghIALMcBxCs7fxXQmkupx1bXDswGPlaTidVaEyKNXkoo4eBV+Sq7L7Vs9zcBgeyQ4GQ/MB1crmoim2orezqcowTuSeEY48jQ7oZX2PLzdyLhNd6RjrEY6I7+uspvH78vfzPAK6UAAAFGAGgAcArmu8Xvy9/M8ArTfio24RW5nnaG67uou3H/KPuqT2X8hHytz1G+upLL3enK3PUb66ys9RDBRdr0hQgou06QqEGUkntH5Tz1e238vF9BeaqKT2j8p56vbb+Xi+gvNWjTdUuRn1XTHmTh8KrJTJlt8t1CPIY44cGnpJVjTJYkmjaN9Ib4u7V923njTethRauZJV3PaW1rfLIiXEDYg6R4VYc9CXW7thfOZbKdbGZtLW8uPVY/u3GrkNUkM9zlcxUjbhfWOA90cRq4gv4LhdqN+VToNYWmnRm9NNVWNTyHc6VWBv8wt4YeHqm6xyPmroq1Z7WGFLSxTq7WLSuPSdjrkfumq5yHXDUeA92oO2SKpVumNAaoJLMXH3myp0rpJ4uKhc3tbDM5BMri1zAj79j7KTiY8TcdBpcsith0286o+sPCagEX9Pzg4zXUCp6QYse8oouCG3tk6m1BYv05W6T+IdyolxbHDAAa2OgDlNCz3ryN2WxBd5PJMg1t81eId2ukqnLlTBbfcuY+9uJLiRcvtPvHdsHK+cfRHcHDWsyawjyy0WBcDI3lTP6TeIcFV+S5OmXx9bJg1048o8Cj0V8Jq2DVu09nL80up7OxHi+oal3P8AXB/IsZS8T/YOV65zvCcc7vfzPAK3ivWCz445zeH954BXOr6I8yfSfyz+jvCLP3fHytz1G+upLP3fHytz1E+usbPaQ0UXadIUIKLtekKhB7Ckk9o/Keer22/l4/oLzVRSe0flPPV7b/y8X0F5q0abqlyM+q6Y8yQsBTDMor1o8aiaE1pbluMqS3sbLLHIhSRQyngqukhaJ9uBjo+H5aOa3ao2t34qouRlLajTalGP8v0IY8ylXQ+PKPFU/bYXOLPge6CKia0LaxTOxHu1Q7cuBd9yPEJ7TbjXKO8CajbMIF6CNIeNvJHjqIWJ7tSpYkalqVblwIdyG+RGXur0hXYJFxal+Dhq5y3slkv3Y2pD0pTr+QUClpJRUdo9XW4OLrTHtM16cZLLWkeC7y4jvlNEpcRtw1Ux27Ci448NZrTFy3nn3IQWxlgGrDZ3pza7/M8ArZo+ArF5171uvp+CqdV0R5l/psUrs2vB3hdl7vTlbnqJ9dS2Xu+PlbnqJ9dY2eshooq16QoQUXa9IVCD2FLJ7RuU89WNtmUSQqkgYMgw0accKrpPaPynnrZWG4Vi+VWmY5tnMWXG+XrIYnA0rhj0mdcTgdNdwnKDqjmduM1SRR/qlr8/4KX6pa8T/BVzDuLZXudRZblmbxXcPUNPc3KqCIwrbOzgrHEnHjoyD+3eSXkht7DeKG4umDGOJVUklfouThXfmbnZ7Cvy1vt9pmv1W1+d8FL9VteJvgq5yrcOGfLmzHN80iyyETPbptAEFo2ZG8pmUa1OFNn3Ky6W/sbDKM5hv5bx2WTZA+7RF2y52WOPJTzE+z2Dy1vt9pT/AKpacTerS/U7Tib1a04/t7kDXPY03jhN0W6sQ7K7W3q2dnrMccaDy/8At80kuZfqWYxWNtlcvUPPhiGYhWDeUy7IwYU8xPs9g8tb7faUn6pacTerTxm9oOBvVq3v9z927aynuId44LiWKNnjhAXF2UYhRg516qpsryjLr21665zFLSTaK9U2GOA87SwqY37knRU+BzOzags0s1Oyr+BKM6sxwP6tSDPLMen6vy0rvdm3Sxlu7K/S7WDDrFUDUTxgnTU826eXW7KlxmqQuwDBXUKcD+1Xee/wXuKX5XDGWLapSVcOyhEM/seJ/V+WnjeGx4pPV+Wkm6kKZlFay3Jlt7iFpYZY8ASVK6DjtDDA0f8A0Tl340/1f8Ndx8xJVWXB0KbktFFpNzdVXAC/qOwA0CQni2flrO3Vwbm5lnI2TKxbDirX/wBE5d+NcfV/wVR7xZPa5U9utvI8nWhmbbw0YEAYYAVxfhfy5rlKR4Fulu6X7mW1mzT8S4Yis/5CPlbnqJ9dSWfu9OVueon11mZvQ2i7XpChKKtekKhBlNJ7R+U89bDfGTb3a3ZX0Lcj6kdY+T2j8p560288m1kWQr6MJ+ylSAr+2cnV5renjs3H1loX+3j9XvbbtxLN9lqW4UnV5jdnjtXHxihtyZNjeSBu5J9k1BJe7xy7W5CJ/wCzuD/mTVTf2+fq97LJuLrPsNRueS7W6aJ/38x+vLVXuY+xvHaNxbf2GoCezf8A36j/APsSf8w1sLnqczTefJluYoLm5uo5F61sBshItP1cNFYe1f8A3ir/APfE/wCZUe9bB94r5jwuPsrQFhmG4l/Z2M17HdW90tuu3IkTHaCjWdIw0VVZdks9/C06yJFEp2dp+E1bbqybGTZ8vpQD7L1XRv8A7blT96Oda7tpNuuNE37Cq9KSisjyuUoxrStKllHbLlWTXsMs8chuSuwEPDqwoLe5y+YRE/gLzmqRekvKKtd4327yM/ulHxmrHJStySWVRyrjxKI2XC/CTlnlPPKTpTdFbP0L1bgrf5Lp0G3dPhQHwV0S1lzBsns3sESR8Crh9WAJGjSOKuU3E+zdZQ3oJh8IArdZXFDmOTpHa3i2+YrI2KtKy4ricBsBuHHgFXSo440+Wa2qqxjvM9uMoy+WvzWpLCWWWE28HxL6e43ojgkeSCBY1Ri5BGIUDT51cl3vm276BBqSEH4WbxV0tlkyXJcxTMb+OW6uY9mGHrCzDQwwAbTp2uKuTZ9N1uYsfRRR8WPhrm419mSSjRyiqxVK7y23B/ftuTm2oSdJyzNVw3BFn7vTlbnqF9dS2fu9OVueon11lZuQ2iLdsGFD05H2dNQGV0ntG5Tz1dWm9N1b2kVq8EVwsI2UaQaQOKhmitZGLOmk68DhSFvY+gfWNSAg7z3Qvo7yKCKIohiaNR5LKxx8qpxvjcqS0VpbxvwOAcRQPZ7D0G9Y0uz2HoH1jUCpLY7zXlpbm3eKO5QuzjrBqZji3x17PvNcyT288VvDBJbMWUovS2hslW7mFQ9nsPQPrGl2ew9A+saCod/WNxtbYsrfb17WBxx5ddD2281xC88klvDcSXEnWuzrqOGGC9zRUPZ7D0G9Y0uzWHoH1jQVCLreq6ntZbaO3it1mGy7RjTs1X2mYy20ZiCq8ZOODcdEdmsPQb1jS7PYegfWNdJuLqnQiSUlRqpFLmryxtH1Ma7Qw2gNNPOdSt0oI27p007s9h6B9Y0uz2HoH1jXX3Z+I4+1b8IJdX89xLHKQFMXQUahpxoiPN5P+onfU+A0/s9h6DesaXZ7D0D6xpG7OLbUtu0StW5JJx2bBsmbtiSiEk+cxoCWWSaVpZOk2vDVo0VYdnsPQb1jSNvZcCH1jSd2c+p1XAmFqEOmOPEfaH+BQd1ueo211IzrgFUYKNAAqI1WztCpUqVCRUqVKgFSpUqAVKlSoBUqVKgFSpUqAVKlSoBUqVKgFSpUqAVKlSoD/9k=",cc.loader.loadBinary=function(t,e){var i=this,n=this.getXMLHttpRequest(),r="load "+t+" failed!";n.open("GET",t,!0),cc.loader.loadBinary._IEFilter?(n.setRequestHeader("Accept-Charset","x-user-defined"),n.onreadystatechange=function(){if(4===n.readyState&&200===n.status){var t=cc._convertResponseBodyToText(n.responseBody);e(null,i._str2Uint8Array(t))}else e(r)}):(n.overrideMimeType&&n.overrideMimeType("text/plain; charset=x-user-defined"),n.onload=function(){4===n.readyState&&200===n.status?e(null,i._str2Uint8Array(n.responseText)):e(r)}),n.send(null)},cc.loader.loadBinary._IEFilter=/msie/i.test(navigator.userAgent)&&!/opera/i.test(navigator.userAgent)&&window.IEBinaryToArray_ByteStr&&window.IEBinaryToArray_ByteStr_Last,cc.loader._str2Uint8Array=function(t){if(!t)return null;for(var e=new Uint8Array(t.length),i=0;i<t.length;i++)e[i]=255&t.charCodeAt(i);return e},cc.loader.loadBinarySync=function(t){var e=this,i=this.getXMLHttpRequest(),n="load "+t+" failed!";i.open("GET",t,!1);var r=null;if(cc.loader.loadBinary._IEFilter){if(i.setRequestHeader("Accept-Charset","x-user-defined"),i.send(null),200!==i.status)return cc.log(n),null;var c=cc._convertResponseBodyToText(i.responseBody);c&&(r=e._str2Uint8Array(c))}else{if(i.overrideMimeType&&i.overrideMimeType("text/plain; charset=x-user-defined"),i.send(null),200!==i.status)return cc.log(n),null;r=this._str2Uint8Array(i.responseText)}return r},window.Uint8Array=window.Uint8Array||window.Array,cc.loader.loadBinary._IEFilter){var IEBinaryToArray_ByteStr_Script='<!-- IEBinaryToArray_ByteStr -->\r\nFunction IEBinaryToArray_ByteStr(Binary)\r\n   IEBinaryToArray_ByteStr = CStr(Binary)\r\nEnd Function\r\nFunction IEBinaryToArray_ByteStr_Last(Binary)\r\n   Dim lastIndex\r\n   lastIndex = LenB(Binary)\r\n   if lastIndex mod 2 Then\r\n       IEBinaryToArray_ByteStr_Last = Chr( AscB( MidB( Binary, lastIndex, 1 ) ) )\r\n   Else\r\n       IEBinaryToArray_ByteStr_Last = ""\r\n   End If\r\nEnd Function\r\n',myVBScript=document.createElement("script");myVBScript.type="text/vbscript",myVBScript.textContent=IEBinaryToArray_ByteStr_Script,document.body.appendChild(myVBScript),cc._convertResponseBodyToText=function(t){for(var e={},i=0;i<256;i++)for(var n=0;n<256;n++)e[String.fromCharCode(i+256*n)]=String.fromCharCode(i)+String.fromCharCode(n);var r=IEBinaryToArray_ByteStr(t),c=IEBinaryToArray_ByteStr_Last(t);return r.replace(/[\s\S]/g,function(t){return e[t]})+c}}var cc=cc||{},ClassManager={id:0|998*Math.random(),instanceId:0|998*Math.random(),getNewID:function(){return this.id++},getNewInstanceId:function(){return this.instanceId++}};switch(function(){var t=/\b_super\b/;cc.Class=function(){},cc.Class.extend=function(e){function i(){this.__instanceId=ClassManager.getNewInstanceId(),this.ctor&&this.ctor.apply(this,arguments)}var n=this.prototype,r=Object.create(n),c=ClassManager.getNewID();ClassManager[c]=n;var o={writable:!0,enumerable:!1,configurable:!0};r.__instanceId=null,i.id=c,o.value=c,Object.defineProperty(r,"__pid",o),i.prototype=r,o.value=i,Object.defineProperty(i.prototype,"constructor",o),this.__getters__&&(i.__getters__=cc.clone(this.__getters__)),this.__setters__&&(i.__setters__=cc.clone(this.__setters__));for(var s=0,a=arguments.length;s<a;++s){var h=arguments[s];for(var l in h){var u="function"==typeof h[l],_="function"==typeof n[l],d=t.test(h[l]);if(u&&_&&d?(o.value=function(t,e){return function(){var i=this._super;this._super=n[t];var r=e.apply(this,arguments);return this._super=i,r}}(l,h[l]),Object.defineProperty(r,l,o)):u?(o.value=h[l],Object.defineProperty(r,l,o)):r[l]=h[l],u){var f,p,g;if(this.__getters__&&this.__getters__[l]){g=this.__getters__[l];for(var m in this.__setters__)if(this.__setters__[m]===g){p=m;break}cc.defineGetterSetter(r,g,h[l],h[p]?h[p]:r[p],l,p)}if(this.__setters__&&this.__setters__[l]){g=this.__setters__[l];for(var m in this.__getters__)if(this.__getters__[m]===g){f=m;break}cc.defineGetterSetter(r,g,h[f]?h[f]:r[f],h[l],f,l)}}}}return i.extend=cc.Class.extend,i.implement=function(t){for(var e in t)r[e]=t[e]},i}}(),cc.defineGetterSetter=function(t,e,i,n,r,c){if(t.__defineGetter__)i&&t.__defineGetter__(e,i),n&&t.__defineSetter__(e,n);else{if(!Object.defineProperty)throw new Error("browser does not support getters");var o={enumerable:!1,configurable:!0};i&&(o.get=i),n&&(o.set=n),Object.defineProperty(t,e,o)}if(!r&&!c)for(var s=null!=i,a=void 0!=n,h=Object.getOwnPropertyNames(t),l=0;l<h.length;l++){var u=h[l];if((t.__lookupGetter__?!t.__lookupGetter__(u):!Object.getOwnPropertyDescriptor(t,u))&&"function"==typeof t[u]){var _=t[u];if(s&&_===i&&(r=u,!a||c))break;if(a&&_===n&&(c=u,!s||r))break}}var d=t.constructor;r&&(d.__getters__||(d.__getters__={}),d.__getters__[r]=e),c&&(d.__setters__||(d.__setters__={}),d.__setters__[c]=e)},cc.clone=function(t){var e=t.constructor?new t.constructor:{};for(var i in t){var n=t[i];"object"!=typeof n||!n||n instanceof cc.Node||n instanceof HTMLElement?e[i]=n:e[i]=cc.clone(n)}return e},cc.inject=function(t,e){for(var i in t)e[i]=t[i]},cc.Point=function(t,e){this.x=t||0,this.y=e||0},cc.p=function(t,e){return void 0===t?{x:0,y:0}:void 0===e?{x:t.x,y:t.y}:{x:t,y:e}},cc.pointEqualToPoint=function(t,e){return t&&e&&t.x===e.x&&t.y===e.y},cc.Size=function(t,e){this.width=t||0,this.height=e||0},cc.size=function(t,e){return void 0===t?{width:0,height:0}:void 0===e?{width:t.width,height:t.height}:{width:t,height:e}},cc.sizeEqualToSize=function(t,e){return t&&e&&t.width===e.width&&t.height===e.height},cc.Rect=function(t,e,i,n){this.x=t||0,this.y=e||0,this.width=i||0,this.height=n||0},cc.rect=function(t,e,i,n){return void 0===t?{x:0,y:0,width:0,height:0}:void 0===e?{x:t.x,y:t.y,width:t.width,height:t.height}:{x:t,y:e,width:i,height:n}},cc.rectEqualToRect=function(t,e){return t&&e&&t.x===e.x&&t.y===e.y&&t.width===e.width&&t.height===e.height},cc._rectEqualToZero=function(t){return t&&0===t.x&&0===t.y&&0===t.width&&0===t.height},cc.rectContainsRect=function(t,e){return!(!t||!e)&&!(t.x>=e.x||t.y>=e.y||t.x+t.width<=e.x+e.width||t.y+t.height<=e.y+e.height)},cc.rectGetMaxX=function(t){return t.x+t.width},cc.rectGetMidX=function(t){return t.x+t.width/2},cc.rectGetMinX=function(t){return t.x},cc.rectGetMaxY=function(t){return t.y+t.height},cc.rectGetMidY=function(t){return t.y+t.height/2},cc.rectGetMinY=function(t){return t.y},cc.rectContainsPoint=function(t,e){return e.x>=cc.rectGetMinX(t)&&e.x<=cc.rectGetMaxX(t)&&e.y>=cc.rectGetMinY(t)&&e.y<=cc.rectGetMaxY(t)},cc.rectIntersectsRect=function(t,e){var i=t.x+t.width,n=t.y+t.height,r=e.x+e.width,c=e.y+e.height;return!(i<e.x||r<t.x||n<e.y||c<t.y)},cc.rectOverlapsRect=function(t,e){return!(t.x+t.width<e.x||e.x+e.width<t.x||t.y+t.height<e.y||e.y+e.height<t.y)},cc.rectUnion=function(t,e){var i=cc.rect(0,0,0,0);return i.x=Math.min(t.x,e.x),i.y=Math.min(t.y,e.y),i.width=Math.max(t.x+t.width,e.x+e.width)-i.x,i.height=Math.max(t.y+t.height,e.y+e.height)-i.y,i},cc.rectIntersection=function(t,e){var i=cc.rect(Math.max(cc.rectGetMinX(t),cc.rectGetMinX(e)),Math.max(cc.rectGetMinY(t),cc.rectGetMinY(e)),0,0);return i.width=Math.min(cc.rectGetMaxX(t),cc.rectGetMaxX(e))-cc.rectGetMinX(i),i.height=Math.min(cc.rectGetMaxY(t),cc.rectGetMaxY(e))-cc.rectGetMinY(i),i},cc.SAXParser=cc.Class.extend({_parser:null,_isSupportDOMParser:null,ctor:function(){window.DOMParser?(this._isSupportDOMParser=!0,this._parser=new DOMParser):this._isSupportDOMParser=!1},parse:function(t){return this._parseXML(t)},_parseXML:function(t){var e;return this._isSupportDOMParser?e=this._parser.parseFromString(t,"text/xml"):(e=new ActiveXObject("Microsoft.XMLDOM"),e.async="false",e.loadXML(t)),e}}),cc.PlistParser=cc.SAXParser.extend({parse:function(t){var e=this._parseXML(t),i=e.documentElement;if("plist"!==i.tagName)return cc.warn("Not a plist file!"),{};for(var n=null,r=0,c=i.childNodes.length;r<c&&(n=i.childNodes[r],1!==n.nodeType);r++);return e=null,this._parseNode(n)},_parseNode:function(t){var e=null,i=t.tagName;if("dict"===i)e=this._parseDict(t);else if("array"===i)e=this._parseArray(t);else if("string"===i)if(1===t.childNodes.length)e=t.firstChild.nodeValue;else{e="";for(var n=0;n<t.childNodes.length;n++)e+=t.childNodes[n].nodeValue}else"false"===i?e=!1:"true"===i?e=!0:"real"===i?e=parseFloat(t.firstChild.nodeValue):"integer"===i&&(e=parseInt(t.firstChild.nodeValue,10));return e},_parseArray:function(t){for(var e=[],i=0,n=t.childNodes.length;i<n;i++){var r=t.childNodes[i];1===r.nodeType&&e.push(this._parseNode(r))}return e},_parseDict:function(t){for(var e={},i=null,n=0,r=t.childNodes.length;n<r;n++){var c=t.childNodes[n];1===c.nodeType&&("key"===c.tagName?i=c.firstChild.nodeValue:e[i]=this._parseNode(c))}return e}}),cc.saxParser=new cc.SAXParser,cc.plistParser=new cc.PlistParser,cc._txtLoader={load:function(t,e,i,n){cc.loader.loadTxt(t,n)}},cc.loader.register(["txt","xml","vsh","fsh","atlas"],cc._txtLoader),cc._jsonLoader={load:function(t,e,i,n){cc.loader.loadJson(t,n)}},cc.loader.register(["json","ExportJson"],cc._jsonLoader),cc._jsLoader={load:function(t,e,i,n){cc.loader.loadJs(t,n)}},cc.loader.register(["js"],cc._jsLoader),cc._imgLoader={load:function(t,e,i,n){var r;r=cc.loader.isLoading(t)?n:function(t,i){return t?n(t):(cc.loader.cache[e]=i,cc.textureCache.handleLoadedTexture(e),void n(null,i))},cc.loader.loadImg(t,r)}},cc.loader.register(["png","jpg","bmp","jpeg","gif","ico","tiff","webp"],cc._imgLoader),cc._serverImgLoader={load:function(t,e,i,n){cc._imgLoader.load(i.src,e,i,n)}},cc.loader.register(["serverImg"],cc._serverImgLoader),cc._plistLoader={load:function(t,e,i,n){cc.loader.loadTxt(t,function(t,e){return t?n(t):void n(null,cc.plistParser.parse(e))})}},cc.loader.register(["plist"],cc._plistLoader),cc._fontLoader={TYPE:{".eot":"embedded-opentype",".ttf":"truetype",".ttc":"truetype",".woff":"woff",".svg":"svg"},_loadFont:function(t,e,i){var n=document,r=cc.path,c=this.TYPE,o=document.createElement("style");o.type="text/css",n.body.appendChild(o);var s="";if(s+=isNaN(t-0)?"@font-face { font-family:"+t+"; src:":"@font-face { font-family:'"+t+"'; src:",e instanceof Array)for(var a=0,h=e.length;a<h;a++){var l=e[a];i=r.extname(l).toLowerCase(),s+="url('"+e[a]+"') format('"+c[i]+"')",s+=a===h-1?";":","}else i=i.toLowerCase(),s+="url('"+e+"') format('"+c[i]+"');";o.textContent+=s+"}";var u=document.createElement("div"),_=u.style;_.fontFamily=t,u.innerHTML=".",_.position="absolute",_.left="-100px",_.top="-100px",n.body.appendChild(u)},load:function(t,e,i,n){var r=this,c=i.type,o=i.name,s=i.srcs;cc.isString(i)?(c=cc.path.extname(i),o=cc.path.basename(i,c),r._loadFont(o,i,c)):r._loadFont(o,s),document.fonts?document.fonts.load("1em "+o).then(function(){n(null,!0)},function(t){n(t)}):n(null,!0)}},cc.loader.register(["font","eot","ttf","woff","svg","ttc"],cc._fontLoader),cc._binaryLoader={load:function(t,e,i,n){cc.loader.loadBinary(t,n)}},cc._csbLoader={load:function(t,e,i,n){cc.loader.loadCsb(t,n)}},cc.loader.register(["csb"],cc._csbLoader),window.CocosEngine=cc.ENGINE_VERSION="Cocos2d-JS v3.13",cc.FIX_ARTIFACTS_BY_STRECHING_TEXEL=0,cc.DIRECTOR_STATS_POSITION=cc.p(0,0),cc.DIRECTOR_FPS_INTERVAL=.5,cc.COCOSNODE_RENDER_SUBPIXEL=1,cc.SPRITEBATCHNODE_RENDER_SUBPIXEL=1,cc.OPTIMIZE_BLEND_FUNC_FOR_PREMULTIPLIED_ALPHA=1,cc.TEXTURE_ATLAS_USE_TRIANGLE_STRIP=0,cc.TEXTURE_ATLAS_USE_VAO=0,cc.TEXTURE_NPOT_SUPPORT=0,cc.RETINA_DISPLAY_SUPPORT=1,cc.RETINA_DISPLAY_FILENAME_SUFFIX="-hd",cc.USE_LA88_LABELS=1,cc.SPRITE_DEBUG_DRAW=0,cc.SPRITEBATCHNODE_DEBUG_DRAW=0,cc.LABELBMFONT_DEBUG_DRAW=0,cc.LABELATLAS_DEBUG_DRAW=0,cc.IS_RETINA_DISPLAY_SUPPORTED=1,cc.DEFAULT_ENGINE=cc.ENGINE_VERSION+"-canvas",cc.ENABLE_STACKABLE_ACTIONS=1,cc.ENABLE_GL_STATE_CACHE=1,cc.$=function(t){var e=this===cc?document:this,i=t instanceof HTMLElement?t:e.querySelector(t);return i&&(i.find=i.find||cc.$,i.hasClass=i.hasClass||function(t){return this.className.match(new RegExp("(\\s|^)"+t+"(\\s|$)"))},i.addClass=i.addClass||function(t){return this.hasClass(t)||(this.className&&(this.className+=" "),this.className+=t),this},i.removeClass=i.removeClass||function(t){return this.hasClass(t)&&(this.className=this.className.replace(t,"")),this},i.remove=i.remove||function(){return this.parentNode&&this.parentNode.removeChild(this),this},i.appendTo=i.appendTo||function(t){return t.appendChild(this),this},i.prependTo=i.prependTo||function(t){return t.childNodes[0]?t.insertBefore(this,t.childNodes[0]):t.appendChild(this),this},i.transforms=i.transforms||function(){return this.style[cc.$.trans]=cc.$.translate(this.position)+cc.$.rotate(this.rotation)+cc.$.scale(this.scale)+cc.$.skew(this.skew),this},i.position=i.position||{x:0,y:0},i.rotation=i.rotation||0,i.scale=i.scale||{x:1,y:1},i.skew=i.skew||{x:0,y:0},i.translates=function(t,e){return this.position.x=t,this.position.y=e,this.transforms(),this},i.rotate=function(t){return this.rotation=t,this.transforms(),this},i.resize=function(t,e){return this.scale.x=t,this.scale.y=e,this.transforms(),this},i.setSkew=function(t,e){return this.skew.x=t,this.skew.y=e,this.transforms(),this}),i},cc.sys.browserType){case cc.sys.BROWSER_TYPE_FIREFOX:cc.$.pfx="Moz",cc.$.hd=!0;break;case cc.sys.BROWSER_TYPE_CHROME:case cc.sys.BROWSER_TYPE_SAFARI:cc.$.pfx="webkit",cc.$.hd=!0;break;case cc.sys.BROWSER_TYPE_OPERA:cc.$.pfx="O",cc.$.hd=!1;break;case cc.sys.BROWSER_TYPE_IE:cc.$.pfx="ms",cc.$.hd=!1;break;default:cc.$.pfx="webkit",cc.$.hd=!0}cc.$.trans=cc.$.pfx+"Transform",cc.$.translate=cc.$.hd?function(t){return"translate3d("+t.x+"px, "+t.y+"px, 0) "}:function(t){return"translate("+t.x+"px, "+t.y+"px) "},cc.$.rotate=cc.$.hd?function(t){
return"rotateZ("+t+"deg) "}:function(t){return"rotate("+t+"deg) "},cc.$.scale=function(t){return"scale("+t.x+", "+t.y+") "},cc.$.skew=function(t){return"skewX("+-t.x+"deg) skewY("+t.y+"deg)"},cc.$new=function(t){return cc.$(document.createElement(t))},cc.$.findpos=function(t){var e=0,i=0;do e+=t.offsetLeft,i+=t.offsetTop;while(t=t.offsetParent);return{x:e,y:i}},cc.INVALID_INDEX=-1,cc.PI=Math.PI,cc.FLT_MAX=parseFloat("3.402823466e+38F"),cc.FLT_MIN=parseFloat("1.175494351e-38F"),cc.RAD=cc.PI/180,cc.DEG=180/cc.PI,cc.UINT_MAX=4294967295,cc.swap=function(t,e,i){if(!cc.isObject(i)||cc.isUndefined(i.x)||cc.isUndefined(i.y))cc.log(cc._LogInfos.swap);else{var n=i[t];i[t]=i[e],i[e]=n}},cc.lerp=function(t,e,i){return t+(e-t)*i},cc.rand=function(){return 16777215*Math.random()},cc.randomMinus1To1=function(){return 2*(Math.random()-.5)},cc.random0To1=Math.random,cc.degreesToRadians=function(t){return t*cc.RAD},cc.radiansToDegrees=function(t){return t*cc.DEG},cc.radiansToDegress=function(t){return cc.log(cc._LogInfos.radiansToDegress),t*cc.DEG},cc.REPEAT_FOREVER=Number.MAX_VALUE-1,cc.nodeDrawSetup=function(t){t._shaderProgram&&(t._shaderProgram.use(),t._shaderProgram.setUniformForModelViewAndProjectionMatrixWithMat4())},cc.enableDefaultGLStates=function(){},cc.disableDefaultGLStates=function(){},cc.incrementGLDraws=function(t){cc.g_NumberOfDraws+=t},cc.FLT_EPSILON=1.192092896e-7,cc.contentScaleFactor=cc.IS_RETINA_DISPLAY_SUPPORTED?function(){return cc.director.getContentScaleFactor()}:function(){return 1},cc.pointPointsToPixels=function(t){var e=cc.contentScaleFactor();return cc.p(t.x*e,t.y*e)},cc.pointPixelsToPoints=function(t){var e=cc.contentScaleFactor();return cc.p(t.x/e,t.y/e)},cc._pointPixelsToPointsOut=function(t,e){var i=cc.contentScaleFactor();e.x=t.x/i,e.y=t.y/i},cc.sizePointsToPixels=function(t){var e=cc.contentScaleFactor();return cc.size(t.width*e,t.height*e)},cc.sizePixelsToPoints=function(t){var e=cc.contentScaleFactor();return cc.size(t.width/e,t.height/e)},cc._sizePixelsToPointsOut=function(t,e){var i=cc.contentScaleFactor();e.width=t.width/i,e.height=t.height/i},cc.rectPixelsToPoints=cc.IS_RETINA_DISPLAY_SUPPORTED?function(t){var e=cc.contentScaleFactor();return cc.rect(t.x/e,t.y/e,t.width/e,t.height/e)}:function(t){return t},cc.rectPointsToPixels=cc.IS_RETINA_DISPLAY_SUPPORTED?function(t){var e=cc.contentScaleFactor();return cc.rect(t.x*e,t.y*e,t.width*e,t.height*e)}:function(t){return t},cc.ONE=1,cc.ZERO=0,cc.SRC_ALPHA=770,cc.SRC_ALPHA_SATURATE=776,cc.SRC_COLOR=768,cc.DST_ALPHA=772,cc.DST_COLOR=774,cc.ONE_MINUS_SRC_ALPHA=771,cc.ONE_MINUS_SRC_COLOR=769,cc.ONE_MINUS_DST_ALPHA=773,cc.ONE_MINUS_DST_COLOR=775,cc.ONE_MINUS_CONSTANT_ALPHA=32772,cc.ONE_MINUS_CONSTANT_COLOR=32770,cc.LINEAR=9729,cc.REPEAT=10497,cc.CLAMP_TO_EDGE=33071,cc.MIRRORED_REPEAT=33648,cc.BLEND_SRC=cc.SRC_ALPHA,cc.game.addEventListener(cc.game.EVENT_RENDERER_INITED,function(){cc._renderType===cc.game.RENDER_TYPE_WEBGL&&cc.OPTIMIZE_BLEND_FUNC_FOR_PREMULTIPLIED_ALPHA&&(cc.BLEND_SRC=cc.ONE)}),cc.BLEND_DST=cc.ONE_MINUS_SRC_ALPHA,cc.checkGLErrorDebug=function(){if(cc.renderMode===cc.game.RENDER_TYPE_WEBGL){var t=cc._renderContext.getError();t&&cc.log(cc._LogInfos.checkGLErrorDebug,t)}},cc.ORIENTATION_PORTRAIT=1,cc.ORIENTATION_LANDSCAPE=2,cc.ORIENTATION_AUTO=3,cc.VERTEX_ATTRIB_FLAG_NONE=0,cc.VERTEX_ATTRIB_FLAG_POSITION=1,cc.VERTEX_ATTRIB_FLAG_COLOR=2,cc.VERTEX_ATTRIB_FLAG_TEX_COORDS=4,cc.VERTEX_ATTRIB_FLAG_POS_COLOR_TEX=cc.VERTEX_ATTRIB_FLAG_POSITION|cc.VERTEX_ATTRIB_FLAG_COLOR|cc.VERTEX_ATTRIB_FLAG_TEX_COORDS,cc.GL_ALL=0,cc.VERTEX_ATTRIB_POSITION=0,cc.VERTEX_ATTRIB_COLOR=1,cc.VERTEX_ATTRIB_TEX_COORDS=2,cc.VERTEX_ATTRIB_MAX=7,cc.UNIFORM_PMATRIX=0,cc.UNIFORM_MVMATRIX=1,cc.UNIFORM_MVPMATRIX=2,cc.UNIFORM_TIME=3,cc.UNIFORM_SINTIME=4,cc.UNIFORM_COSTIME=5,cc.UNIFORM_RANDOM01=6,cc.UNIFORM_SAMPLER=7,cc.UNIFORM_MAX=8,cc.SHADER_POSITION_TEXTURECOLOR="ShaderPositionTextureColor",cc.SHADER_SPRITE_POSITION_TEXTURECOLOR="ShaderSpritePositionTextureColor",cc.SHADER_POSITION_TEXTURECOLORALPHATEST="ShaderPositionTextureColorAlphaTest",cc.SHADER_SPRITE_POSITION_TEXTURECOLORALPHATEST="ShaderSpritePositionTextureColorAlphaTest",cc.SHADER_POSITION_COLOR="ShaderPositionColor",cc.SHADER_SPRITE_POSITION_COLOR="ShaderSpritePositionColor",cc.SHADER_POSITION_TEXTURE="ShaderPositionTexture",cc.SHADER_POSITION_TEXTURE_UCOLOR="ShaderPositionTexture_uColor",cc.SHADER_POSITION_TEXTUREA8COLOR="ShaderPositionTextureA8Color",cc.SHADER_POSITION_UCOLOR="ShaderPosition_uColor",cc.SHADER_POSITION_LENGTHTEXTURECOLOR="ShaderPositionLengthTextureColor",cc.UNIFORM_PMATRIX_S="CC_PMatrix",cc.UNIFORM_MVMATRIX_S="CC_MVMatrix",cc.UNIFORM_MVPMATRIX_S="CC_MVPMatrix",cc.UNIFORM_TIME_S="CC_Time",cc.UNIFORM_SINTIME_S="CC_SinTime",cc.UNIFORM_COSTIME_S="CC_CosTime",cc.UNIFORM_RANDOM01_S="CC_Random01",cc.UNIFORM_SAMPLER_S="CC_Texture0",cc.UNIFORM_ALPHA_TEST_VALUE_S="CC_alpha_value",cc.ATTRIBUTE_NAME_COLOR="a_color",cc.ATTRIBUTE_NAME_POSITION="a_position",cc.ATTRIBUTE_NAME_TEX_COORD="a_texCoord",cc.ATTRIBUTE_NAME_MVMAT="a_mvMatrix",cc.ITEM_SIZE=32,cc.CURRENT_ITEM=3233828865,cc.ZOOM_ACTION_TAG=3233828866,cc.NORMAL_TAG=8801,cc.SELECTED_TAG=8802,cc.DISABLE_TAG=8803,cc.arrayVerifyType=function(t,e){if(t&&t.length>0)for(var i=0;i<t.length;i++)if(!(t[i]instanceof e))return cc.log("element type is wrong!"),!1;return!0},cc.arrayRemoveObject=function(t,e){for(var i=0,n=t.length;i<n;i++)if(t[i]===e){t.splice(i,1);break}},cc.arrayRemoveArray=function(t,e){for(var i=0,n=e.length;i<n;i++)cc.arrayRemoveObject(t,e[i])},cc.arrayAppendObjectsToIndex=function(t,e,i){return t.splice.apply(t,[i,0].concat(e)),t},cc.copyArray=function(t){var e,i=t.length,n=new Array(i);for(e=0;e<i;e+=1)n[e]=t[e];return n},cc._tmp.PrototypeColor=function(){var t=cc.color;t._getWhite=function(){return t(255,255,255)},t._getYellow=function(){return t(255,255,0)},t._getBlue=function(){return t(0,0,255)},t._getGreen=function(){return t(0,255,0)},t._getRed=function(){return t(255,0,0)},t._getMagenta=function(){return t(255,0,255)},t._getBlack=function(){return t(0,0,0)},t._getOrange=function(){return t(255,127,0)},t._getGray=function(){return t(166,166,166)},t.WHITE,cc.defineGetterSetter(t,"WHITE",t._getWhite),t.YELLOW,cc.defineGetterSetter(t,"YELLOW",t._getYellow),t.BLUE,cc.defineGetterSetter(t,"BLUE",t._getBlue),t.GREEN,cc.defineGetterSetter(t,"GREEN",t._getGreen),t.RED,cc.defineGetterSetter(t,"RED",t._getRed),t.MAGENTA,cc.defineGetterSetter(t,"MAGENTA",t._getMagenta),t.BLACK,cc.defineGetterSetter(t,"BLACK",t._getBlack),t.ORANGE,cc.defineGetterSetter(t,"ORANGE",t._getOrange),t.GRAY,cc.defineGetterSetter(t,"GRAY",t._getGray),cc.BlendFunc._disable=function(){return new cc.BlendFunc(cc.ONE,cc.ZERO)},cc.BlendFunc._alphaPremultiplied=function(){return new cc.BlendFunc(cc.ONE,cc.ONE_MINUS_SRC_ALPHA)},cc.BlendFunc._alphaNonPremultiplied=function(){return new cc.BlendFunc(cc.SRC_ALPHA,cc.ONE_MINUS_SRC_ALPHA)},cc.BlendFunc._additive=function(){return new cc.BlendFunc(cc.SRC_ALPHA,cc.ONE)},cc.BlendFunc.DISABLE,cc.defineGetterSetter(cc.BlendFunc,"DISABLE",cc.BlendFunc._disable),cc.BlendFunc.ALPHA_PREMULTIPLIED,cc.defineGetterSetter(cc.BlendFunc,"ALPHA_PREMULTIPLIED",cc.BlendFunc._alphaPremultiplied),cc.BlendFunc.ALPHA_NON_PREMULTIPLIED,cc.defineGetterSetter(cc.BlendFunc,"ALPHA_NON_PREMULTIPLIED",cc.BlendFunc._alphaNonPremultiplied),cc.BlendFunc.ADDITIVE,cc.defineGetterSetter(cc.BlendFunc,"ADDITIVE",cc.BlendFunc._additive)};var cc=cc||{};cc._tmp=cc._tmp||{},cc.game.addEventListener(cc.game.EVENT_RENDERER_INITED,function(){if(cc._renderType===cc.game.RENDER_TYPE_WEBGL){cc.color=function(t,e,i,n,r,c){if(void 0===t)return new cc.Color(0,0,0,255,r,c);if(cc.isString(t)){var o=cc.hexToColor(t);return new cc.Color(o.r,o.g,o.b,o.a)}return cc.isObject(t)?new cc.Color(t.r,t.g,t.b,t.a,t.arrayBuffer,t.offset):new cc.Color(t,e,i,n,r,c)},cc.Color=function(t,e,i,n,r,c){this._arrayBuffer=r||new ArrayBuffer(cc.Color.BYTES_PER_ELEMENT),this._offset=c||0;var o=this._arrayBuffer,s=this._offset;this._view=new Uint8Array(o,s,4),this._view[0]=t||0,this._view[1]=e||0,this._view[2]=i||0,this._view[3]=null==n?255:n,void 0===n&&(this.a_undefined=!0)},cc.Color.BYTES_PER_ELEMENT=4;var t=cc.Color.prototype;t._getR=function(){return this._view[0]},t._setR=function(t){this._view[0]=t<0?0:t},t._getG=function(){return this._view[1]},t._setG=function(t){this._view[1]=t<0?0:t},t._getB=function(){return this._view[2]},t._setB=function(t){this._view[2]=t<0?0:t},t._getA=function(){return this._view[3]},t._setA=function(t){this._view[3]=t<0?0:t},t.r,cc.defineGetterSetter(t,"r",t._getR,t._setR),t.g,cc.defineGetterSetter(t,"g",t._getG,t._setG),t.b,cc.defineGetterSetter(t,"b",t._getB,t._setB),t.a,cc.defineGetterSetter(t,"a",t._getA,t._setA),cc.assert(cc.isFunction(cc._tmp.PrototypeColor),cc._LogInfos.MissingFile,"CCTypesPropertyDefine.js"),cc._tmp.PrototypeColor(),delete cc._tmp.PrototypeColor}}),cc.Color=function(t,e,i,n){this.r=t||0,this.g=e||0,this.b=i||0,this.a=null==n?255:n},cc.color=function(t,e,i,n){return void 0===t?{r:0,g:0,b:0,a:255}:cc.isString(t)?cc.hexToColor(t):cc.isObject(t)?{r:t.r,g:t.g,b:t.b,a:null==t.a?255:t.a}:{r:t,g:e,b:i,a:null==n?255:n}},cc.colorEqual=function(t,e){return t.r===e.r&&t.g===e.g&&t.b===e.b},cc.Acceleration=function(t,e,i,n){this.x=t||0,this.y=e||0,this.z=i||0,this.timestamp=n||0},cc.Vertex2F=function(t,e,i,n){this._arrayBuffer=i||new ArrayBuffer(cc.Vertex2F.BYTES_PER_ELEMENT),this._offset=n||0,this._view=new Float32Array(this._arrayBuffer,this._offset,2),this._view[0]=t||0,this._view[1]=e||0},cc.Vertex2F.BYTES_PER_ELEMENT=8,_p=cc.Vertex2F.prototype,_p._getX=function(){return this._view[0]},_p._setX=function(t){this._view[0]=t},_p._getY=function(){return this._view[1]},_p._setY=function(t){this._view[1]=t},_p.x,cc.defineGetterSetter(_p,"x",_p._getX,_p._setX),_p.y,cc.defineGetterSetter(_p,"y",_p._getY,_p._setY),cc.Vertex3F=function(t,e,i,n,r){this._arrayBuffer=n||new ArrayBuffer(cc.Vertex3F.BYTES_PER_ELEMENT),this._offset=r||0;var c=this._arrayBuffer,o=this._offset;this._view=new Float32Array(c,o,3),this._view[0]=t||0,this._view[1]=e||0,this._view[2]=i||0},cc.Vertex3F.BYTES_PER_ELEMENT=12,_p=cc.Vertex3F.prototype,_p._getX=function(){return this._view[0]},_p._setX=function(t){this._view[0]=t},_p._getY=function(){return this._view[1]},_p._setY=function(t){this._view[1]=t},_p._getZ=function(){return this._view[2]},_p._setZ=function(t){this._view[2]=t},_p.x,cc.defineGetterSetter(_p,"x",_p._getX,_p._setX),_p.y,cc.defineGetterSetter(_p,"y",_p._getY,_p._setY),_p.z,cc.defineGetterSetter(_p,"z",_p._getZ,_p._setZ),cc.Tex2F=function(t,e,i,n){this._arrayBuffer=i||new ArrayBuffer(cc.Tex2F.BYTES_PER_ELEMENT),this._offset=n||0,this._view=new Float32Array(this._arrayBuffer,this._offset,2),this._view[0]=t||0,this._view[1]=e||0},cc.Tex2F.BYTES_PER_ELEMENT=8,_p=cc.Tex2F.prototype,_p._getU=function(){return this._view[0]},_p._setU=function(t){this._view[0]=t},_p._getV=function(){return this._view[1]},_p._setV=function(t){this._view[1]=t},_p.u,cc.defineGetterSetter(_p,"u",_p._getU,_p._setU),_p.v,cc.defineGetterSetter(_p,"v",_p._getV,_p._setV),cc.Quad2=function(t,e,i,n,r,c){this._arrayBuffer=r||new ArrayBuffer(cc.Quad2.BYTES_PER_ELEMENT),this._offset=c||0;var o=this._arrayBuffer,s=this._offset,a=cc.Vertex2F.BYTES_PER_ELEMENT;this._tl=t?new cc.Vertex2F(t.x,t.y,o,s):new cc.Vertex2F(0,0,o,s),s+=a,this._tr=e?new cc.Vertex2F(e.x,e.y,o,s):new cc.Vertex2F(0,0,o,s),s+=a,this._bl=i?new cc.Vertex2F(i.x,i.y,o,s):new cc.Vertex2F(0,0,o,s),s+=a,this._br=n?new cc.Vertex2F(n.x,n.y,o,s):new cc.Vertex2F(0,0,o,s)},cc.Quad2.BYTES_PER_ELEMENT=32,_p=cc.Quad2.prototype,_p._getTL=function(){return this._tl},_p._setTL=function(t){this._tl._view[0]=t.x,this._tl._view[1]=t.y},_p._getTR=function(){return this._tr},_p._setTR=function(t){this._tr._view[0]=t.x,this._tr._view[1]=t.y},_p._getBL=function(){return this._bl},_p._setBL=function(t){this._bl._view[0]=t.x,this._bl._view[1]=t.y},_p._getBR=function(){return this._br},_p._setBR=function(t){this._br._view[0]=t.x,this._br._view[1]=t.y},_p.tl,cc.defineGetterSetter(_p,"tl",_p._getTL,_p._setTL),_p.tr,cc.defineGetterSetter(_p,"tr",_p._getTR,_p._setTR),_p.bl,cc.defineGetterSetter(_p,"bl",_p._getBL,_p._setBL),_p.br,cc.defineGetterSetter(_p,"br",_p._getBR,_p._setBR),cc.Quad3=function(t,e,i,n,r,c){this._arrayBuffer=r||new ArrayBuffer(cc.Quad3.BYTES_PER_ELEMENT),this._offset=c||0;var o=this._arrayBuffer,s=this._offset,a=cc.Vertex3F.BYTES_PER_ELEMENT;this.bl=t?new cc.Vertex3F(t.x,t.y,t.z,o,s):new cc.Vertex3F(0,0,0,o,s),s+=a,this.br=e?new cc.Vertex3F(e.x,e.y,e.z,o,s):new cc.Vertex3F(0,0,0,o,s),s+=a,this.tl=i?new cc.Vertex3F(i.x,i.y,i.z,o,s):new cc.Vertex3F(0,0,0,o,s),s+=a,this.tr=n?new cc.Vertex3F(n.x,n.y,n.z,o,s):new cc.Vertex3F(0,0,0,o,s)},cc.Quad3.BYTES_PER_ELEMENT=48,cc.V3F_C4B_T2F=function(t,e,i,n,r){this._arrayBuffer=n||new ArrayBuffer(cc.V3F_C4B_T2F.BYTES_PER_ELEMENT),this._offset=r||0;var c=this._arrayBuffer,o=this._offset;this._vertices=t?new cc.Vertex3F(t.x,t.y,t.z,c,o):new cc.Vertex3F(0,0,0,c,o),o+=cc.Vertex3F.BYTES_PER_ELEMENT,this._colors=e?new cc.Color(e.r,e.g,e.b,e.a,c,o):new cc.Color(0,0,0,0,c,o),o+=cc.Color.BYTES_PER_ELEMENT,this._texCoords=i?new cc.Tex2F(i.u,i.v,c,o):new cc.Tex2F(0,0,c,o)},cc.V3F_C4B_T2F.BYTES_PER_ELEMENT=24,_p=cc.V3F_C4B_T2F.prototype,_p._getVertices=function(){return this._vertices},_p._setVertices=function(t){var e=this._vertices;e._view[0]=t.x,e._view[1]=t.y,e._view[2]=t.z},_p._getColor=function(){return this._colors},_p._setColor=function(t){var e=this._colors;e._view[0]=t.r,e._view[1]=t.g,e._view[2]=t.b,e._view[3]=t.a},_p._getTexCoords=function(){return this._texCoords},_p._setTexCoords=function(t){this._texCoords._view[0]=t.u,this._texCoords._view[1]=t.v},_p.vertices,cc.defineGetterSetter(_p,"vertices",_p._getVertices,_p._setVertices),_p.colors,cc.defineGetterSetter(_p,"colors",_p._getColor,_p._setColor),_p.texCoords,cc.defineGetterSetter(_p,"texCoords",_p._getTexCoords,_p._setTexCoords),cc.V3F_C4B_T2F_Quad=function(t,e,i,n,r,c){this._arrayBuffer=r||new ArrayBuffer(cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT),this._offset=c||0;var o=this._arrayBuffer,s=this._offset,a=cc.V3F_C4B_T2F.BYTES_PER_ELEMENT;this._tl=t?new cc.V3F_C4B_T2F(t.vertices,t.colors,t.texCoords,o,s):new cc.V3F_C4B_T2F(null,null,null,o,s),s+=a,this._bl=e?new cc.V3F_C4B_T2F(e.vertices,e.colors,e.texCoords,o,s):new cc.V3F_C4B_T2F(null,null,null,o,s),s+=a,this._tr=i?new cc.V3F_C4B_T2F(i.vertices,i.colors,i.texCoords,o,s):new cc.V3F_C4B_T2F(null,null,null,o,s),s+=a,this._br=n?new cc.V3F_C4B_T2F(n.vertices,n.colors,n.texCoords,o,s):new cc.V3F_C4B_T2F(null,null,null,o,s)},cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT=96,_p=cc.V3F_C4B_T2F_Quad.prototype,_p._getTL=function(){return this._tl},_p._setTL=function(t){var e=this._tl;e.vertices=t.vertices,e.colors=t.colors,e.texCoords=t.texCoords},_p._getBL=function(){return this._bl},_p._setBL=function(t){var e=this._bl;e.vertices=t.vertices,e.colors=t.colors,e.texCoords=t.texCoords},_p._getTR=function(){return this._tr},_p._setTR=function(t){var e=this._tr;e.vertices=t.vertices,e.colors=t.colors,e.texCoords=t.texCoords},_p._getBR=function(){return this._br},_p._setBR=function(t){var e=this._br;e.vertices=t.vertices,e.colors=t.colors,e.texCoords=t.texCoords},_p._getArrayBuffer=function(){return this._arrayBuffer},_p.tl,cc.defineGetterSetter(_p,"tl",_p._getTL,_p._setTL),_p.tr,cc.defineGetterSetter(_p,"tr",_p._getTR,_p._setTR),_p.bl,cc.defineGetterSetter(_p,"bl",_p._getBL,_p._setBL),_p.br,cc.defineGetterSetter(_p,"br",_p._getBR,_p._setBR),_p.arrayBuffer,cc.defineGetterSetter(_p,"arrayBuffer",_p._getArrayBuffer,null),cc.V3F_C4B_T2F_QuadZero=function(){return new cc.V3F_C4B_T2F_Quad},cc.V3F_C4B_T2F_QuadCopy=function(t){if(!t)return cc.V3F_C4B_T2F_QuadZero();var e=t.tl,i=t.bl,n=t.tr,r=t.br;return{tl:{vertices:{x:e.vertices.x,y:e.vertices.y,z:e.vertices.z},colors:{r:e.colors.r,g:e.colors.g,b:e.colors.b,a:e.colors.a},texCoords:{u:e.texCoords.u,v:e.texCoords.v}},bl:{vertices:{x:i.vertices.x,y:i.vertices.y,z:i.vertices.z},colors:{r:i.colors.r,g:i.colors.g,b:i.colors.b,a:i.colors.a},texCoords:{u:i.texCoords.u,v:i.texCoords.v}},tr:{vertices:{x:n.vertices.x,y:n.vertices.y,z:n.vertices.z},colors:{r:n.colors.r,g:n.colors.g,b:n.colors.b,a:n.colors.a},texCoords:{u:n.texCoords.u,v:n.texCoords.v}},br:{vertices:{x:r.vertices.x,y:r.vertices.y,z:r.vertices.z},colors:{r:r.colors.r,g:r.colors.g,b:r.colors.b,a:r.colors.a},texCoords:{u:r.texCoords.u,v:r.texCoords.v}}}},cc.V3F_C4B_T2F_QuadsCopy=function(t){if(!t)return[];for(var e=[],i=0;i<t.length;i++)e.push(cc.V3F_C4B_T2F_QuadCopy(t[i]));return e},cc.V2F_C4B_T2F=function(t,e,i,n,r){this._arrayBuffer=n||new ArrayBuffer(cc.V2F_C4B_T2F.BYTES_PER_ELEMENT),this._offset=r||0;var c=this._arrayBuffer,o=this._offset;this._vertices=t?new cc.Vertex2F(t.x,t.y,c,o):new cc.Vertex2F(0,0,c,o),o+=cc.Vertex2F.BYTES_PER_ELEMENT,this._colors=e?cc.color(e.r,e.g,e.b,e.a,c,o):cc.color(0,0,0,0,c,o),o+=cc.Color.BYTES_PER_ELEMENT,this._texCoords=i?new cc.Tex2F(i.u,i.v,c,o):new cc.Tex2F(0,0,c,o)},cc.V2F_C4B_T2F.BYTES_PER_ELEMENT=20,_p=cc.V2F_C4B_T2F.prototype,_p._getVertices=function(){return this._vertices},_p._setVertices=function(t){this._vertices._view[0]=t.x,this._vertices._view[1]=t.y},_p._getColor=function(){return this._colors},_p._setColor=function(t){var e=this._colors;e._view[0]=t.r,e._view[1]=t.g,e._view[2]=t.b,e._view[3]=t.a},_p._getTexCoords=function(){return this._texCoords},_p._setTexCoords=function(t){this._texCoords._view[0]=t.u,this._texCoords._view[1]=t.v},_p.vertices,cc.defineGetterSetter(_p,"vertices",_p._getVertices,_p._setVertices),_p.colors,cc.defineGetterSetter(_p,"colors",_p._getColor,_p._setColor),_p.texCoords,cc.defineGetterSetter(_p,"texCoords",_p._getTexCoords,_p._setTexCoords),cc.V2F_C4B_T2F_Triangle=function(t,e,i,n,r){this._arrayBuffer=n||new ArrayBuffer(cc.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT),this._offset=r||0;var c=this._arrayBuffer,o=this._offset,s=cc.V2F_C4B_T2F.BYTES_PER_ELEMENT;this._a=t?new cc.V2F_C4B_T2F(t.vertices,t.colors,t.texCoords,c,o):new cc.V2F_C4B_T2F(null,null,null,c,o),o+=s,this._b=e?new cc.V2F_C4B_T2F(e.vertices,e.colors,e.texCoords,c,o):new cc.V2F_C4B_T2F(null,null,null,c,o),o+=s,this._c=i?new cc.V2F_C4B_T2F(i.vertices,i.colors,i.texCoords,c,o):new cc.V2F_C4B_T2F(null,null,null,c,o)},cc.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT=60,_p=cc.V2F_C4B_T2F_Triangle.prototype,_p._getA=function(){return this._a},_p._setA=function(t){var e=this._a;e.vertices=t.vertices,e.colors=t.colors,e.texCoords=t.texCoords},_p._getB=function(){return this._b},_p._setB=function(t){var e=this._b;e.vertices=t.vertices,e.colors=t.colors,e.texCoords=t.texCoords},_p._getC=function(){return this._c},_p._setC=function(t){var e=this._c;e.vertices=t.vertices,e.colors=t.colors,e.texCoords=t.texCoords},_p.a,cc.defineGetterSetter(_p,"a",_p._getA,_p._setA),_p.b,cc.defineGetterSetter(_p,"b",_p._getB,_p._setB),_p.c,cc.defineGetterSetter(_p,"c",_p._getC,_p._setC),cc.vertex2=function(t,e){return new cc.Vertex2F(t,e)},cc.vertex3=function(t,e,i){return new cc.Vertex3F(t,e,i)},cc.tex2=function(t,e){return new cc.Tex2F(t,e)},cc.BlendFunc=function(t,e){this.src=t,this.dst=e},cc.blendFuncDisable=function(){return new cc.BlendFunc(cc.ONE,cc.ZERO)},cc.hexToColor=function(t){t=t.replace(/^#?/,"0x");var e=parseInt(t),i=e>>16,n=(e>>8)%256,r=e%256;return cc.color(i,n,r)},cc.colorToHex=function(t){var e=t.r.toString(16),i=t.g.toString(16),n=t.b.toString(16);return"#"+(t.r<16?"0"+e:e)+(t.g<16?"0"+i:i)+(t.b<16?"0"+n:n)},cc.TEXT_ALIGNMENT_LEFT=0,cc.TEXT_ALIGNMENT_CENTER=1,cc.TEXT_ALIGNMENT_RIGHT=2,cc.VERTICAL_TEXT_ALIGNMENT_TOP=0,cc.VERTICAL_TEXT_ALIGNMENT_CENTER=1,cc.VERTICAL_TEXT_ALIGNMENT_BOTTOM=2,cc._Dictionary=cc.Class.extend({_keyMapTb:null,_valueMapTb:null,__currId:0,ctor:function(){this._keyMapTb={},this._valueMapTb={},this.__currId=2<<(0|10*Math.random())},__getKey:function(){return this.__currId++,"key_"+this.__currId},setObject:function(t,e){if(null!=e){var i=this.__getKey();this._keyMapTb[i]=e,this._valueMapTb[i]=t}},objectForKey:function(t){if(null==t)return null;var e=this._keyMapTb;for(var i in e)if(e[i]===t)return this._valueMapTb[i];return null},valueForKey:function(t){return this.objectForKey(t)},removeObjectForKey:function(t){if(null!=t){var e=this._keyMapTb;for(var i in e)if(e[i]===t)return delete this._valueMapTb[i],void delete e[i]}},removeObjectsForKeys:function(t){if(null!=t)for(var e=0;e<t.length;e++)this.removeObjectForKey(t[e])},allKeys:function(){var t=[],e=this._keyMapTb;for(var i in e)t.push(e[i]);return t},removeAllObjects:function(){this._keyMapTb={},this._valueMapTb={}},count:function(){return this.allKeys().length}}),cc.FontDefinition=function(t){var e=this;if(e.fontName="Arial",e.fontSize=12,e.textAlign=cc.TEXT_ALIGNMENT_CENTER,e.verticalAlign=cc.VERTICAL_TEXT_ALIGNMENT_TOP,e.fillStyle=cc.color(255,255,255,255),e.boundingWidth=0,e.boundingHeight=0,e.strokeEnabled=!1,e.strokeStyle=cc.color(255,255,255,255),e.lineWidth=1,e.lineHeight="normal",e.fontStyle="normal",e.fontWeight="normal",e.shadowEnabled=!1,e.shadowOffsetX=0,e.shadowOffsetY=0,e.shadowBlur=0,e.shadowOpacity=1,t&&t instanceof Object)for(var i in t)e[i]=t[i]},cc.FontDefinition.prototype._getCanvasFontStr=function(){var t=this.lineHeight.charAt?this.lineHeight:this.lineHeight+"px";return this.fontStyle+" "+this.fontWeight+" "+this.fontSize+"px/"+t+" '"+this.fontName+"'"},cc.game.addEventListener(cc.game.EVENT_RENDERER_INITED,function(){cc._renderType===cc.game.RENDER_TYPE_CANVAS&&(cc.assert(cc.isFunction(cc._tmp.PrototypeColor),cc._LogInfos.MissingFile,"CCTypesPropertyDefine.js"),cc._tmp.PrototypeColor(),delete cc._tmp.PrototypeColor)}),cc.Touches=[],cc.TouchesIntergerDict={},cc.DENSITYDPI_DEVICE="device-dpi",cc.DENSITYDPI_HIGH="high-dpi",cc.DENSITYDPI_MEDIUM="medium-dpi",cc.DENSITYDPI_LOW="low-dpi";var __BrowserGetter={init:function(){this.html=document.getElementsByTagName("html")[0]},availWidth:function(t){return t&&t!==this.html?t.clientWidth:window.innerWidth},availHeight:function(t){return t&&t!==this.html?t.clientHeight:window.innerHeight},meta:{width:"device-width"},adaptationType:cc.sys.browserType};switch(window.navigator.userAgent.indexOf("OS 8_1_")>-1&&(__BrowserGetter.adaptationType=cc.sys.BROWSER_TYPE_MIUI),cc.sys.os===cc.sys.OS_IOS&&(__BrowserGetter.adaptationType=cc.sys.BROWSER_TYPE_SAFARI),__BrowserGetter.adaptationType){case cc.sys.BROWSER_TYPE_SAFARI:__BrowserGetter.meta["minimal-ui"]="true",__BrowserGetter.availWidth=function(t){return t.clientWidth},__BrowserGetter.availHeight=function(t){return t.clientHeight};break;case cc.sys.BROWSER_TYPE_CHROME:__BrowserGetter.__defineGetter__("target-densitydpi",function(){return cc.view._targetDensityDPI});case cc.sys.BROWSER_TYPE_SOUGOU:case cc.sys.BROWSER_TYPE_UC:__BrowserGetter.availWidth=function(t){return t.clientWidth},__BrowserGetter.availHeight=function(t){return t.clientHeight};break;case cc.sys.BROWSER_TYPE_MIUI:__BrowserGetter.init=function(t){if(!t.__resizeWithBrowserSize){var e=function(){t.setDesignResolutionSize(t._designResolutionSize.width,t._designResolutionSize.height,t._resolutionPolicy),window.removeEventListener("resize",e,!1)};window.addEventListener("resize",e,!1)}}}var _scissorRect=cc.rect();cc.EGLView=cc.Class.extend({_delegate:null,_frameSize:null,_designResolutionSize:null,_originalDesignResolutionSize:null,_viewPortRect:null,_visibleRect:null,_retinaEnabled:!1,_autoFullScreen:!1,_devicePixelRatio:1,_viewName:"",_resizeCallback:null,_scaleX:1,_originalScaleX:1,_scaleY:1,_originalScaleY:1,_isRotated:!1,_orientation:3,_resolutionPolicy:null,_rpExactFit:null,_rpShowAll:null,_rpNoBorder:null,_rpFixedHeight:null,_rpFixedWidth:null,_initialized:!1,_contentTranslateLeftTop:null,_frame:null,_frameZoomFactor:1,__resizeWithBrowserSize:!1,_isAdjustViewPort:!0,_targetDensityDPI:null,ctor:function(){var t=this,e=document,i=cc.ContainerStrategy,n=cc.ContentStrategy;__BrowserGetter.init(this),t._frame=cc.container.parentNode===e.body?e.documentElement:cc.container.parentNode,t._frameSize=cc.size(0,0),t._initFrameSize();var r=cc._canvas.width,c=cc._canvas.height;t._designResolutionSize=cc.size(r,c),t._originalDesignResolutionSize=cc.size(r,c),t._viewPortRect=cc.rect(0,0,r,c),t._visibleRect=cc.rect(0,0,r,c),t._contentTranslateLeftTop={left:0,top:0},t._viewName="Cocos2dHTML5";var o=cc.sys;t.enableRetina(o.os===o.OS_IOS||o.os===o.OS_OSX),t.enableAutoFullScreen(o.isMobile&&o.browserType!==o.BROWSER_TYPE_BAIDU),cc.visibleRect&&cc.visibleRect.init(t._visibleRect),t._rpExactFit=new cc.ResolutionPolicy(i.EQUAL_TO_FRAME,n.EXACT_FIT),t._rpShowAll=new cc.ResolutionPolicy(i.PROPORTION_TO_FRAME,n.SHOW_ALL),t._rpNoBorder=new cc.ResolutionPolicy(i.EQUAL_TO_FRAME,n.NO_BORDER),t._rpFixedHeight=new cc.ResolutionPolicy(i.EQUAL_TO_FRAME,n.FIXED_HEIGHT),t._rpFixedWidth=new cc.ResolutionPolicy(i.EQUAL_TO_FRAME,n.FIXED_WIDTH),t._targetDensityDPI=cc.DENSITYDPI_HIGH},_resizeEvent:function(){var t;t=this.setDesignResolutionSize?this:cc.view;var e=t._frameSize.width,i=t._frameSize.height,n=t._isRotated;if(t._initFrameSize(),t._isRotated!==n||t._frameSize.width!==e||t._frameSize.height!==i){t._resizeCallback&&t._resizeCallback.call();var r=t._originalDesignResolutionSize.width,c=t._originalDesignResolutionSize.height;r>0&&t.setDesignResolutionSize(r,c,t._resolutionPolicy)}},setTargetDensityDPI:function(t){this._targetDensityDPI=t,this._adjustViewportMeta()},getTargetDensityDPI:function(){return this._targetDensityDPI},resizeWithBrowserSize:function(t){t?this.__resizeWithBrowserSize||(this.__resizeWithBrowserSize=!0,window.addEventListener("resize",this._resizeEvent),window.addEventListener("orientationchange",this._resizeEvent)):this.__resizeWithBrowserSize&&(this.__resizeWithBrowserSize=!1,window.removeEventListener("resize",this._resizeEvent),window.removeEventListener("orientationchange",this._resizeEvent))},setResizeCallback:function(t){(cc.isFunction(t)||null==t)&&(this._resizeCallback=t)},setOrientation:function(t){t&=cc.ORIENTATION_AUTO,t&&(this._orientation=t)},_initFrameSize:function(){var t=this._frameSize,e=__BrowserGetter.availWidth(this._frame),i=__BrowserGetter.availHeight(this._frame),n=e>=i;!cc.sys.isMobile||n&&this._orientation&cc.ORIENTATION_LANDSCAPE||!n&&this._orientation&cc.ORIENTATION_PORTRAIT?(t.width=e,t.height=i,cc.container.style["-webkit-transform"]="rotate(0deg)",cc.container.style.transform="rotate(0deg)",this._isRotated=!1):(t.width=i,t.height=e,cc.container.style["-webkit-transform"]="rotate(90deg)",cc.container.style.transform="rotate(90deg)",cc.container.style["-webkit-transform-origin"]="0px 0px 0px",cc.container.style.transformOrigin="0px 0px 0px",this._isRotated=!0)},_adjustSizeKeepCanvasSize:function(){var t=this._originalDesignResolutionSize.width,e=this._originalDesignResolutionSize.height;t>0&&this.setDesignResolutionSize(t,e,this._resolutionPolicy)},_setViewportMeta:function(t,e){var i=document.getElementById("cocosMetaElement");i&&e&&document.head.removeChild(i);var n,r,c,o=document.getElementsByName("viewport"),s=o?o[0]:null;n=s?s.content:"",i=i||document.createElement("meta"),i.id="cocosMetaElement",i.name="viewport",i.content="";for(r in t)n.indexOf(r)==-1?n+=","+r+"="+t[r]:e&&(c=new RegExp(r+"s*=s*[^,]+"),n.replace(c,r+"="+t[r]));/^,/.test(n)&&(n=n.substr(1)),i.content=n,s&&(s.content=n),document.head.appendChild(i)},_adjustViewportMeta:function(){this._isAdjustViewPort&&(this._setViewportMeta(__BrowserGetter.meta,!1),this._isAdjustViewPort=!1)},_setScaleXYForRenderTexture:function(){var t=cc.contentScaleFactor();this._scaleX=t,this._scaleY=t},_resetScale:function(){this._scaleX=this._originalScaleX,this._scaleY=this._originalScaleY},_adjustSizeToBrowser:function(){},initialize:function(){this._initialized=!0},adjustViewPort:function(t){this._isAdjustViewPort=t},enableRetina:function(t){this._retinaEnabled=!!t},isRetinaEnabled:function(){return this._retinaEnabled},enableAutoFullScreen:function(t){t&&t!==this._autoFullScreen&&cc.sys.isMobile&&this._frame===document.documentElement?(this._autoFullScreen=!0,cc.screen.autoFullScreen(this._frame)):this._autoFullScreen=!1},isAutoFullScreenEnabled:function(){return this._autoFullScreen},end:function(){},isOpenGLReady:function(){return cc.game.canvas&&cc._renderContext},setFrameZoomFactor:function(t){this._frameZoomFactor=t,this.centerWindow(),cc.director.setProjection(cc.director.getProjection())},swapBuffers:function(){},setIMEKeyboardState:function(t){},setContentTranslateLeftTop:function(t,e){this._contentTranslateLeftTop={left:t,top:e}},getContentTranslateLeftTop:function(){return this._contentTranslateLeftTop},getCanvasSize:function(){return cc.size(cc._canvas.width,cc._canvas.height)},getFrameSize:function(){return cc.size(this._frameSize.width,this._frameSize.height)},setFrameSize:function(t,e){this._frameSize.width=t,this._frameSize.height=e,this._frame.style.width=t+"px",this._frame.style.height=e+"px",this._resizeEvent(),cc.director.setProjection(cc.director.getProjection())},centerWindow:function(){},getVisibleSize:function(){return cc.size(this._visibleRect.width,this._visibleRect.height)},getVisibleSizeInPixel:function(){return cc.size(this._visibleRect.width*this._scaleX,this._visibleRect.height*this._scaleY)},getVisibleOrigin:function(){return cc.p(this._visibleRect.x,this._visibleRect.y)},getVisibleOriginInPixel:function(){return cc.p(this._visibleRect.x*this._scaleX,this._visibleRect.y*this._scaleY)},canSetContentScaleFactor:function(){return!0},getResolutionPolicy:function(){return this._resolutionPolicy},setResolutionPolicy:function(t){var e=this;if(t instanceof cc.ResolutionPolicy)e._resolutionPolicy=t;else{var i=cc.ResolutionPolicy;t===i.EXACT_FIT&&(e._resolutionPolicy=e._rpExactFit),t===i.SHOW_ALL&&(e._resolutionPolicy=e._rpShowAll),t===i.NO_BORDER&&(e._resolutionPolicy=e._rpNoBorder),t===i.FIXED_HEIGHT&&(e._resolutionPolicy=e._rpFixedHeight),t===i.FIXED_WIDTH&&(e._resolutionPolicy=e._rpFixedWidth)}},setDesignResolutionSize:function(t,e,i){if(!(t>0||e>0))return void cc.log(cc._LogInfos.EGLView_setDesignResolutionSize);this.setResolutionPolicy(i);var n=this._resolutionPolicy;if(!n)return void cc.log(cc._LogInfos.EGLView_setDesignResolutionSize_2);n.preApply(this),cc.sys.isMobile&&this._adjustViewportMeta(),this._initFrameSize(),this._originalDesignResolutionSize.width=this._designResolutionSize.width=t,this._originalDesignResolutionSize.height=this._designResolutionSize.height=e;var r=n.apply(this,this._designResolutionSize);if(r.scale&&2===r.scale.length&&(this._scaleX=r.scale[0],this._scaleY=r.scale[1]),r.viewport){var c=this._viewPortRect,o=this._visibleRect,s=r.viewport;c.x=s.x,c.y=s.y,c.width=s.width,c.height=s.height,o.x=-c.x/this._scaleX,o.y=-c.y/this._scaleY,o.width=cc._canvas.width/this._scaleX,o.height=cc._canvas.height/this._scaleY,cc._renderContext.setOffset&&cc._renderContext.setOffset(c.x,-c.y)}var a=cc.director;a._winSizeInPoints.width=this._designResolutionSize.width,a._winSizeInPoints.height=this._designResolutionSize.height,n.postApply(this),cc.winSize.width=a._winSizeInPoints.width,cc.winSize.height=a._winSizeInPoints.height,cc._renderType===cc.game.RENDER_TYPE_WEBGL&&a.setGLDefaultValues(),this._originalScaleX=this._scaleX,this._originalScaleY=this._scaleY,cc.DOM&&cc.DOM._resetEGLViewDiv(),cc.visibleRect&&cc.visibleRect.init(this._visibleRect)},getDesignResolutionSize:function(){return cc.size(this._designResolutionSize.width,this._designResolutionSize.height)},setRealPixelResolution:function(t,e,i){this._setViewportMeta({width:t,"target-densitydpi":cc.DENSITYDPI_DEVICE},!0),document.body.style.width=t+"px",document.body.style.left="0px",document.body.style.top="0px",this.setDesignResolutionSize(t,e,i)},setViewPortInPoints:function(t,e,i,n){var r=this._frameZoomFactor,c=this._scaleX,o=this._scaleY;cc._renderContext.viewport(t*c*r+this._viewPortRect.x*r,e*o*r+this._viewPortRect.y*r,i*c*r,n*o*r)},setScissorInPoints:function(t,e,i,n){var r=this._frameZoomFactor,c=this._scaleX,o=this._scaleY;_scissorRect.x=t,_scissorRect.y=e,_scissorRect.width=i,_scissorRect.height=n,
cc._renderContext.scissor(t*c*r+this._viewPortRect.x*r,e*o*r+this._viewPortRect.y*r,i*c*r,n*o*r)},isScissorEnabled:function(){return cc._renderContext.isEnabled(gl.SCISSOR_TEST)},getScissorRect:function(){return cc.rect(_scissorRect)},setViewName:function(t){null!=t&&t.length>0&&(this._viewName=t)},getViewName:function(){return this._viewName},getViewPortRect:function(){return this._viewPortRect},getScaleX:function(){return this._scaleX},getScaleY:function(){return this._scaleY},getDevicePixelRatio:function(){return this._devicePixelRatio},convertToLocationInView:function(t,e,i){var n=this._devicePixelRatio*(t-i.left),r=this._devicePixelRatio*(i.top+i.height-e);return this._isRotated?{x:this._viewPortRect.width-r,y:n}:{x:n,y:r}},_convertMouseToLocationInView:function(t,e){var i=this._viewPortRect,n=this;t.x=(n._devicePixelRatio*(t.x-e.left)-i.x)/n._scaleX,t.y=(n._devicePixelRatio*(e.top+e.height-t.y)-i.y)/n._scaleY},_convertPointWithScale:function(t){var e=this._viewPortRect;t.x=(t.x-e.x)/this._scaleX,t.y=(t.y-e.y)/this._scaleY},_convertTouchesWithScale:function(t){for(var e,i,n,r=this._viewPortRect,c=this._scaleX,o=this._scaleY,s=0;s<t.length;s++)e=t[s],i=e._point,n=e._prevPoint,i.x=(i.x-r.x)/c,i.y=(i.y-r.y)/o,n.x=(n.x-r.x)/c,n.y=(n.y-r.y)/o}}),cc.EGLView._getInstance=function(){return this._instance||(this._instance=this._instance||new cc.EGLView,this._instance.initialize()),this._instance},cc.ContainerStrategy=cc.Class.extend({preApply:function(t){},apply:function(t,e){},postApply:function(t){},_setupContainer:function(t,e,i){var n=cc.game.canvas,r=cc.game.container;r.style.width=n.style.width=e+"px",r.style.height=n.style.height=i+"px";var c=t._devicePixelRatio=1;t.isRetinaEnabled()&&(c=t._devicePixelRatio=Math.min(2,window.devicePixelRatio||1)),n.width=e*c,n.height=i*c,cc._renderContext.resetCache&&cc._renderContext.resetCache()},_fixContainer:function(){document.body.insertBefore(cc.container,document.body.firstChild);var t=document.body.style;t.width=window.innerWidth+"px",t.height=window.innerHeight+"px",t.overflow="hidden";var e=cc.container.style;e.position="fixed",e.left=e.top="0px",document.body.scrollTop=0}}),cc.ContentStrategy=cc.Class.extend({_result:{scale:[1,1],viewport:null},_buildResult:function(t,e,i,n,r,c){Math.abs(t-i)<2&&(i=t),Math.abs(e-n)<2&&(n=e);var o=cc.rect(Math.round((t-i)/2),Math.round((e-n)/2),i,n);return cc._renderType===cc.game.RENDER_TYPE_CANVAS,this._result.scale=[r,c],this._result.viewport=o,this._result},preApply:function(t){},apply:function(t,e){return{scale:[1,1]}},postApply:function(t){}}),function(){var t=cc.ContainerStrategy.extend({apply:function(t){var e=t._frameSize.height,i=cc.container.style;this._setupContainer(t,t._frameSize.width,t._frameSize.height),t._isRotated?i.marginLeft=e+"px":i.margin="0px"}}),e=cc.ContainerStrategy.extend({apply:function(t,e){var i,n,r=t._frameSize.width,c=t._frameSize.height,o=cc.container.style,s=e.width,a=e.height,h=r/s,l=c/a;h<l?(i=r,n=a*h):(i=s*l,n=c);var u=Math.round((r-i)/2),_=Math.round((c-n)/2);i=r-2*u,n=c-2*_,this._setupContainer(t,i,n),t._isRotated?o.marginLeft=c+"px":o.margin="0px",o.paddingLeft=u+"px",o.paddingRight=u+"px",o.paddingTop=_+"px",o.paddingBottom=_+"px"}}),i=(t.extend({preApply:function(t){this._super(t),t._frame=document.documentElement},apply:function(t){this._super(t),this._fixContainer()}}),e.extend({preApply:function(t){this._super(t),t._frame=document.documentElement},apply:function(t,e){this._super(t,e),this._fixContainer()}}),cc.ContainerStrategy.extend({apply:function(t){this._setupContainer(t,cc._canvas.width,cc._canvas.height)}}));cc.ContainerStrategy.EQUAL_TO_FRAME=new t,cc.ContainerStrategy.PROPORTION_TO_FRAME=new e,cc.ContainerStrategy.ORIGINAL_CONTAINER=new i;var n=cc.ContentStrategy.extend({apply:function(t,e){var i=cc._canvas.width,n=cc._canvas.height,r=i/e.width,c=n/e.height;return this._buildResult(i,n,i,n,r,c)}}),r=cc.ContentStrategy.extend({apply:function(t,e){var i,n,r=cc._canvas.width,c=cc._canvas.height,o=e.width,s=e.height,a=r/o,h=c/s,l=0;return a<h?(l=a,i=r,n=s*l):(l=h,i=o*l,n=c),this._buildResult(r,c,i,n,l,l)}}),c=cc.ContentStrategy.extend({apply:function(t,e){var i,n,r,c=cc._canvas.width,o=cc._canvas.height,s=e.width,a=e.height,h=c/s,l=o/a;return h<l?(i=l,n=s*i,r=o):(i=h,n=c,r=a*i),this._buildResult(c,o,n,r,i,i)}}),o=cc.ContentStrategy.extend({apply:function(t,e){var i=cc._canvas.width,n=cc._canvas.height,r=e.height,c=n/r,o=i,s=n;return this._buildResult(i,n,o,s,c,c)},postApply:function(t){cc.director._winSizeInPoints=t.getVisibleSize()}}),s=cc.ContentStrategy.extend({apply:function(t,e){var i=cc._canvas.width,n=cc._canvas.height,r=e.width,c=i/r,o=i,s=n;return this._buildResult(i,n,o,s,c,c)},postApply:function(t){cc.director._winSizeInPoints=t.getVisibleSize()}});cc.ContentStrategy.EXACT_FIT=new n,cc.ContentStrategy.SHOW_ALL=new r,cc.ContentStrategy.NO_BORDER=new c,cc.ContentStrategy.FIXED_HEIGHT=new o,cc.ContentStrategy.FIXED_WIDTH=new s}(),cc.ResolutionPolicy=cc.Class.extend({_containerStrategy:null,_contentStrategy:null,ctor:function(t,e){this.setContainerStrategy(t),this.setContentStrategy(e)},preApply:function(t){this._containerStrategy.preApply(t),this._contentStrategy.preApply(t)},apply:function(t,e){return this._containerStrategy.apply(t,e),this._contentStrategy.apply(t,e)},postApply:function(t){this._containerStrategy.postApply(t),this._contentStrategy.postApply(t)},setContainerStrategy:function(t){t instanceof cc.ContainerStrategy&&(this._containerStrategy=t)},setContentStrategy:function(t){t instanceof cc.ContentStrategy&&(this._contentStrategy=t)}}),cc.ResolutionPolicy.EXACT_FIT=0,cc.ResolutionPolicy.NO_BORDER=1,cc.ResolutionPolicy.SHOW_ALL=2,cc.ResolutionPolicy.FIXED_HEIGHT=3,cc.ResolutionPolicy.FIXED_WIDTH=4,cc.ResolutionPolicy.UNKNOWN=5,cc.screen={_supportsFullScreen:!1,_preOnFullScreenChange:null,_touchEvent:"",_fn:null,_fnMap:[["requestFullscreen","exitFullscreen","fullscreenchange","fullscreenEnabled","fullscreenElement"],["requestFullScreen","exitFullScreen","fullScreenchange","fullScreenEnabled","fullScreenElement"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitfullscreenchange","webkitIsFullScreen","webkitCurrentFullScreenElement"],["mozRequestFullScreen","mozCancelFullScreen","mozfullscreenchange","mozFullScreen","mozFullScreenElement"],["msRequestFullscreen","msExitFullscreen","MSFullscreenChange","msFullscreenEnabled","msFullscreenElement"]],init:function(){this._fn={};var t,e,i,n=this._fnMap;for(t=0,l=n.length;t<l;t++)if(e=n[t],e&&e[1]in document){for(t=0,i=e.length;t<i;t++)this._fn[n[0][t]]=e[t];break}this._supportsFullScreen="undefined"!=typeof this._fn.requestFullscreen,this._touchEvent="ontouchstart"in window?"touchstart":"mousedown"},fullScreen:function(){return!!this._supportsFullScreen&&(void 0!==document[this._fn.fullscreenElement]&&null!==document[this._fn.fullscreenElement])},requestFullScreen:function(t,e){if(this._supportsFullScreen){if(t=t||document.documentElement,e){var i=this._fn.fullscreenchange;this._preOnFullScreenChange&&document.removeEventListener(i,this._preOnFullScreenChange),this._preOnFullScreenChange=e,document.addEventListener(i,e,!1)}return t[this._fn.requestFullscreen]()}},exitFullScreen:function(){return!this._supportsFullScreen||document[this._fn.exitFullscreen]()},autoFullScreen:function(t,e){function i(){n.removeEventListener(r._touchEvent,i),r.requestFullScreen(t,e)}t=t||document.body;var n=cc.game.canvas||t,r=this;this.requestFullScreen(t,e),n.addEventListener(this._touchEvent,i)}},cc.screen.init(),cc.visibleRect={topLeft:cc.p(0,0),topRight:cc.p(0,0),top:cc.p(0,0),bottomLeft:cc.p(0,0),bottomRight:cc.p(0,0),bottom:cc.p(0,0),center:cc.p(0,0),left:cc.p(0,0),right:cc.p(0,0),width:0,height:0,init:function(t){var e=this.width=t.width,i=this.height=t.height,n=t.x,r=t.y,c=r+i,o=n+e;this.topLeft.x=n,this.topLeft.y=c,this.topRight.x=o,this.topRight.y=c,this.top.x=n+e/2,this.top.y=c,this.bottomLeft.x=n,this.bottomLeft.y=r,this.bottomRight.x=o,this.bottomRight.y=r,this.bottom.x=n+e/2,this.bottom.y=r,this.center.x=n+e/2,this.center.y=r+i/2,this.left.x=n,this.left.y=r+i/2,this.right.x=o,this.right.y=r+i/2}},cc.UIInterfaceOrientationLandscapeLeft=-90,cc.UIInterfaceOrientationLandscapeRight=90,cc.UIInterfaceOrientationPortraitUpsideDown=180,cc.UIInterfaceOrientationPortrait=0,cc.inputManager={_mousePressed:!1,_isRegisterEvent:!1,_preTouchPoint:cc.p(0,0),_prevMousePoint:cc.p(0,0),_preTouchPool:[],_preTouchPoolPointer:0,_touches:[],_touchesIntegerDict:{},_indexBitsUsed:0,_maxTouches:5,_accelEnabled:!1,_accelInterval:1/30,_accelMinus:1,_accelCurTime:0,_acceleration:null,_accelDeviceEvent:null,_getUnUsedIndex:function(){for(var t=this._indexBitsUsed,e=0;e<this._maxTouches;e++){if(!(1&t))return this._indexBitsUsed|=1<<e,e;t>>=1}return-1},_removeUsedIndexBit:function(t){if(!(t<0||t>=this._maxTouches)){var e=1<<t;e=~e,this._indexBitsUsed&=e}},_glView:null,handleTouchesBegin:function(t){for(var e,i,n,r,c=[],o=this._touchesIntegerDict,s=0,a=t.length;s<a;s++)if(e=t[s],r=e.getID(),i=o[r],null==i){var h=this._getUnUsedIndex();if(h===-1){cc.log(cc._LogInfos.inputManager_handleTouchesBegin,h);continue}n=this._touches[h]=new cc.Touch(e._point.x,e._point.y,e.getID()),n._setPrevPoint(e._prevPoint),o[r]=h,c.push(n)}if(c.length>0){this._glView._convertTouchesWithScale(c);var l=new cc.EventTouch(c);l._eventCode=cc.EventTouch.EventCode.BEGAN,cc.eventManager.dispatchEvent(l)}},handleTouchesMove:function(t){for(var e,i,n,r=[],c=this._touches,o=0,s=t.length;o<s;o++)e=t[o],n=e.getID(),i=this._touchesIntegerDict[n],null!=i&&c[i]&&(c[i]._setPoint(e._point),c[i]._setPrevPoint(e._prevPoint),r.push(c[i]));if(r.length>0){this._glView._convertTouchesWithScale(r);var a=new cc.EventTouch(r);a._eventCode=cc.EventTouch.EventCode.MOVED,cc.eventManager.dispatchEvent(a)}},handleTouchesEnd:function(t){var e=this.getSetOfTouchesEndOrCancel(t);if(e.length>0){this._glView._convertTouchesWithScale(e);var i=new cc.EventTouch(e);i._eventCode=cc.EventTouch.EventCode.ENDED,cc.eventManager.dispatchEvent(i)}},handleTouchesCancel:function(t){var e=this.getSetOfTouchesEndOrCancel(t);if(e.length>0){this._glView._convertTouchesWithScale(e);var i=new cc.EventTouch(e);i._eventCode=cc.EventTouch.EventCode.CANCELLED,cc.eventManager.dispatchEvent(i)}},getSetOfTouchesEndOrCancel:function(t){for(var e,i,n,r=[],c=this._touches,o=this._touchesIntegerDict,s=0,a=t.length;s<a;s++)e=t[s],n=e.getID(),i=o[n],null!=i&&c[i]&&(c[i]._setPoint(e._point),c[i]._setPrevPoint(e._prevPoint),r.push(c[i]),this._removeUsedIndexBit(i),delete o[n]);return r},getHTMLElementPosition:function(t){var e=document.documentElement,i=window,n=null;return n=cc.isFunction(t.getBoundingClientRect)?t.getBoundingClientRect():{left:0,top:0,width:parseInt(t.style.width),height:parseInt(t.style.height)},{left:n.left+i.pageXOffset-e.clientLeft,top:n.top+i.pageYOffset-e.clientTop,width:n.width,height:n.height}},getPreTouch:function(t){for(var e=null,i=this._preTouchPool,n=t.getID(),r=i.length-1;r>=0;r--)if(i[r].getID()===n){e=i[r];break}return e||(e=t),e},setPreTouch:function(t){for(var e=!1,i=this._preTouchPool,n=t.getID(),r=i.length-1;r>=0;r--)if(i[r].getID()===n){i[r]=t,e=!0;break}e||(i.length<=50?i.push(t):(i[this._preTouchPoolPointer]=t,this._preTouchPoolPointer=(this._preTouchPoolPointer+1)%50))},getTouchByXY:function(t,e,i){var n=this._preTouchPoint,r=this._glView.convertToLocationInView(t,e,i),c=new cc.Touch(r.x,r.y);return c._setPrevPoint(n.x,n.y),n.x=r.x,n.y=r.y,c},getMouseEvent:function(t,e,i){var n=this._prevMousePoint;this._glView._convertMouseToLocationInView(t,e);var r=new cc.EventMouse(i);return r.setLocation(t.x,t.y),r._setPrevCursor(n.x,n.y),n.x=t.x,n.y=t.y,r},getPointByEvent:function(t,e){return null!=t.pageX?{x:t.pageX,y:t.pageY}:(e.left-=document.body.scrollLeft,e.top-=document.body.scrollTop,{x:t.clientX,y:t.clientY})},getTouchesByEvent:function(t,e){for(var i,n,r,c=[],o=this._glView,s=this._preTouchPoint,a=t.changedTouches.length,h=0;h<a;h++)if(i=t.changedTouches[h]){var l;l=cc.sys.BROWSER_TYPE_FIREFOX===cc.sys.browserType?o.convertToLocationInView(i.pageX,i.pageY,e):o.convertToLocationInView(i.clientX,i.clientY,e),null!=i.identifier?(n=new cc.Touch(l.x,l.y,i.identifier),r=this.getPreTouch(n).getLocation(),n._setPrevPoint(r.x,r.y),this.setPreTouch(n)):(n=new cc.Touch(l.x,l.y),n._setPrevPoint(s.x,s.y)),s.x=l.x,s.y=l.y,c.push(n)}return c},registerSystemEvent:function(t){if(!this._isRegisterEvent){var e=(this._glView=cc.view,this),i="mouse"in cc.sys.capabilities,n="touches"in cc.sys.capabilities,r=!1;if(cc.sys.isMobile&&(r=!0),i&&(window.addEventListener("mousedown",function(){e._mousePressed=!0},!1),window.addEventListener("mouseup",function(i){if(!r){var n=e._mousePressed;if(e._mousePressed=!1,n){var c=e.getHTMLElementPosition(t),o=e.getPointByEvent(i,c);if(!cc.rectContainsPoint(new cc.Rect(c.left,c.top,c.width,c.height),o)){e.handleTouchesEnd([e.getTouchByXY(o.x,o.y,c)]);var s=e.getMouseEvent(o,c,cc.EventMouse.UP);s.setButton(i.button),cc.eventManager.dispatchEvent(s)}}}},!1),t.addEventListener("mousedown",function(i){if(!r){e._mousePressed=!0;var n=e.getHTMLElementPosition(t),c=e.getPointByEvent(i,n);e.handleTouchesBegin([e.getTouchByXY(c.x,c.y,n)]);var o=e.getMouseEvent(c,n,cc.EventMouse.DOWN);o.setButton(i.button),cc.eventManager.dispatchEvent(o),i.stopPropagation(),i.preventDefault(),t.focus()}},!1),t.addEventListener("mouseup",function(i){if(!r){e._mousePressed=!1;var n=e.getHTMLElementPosition(t),c=e.getPointByEvent(i,n);e.handleTouchesEnd([e.getTouchByXY(c.x,c.y,n)]);var o=e.getMouseEvent(c,n,cc.EventMouse.UP);o.setButton(i.button),cc.eventManager.dispatchEvent(o),i.stopPropagation(),i.preventDefault()}},!1),t.addEventListener("mousemove",function(i){if(!r){var n=e.getHTMLElementPosition(t),c=e.getPointByEvent(i,n);e.handleTouchesMove([e.getTouchByXY(c.x,c.y,n)]);var o=e.getMouseEvent(c,n,cc.EventMouse.MOVE);e._mousePressed?o.setButton(i.button):o.setButton(null),cc.eventManager.dispatchEvent(o),i.stopPropagation(),i.preventDefault()}},!1),t.addEventListener("mousewheel",function(i){var n=e.getHTMLElementPosition(t),r=e.getPointByEvent(i,n),c=e.getMouseEvent(r,n,cc.EventMouse.SCROLL);c.setButton(i.button),c.setScrollData(0,i.wheelDelta),cc.eventManager.dispatchEvent(c),i.stopPropagation(),i.preventDefault()},!1),t.addEventListener("DOMMouseScroll",function(i){var n=e.getHTMLElementPosition(t),r=e.getPointByEvent(i,n),c=e.getMouseEvent(r,n,cc.EventMouse.SCROLL);c.setButton(i.button),c.setScrollData(0,i.detail*-120),cc.eventManager.dispatchEvent(c),i.stopPropagation(),i.preventDefault()},!1)),window.navigator.msPointerEnabled){var c={MSPointerDown:e.handleTouchesBegin,MSPointerMove:e.handleTouchesMove,MSPointerUp:e.handleTouchesEnd,MSPointerCancel:e.handleTouchesCancel};for(var o in c)!function(i,n){t.addEventListener(i,function(i){var r=e.getHTMLElementPosition(t);r.left-=document.documentElement.scrollLeft,r.top-=document.documentElement.scrollTop,n.call(e,[e.getTouchByXY(i.clientX,i.clientY,r)]),i.stopPropagation()},!1)}(o,c[o])}n&&(t.addEventListener("touchstart",function(i){if(i.changedTouches){var n=e.getHTMLElementPosition(t);n.left-=document.body.scrollLeft,n.top-=document.body.scrollTop,e.handleTouchesBegin(e.getTouchesByEvent(i,n)),i.stopPropagation(),i.preventDefault(),t.focus()}},!1),t.addEventListener("touchmove",function(i){if(i.changedTouches){var n=e.getHTMLElementPosition(t);n.left-=document.body.scrollLeft,n.top-=document.body.scrollTop,e.handleTouchesMove(e.getTouchesByEvent(i,n)),i.stopPropagation(),i.preventDefault()}},!1),t.addEventListener("touchend",function(i){if(i.changedTouches){var n=e.getHTMLElementPosition(t);n.left-=document.body.scrollLeft,n.top-=document.body.scrollTop,e.handleTouchesEnd(e.getTouchesByEvent(i,n)),i.stopPropagation(),i.preventDefault()}},!1),t.addEventListener("touchcancel",function(i){if(i.changedTouches){var n=e.getHTMLElementPosition(t);n.left-=document.body.scrollLeft,n.top-=document.body.scrollTop,e.handleTouchesCancel(e.getTouchesByEvent(i,n)),i.stopPropagation(),i.preventDefault()}},!1)),this._registerKeyboardEvent(),this._registerAccelerometerEvent(),this._isRegisterEvent=!0}},_registerKeyboardEvent:function(){},_registerAccelerometerEvent:function(){},update:function(t){this._accelCurTime>this._accelInterval&&(this._accelCurTime-=this._accelInterval,cc.eventManager.dispatchEvent(new cc.EventAcceleration(this._acceleration))),this._accelCurTime+=t}},cc.AffineTransform=function(t,e,i,n,r,c){this.a=t,this.b=e,this.c=i,this.d=n,this.tx=r,this.ty=c},cc.affineTransformMake=function(t,e,i,n,r,c){return{a:t,b:e,c:i,d:n,tx:r,ty:c}},cc.pointApplyAffineTransform=function(t,e,i){var n,r;return void 0===i?(i=e,n=t.x,r=t.y):(n=t,r=e),{x:i.a*n+i.c*r+i.tx,y:i.b*n+i.d*r+i.ty}},cc._pointApplyAffineTransform=function(t,e,i){return cc.pointApplyAffineTransform(t,e,i)},cc.sizeApplyAffineTransform=function(t,e){return{width:e.a*t.width+e.c*t.height,height:e.b*t.width+e.d*t.height}},cc.affineTransformMakeIdentity=function(){return{a:1,b:0,c:0,d:1,tx:0,ty:0}},cc.affineTransformIdentity=function(){return{a:1,b:0,c:0,d:1,tx:0,ty:0}},cc.rectApplyAffineTransform=function(t,e){var i=cc.rectGetMinY(t),n=cc.rectGetMinX(t),r=cc.rectGetMaxX(t),c=cc.rectGetMaxY(t),o=cc.pointApplyAffineTransform(n,i,e),s=cc.pointApplyAffineTransform(r,i,e),a=cc.pointApplyAffineTransform(n,c,e),h=cc.pointApplyAffineTransform(r,c,e),l=Math.min(o.x,s.x,a.x,h.x),u=Math.max(o.x,s.x,a.x,h.x),_=Math.min(o.y,s.y,a.y,h.y),d=Math.max(o.y,s.y,a.y,h.y);return cc.rect(l,_,u-l,d-_)},cc._rectApplyAffineTransformIn=function(t,e){var i=cc.rectGetMinY(t),n=cc.rectGetMinX(t),r=cc.rectGetMaxX(t),c=cc.rectGetMaxY(t),o=cc.pointApplyAffineTransform(n,i,e),s=cc.pointApplyAffineTransform(r,i,e),a=cc.pointApplyAffineTransform(n,c,e),h=cc.pointApplyAffineTransform(r,c,e),l=Math.min(o.x,s.x,a.x,h.x),u=Math.max(o.x,s.x,a.x,h.x),_=Math.min(o.y,s.y,a.y,h.y),d=Math.max(o.y,s.y,a.y,h.y);return t.x=l,t.y=_,t.width=u-l,t.height=d-_,t},cc.affineTransformTranslate=function(t,e,i){return{a:t.a,b:t.b,c:t.c,d:t.d,tx:t.tx+t.a*e+t.c*i,ty:t.ty+t.b*e+t.d*i}},cc.affineTransformScale=function(t,e,i){return{a:t.a*e,b:t.b*e,c:t.c*i,d:t.d*i,tx:t.tx,ty:t.ty}},cc.affineTransformRotate=function(t,e){var i=Math.sin(e),n=Math.cos(e);return{a:t.a*n+t.c*i,b:t.b*n+t.d*i,c:t.c*n-t.a*i,d:t.d*n-t.b*i,tx:t.tx,ty:t.ty}},cc.affineTransformConcat=function(t,e){return{a:t.a*e.a+t.b*e.c,b:t.a*e.b+t.b*e.d,c:t.c*e.a+t.d*e.c,d:t.c*e.b+t.d*e.d,tx:t.tx*e.a+t.ty*e.c+e.tx,ty:t.tx*e.b+t.ty*e.d+e.ty}},cc.affineTransformConcatIn=function(t,e){var i=t.a,n=t.b,r=t.c,c=t.d,o=t.tx,s=t.ty;return t.a=i*e.a+n*e.c,t.b=i*e.b+n*e.d,t.c=r*e.a+c*e.c,t.d=r*e.b+c*e.d,t.tx=o*e.a+s*e.c+e.tx,t.ty=o*e.b+s*e.d+e.ty,t},cc.affineTransformEqualToTransform=function(t,e){return t.a===e.a&&t.b===e.b&&t.c===e.c&&t.d===e.d&&t.tx===e.tx&&t.ty===e.ty},cc.affineTransformInvert=function(t){var e=1/(t.a*t.d-t.b*t.c);return{a:e*t.d,b:-e*t.b,c:-e*t.c,d:e*t.a,tx:e*(t.c*t.ty-t.d*t.tx),ty:e*(t.b*t.tx-t.a*t.ty)}},cc.POINT_EPSILON=parseFloat("1.192092896e-07F"),cc.pNeg=function(t){return cc.p(-t.x,-t.y)},cc.pAdd=function(t,e){return cc.p(t.x+e.x,t.y+e.y)},cc.pSub=function(t,e){return cc.p(t.x-e.x,t.y-e.y)},cc.pMult=function(t,e){return cc.p(t.x*e,t.y*e)},cc.pMidpoint=function(t,e){return cc.pMult(cc.pAdd(t,e),.5)},cc.pDot=function(t,e){return t.x*e.x+t.y*e.y},cc.pCross=function(t,e){return t.x*e.y-t.y*e.x},cc.pPerp=function(t){return cc.p(-t.y,t.x)},cc.pRPerp=function(t){return cc.p(t.y,-t.x)},cc.pProject=function(t,e){return cc.pMult(e,cc.pDot(t,e)/cc.pDot(e,e))},cc.pRotate=function(t,e){return cc.p(t.x*e.x-t.y*e.y,t.x*e.y+t.y*e.x)},cc.pUnrotate=function(t,e){return cc.p(t.x*e.x+t.y*e.y,t.y*e.x-t.x*e.y)},cc.pLengthSQ=function(t){return cc.pDot(t,t)},cc.pDistanceSQ=function(t,e){return cc.pLengthSQ(cc.pSub(t,e))},cc.pLength=function(t){return Math.sqrt(cc.pLengthSQ(t))},cc.pDistance=function(t,e){return cc.pLength(cc.pSub(t,e))},cc.pNormalize=function(t){var e=cc.pLength(t);return 0===e?cc.p(t):cc.pMult(t,1/e)},cc.pForAngle=function(t){return cc.p(Math.cos(t),Math.sin(t))},cc.pToAngle=function(t){return Math.atan2(t.y,t.x)},cc.clampf=function(t,e,i){if(e>i){var n=e;e=i,i=n}return t<e?e:t<i?t:i},cc.pClamp=function(t,e,i){return cc.p(cc.clampf(t.x,e.x,i.x),cc.clampf(t.y,e.y,i.y))},cc.pFromSize=function(t){return cc.p(t.width,t.height)},cc.pCompOp=function(t,e){return cc.p(e(t.x),e(t.y))},cc.pLerp=function(t,e,i){return cc.pAdd(cc.pMult(t,1-i),cc.pMult(e,i))},cc.pFuzzyEqual=function(t,e,i){return t.x-i<=e.x&&e.x<=t.x+i&&t.y-i<=e.y&&e.y<=t.y+i},cc.pCompMult=function(t,e){return cc.p(t.x*e.x,t.y*e.y)},cc.pAngleSigned=function(t,e){var i=cc.pNormalize(t),n=cc.pNormalize(e),r=Math.atan2(i.x*n.y-i.y*n.x,cc.pDot(i,n));return Math.abs(r)<cc.POINT_EPSILON?0:r},cc.pAngle=function(t,e){var i=Math.acos(cc.pDot(cc.pNormalize(t),cc.pNormalize(e)));return Math.abs(i)<cc.POINT_EPSILON?0:i},cc.pRotateByAngle=function(t,e,i){var n=cc.pSub(t,e),r=Math.cos(i),c=Math.sin(i),o=n.x;return n.x=o*r-n.y*c+e.x,n.y=o*c+n.y*r+e.y,n},cc.pLineIntersect=function(t,e,i,n,r){if(t.x===e.x&&t.y===e.y||i.x===n.x&&i.y===n.y)return!1;var c=e.x-t.x,o=e.y-t.y,s=n.x-i.x,a=n.y-i.y,h=t.x-i.x,l=t.y-i.y,u=a*c-s*o;return r.x=s*l-a*h,r.y=c*l-o*h,0===u?0===r.x||0===r.y:(r.x=r.x/u,r.y=r.y/u,!0)},cc.pSegmentIntersect=function(t,e,i,n){var r=cc.p(0,0);return!!(cc.pLineIntersect(t,e,i,n,r)&&r.x>=0&&r.x<=1&&r.y>=0&&r.y<=1)},cc.pIntersectPoint=function(t,e,i,n){var r=cc.p(0,0);if(cc.pLineIntersect(t,e,i,n,r)){var c=cc.p(0,0);return c.x=t.x+r.x*(e.x-t.x),c.y=t.y+r.x*(e.y-t.y),c}return cc.p(0,0)},cc.pSameAs=function(t,e){return null!=t&&null!=e&&(t.x===e.x&&t.y===e.y)},cc.pZeroIn=function(t){t.x=0,t.y=0},cc.pIn=function(t,e){t.x=e.x,t.y=e.y},cc.pMultIn=function(t,e){t.x*=e,t.y*=e},cc.pSubIn=function(t,e){t.x-=e.x,t.y-=e.y},cc.pAddIn=function(t,e){t.x+=e.x,t.y+=e.y},cc.pNormalizeIn=function(t){cc.pMultIn(t,1/Math.sqrt(t.x*t.x+t.y*t.y))},cc.Touch=cc.Class.extend({_point:null,_prevPoint:null,_id:0,_startPointCaptured:!1,_startPoint:null,ctor:function(t,e,i){this.setTouchInfo(i,t,e)},getLocation:function(){return{x:this._point.x,y:this._point.y}},getLocationX:function(){return this._point.x},getLocationY:function(){return this._point.y},getPreviousLocation:function(){return{x:this._prevPoint.x,y:this._prevPoint.y}},getStartLocation:function(){return{x:this._startPoint.x,y:this._startPoint.y}},getDelta:function(){return cc.pSub(this._point,this._prevPoint)},getLocationInView:function(){return{x:this._point.x,y:this._point.y}},getPreviousLocationInView:function(){return{x:this._prevPoint.x,y:this._prevPoint.y}},getStartLocationInView:function(){return{x:this._startPoint.x,y:this._startPoint.y}},getID:function(){return this._id},getId:function(){return cc.log("getId is deprecated. Please use getID instead."),this._id},setTouchInfo:function(t,e,i){this._prevPoint=this._point,this._point=cc.p(e||0,i||0),this._id=t,this._startPointCaptured||(this._startPoint=cc.p(this._point),cc.view._convertPointWithScale(this._startPoint),this._startPointCaptured=!0)},_setPoint:function(t,e){void 0===e?(this._point.x=t.x,this._point.y=t.y):(this._point.x=t,this._point.y=e)},_setPrevPoint:function(t,e){void 0===e?this._prevPoint=cc.p(t.x,t.y):this._prevPoint=cc.p(t||0,e||0)}}),cc.Event=cc.Class.extend({_type:0,_isStopped:!1,_currentTarget:null,_setCurrentTarget:function(t){this._currentTarget=t},ctor:function(t){this._type=t},getType:function(){return this._type},stopPropagation:function(){this._isStopped=!0},isStopped:function(){return this._isStopped},getCurrentTarget:function(){return this._currentTarget}}),cc.Event.TOUCH=0,cc.Event.KEYBOARD=1,cc.Event.ACCELERATION=2,cc.Event.MOUSE=3,cc.Event.FOCUS=4,cc.Event.CUSTOM=6,cc.EventCustom=cc.Event.extend({_eventName:null,_userData:null,ctor:function(t){cc.Event.prototype.ctor.call(this,cc.Event.CUSTOM),this._eventName=t},setUserData:function(t){this._userData=t},getUserData:function(){return this._userData},getEventName:function(){return this._eventName}}),cc.EventMouse=cc.Event.extend({_eventType:0,_button:0,_x:0,_y:0,_prevX:0,_prevY:0,_scrollX:0,_scrollY:0,ctor:function(t){cc.Event.prototype.ctor.call(this,cc.Event.MOUSE),this._eventType=t},setScrollData:function(t,e){this._scrollX=t,this._scrollY=e},getScrollX:function(){return this._scrollX},getScrollY:function(){return this._scrollY},setLocation:function(t,e){this._x=t,this._y=e},getLocation:function(){return{x:this._x,y:this._y}},getLocationInView:function(){return{x:this._x,y:cc.view._designResolutionSize.height-this._y}},_setPrevCursor:function(t,e){this._prevX=t,this._prevY=e},getDelta:function(){return{x:this._x-this._prevX,y:this._y-this._prevY}},getDeltaX:function(){return this._x-this._prevX},getDeltaY:function(){return this._y-this._prevY},setButton:function(t){this._button=t},getButton:function(){return this._button},getLocationX:function(){return this._x},getLocationY:function(){return this._y}}),cc.EventMouse.NONE=0,cc.EventMouse.DOWN=1,cc.EventMouse.UP=2,cc.EventMouse.MOVE=3,cc.EventMouse.SCROLL=4,cc.EventMouse.BUTTON_LEFT=0,cc.EventMouse.BUTTON_RIGHT=2,cc.EventMouse.BUTTON_MIDDLE=1,cc.EventMouse.BUTTON_4=3,cc.EventMouse.BUTTON_5=4,cc.EventMouse.BUTTON_6=5,cc.EventMouse.BUTTON_7=6,cc.EventMouse.BUTTON_8=7,cc.EventTouch=cc.Event.extend({_eventCode:0,_touches:null,ctor:function(t){cc.Event.prototype.ctor.call(this,cc.Event.TOUCH),this._touches=t||[]},getEventCode:function(){return this._eventCode},getTouches:function(){return this._touches},_setEventCode:function(t){this._eventCode=t},_setTouches:function(t){this._touches=t}}),cc.EventTouch.MAX_TOUCHES=5,cc.EventTouch.EventCode={BEGAN:0,MOVED:1,ENDED:2,CANCELLED:3},cc.EventFocus=cc.Event.extend({_widgetGetFocus:null,_widgetLoseFocus:null,ctor:function(t,e){cc.Event.prototype.ctor.call(this,cc.Event.FOCUS),this._widgetGetFocus=e,this._widgetLoseFocus=t}}),cc.EventListener=cc.Class.extend({_onEvent:null,_type:0,_listenerID:null,_registered:!1,_fixedPriority:0,_node:null,_paused:!0,_isEnabled:!0,ctor:function(t,e,i){this._onEvent=i,this._type=t||0,this._listenerID=e||""},_setPaused:function(t){this._paused=t},_isPaused:function(){return this._paused},_setRegistered:function(t){this._registered=t},_isRegistered:function(){return this._registered},_getType:function(){return this._type},_getListenerID:function(){return this._listenerID},_setFixedPriority:function(t){this._fixedPriority=t},_getFixedPriority:function(){return this._fixedPriority},_setSceneGraphPriority:function(t){this._node=t},_getSceneGraphPriority:function(){return this._node},checkAvailable:function(){return null!==this._onEvent},clone:function(){return null},setEnabled:function(t){this._isEnabled=t},isEnabled:function(){return this._isEnabled},retain:function(){},release:function(){}}),cc.EventListener.UNKNOWN=0,cc.EventListener.TOUCH_ONE_BY_ONE=1,cc.EventListener.TOUCH_ALL_AT_ONCE=2,cc.EventListener.KEYBOARD=3,cc.EventListener.MOUSE=4,cc.EventListener.ACCELERATION=6,cc.EventListener.FOCUS=7,cc.EventListener.CUSTOM=8,cc._EventListenerCustom=cc.EventListener.extend({_onCustomEvent:null,ctor:function(t,e){this._onCustomEvent=e;var i=this,n=function(t){null!==i._onCustomEvent&&i._onCustomEvent(t)};cc.EventListener.prototype.ctor.call(this,cc.EventListener.CUSTOM,t,n)},checkAvailable:function(){return cc.EventListener.prototype.checkAvailable.call(this)&&null!==this._onCustomEvent},clone:function(){return new cc._EventListenerCustom(this._listenerID,this._onCustomEvent)}}),cc._EventListenerCustom.create=function(t,e){return new cc._EventListenerCustom(t,e)},cc._EventListenerMouse=cc.EventListener.extend({onMouseDown:null,onMouseUp:null,onMouseMove:null,onMouseScroll:null,ctor:function(){var t=this,e=function(e){var i=cc.EventMouse;switch(e._eventType){case i.DOWN:t.onMouseDown&&t.onMouseDown(e);break;case i.UP:t.onMouseUp&&t.onMouseUp(e);break;case i.MOVE:t.onMouseMove&&t.onMouseMove(e);break;case i.SCROLL:t.onMouseScroll&&t.onMouseScroll(e)}};cc.EventListener.prototype.ctor.call(this,cc.EventListener.MOUSE,cc._EventListenerMouse.LISTENER_ID,e)},clone:function(){var t=new cc._EventListenerMouse;return t.onMouseDown=this.onMouseDown,t.onMouseUp=this.onMouseUp,t.onMouseMove=this.onMouseMove,t.onMouseScroll=this.onMouseScroll,t},checkAvailable:function(){return!0}}),cc._EventListenerMouse.LISTENER_ID="__cc_mouse",cc._EventListenerMouse.create=function(){return new cc._EventListenerMouse},cc._EventListenerTouchOneByOne=cc.EventListener.extend({_claimedTouches:null,swallowTouches:!1,onTouchBegan:null,onTouchMoved:null,onTouchEnded:null,onTouchCancelled:null,ctor:function(){cc.EventListener.prototype.ctor.call(this,cc.EventListener.TOUCH_ONE_BY_ONE,cc._EventListenerTouchOneByOne.LISTENER_ID,null),this._claimedTouches=[]},setSwallowTouches:function(t){this.swallowTouches=t},isSwallowTouches:function(){return this.swallowTouches},clone:function(){var t=new cc._EventListenerTouchOneByOne;return t.onTouchBegan=this.onTouchBegan,t.onTouchMoved=this.onTouchMoved,t.onTouchEnded=this.onTouchEnded,t.onTouchCancelled=this.onTouchCancelled,t.swallowTouches=this.swallowTouches,t},checkAvailable:function(){return!!this.onTouchBegan||(cc.log(cc._LogInfos._EventListenerTouchOneByOne_checkAvailable),!1)}}),cc._EventListenerTouchOneByOne.LISTENER_ID="__cc_touch_one_by_one",cc._EventListenerTouchOneByOne.create=function(){return new cc._EventListenerTouchOneByOne},cc._EventListenerTouchAllAtOnce=cc.EventListener.extend({onTouchesBegan:null,onTouchesMoved:null,onTouchesEnded:null,onTouchesCancelled:null,ctor:function(){cc.EventListener.prototype.ctor.call(this,cc.EventListener.TOUCH_ALL_AT_ONCE,cc._EventListenerTouchAllAtOnce.LISTENER_ID,null)},clone:function(){var t=new cc._EventListenerTouchAllAtOnce;return t.onTouchesBegan=this.onTouchesBegan,t.onTouchesMoved=this.onTouchesMoved,t.onTouchesEnded=this.onTouchesEnded,t.onTouchesCancelled=this.onTouchesCancelled,t},checkAvailable:function(){return null!==this.onTouchesBegan||null!==this.onTouchesMoved||null!==this.onTouchesEnded||null!==this.onTouchesCancelled||(cc.log(cc._LogInfos._EventListenerTouchAllAtOnce_checkAvailable),!1)}}),cc._EventListenerTouchAllAtOnce.LISTENER_ID="__cc_touch_all_at_once",cc._EventListenerTouchAllAtOnce.create=function(){return new cc._EventListenerTouchAllAtOnce},cc.EventListener.create=function(t){cc.assert(t&&t.event,cc._LogInfos.EventListener_create);var e=t.event;delete t.event;var i=null;e===cc.EventListener.TOUCH_ONE_BY_ONE?i=new cc._EventListenerTouchOneByOne:e===cc.EventListener.TOUCH_ALL_AT_ONCE?i=new cc._EventListenerTouchAllAtOnce:e===cc.EventListener.MOUSE?i=new cc._EventListenerMouse:e===cc.EventListener.CUSTOM?(i=new cc._EventListenerCustom(t.eventName,t.callback),delete t.eventName,delete t.callback):e===cc.EventListener.KEYBOARD?i=new cc._EventListenerKeyboard:e===cc.EventListener.ACCELERATION?(i=new cc._EventListenerAcceleration(t.callback),delete t.callback):e===cc.EventListener.FOCUS&&(i=new cc._EventListenerFocus);for(var n in t)i[n]=t[n];return i},cc._EventListenerFocus=cc.EventListener.extend({clone:function(){var t=new cc._EventListenerFocus;return t.onFocusChanged=this.onFocusChanged,t},checkAvailable:function(){return!!this.onFocusChanged||(cc.log("Invalid EventListenerFocus!"),!1)},onFocusChanged:null,ctor:function(){var t=function(t){this.onFocusChanged&&this.onFocusChanged(t._widgetLoseFocus,t._widgetGetFocus)};cc.EventListener.prototype.ctor.call(this,cc.EventListener.FOCUS,cc._EventListenerFocus.LISTENER_ID,t)}}),cc._EventListenerFocus.LISTENER_ID="__cc_focus_event",cc._EventListenerVector=cc.Class.extend({_fixedListeners:null,_sceneGraphListeners:null,gt0Index:0,ctor:function(){this._fixedListeners=[],this._sceneGraphListeners=[]},size:function(){return this._fixedListeners.length+this._sceneGraphListeners.length},empty:function(){return 0===this._fixedListeners.length&&0===this._sceneGraphListeners.length},push:function(t){0===t._getFixedPriority()?this._sceneGraphListeners.push(t):this._fixedListeners.push(t)},clearSceneGraphListeners:function(){this._sceneGraphListeners.length=0;
},clearFixedListeners:function(){this._fixedListeners.length=0},clear:function(){this._sceneGraphListeners.length=0,this._fixedListeners.length=0},getFixedPriorityListeners:function(){return this._fixedListeners},getSceneGraphPriorityListeners:function(){return this._sceneGraphListeners}}),cc.__getListenerID=function(t){var e=cc.Event,i=t.getType();return i===e.ACCELERATION?cc._EventListenerAcceleration.LISTENER_ID:i===e.CUSTOM?t.getEventName():i===e.KEYBOARD?cc._EventListenerKeyboard.LISTENER_ID:i===e.MOUSE?cc._EventListenerMouse.LISTENER_ID:i===e.FOCUS?cc._EventListenerFocus.LISTENER_ID:(i===e.TOUCH&&cc.log(cc._LogInfos.__getListenerID),"")},cc.eventManager={DIRTY_NONE:0,DIRTY_FIXED_PRIORITY:1,DIRTY_SCENE_GRAPH_PRIORITY:2,DIRTY_ALL:3,_listenersMap:{},_priorityDirtyFlagMap:{},_nodeListenersMap:{},_nodePriorityMap:{},_globalZOrderNodeMap:{},_toAddedListeners:[],_toRemovedListeners:[],_dirtyNodes:[],_inDispatch:0,_isEnabled:!1,_nodePriorityIndex:0,_internalCustomListenerIDs:[cc.game.EVENT_HIDE,cc.game.EVENT_SHOW],_setDirtyForNode:function(t){null!=this._nodeListenersMap[t.__instanceId]&&this._dirtyNodes.push(t);for(var e=t.getChildren(),i=0,n=e.length;i<n;i++)this._setDirtyForNode(e[i])},pauseTarget:function(t,e){var i,n,r=this._nodeListenersMap[t.__instanceId];if(r)for(i=0,n=r.length;i<n;i++)r[i]._setPaused(!0);if(e===!0){var c=t.getChildren();for(i=0,n=c.length;i<n;i++)this.pauseTarget(c[i],!0)}},resumeTarget:function(t,e){var i,n,r=this._nodeListenersMap[t.__instanceId];if(r)for(i=0,n=r.length;i<n;i++)r[i]._setPaused(!1);if(this._setDirtyForNode(t),e===!0){var c=t.getChildren();for(i=0,n=c.length;i<n;i++)this.resumeTarget(c[i],!0)}},_addListener:function(t){0===this._inDispatch?this._forceAddEventListener(t):this._toAddedListeners.push(t)},_forceAddEventListener:function(t){var e=t._getListenerID(),i=this._listenersMap[e];if(i||(i=new cc._EventListenerVector,this._listenersMap[e]=i),i.push(t),0===t._getFixedPriority()){this._setDirty(e,this.DIRTY_SCENE_GRAPH_PRIORITY);var n=t._getSceneGraphPriority();null===n&&cc.log(cc._LogInfos.eventManager__forceAddEventListener),this._associateNodeAndEventListener(n,t),n.isRunning()&&this.resumeTarget(n)}else this._setDirty(e,this.DIRTY_FIXED_PRIORITY)},_getListeners:function(t){return this._listenersMap[t]},_updateDirtyFlagForSceneGraph:function(){if(0!==this._dirtyNodes.length){for(var t,e,i=this._dirtyNodes,n=this._nodeListenersMap,r=0,c=i.length;r<c;r++)if(t=n[i[r].__instanceId])for(var o=0,s=t.length;o<s;o++)e=t[o],e&&this._setDirty(e._getListenerID(),this.DIRTY_SCENE_GRAPH_PRIORITY);this._dirtyNodes.length=0}},_removeAllListenersInVector:function(t){if(t)for(var e,i=0;i<t.length;)e=t[i],e._setRegistered(!1),null!=e._getSceneGraphPriority()&&(this._dissociateNodeAndEventListener(e._getSceneGraphPriority(),e),e._setSceneGraphPriority(null)),0===this._inDispatch?cc.arrayRemoveObject(t,e):++i},_removeListenersForListenerID:function(t){var e,i=this._listenersMap[t];if(i){var n=i.getFixedPriorityListeners(),r=i.getSceneGraphPriorityListeners();this._removeAllListenersInVector(r),this._removeAllListenersInVector(n),delete this._priorityDirtyFlagMap[t],this._inDispatch||(i.clear(),delete this._listenersMap[t])}var c,o=this._toAddedListeners;for(e=0;e<o.length;)c=o[e],c&&c._getListenerID()===t?cc.arrayRemoveObject(o,c):++e},_sortEventListeners:function(t){var e=this.DIRTY_NONE,i=this._priorityDirtyFlagMap;if(i[t]&&(e=i[t]),e!==this.DIRTY_NONE&&(i[t]=this.DIRTY_NONE,e&this.DIRTY_FIXED_PRIORITY&&this._sortListenersOfFixedPriority(t),e&this.DIRTY_SCENE_GRAPH_PRIORITY)){var n=cc.director.getRunningScene();n?this._sortListenersOfSceneGraphPriority(t,n):i[t]=this.DIRTY_SCENE_GRAPH_PRIORITY}},_sortListenersOfSceneGraphPriority:function(t,e){var i=this._getListeners(t);if(i){var n=i.getSceneGraphPriorityListeners();n&&0!==n.length&&(this._nodePriorityIndex=0,this._nodePriorityMap={},this._visitTarget(e,!0),i.getSceneGraphPriorityListeners().sort(this._sortEventListenersOfSceneGraphPriorityDes))}},_sortEventListenersOfSceneGraphPriorityDes:function(t,e){var i=cc.eventManager._nodePriorityMap,n=t._getSceneGraphPriority(),r=e._getSceneGraphPriority();return e&&r&&i[r.__instanceId]?t&&n&&i[n.__instanceId]?i[e._getSceneGraphPriority().__instanceId]-i[t._getSceneGraphPriority().__instanceId]:1:-1},_sortListenersOfFixedPriority:function(t){var e=this._listenersMap[t];if(e){var i=e.getFixedPriorityListeners();if(i&&0!==i.length){i.sort(this._sortListenersOfFixedPriorityAsc);for(var n=0,r=i.length;n<r&&!(i[n]._getFixedPriority()>=0);)++n;e.gt0Index=n}}},_sortListenersOfFixedPriorityAsc:function(t,e){return t._getFixedPriority()-e._getFixedPriority()},_onUpdateListeners:function(t){var e=this._listenersMap[t];if(e){var i,n,r,c=e.getFixedPriorityListeners(),o=e.getSceneGraphPriorityListeners(),s=this._toRemovedListeners;if(o)for(i=0;i<o.length;)n=o[i],n._isRegistered()?++i:(cc.arrayRemoveObject(o,n),r=s.indexOf(n),r!==-1&&s.splice(r,1));if(c)for(i=0;i<c.length;)n=c[i],n._isRegistered()?++i:(cc.arrayRemoveObject(c,n),r=s.indexOf(n),r!==-1&&s.splice(r,1));o&&0===o.length&&e.clearSceneGraphListeners(),c&&0===c.length&&e.clearFixedListeners()}},_updateListeners:function(t){var e=this._inDispatch;if(cc.assert(e>0,cc._LogInfos.EventManager__updateListeners),!(e>1)){t.getType()===cc.Event.TOUCH?(this._onUpdateListeners(cc._EventListenerTouchOneByOne.LISTENER_ID),this._onUpdateListeners(cc._EventListenerTouchAllAtOnce.LISTENER_ID)):this._onUpdateListeners(cc.__getListenerID(t)),cc.assert(1===e,cc._LogInfos.EventManager__updateListeners_2);var i=this._listenersMap,n=this._priorityDirtyFlagMap;for(var r in i)i[r].empty()&&(delete n[r],delete i[r]);var c=this._toAddedListeners;if(0!==c.length){for(var o=0,s=c.length;o<s;o++)this._forceAddEventListener(c[o]);this._toAddedListeners.length=0}0!==this._toRemovedListeners.length&&this._cleanToRemovedListeners()}},_cleanToRemovedListeners:function(){for(var t=this._toRemovedListeners,e=0;e<t.length;e++){var i=t[e],n=this._listenersMap[i._getListenerID()];if(n){var r,c=n.getFixedPriorityListeners(),o=n.getSceneGraphPriorityListeners();o&&(r=o.indexOf(i),r!==-1&&o.splice(r,1)),c&&(r=c.indexOf(i),r!==-1&&c.splice(r,1))}}t.length=0},_onTouchEventCallback:function(t,e){if(!t._isRegistered)return!1;var i=e.event,n=e.selTouch;i._setCurrentTarget(t._node);var r,c=!1,o=i.getEventCode(),s=cc.EventTouch.EventCode;return o===s.BEGAN?t.onTouchBegan&&(c=t.onTouchBegan(n,i),c&&t._registered&&t._claimedTouches.push(n)):t._claimedTouches.length>0&&(r=t._claimedTouches.indexOf(n))!==-1&&(c=!0,o===s.MOVED&&t.onTouchMoved?t.onTouchMoved(n,i):o===s.ENDED?(t.onTouchEnded&&t.onTouchEnded(n,i),t._registered&&t._claimedTouches.splice(r,1)):o===s.CANCELLED&&(t.onTouchCancelled&&t.onTouchCancelled(n,i),t._registered&&t._claimedTouches.splice(r,1))),i.isStopped()?(cc.eventManager._updateListeners(i),!0):!!(c&&t._registered&&t.swallowTouches)&&(e.needsMutableSet&&e.touches.splice(n,1),!0)},_dispatchTouchEvent:function(t){this._sortEventListeners(cc._EventListenerTouchOneByOne.LISTENER_ID),this._sortEventListeners(cc._EventListenerTouchAllAtOnce.LISTENER_ID);var e=this._getListeners(cc._EventListenerTouchOneByOne.LISTENER_ID),i=this._getListeners(cc._EventListenerTouchAllAtOnce.LISTENER_ID);if(null!==e||null!==i){var n=t.getTouches(),r=cc.copyArray(n),c={event:t,needsMutableSet:e&&i,touches:r,selTouch:null};if(e)for(var o=0;o<n.length;o++)if(c.selTouch=n[o],this._dispatchEventToListeners(e,this._onTouchEventCallback,c),t.isStopped())return;i&&r.length>0&&(this._dispatchEventToListeners(i,this._onTouchesEventCallback,{event:t,touches:r}),t.isStopped())||this._updateListeners(t)}},_onTouchesEventCallback:function(t,e){if(!t._registered)return!1;var i=cc.EventTouch.EventCode,n=e.event,r=e.touches,c=n.getEventCode();return n._setCurrentTarget(t._node),c===i.BEGAN&&t.onTouchesBegan?t.onTouchesBegan(r,n):c===i.MOVED&&t.onTouchesMoved?t.onTouchesMoved(r,n):c===i.ENDED&&t.onTouchesEnded?t.onTouchesEnded(r,n):c===i.CANCELLED&&t.onTouchesCancelled&&t.onTouchesCancelled(r,n),!!n.isStopped()&&(cc.eventManager._updateListeners(n),!0)},_associateNodeAndEventListener:function(t,e){var i=this._nodeListenersMap[t.__instanceId];i||(i=[],this._nodeListenersMap[t.__instanceId]=i),i.push(e)},_dissociateNodeAndEventListener:function(t,e){var i=this._nodeListenersMap[t.__instanceId];i&&(cc.arrayRemoveObject(i,e),0===i.length&&delete this._nodeListenersMap[t.__instanceId])},_dispatchEventToListeners:function(t,e,i){var n,r,c=!1,o=t.getFixedPriorityListeners(),s=t.getSceneGraphPriorityListeners(),a=0;if(o&&0!==o.length)for(;a<t.gt0Index;++a)if(r=o[a],r.isEnabled()&&!r._isPaused()&&r._isRegistered()&&e(r,i)){c=!0;break}if(s&&!c)for(n=0;n<s.length;n++)if(r=s[n],r.isEnabled()&&!r._isPaused()&&r._isRegistered()&&e(r,i)){c=!0;break}if(o&&!c)for(;a<o.length;++a)if(r=o[a],r.isEnabled()&&!r._isPaused()&&r._isRegistered()&&e(r,i)){c=!0;break}},_setDirty:function(t,e){var i=this._priorityDirtyFlagMap;null==i[t]?i[t]=e:i[t]=e|i[t]},_visitTarget:function(t,e){var i=t.getChildren(),n=0,r=i.length,c=this._globalZOrderNodeMap,o=this._nodeListenersMap;if(r>0){for(var s;n<r&&(s=i[n],s&&s.getLocalZOrder()<0);n++)this._visitTarget(s,!1);for(null!=o[t.__instanceId]&&(c[t.getGlobalZOrder()]||(c[t.getGlobalZOrder()]=[]),c[t.getGlobalZOrder()].push(t.__instanceId));n<r;n++)s=i[n],s&&this._visitTarget(s,!1)}else null!=o[t.__instanceId]&&(c[t.getGlobalZOrder()]||(c[t.getGlobalZOrder()]=[]),c[t.getGlobalZOrder()].push(t.__instanceId));if(e){var a=[];for(var h in c)a.push(h);a.sort(this._sortNumberAsc);var l,u,_=a.length,d=this._nodePriorityMap;for(n=0;n<_;n++)for(l=c[a[n]],u=0;u<l.length;u++)d[l[u]]=++this._nodePriorityIndex;this._globalZOrderNodeMap={}}},_sortNumberAsc:function(t,e){return t-e},addListener:function(t,e){if(cc.assert(t&&e,cc._LogInfos.eventManager_addListener_2),t instanceof cc.EventListener){if(t._isRegistered())return void cc.log(cc._LogInfos.eventManager_addListener_4)}else cc.assert(!cc.isNumber(e),cc._LogInfos.eventManager_addListener_3),t=cc.EventListener.create(t);if(t.checkAvailable()){if(cc.isNumber(e)){if(0===e)return void cc.log(cc._LogInfos.eventManager_addListener);t._setSceneGraphPriority(null),t._setFixedPriority(e),t._setRegistered(!0),t._setPaused(!1),this._addListener(t)}else t._setSceneGraphPriority(e),t._setFixedPriority(0),t._setRegistered(!0),this._addListener(t);return t}},addCustomListener:function(t,e){var i=new cc._EventListenerCustom(t,e);return this.addListener(i,1),i},removeListener:function(t){if(null!=t){var e,i=this._listenersMap;for(var n in i){var r=i[n],c=r.getFixedPriorityListeners(),o=r.getSceneGraphPriorityListeners();if(e=this._removeListenerInVector(o,t),e?this._setDirty(t._getListenerID(),this.DIRTY_SCENE_GRAPH_PRIORITY):(e=this._removeListenerInVector(c,t),e&&this._setDirty(t._getListenerID(),this.DIRTY_FIXED_PRIORITY)),r.empty()&&(delete this._priorityDirtyFlagMap[t._getListenerID()],delete i[n]),e)break}if(!e)for(var s=this._toAddedListeners,a=0,h=s.length;a<h;a++){var l=s[a];if(l===t){cc.arrayRemoveObject(s,l),l._setRegistered(!1);break}}}},_removeListenerInCallback:function(t,e){if(null==t)return!1;for(var i=0,n=t.length;i<n;i++){var r=t[i];if(r._onCustomEvent===e||r._onEvent===e)return r._setRegistered(!1),null!=r._getSceneGraphPriority()&&(this._dissociateNodeAndEventListener(r._getSceneGraphPriority(),r),r._setSceneGraphPriority(null)),0===this._inDispatch&&cc.arrayRemoveObject(t,r),!0}return!1},_removeListenerInVector:function(t,e){if(null==t)return!1;for(var i=0,n=t.length;i<n;i++){var r=t[i];if(r===e)return r._setRegistered(!1),null!=r._getSceneGraphPriority()&&(this._dissociateNodeAndEventListener(r._getSceneGraphPriority(),r),r._setSceneGraphPriority(null)),0===this._inDispatch?cc.arrayRemoveObject(t,r):this._toRemovedListeners.push(r),!0}return!1},removeListeners:function(t,e){var i=this;if(t instanceof cc.Node){delete i._nodePriorityMap[t.__instanceId],cc.arrayRemoveObject(i._dirtyNodes,t);var n,r=i._nodeListenersMap[t.__instanceId];if(r){var c=cc.copyArray(r);for(n=0;n<c.length;n++)i.removeListener(c[n]);c.length=0}var o=i._toAddedListeners;for(n=0;n<o.length;){var s=o[n];s._getSceneGraphPriority()===t?(s._setSceneGraphPriority(null),s._setRegistered(!1),o.splice(n,1)):++n}if(e===!0){var a,h=t.getChildren();for(n=0,a=h.length;n<a;n++)i.removeListeners(h[n],!0)}}else t===cc.EventListener.TOUCH_ONE_BY_ONE?i._removeListenersForListenerID(cc._EventListenerTouchOneByOne.LISTENER_ID):t===cc.EventListener.TOUCH_ALL_AT_ONCE?i._removeListenersForListenerID(cc._EventListenerTouchAllAtOnce.LISTENER_ID):t===cc.EventListener.MOUSE?i._removeListenersForListenerID(cc._EventListenerMouse.LISTENER_ID):t===cc.EventListener.ACCELERATION?i._removeListenersForListenerID(cc._EventListenerAcceleration.LISTENER_ID):t===cc.EventListener.KEYBOARD?i._removeListenersForListenerID(cc._EventListenerKeyboard.LISTENER_ID):cc.log(cc._LogInfos.eventManager_removeListeners)},removeCustomListeners:function(t){this._removeListenersForListenerID(t)},removeAllListeners:function(){var t=this._listenersMap,e=this._internalCustomListenerIDs;for(var i in t)e.indexOf(i)===-1&&this._removeListenersForListenerID(i)},setPriority:function(t,e){if(null!=t){var i=this._listenersMap;for(var n in i){var r=i[n],c=r.getFixedPriorityListeners();if(c){var o=c.indexOf(t);if(o!==-1)return null!=t._getSceneGraphPriority()&&cc.log(cc._LogInfos.eventManager_setPriority),void(t._getFixedPriority()!==e&&(t._setFixedPriority(e),this._setDirty(t._getListenerID(),this.DIRTY_FIXED_PRIORITY)))}}}},setEnabled:function(t){this._isEnabled=t},isEnabled:function(){return this._isEnabled},dispatchEvent:function(t){if(this._isEnabled){if(this._updateDirtyFlagForSceneGraph(),this._inDispatch++,!t||!t.getType)throw new Error("event is undefined");if(t.getType()===cc.Event.TOUCH)return this._dispatchTouchEvent(t),void this._inDispatch--;var e=cc.__getListenerID(t);this._sortEventListeners(e);var i=this._listenersMap[e];null!=i&&this._dispatchEventToListeners(i,this._onListenerCallback,t),this._updateListeners(t),this._inDispatch--}},_onListenerCallback:function(t,e){return e._setCurrentTarget(t._getSceneGraphPriority()),t._onEvent(e),e.isStopped()},dispatchCustomEvent:function(t,e){var i=new cc.EventCustom(t);i.setUserData(e),this.dispatchEvent(i)}},cc._tmp.PrototypeCCNode=function(){var t=cc.Node.prototype;cc.defineGetterSetter(t,"x",t.getPositionX,t.setPositionX),cc.defineGetterSetter(t,"y",t.getPositionY,t.setPositionY),t.width,cc.defineGetterSetter(t,"width",t._getWidth,t._setWidth),t.height,cc.defineGetterSetter(t,"height",t._getHeight,t._setHeight),t.anchorX,cc.defineGetterSetter(t,"anchorX",t._getAnchorX,t._setAnchorX),t.anchorY,cc.defineGetterSetter(t,"anchorY",t._getAnchorY,t._setAnchorY),t.skewX,cc.defineGetterSetter(t,"skewX",t.getSkewX,t.setSkewX),t.skewY,cc.defineGetterSetter(t,"skewY",t.getSkewY,t.setSkewY),t.zIndex,cc.defineGetterSetter(t,"zIndex",t.getLocalZOrder,t.setLocalZOrder),t.vertexZ,cc.defineGetterSetter(t,"vertexZ",t.getVertexZ,t.setVertexZ),t.rotation,cc.defineGetterSetter(t,"rotation",t.getRotation,t.setRotation),t.rotationX,cc.defineGetterSetter(t,"rotationX",t.getRotationX,t.setRotationX),t.rotationY,cc.defineGetterSetter(t,"rotationY",t.getRotationY,t.setRotationY),t.scale,cc.defineGetterSetter(t,"scale",t.getScale,t.setScale),t.scaleX,cc.defineGetterSetter(t,"scaleX",t.getScaleX,t.setScaleX),t.scaleY,cc.defineGetterSetter(t,"scaleY",t.getScaleY,t.setScaleY),t.children,cc.defineGetterSetter(t,"children",t.getChildren),t.childrenCount,cc.defineGetterSetter(t,"childrenCount",t.getChildrenCount),t.parent,cc.defineGetterSetter(t,"parent",t.getParent,t.setParent),t.visible,cc.defineGetterSetter(t,"visible",t.isVisible,t.setVisible),t.running,cc.defineGetterSetter(t,"running",t.isRunning),t.ignoreAnchor,cc.defineGetterSetter(t,"ignoreAnchor",t.isIgnoreAnchorPointForPosition,t.ignoreAnchorPointForPosition),t.tag,t.userData,t.userObject,t.arrivalOrder,t.actionManager,cc.defineGetterSetter(t,"actionManager",t.getActionManager,t.setActionManager),t.scheduler,cc.defineGetterSetter(t,"scheduler",t.getScheduler,t.setScheduler),t.shaderProgram,cc.defineGetterSetter(t,"shaderProgram",t.getShaderProgram,t.setShaderProgram),t.opacity,cc.defineGetterSetter(t,"opacity",t.getOpacity,t.setOpacity),t.opacityModifyRGB,cc.defineGetterSetter(t,"opacityModifyRGB",t.isOpacityModifyRGB),t.cascadeOpacity,cc.defineGetterSetter(t,"cascadeOpacity",t.isCascadeOpacityEnabled,t.setCascadeOpacityEnabled),t.color,cc.defineGetterSetter(t,"color",t.getColor,t.setColor),t.cascadeColor,cc.defineGetterSetter(t,"cascadeColor",t.isCascadeColorEnabled,t.setCascadeColorEnabled)},cc.NODE_TAG_INVALID=-1,cc.s_globalOrderOfArrival=1,cc.Node=cc.Class.extend({_localZOrder:0,_globalZOrder:0,_vertexZ:0,_customZ:NaN,_rotationX:0,_rotationY:0,_scaleX:1,_scaleY:1,_position:null,_normalizedPosition:null,_usingNormalizedPosition:!1,_normalizedPositionDirty:!1,_skewX:0,_skewY:0,_children:null,_visible:!0,_anchorPoint:null,_contentSize:null,_running:!1,_parent:null,_ignoreAnchorPointForPosition:!1,tag:cc.NODE_TAG_INVALID,userData:null,userObject:null,_reorderChildDirty:!1,_shaderProgram:null,arrivalOrder:0,_actionManager:null,_scheduler:null,_eventDispatcher:null,_additionalTransformDirty:!1,_additionalTransform:null,_componentContainer:null,_isTransitionFinished:!1,_className:"Node",_showNode:!1,_name:"",_realOpacity:255,_realColor:null,_cascadeColorEnabled:!1,_cascadeOpacityEnabled:!1,_renderCmd:null,ctor:function(){this._initNode(),this._initRendererCmd()},_initNode:function(){var t=this;t._anchorPoint=cc.p(0,0),t._contentSize=cc.size(0,0),t._position=cc.p(0,0),t._normalizedPosition=cc.p(0,0),t._children=[];var e=cc.director;t._actionManager=e.getActionManager(),t._scheduler=e.getScheduler(),t._additionalTransform=cc.affineTransformMakeIdentity(),cc.ComponentContainer&&(t._componentContainer=new cc.ComponentContainer(t)),this._realOpacity=255,this._realColor=cc.color(255,255,255,255),this._cascadeColorEnabled=!1,this._cascadeOpacityEnabled=!1},init:function(){return!0},_arrayMakeObjectsPerformSelector:function(t,e){if(t&&0!==t.length){var i,n,r=t.length,c=cc.Node._stateCallbackType;switch(e){case c.onEnter:for(i=0;i<r;i++)n=t[i],n&&n.onEnter();break;case c.onExit:for(i=0;i<r;i++)n=t[i],n&&n.onExit();break;case c.onEnterTransitionDidFinish:for(i=0;i<r;i++)n=t[i],n&&n.onEnterTransitionDidFinish();break;case c.cleanup:for(i=0;i<r;i++)n=t[i],n&&n.cleanup();break;case c.updateTransform:for(i=0;i<r;i++)n=t[i],n&&n.updateTransform();break;case c.onExitTransitionDidStart:for(i=0;i<r;i++)n=t[i],n&&n.onExitTransitionDidStart();break;case c.sortAllChildren:for(i=0;i<r;i++)n=t[i],n&&n.sortAllChildren();break;default:cc.assert(0,cc._LogInfos.Node__arrayMakeObjectsPerformSelector)}}},attr:function(t){for(var e in t)this[e]=t[e]},getSkewX:function(){return this._skewX},setSkewX:function(t){this._skewX=t,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},getSkewY:function(){return this._skewY},setSkewY:function(t){this._skewY=t,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},setLocalZOrder:function(t){this._localZOrder=t,this._parent&&this._parent.reorderChild(this,t),cc.eventManager._setDirtyForNode(this)},_setLocalZOrder:function(t){this._localZOrder=t},getLocalZOrder:function(){return this._localZOrder},getZOrder:function(){return cc.log(cc._LogInfos.Node_getZOrder),this.getLocalZOrder()},setZOrder:function(t){cc.log(cc._LogInfos.Node_setZOrder),this.setLocalZOrder(t)},setGlobalZOrder:function(t){this._globalZOrder!==t&&(this._globalZOrder=t,cc.eventManager._setDirtyForNode(this))},getGlobalZOrder:function(){return this._globalZOrder},getVertexZ:function(){return this._vertexZ},setVertexZ:function(t){this._customZ=this._vertexZ=t},getRotation:function(){return this._rotationX!==this._rotationY&&cc.log(cc._LogInfos.Node_getRotation),this._rotationX},setRotation:function(t){this._rotationX=this._rotationY=t,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},getRotationX:function(){return this._rotationX},setRotationX:function(t){this._rotationX=t,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},getRotationY:function(){return this._rotationY},setRotationY:function(t){this._rotationY=t,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},getScale:function(){return this._scaleX!==this._scaleY&&cc.log(cc._LogInfos.Node_getScale),this._scaleX},setScale:function(t,e){this._scaleX=t,this._scaleY=e||0===e?e:t,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},getScaleX:function(){return this._scaleX},setScaleX:function(t){this._scaleX=t,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},getScaleY:function(){return this._scaleY},setScaleY:function(t){this._scaleY=t,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},setPosition:function(t,e){var i=this._position;if(void 0===e){if(i.x===t.x&&i.y===t.y)return;i.x=t.x,i.y=t.y}else{if(i.x===t&&i.y===e)return;i.x=t,i.y=e}this._usingNormalizedPosition=!1,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},setNormalizedPosition:function(t,e){var i=this._normalizedPosition;void 0===e?(i.x=t.x,i.y=t.y):(i.x=t,i.y=e),this._normalizedPositionDirty=this._usingNormalizedPosition=!0,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},getPosition:function(){return cc.p(this._position)},getNormalizedPosition:function(){return cc.p(this._normalizedPosition)},getPositionX:function(){return this._position.x},setPositionX:function(t){this._position.x=t,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},getPositionY:function(){return this._position.y},setPositionY:function(t){this._position.y=t,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},getChildrenCount:function(){return this._children.length},getChildren:function(){return this._children},isVisible:function(){return this._visible},setVisible:function(t){this._visible!==t&&(this._visible=t,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty),cc.renderer.childrenOrderDirty=!0)},getAnchorPoint:function(){return cc.p(this._anchorPoint)},setAnchorPoint:function(t,e){var i=this._anchorPoint;if(void 0===e){if(t.x===i.x&&t.y===i.y)return;i.x=t.x,i.y=t.y}else{if(t===i.x&&e===i.y)return;i.x=t,i.y=e}this._renderCmd._updateAnchorPointInPoint()},_getAnchorX:function(){return this._anchorPoint.x},_setAnchorX:function(t){this._anchorPoint.x!==t&&(this._anchorPoint.x=t,this._renderCmd._updateAnchorPointInPoint())},_getAnchorY:function(){return this._anchorPoint.y},_setAnchorY:function(t){this._anchorPoint.y!==t&&(this._anchorPoint.y=t,this._renderCmd._updateAnchorPointInPoint())},getAnchorPointInPoints:function(){return this._renderCmd.getAnchorPointInPoints()},_getWidth:function(){return this._contentSize.width},_setWidth:function(t){this._contentSize.width=t,this._renderCmd._updateAnchorPointInPoint()},_getHeight:function(){return this._contentSize.height},_setHeight:function(t){this._contentSize.height=t,this._renderCmd._updateAnchorPointInPoint()},getContentSize:function(){return cc.size(this._contentSize)},setContentSize:function(t,e){var i=this._contentSize;if(void 0===e){if(t.width===i.width&&t.height===i.height)return;i.width=t.width,i.height=t.height}else{if(t===i.width&&e===i.height)return;i.width=t,i.height=e}this._renderCmd._updateAnchorPointInPoint()},isRunning:function(){return this._running},getParent:function(){return this._parent},setParent:function(t){this._parent=t,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},isIgnoreAnchorPointForPosition:function(){return this._ignoreAnchorPointForPosition},ignoreAnchorPointForPosition:function(t){t!==this._ignoreAnchorPointForPosition&&(this._ignoreAnchorPointForPosition=t,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty))},getTag:function(){return this.tag},setTag:function(t){this.tag=t},setName:function(t){this._name=t},getName:function(){return this._name},getUserData:function(){return this.userData},setUserData:function(t){this.userData=t},getUserObject:function(){return this.userObject},setUserObject:function(t){this.userObject!==t&&(this.userObject=t)},getOrderOfArrival:function(){return this.arrivalOrder},setOrderOfArrival:function(t){this.arrivalOrder=t},getActionManager:function(){return this._actionManager||(this._actionManager=cc.director.getActionManager()),this._actionManager},setActionManager:function(t){this._actionManager!==t&&(this.stopAllActions(),this._actionManager=t)},getScheduler:function(){return this._scheduler||(this._scheduler=cc.director.getScheduler()),this._scheduler},setScheduler:function(t){this._scheduler!==t&&(this.unscheduleAllCallbacks(),this._scheduler=t)},boundingBox:function(){return cc.log(cc._LogInfos.Node_boundingBox),this.getBoundingBox()},getBoundingBox:function(){var t=cc.rect(0,0,this._contentSize.width,this._contentSize.height);return cc._rectApplyAffineTransformIn(t,this.getNodeToParentTransform())},cleanup:function(){this.stopAllActions(),this.unscheduleAllCallbacks(),cc.eventManager.removeListeners(this),this._arrayMakeObjectsPerformSelector(this._children,cc.Node._stateCallbackType.cleanup)},getChildByTag:function(t){var e=this._children;if(null!==e)for(var i=0;i<e.length;i++){var n=e[i];if(n&&n.tag===t)return n}return null},getChildByName:function(t){if(!t)return cc.log("Invalid name"),null;for(var e=this._children,i=0,n=e.length;i<n;i++)if(e[i]._name===t)return e[i];return null},addChild:function(t,e,i){e=void 0===e?t._localZOrder:e;var n,r=!1;cc.isUndefined(i)?(i=void 0,n=t._name):cc.isString(i)?(n=i,i=void 0):cc.isNumber(i)&&(r=!0,n=""),cc.assert(t,cc._LogInfos.Node_addChild_3),cc.assert(null===t._parent,"child already added. It can't be added again"),this._addChildHelper(t,e,i,n,r)},_addChildHelper:function(t,e,i,n,r){this._children||(this._children=[]),this._insertChild(t,e),r?t.setTag(i):t.setName(n),t.setParent(this),t.setOrderOfArrival(cc.s_globalOrderOfArrival++),this._running&&(t.onEnter(),this._isTransitionFinished&&t.onEnterTransitionDidFinish()),t._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty),this._cascadeColorEnabled&&t._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.colorDirty),this._cascadeOpacityEnabled&&t._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.opacityDirty)},removeFromParent:function(t){this._parent&&(void 0===t&&(t=!0),this._parent.removeChild(this,t))},removeFromParentAndCleanup:function(t){cc.log(cc._LogInfos.Node_removeFromParentAndCleanup),this.removeFromParent(t)},removeChild:function(t,e){0!==this._children.length&&(void 0===e&&(e=!0),this._children.indexOf(t)>-1&&this._detachChild(t,e),cc.renderer.childrenOrderDirty=!0)},removeChildByTag:function(t,e){t===cc.NODE_TAG_INVALID&&cc.log(cc._LogInfos.Node_removeChildByTag);var i=this.getChildByTag(t);i?this.removeChild(i,e):cc.log(cc._LogInfos.Node_removeChildByTag_2,t)},removeAllChildrenWithCleanup:function(t){this.removeAllChildren(t)},removeAllChildren:function(t){var e=this._children;if(null!==e){void 0===t&&(t=!0);for(var i=0;i<e.length;i++){var n=e[i];n&&(this._running&&(n.onExitTransitionDidStart(),n.onExit()),t&&n.cleanup(),n.parent=null,n._renderCmd.detachFromParent())}this._children.length=0,cc.renderer.childrenOrderDirty=!0}},_detachChild:function(t,e){this._running&&(t.onExitTransitionDidStart(),t.onExit()),e&&t.cleanup(),t.parent=null,t._renderCmd.detachFromParent(),cc.arrayRemoveObject(this._children,t)},_insertChild:function(t,e){cc.renderer.childrenOrderDirty=this._reorderChildDirty=!0,this._children.push(t),t._setLocalZOrder(e)},setNodeDirty:function(){this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},reorderChild:function(t,e){cc.assert(t,cc._LogInfos.Node_reorderChild),cc.renderer.childrenOrderDirty=this._reorderChildDirty=!0,t.arrivalOrder=cc.s_globalOrderOfArrival,cc.s_globalOrderOfArrival++,t._setLocalZOrder(e),this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.orderDirty)},sortAllChildren:function(){if(this._reorderChildDirty){var t,e,i,n=this._children,r=n.length;for(t=1;t<r;t++){for(i=n[t],e=t-1;e>=0;){if(i._localZOrder<n[e]._localZOrder)n[e+1]=n[e];else{if(!(i._localZOrder===n[e]._localZOrder&&i.arrivalOrder<n[e].arrivalOrder))break;n[e+1]=n[e]}e--}n[e+1]=i}this._reorderChildDirty=!1}},draw:function(t){},transformAncestors:function(){null!==this._parent&&(this._parent.transformAncestors(),this._parent.transform())},onEnter:function(){this._isTransitionFinished=!1,this._running=!0,this._arrayMakeObjectsPerformSelector(this._children,cc.Node._stateCallbackType.onEnter),this.resume()},onEnterTransitionDidFinish:function(){this._isTransitionFinished=!0,this._arrayMakeObjectsPerformSelector(this._children,cc.Node._stateCallbackType.onEnterTransitionDidFinish)},onExitTransitionDidStart:function(){this._arrayMakeObjectsPerformSelector(this._children,cc.Node._stateCallbackType.onExitTransitionDidStart)},onExit:function(){this._running=!1,this.pause(),this._arrayMakeObjectsPerformSelector(this._children,cc.Node._stateCallbackType.onExit),this.removeAllComponents()},runAction:function(t){return cc.assert(t,cc._LogInfos.Node_runAction),this.actionManager.addAction(t,this,!this._running),t},stopAllActions:function(){this.actionManager&&this.actionManager.removeAllActionsFromTarget(this)},stopAction:function(t){this.actionManager.removeAction(t)},stopActionByTag:function(t){return t===cc.ACTION_TAG_INVALID?void cc.log(cc._LogInfos.Node_stopActionByTag):void this.actionManager.removeActionByTag(t,this)},getActionByTag:function(t){return t===cc.ACTION_TAG_INVALID?(cc.log(cc._LogInfos.Node_getActionByTag),null):this.actionManager.getActionByTag(t,this)},getNumberOfRunningActions:function(){return this.actionManager.numberOfRunningActionsInTarget(this)},scheduleUpdate:function(){this.scheduleUpdateWithPriority(0)},scheduleUpdateWithPriority:function(t){this.scheduler.scheduleUpdate(this,t,!this._running)},unscheduleUpdate:function(){this.scheduler.unscheduleUpdate(this)},schedule:function(t,e,i,n,r){var c=arguments.length;"function"==typeof t?1===c?(e=0,i=cc.REPEAT_FOREVER,n=0,r=this.__instanceId):2===c?"number"==typeof e?(i=cc.REPEAT_FOREVER,n=0,r=this.__instanceId):(r=e,e=0,i=cc.REPEAT_FOREVER,n=0):3===c?("string"==typeof i?(r=i,i=cc.REPEAT_FOREVER):r=this.__instanceId,n=0):4===c&&(r=this.__instanceId):1===c?(e=0,i=cc.REPEAT_FOREVER,n=0):2===c&&(i=cc.REPEAT_FOREVER,n=0),cc.assert(t,cc._LogInfos.Node_schedule),cc.assert(e>=0,cc._LogInfos.Node_schedule_2),e=e||0,i=null==i?cc.REPEAT_FOREVER:i,n=n||0,this.scheduler.schedule(t,this,e,i,n,!this._running,r)},scheduleOnce:function(t,e,i){void 0===i&&(i=this.__instanceId),this.schedule(t,0,0,e,i)},unschedule:function(t){t&&this.scheduler.unschedule(t,this)},unscheduleAllCallbacks:function(){this.scheduler.unscheduleAllForTarget(this)},resumeSchedulerAndActions:function(){cc.log(cc._LogInfos.Node_resumeSchedulerAndActions),this.resume()},resume:function(){this.scheduler.resumeTarget(this),this.actionManager&&this.actionManager.resumeTarget(this),cc.eventManager.resumeTarget(this)},pauseSchedulerAndActions:function(){cc.log(cc._LogInfos.Node_pauseSchedulerAndActions),this.pause()},pause:function(){this.scheduler.pauseTarget(this),this.actionManager&&this.actionManager.pauseTarget(this),cc.eventManager.pauseTarget(this)},setAdditionalTransform:function(t){return void 0===t?this._additionalTransformDirty=!1:(this._additionalTransform=t,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty),void(this._additionalTransformDirty=!0))},getParentToNodeTransform:function(){return this._renderCmd.getParentToNodeTransform()},parentToNodeTransform:function(){return this.getParentToNodeTransform()},getNodeToWorldTransform:function(){for(var t=this.getNodeToParentTransform(),e=this._parent;null!==e;e=e.parent)t=cc.affineTransformConcat(t,e.getNodeToParentTransform());return t},nodeToWorldTransform:function(){return this.getNodeToWorldTransform()},getWorldToNodeTransform:function(){return cc.affineTransformInvert(this.getNodeToWorldTransform());
},worldToNodeTransform:function(){return this.getWorldToNodeTransform()},convertToNodeSpace:function(t){return cc.pointApplyAffineTransform(t,this.getWorldToNodeTransform())},convertToWorldSpace:function(t){return t=t||cc.p(0,0),cc.pointApplyAffineTransform(t,this.getNodeToWorldTransform())},convertToNodeSpaceAR:function(t){return cc.pSub(this.convertToNodeSpace(t),this._renderCmd.getAnchorPointInPoints())},convertToWorldSpaceAR:function(t){t=t||cc.p(0,0);var e=cc.pAdd(t,this._renderCmd.getAnchorPointInPoints());return this.convertToWorldSpace(e)},_convertToWindowSpace:function(t){var e=this.convertToWorldSpace(t);return cc.director.convertToUI(e)},convertTouchToNodeSpace:function(t){var e=t.getLocation();return this.convertToNodeSpace(e)},convertTouchToNodeSpaceAR:function(t){var e=cc.director.convertToGL(t.getLocation());return this.convertToNodeSpaceAR(e)},update:function(t){this._componentContainer&&!this._componentContainer.isEmpty()&&this._componentContainer.visit(t)},updateTransform:function(){this._arrayMakeObjectsPerformSelector(this._children,cc.Node._stateCallbackType.updateTransform)},retain:function(){},release:function(){},getComponent:function(t){return this._componentContainer?this._componentContainer.getComponent(t):null},addComponent:function(t){this._componentContainer&&this._componentContainer.add(t)},removeComponent:function(t){return!!this._componentContainer&&this._componentContainer.remove(t)},removeAllComponents:function(){this._componentContainer&&this._componentContainer.removeAll()},grid:null,visit:function(t){this._renderCmd.visit(t)},transform:function(t,e){this._renderCmd.transform(t,e)},nodeToParentTransform:function(){return this.getNodeToParentTransform()},getNodeToParentTransform:function(t){var e=this._renderCmd.getNodeToParentTransform();if(t){for(var i={a:e.a,b:e.b,c:e.c,d:e.d,tx:e.tx,ty:e.ty},n=this._parent;null!=n&&n!=t;n=n.getParent())cc.affineTransformConcatIn(i,n.getNodeToParentTransform());return i}return e},getNodeToParentAffineTransform:function(t){return this.getNodeToParentTransform(t)},getCamera:function(){return null},getGrid:function(){return this.grid},setGrid:function(t){this.grid=t},getShaderProgram:function(){return this._renderCmd.getShaderProgram()},setShaderProgram:function(t){this._renderCmd.setShaderProgram(t)},getGLServerState:function(){return 0},setGLServerState:function(t){},getBoundingBoxToWorld:function(){var t=cc.rect(0,0,this._contentSize.width,this._contentSize.height),e=this.getNodeToWorldTransform();if(t=cc.rectApplyAffineTransform(t,e),!this._children)return t;for(var i=this._children,n=0;n<i.length;n++){var r=i[n];if(r&&r._visible){var c=r._getBoundingBoxToCurrentNode(e);c&&(t=cc.rectUnion(t,c))}}return t},_getBoundingBoxToCurrentNode:function(t){var e=cc.rect(0,0,this._contentSize.width,this._contentSize.height),i=void 0===t?this.getNodeToParentTransform():cc.affineTransformConcat(this.getNodeToParentTransform(),t);if(e=cc.rectApplyAffineTransform(e,i),!this._children)return e;for(var n=this._children,r=0;r<n.length;r++){var c=n[r];if(c&&c._visible){var o=c._getBoundingBoxToCurrentNode(i);o&&(e=cc.rectUnion(e,o))}}return e},getOpacity:function(){return this._realOpacity},getDisplayedOpacity:function(){return this._renderCmd.getDisplayedOpacity()},setOpacity:function(t){this._realOpacity=t,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.opacityDirty)},updateDisplayedOpacity:function(t){this._renderCmd._updateDisplayOpacity(t)},isCascadeOpacityEnabled:function(){return this._cascadeOpacityEnabled},setCascadeOpacityEnabled:function(t){this._cascadeOpacityEnabled!==t&&(this._cascadeOpacityEnabled=t,this._renderCmd.setCascadeOpacityEnabledDirty())},getColor:function(){var t=this._realColor;return cc.color(t.r,t.g,t.b,t.a)},getDisplayedColor:function(){return this._renderCmd.getDisplayedColor()},setColor:function(t){var e=this._realColor;e.r=t.r,e.g=t.g,e.b=t.b,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.colorDirty)},updateDisplayedColor:function(t){this._renderCmd._updateDisplayColor(t)},isCascadeColorEnabled:function(){return this._cascadeColorEnabled},setCascadeColorEnabled:function(t){this._cascadeColorEnabled!==t&&(this._cascadeColorEnabled=t,this._renderCmd.setCascadeColorEnabledDirty())},setOpacityModifyRGB:function(t){},isOpacityModifyRGB:function(){return!1},_initRendererCmd:function(){this._renderCmd=cc.renderer.getRenderCmd(this)},_createRenderCmd:function(){return cc._renderType===cc.game.RENDER_TYPE_CANVAS?new cc.Node.CanvasRenderCmd(this):new cc.Node.WebGLRenderCmd(this)},enumerateChildren:function(t,e){cc.assert(t&&0!=t.length,"Invalid name"),cc.assert(null!=e,"Invalid callback function");var i=t.length,n=0,r=i,c=!1;i>2&&"/"===t[0]&&"/"===t[1]&&(c=!0,n=2,r-=2);var o=!1;i>3&&"/"===t[i-3]&&"."===t[i-2]&&"."===t[i-1]&&(o=!0,r-=3);var s=t.substr(n,r);o&&(s="[[:alnum:]]+/"+s),c?this.doEnumerateRecursive(this,s,e):this.doEnumerate(s,e)},doEnumerateRecursive:function(t,e,i){var n=!1;if(t.doEnumerate(e,i))n=!0;else for(var r,c=t.getChildren(),o=c.length,s=0;s<o;s++)if(r=c[s],this.doEnumerateRecursive(r,e,i)){n=!0;break}},doEnumerate:function(t,e){var i=t.indexOf("/"),n=t,r=!1;i!==-1&&(n=t.substr(0,i),r=!0);for(var c,o=!1,s=this._children,a=s.length,h=0;h<a;h++)if(c=s[h],c._name.indexOf(n)!==-1)if(r){if(o=c.doEnumerate(t,e))break}else if(e(c)){o=!0;break}return o}}),cc.Node.create=function(){return new cc.Node},cc.Node._stateCallbackType={onEnter:1,onExit:2,cleanup:3,onEnterTransitionDidFinish:4,updateTransform:5,onExitTransitionDidStart:6,sortAllChildren:7},cc.assert(cc.isFunction(cc._tmp.PrototypeCCNode),cc._LogInfos.MissingFile,"BaseNodesPropertyDefine.js"),cc._tmp.PrototypeCCNode(),delete cc._tmp.PrototypeCCNode,cc.CustomRenderCmd=function(t,e){this._needDraw=!0,this._target=t,this._callback=e,this.rendering=function(t,e,i){this._callback&&this._callback.call(this._target,t,e,i)},this.needDraw=function(){return this._needDraw}},cc.Node._dirtyFlags={transformDirty:1,visibleDirty:2,colorDirty:4,opacityDirty:8,cacheDirty:16,orderDirty:32,textDirty:64,gradientDirty:128,textureDirty:256,contentDirty:512,COUNT:10,all:1023},cc.Node.RenderCmd=function(t){this._dirtyFlag=1,this._savedDirtyFlag=!0,this._node=t,this._needDraw=!1,this._anchorPointInPoints=new cc.Point(0,0),this._transform={a:1,b:0,c:0,d:1,tx:0,ty:0},this._worldTransform={a:1,b:0,c:0,d:1,tx:0,ty:0},this._inverse={a:1,b:0,c:0,d:1,tx:0,ty:0},this._displayedOpacity=255,this._displayedColor=cc.color(255,255,255,255),this._cascadeColorEnabledDirty=!1,this._cascadeOpacityEnabledDirty=!1,this._curLevel=-1},cc.Node.RenderCmd.prototype={constructor:cc.Node.RenderCmd,needDraw:function(){return this._needDraw},getAnchorPointInPoints:function(){return cc.p(this._anchorPointInPoints)},getDisplayedColor:function(){var t=this._displayedColor;return cc.color(t.r,t.g,t.b,t.a)},getDisplayedOpacity:function(){return this._displayedOpacity},setCascadeColorEnabledDirty:function(){this._cascadeColorEnabledDirty=!0,this.setDirtyFlag(cc.Node._dirtyFlags.colorDirty)},setCascadeOpacityEnabledDirty:function(){this._cascadeOpacityEnabledDirty=!0,this.setDirtyFlag(cc.Node._dirtyFlags.opacityDirty)},getParentToNodeTransform:function(){return this._dirtyFlag&cc.Node._dirtyFlags.transformDirty&&(this._inverse=cc.affineTransformInvert(this.getNodeToParentTransform())),this._inverse},detachFromParent:function(){},_updateAnchorPointInPoint:function(){var t=this._anchorPointInPoints,e=this._node._contentSize,i=this._node._anchorPoint;t.x=e.width*i.x,t.y=e.height*i.y,this.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},setDirtyFlag:function(t){0===this._dirtyFlag&&0!==t&&cc.renderer.pushDirtyNode(this),this._dirtyFlag|=t},getParentRenderCmd:function(){return this._node&&this._node._parent&&this._node._parent._renderCmd?this._node._parent._renderCmd:null},transform:function(t,e){var i=this._node,n=t?t._worldTransform:null,r=this._transform,c=this._worldTransform;if(i._usingNormalizedPosition&&i._parent){var o=i._parent._contentSize;i._position.x=i._normalizedPosition.x*o.width,i._position.y=i._normalizedPosition.y*o.height,i._normalizedPositionDirty=!1}var s=i._rotationX||i._rotationY,a=i._skewX||i._skewY,h=i._scaleX,l=i._scaleY,u=this._anchorPointInPoints.x,_=this._anchorPointInPoints.y,d=1,f=0,p=0,g=1;if(s||a){if(r.tx=i._position.x,r.ty=i._position.y,s){var m=.017453292519943295*i._rotationX;if(p=Math.sin(m),g=Math.cos(m),i._rotationY===i._rotationX)d=g,f=-p;else{var v=.017453292519943295*i._rotationY;d=Math.cos(v),f=-Math.sin(v)}}if(r.a=d*=h,r.b=f*=h,r.c=p*=l,r.d=g*=l,a){var T=Math.tan(i._skewX*Math.PI/180),y=Math.tan(i._skewY*Math.PI/180);T===1/0&&(T=99999999),y===1/0&&(y=99999999),r.a=d+p*y,r.b=f+g*y,r.c=p+d*T,r.d=g+f*T}(u||_)&&(r.tx-=r.a*u+r.c*_,r.ty-=r.b*u+r.d*_,i._ignoreAnchorPointForPosition&&(r.tx+=u,r.ty+=_)),n?(c.a=r.a*n.a+r.b*n.c,c.b=r.a*n.b+r.b*n.d,c.c=r.c*n.a+r.d*n.c,c.d=r.c*n.b+r.d*n.d,c.tx=n.a*r.tx+n.c*r.ty+n.tx,c.ty=n.d*r.ty+n.ty+n.b*r.tx):(c.a=r.a,c.b=r.b,c.c=r.c,c.d=r.d,c.tx=r.tx,c.ty=r.ty)}else r.a=h,r.b=0,r.c=0,r.d=l,r.tx=i._position.x,r.ty=i._position.y,(u||_)&&(r.tx-=r.a*u,r.ty-=r.d*_,i._ignoreAnchorPointForPosition&&(r.tx+=u,r.ty+=_)),n?(c.a=r.a*n.a+r.b*n.c,c.b=r.a*n.b+r.b*n.d,c.c=r.c*n.a+r.d*n.c,c.d=r.c*n.b+r.d*n.d,c.tx=r.tx*n.a+r.ty*n.c+n.tx,c.ty=r.tx*n.b+r.ty*n.d+n.ty):(c.a=r.a,c.b=r.b,c.c=r.c,c.d=r.d,c.tx=r.tx,c.ty=r.ty);if(i._additionalTransformDirty&&(this._transform=cc.affineTransformConcat(r,i._additionalTransform)),this._updateCurrentRegions&&this._updateCurrentRegions(),this._notifyRegionStatus&&this._notifyRegionStatus(cc.Node.CanvasRenderCmd.RegionStatus.DirtyDouble),e){var S=this._node._children;if(!S||0===S.length)return;var C,E;for(C=0,E=S.length;C<E;C++)S[C]._renderCmd.transform(this,e)}this._cacheDirty=!0},getNodeToParentTransform:function(){return this._dirtyFlag&cc.Node._dirtyFlags.transformDirty&&this.transform(),this._transform},visit:function(t){var e=this._node,i=cc.renderer;e._visible&&(t=t||this.getParentRenderCmd(),t&&(this._curLevel=t._curLevel+1),isNaN(e._customZ)&&(e._vertexZ=i.assignedZ,i.assignedZ+=i.assignedZStep),this._syncStatus(t),this.visitChildren())},_updateDisplayColor:function(t){var e,i,n,r,c=this._node,o=this._displayedColor,s=c._realColor;if(this._notifyRegionStatus&&this._notifyRegionStatus(cc.Node.CanvasRenderCmd.RegionStatus.Dirty),this._cascadeColorEnabledDirty&&!c._cascadeColorEnabled){o.r=s.r,o.g=s.g,o.b=s.b;var a=new cc.Color(255,255,255,255);for(n=c._children,e=0,i=n.length;e<i;e++)r=n[e],r&&r._renderCmd&&r._renderCmd._updateDisplayColor(a);this._cascadeColorEnabledDirty=!1}else{if(void 0===t){var h=c._parent;t=h&&h._cascadeColorEnabled?h.getDisplayedColor():cc.color.WHITE}if(o.r=0|s.r*t.r/255,o.g=0|s.g*t.g/255,o.b=0|s.b*t.b/255,c._cascadeColorEnabled)for(n=c._children,e=0,i=n.length;e<i;e++)r=n[e],r&&r._renderCmd&&(r._renderCmd._updateDisplayColor(o),r._renderCmd._updateColor())}this._dirtyFlag=this._dirtyFlag&cc.Node._dirtyFlags.colorDirty^this._dirtyFlag},_updateDisplayOpacity:function(t){var e,i,n,r,c=this._node;if(this._notifyRegionStatus&&this._notifyRegionStatus(cc.Node.CanvasRenderCmd.RegionStatus.Dirty),this._cascadeOpacityEnabledDirty&&!c._cascadeOpacityEnabled){for(this._displayedOpacity=c._realOpacity,n=c._children,e=0,i=n.length;e<i;e++)r=n[e],r&&r._renderCmd&&r._renderCmd._updateDisplayOpacity(255);this._cascadeOpacityEnabledDirty=!1}else{if(void 0===t){var o=c._parent;t=255,o&&o._cascadeOpacityEnabled&&(t=o.getDisplayedOpacity())}if(this._displayedOpacity=c._realOpacity*t/255,c._cascadeOpacityEnabled)for(n=c._children,e=0,i=n.length;e<i;e++)r=n[e],r&&r._renderCmd&&(r._renderCmd._updateDisplayOpacity(this._displayedOpacity),r._renderCmd._updateColor())}this._dirtyFlag=this._dirtyFlag&cc.Node._dirtyFlags.opacityDirty^this._dirtyFlag},_syncDisplayColor:function(t){var e=this._node,i=this._displayedColor,n=e._realColor;if(void 0===t){var r=e._parent;t=r&&r._cascadeColorEnabled?r.getDisplayedColor():cc.color.WHITE}i.r=0|n.r*t.r/255,i.g=0|n.g*t.g/255,i.b=0|n.b*t.b/255},_syncDisplayOpacity:function(t){var e=this._node;if(void 0===t){var i=e._parent;t=255,i&&i._cascadeOpacityEnabled&&(t=i.getDisplayedOpacity())}this._displayedOpacity=e._realOpacity*t/255},_updateColor:function(){},updateStatus:function(){var t=cc.Node._dirtyFlags,e=this._dirtyFlag,i=e&t.colorDirty,n=e&t.opacityDirty;this._savedDirtyFlag=this._savedDirtyFlag||e,i&&this._updateDisplayColor(),n&&this._updateDisplayOpacity(),(i||n)&&this._updateColor(),e&t.transformDirty&&(this.transform(this.getParentRenderCmd(),!0),this._dirtyFlag=this._dirtyFlag&t.transformDirty^this._dirtyFlag),e&t.orderDirty&&(this._dirtyFlag=this._dirtyFlag&t.orderDirty^this._dirtyFlag)},_syncStatus:function(t){var e=cc.Node._dirtyFlags,i=this._dirtyFlag,n=null;t?(n=t._node,this._savedDirtyFlag=this._savedDirtyFlag||t._savedDirtyFlag||i):this._savedDirtyFlag=this._savedDirtyFlag||i,n&&n._cascadeColorEnabled&&t._dirtyFlag&e.colorDirty&&(i|=e.colorDirty),n&&n._cascadeOpacityEnabled&&t._dirtyFlag&e.opacityDirty&&(i|=e.opacityDirty),t&&t._dirtyFlag&e.transformDirty&&(i|=e.transformDirty);var r=i&e.colorDirty,c=i&e.opacityDirty;this._dirtyFlag=i,r&&this._syncDisplayColor(),c&&this._syncDisplayOpacity(),(r||c)&&this._updateColor(),i&e.transformDirty&&this.transform(t),i&e.orderDirty&&(this._dirtyFlag=this._dirtyFlag&e.orderDirty^this._dirtyFlag)},visitChildren:function(){var t,e,i=cc.renderer,n=this._node,r=n._children,c=r.length;if(c>0){for(n.sortAllChildren(),t=0;t<c&&(e=r[t],e._localZOrder<0);t++)e._renderCmd.visit(this);for(i.pushRenderCommand(this);t<c;t++)r[t]._renderCmd.visit(this)}else i.pushRenderCommand(this);this._dirtyFlag=0}},cc.Node.RenderCmd.prototype.originVisit=cc.Node.RenderCmd.prototype.visit,cc.Node.RenderCmd.prototype.originTransform=cc.Node.RenderCmd.prototype.transform,function(){cc.Node.CanvasRenderCmd=function(t){cc.Node.RenderCmd.call(this,t),this._cachedParent=null,this._cacheDirty=!1,this._currentRegion=new cc.Region,this._oldRegion=new cc.Region,this._regionFlag=0,this._canUseDirtyRegion=!1},cc.Node.CanvasRenderCmd.RegionStatus={NotDirty:0,Dirty:1,DirtyDouble:2};var t=cc.Node.CanvasRenderCmd.prototype=Object.create(cc.Node.RenderCmd.prototype);t.constructor=cc.Node.CanvasRenderCmd,t._notifyRegionStatus=function(t){this._needDraw&&this._regionFlag<t&&(this._regionFlag=t)};var e=new cc.Rect;t.getLocalBB=function(){var t=this._node;return e.x=e.y=0,e.width=t._contentSize.width,e.height=t._contentSize.height,e},t._updateCurrentRegions=function(){var t=this._currentRegion;this._currentRegion=this._oldRegion,this._oldRegion=t,cc.Node.CanvasRenderCmd.RegionStatus.DirtyDouble!==this._regionFlag||this._currentRegion.isEmpty()||this._oldRegion.union(this._currentRegion),this._currentRegion.updateRegion(this.getLocalBB(),this._worldTransform)},t.setDirtyFlag=function(t,e){cc.Node.RenderCmd.prototype.setDirtyFlag.call(this,t,e),this._setCacheDirty(e),this._cachedParent&&this._cachedParent.setDirtyFlag(t,!0)},t._setCacheDirty=function(){if(this._cacheDirty===!1){this._cacheDirty=!0;var t=this._cachedParent;t&&t!==this&&t._setNodeDirtyForCache&&t._setNodeDirtyForCache()}},t._setCachedParent=function(t){if(this._cachedParent!==t){this._cachedParent=t;for(var e=this._node._children,i=0,n=e.length;i<n;i++)e[i]._renderCmd._setCachedParent(t)}},t.detachFromParent=function(){this._cachedParent=null;for(var t,e=this._node._children,i=0,n=e.length;i<n;i++)t=e[i],t&&t._renderCmd&&t._renderCmd.detachFromParent()},t.setShaderProgram=function(t){},t.getShaderProgram=function(){return null},cc.Node.CanvasRenderCmd._getCompositeOperationByBlendFunc=function(t){return t?t.src===cc.SRC_ALPHA&&t.dst===cc.ONE||t.src===cc.ONE&&t.dst===cc.ONE?"lighter":t.src===cc.ZERO&&t.dst===cc.SRC_ALPHA?"destination-in":t.src===cc.ZERO&&t.dst===cc.ONE_MINUS_SRC_ALPHA?"destination-out":"source-over":"source-over"}}(),cc._tmp.PrototypeTexture2D=function(){var t=cc.Texture2D;t.PVRImagesHavePremultipliedAlpha=function(t){cc.PVRHaveAlphaPremultiplied_=t},t.PIXEL_FORMAT_RGBA8888=2,t.PIXEL_FORMAT_RGB888=3,t.PIXEL_FORMAT_RGB565=4,t.PIXEL_FORMAT_A8=5,t.PIXEL_FORMAT_I8=6,t.PIXEL_FORMAT_AI88=7,t.PIXEL_FORMAT_RGBA4444=8,t.PIXEL_FORMAT_RGB5A1=7,t.PIXEL_FORMAT_PVRTC4=9,t.PIXEL_FORMAT_PVRTC2=10,t.PIXEL_FORMAT_DEFAULT=t.PIXEL_FORMAT_RGBA8888,t.defaultPixelFormat=t.PIXEL_FORMAT_DEFAULT;var e=cc.Texture2D._M={};e[t.PIXEL_FORMAT_RGBA8888]="RGBA8888",e[t.PIXEL_FORMAT_RGB888]="RGB888",e[t.PIXEL_FORMAT_RGB565]="RGB565",e[t.PIXEL_FORMAT_A8]="A8",e[t.PIXEL_FORMAT_I8]="I8",e[t.PIXEL_FORMAT_AI88]="AI88",e[t.PIXEL_FORMAT_RGBA4444]="RGBA4444",e[t.PIXEL_FORMAT_RGB5A1]="RGB5A1",e[t.PIXEL_FORMAT_PVRTC4]="PVRTC4",e[t.PIXEL_FORMAT_PVRTC2]="PVRTC2";var i=cc.Texture2D._B={};i[t.PIXEL_FORMAT_RGBA8888]=32,i[t.PIXEL_FORMAT_RGB888]=24,i[t.PIXEL_FORMAT_RGB565]=16,i[t.PIXEL_FORMAT_A8]=8,i[t.PIXEL_FORMAT_I8]=8,i[t.PIXEL_FORMAT_AI88]=16,i[t.PIXEL_FORMAT_RGBA4444]=16,i[t.PIXEL_FORMAT_RGB5A1]=16,i[t.PIXEL_FORMAT_PVRTC4]=4,i[t.PIXEL_FORMAT_PVRTC2]=3;var n=cc.Texture2D.prototype;n.name,cc.defineGetterSetter(n,"name",n.getName),n.pixelFormat,cc.defineGetterSetter(n,"pixelFormat",n.getPixelFormat),n.pixelsWidth,cc.defineGetterSetter(n,"pixelsWidth",n.getPixelsWide),n.pixelsHeight,cc.defineGetterSetter(n,"pixelsHeight",n.getPixelsHigh),n.width,cc.defineGetterSetter(n,"width",n._getWidth),n.height,cc.defineGetterSetter(n,"height",n._getHeight)},cc._tmp.PrototypeTextureAtlas=function(){var t=cc.TextureAtlas.prototype;t.totalQuads,cc.defineGetterSetter(t,"totalQuads",t.getTotalQuads),t.capacity,cc.defineGetterSetter(t,"capacity",t.getCapacity),t.quads,cc.defineGetterSetter(t,"quads",t.getQuads,t.setQuads)},cc._tmp.WebGLTexture2D=function(){cc.Texture2D=cc.Class.extend({_pVRHaveAlphaPremultiplied:!0,_pixelFormat:null,_pixelsWide:0,_pixelsHigh:0,_name:"",_contentSize:null,maxS:0,maxT:0,_hasPremultipliedAlpha:!1,_hasMipmaps:!1,shaderProgram:null,_textureLoaded:!1,_htmlElementObj:null,_webTextureObj:null,url:null,ctor:function(){this._contentSize=cc.size(0,0),this._pixelFormat=cc.Texture2D.defaultPixelFormat},releaseTexture:function(){this._webTextureObj&&cc._renderContext.deleteTexture(this._webTextureObj),cc.loader.release(this.url)},getPixelFormat:function(){return this._pixelFormat},getPixelsWide:function(){return this._pixelsWide},getPixelsHigh:function(){return this._pixelsHigh},getName:function(){return this._webTextureObj},getContentSize:function(){return cc.size(this._contentSize.width/cc.contentScaleFactor(),this._contentSize.height/cc.contentScaleFactor())},_getWidth:function(){return this._contentSize.width/cc.contentScaleFactor()},_getHeight:function(){return this._contentSize.height/cc.contentScaleFactor()},getContentSizeInPixels:function(){return this._contentSize},getMaxS:function(){return this.maxS},setMaxS:function(t){this.maxS=t},getMaxT:function(){return this.maxT},setMaxT:function(t){this.maxT=t},getShaderProgram:function(){return this.shaderProgram},setShaderProgram:function(t){this.shaderProgram=t},hasPremultipliedAlpha:function(){return this._hasPremultipliedAlpha},hasMipmaps:function(){return this._hasMipmaps},description:function(){var t=this;return"<cc.Texture2D | Name = "+t._name+" | Dimensions = "+t._pixelsWide+" x "+t._pixelsHigh+" | Coordinates = ("+t.maxS+", "+t.maxT+")>"},releaseData:function(t){t=null},keepData:function(t,e){return t},initWithData:function(t,e,i,n,r){var c=this,o=cc.Texture2D,s=cc._renderContext,a=s.RGBA,h=s.UNSIGNED_BYTE,l=cc.Texture2D._B[e],u=i*l/8;switch(u%8===0?s.pixelStorei(s.UNPACK_ALIGNMENT,8):u%4===0?s.pixelStorei(s.UNPACK_ALIGNMENT,4):u%2===0?s.pixelStorei(s.UNPACK_ALIGNMENT,2):s.pixelStorei(s.UNPACK_ALIGNMENT,1),c._webTextureObj=s.createTexture(),cc.glBindTexture2D(c),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),e){case o.PIXEL_FORMAT_RGBA8888:a=s.RGBA;break;case o.PIXEL_FORMAT_RGB888:a=s.RGB;break;case o.PIXEL_FORMAT_RGBA4444:h=s.UNSIGNED_SHORT_4_4_4_4;break;case o.PIXEL_FORMAT_RGB5A1:h=s.UNSIGNED_SHORT_5_5_5_1;break;case o.PIXEL_FORMAT_RGB565:h=s.UNSIGNED_SHORT_5_6_5;break;case o.PIXEL_FORMAT_AI88:a=s.LUMINANCE_ALPHA;break;case o.PIXEL_FORMAT_A8:a=s.ALPHA;break;case o.PIXEL_FORMAT_I8:a=s.LUMINANCE;break;default:cc.assert(0,cc._LogInfos.Texture2D_initWithData)}return s.texImage2D(s.TEXTURE_2D,0,a,i,n,0,a,h,t),c._contentSize.width=r.width,c._contentSize.height=r.height,c._pixelsWide=i,c._pixelsHigh=n,c._pixelFormat=e,c.maxS=r.width/i,c.maxT=r.height/n,c._hasPremultipliedAlpha=!1,c._hasMipmaps=!1,c.shaderProgram=cc.shaderCache.programForKey(cc.SHADER_POSITION_TEXTURE),c._textureLoaded=!0,!0},drawAtPoint:function(t){var e=this,i=[0,e.maxT,e.maxS,e.maxT,0,0,e.maxS,0],n=cc._renderContext,r=e._pixelsWide*e.maxS,c=e._pixelsHigh*e.maxT,o=[t.x,t.y,0,r+t.x,t.y,0,t.x,c+t.y,0,r+t.x,c+t.y,0];e._shaderProgram.use(),e._shaderProgram.setUniformsForBuiltins(),cc.glBindTexture2D(e),n.enableVertexAttribArray(cc.VERTEX_ATTRIB_POSITION),n.enableVertexAttribArray(cc.VERTEX_ATTRIB_TEX_COORDS),n.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,n.FLOAT,!1,0,o),n.vertexAttribPointer(cc.VERTEX_ATTRIB_TEX_COORDS,2,n.FLOAT,!1,0,i),n.drawArrays(n.TRIANGLE_STRIP,0,4)},drawInRect:function(t){var e=this,i=[0,e.maxT,e.maxS,e.maxT,0,0,e.maxS,0],n=[t.x,t.y,t.x+t.width,t.y,t.x,t.y+t.height,t.x+t.width,t.y+t.height];e._shaderProgram.use(),e._shaderProgram.setUniformsForBuiltins(),cc.glBindTexture2D(e);var r=cc._renderContext;r.enableVertexAttribArray(cc.VERTEX_ATTRIB_POSITION),r.enableVertexAttribArray(cc.VERTEX_ATTRIB_TEX_COORDS),r.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,r.FLOAT,!1,0,n),r.vertexAttribPointer(cc.VERTEX_ATTRIB_TEX_COORDS,2,r.FLOAT,!1,0,i),r.drawArrays(r.TRIANGLE_STRIP,0,4)},initWithImage:function(t){if(null==t)return cc.log(cc._LogInfos.Texture2D_initWithImage),!1;var e=t.getWidth(),i=t.getHeight(),n=cc.configuration.getMaxTextureSize();return e>n||i>n?(cc.log(cc._LogInfos.Texture2D_initWithImage_2,e,i,n,n),!1):(this._textureLoaded=!0,this._initPremultipliedATextureWithImage(t,e,i))},initWithElement:function(t){t&&(this._webTextureObj=cc._renderContext.createTexture(),this._htmlElementObj=t,this._textureLoaded=!0,this._hasPremultipliedAlpha=!0)},getHtmlElementObj:function(){return this._htmlElementObj},isLoaded:function(){return this._textureLoaded},handleLoadedTexture:function(t){var e=this;if(t=void 0!==t?t:e._hasPremultipliedAlpha,cc.game._rendererInitialized){if(!e._htmlElementObj){var i=cc.loader.getRes(e.url);if(!i)return;e.initWithElement(i)}if(e._htmlElementObj.width&&e._htmlElementObj.height){var n=cc._renderContext;cc.glBindTexture2D(e),n.pixelStorei(n.UNPACK_ALIGNMENT,4),t&&n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,e._htmlElementObj),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),e.shaderProgram=cc.shaderCache.programForKey(cc.SHADER_POSITION_TEXTURE),cc.glBindTexture2D(null),t&&n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0);var r=e._htmlElementObj.width,c=e._htmlElementObj.height;e._pixelsWide=e._contentSize.width=r,e._pixelsHigh=e._contentSize.height=c,e._pixelFormat=cc.Texture2D.PIXEL_FORMAT_RGBA8888,e.maxS=1,e.maxT=1,e._hasPremultipliedAlpha=t,e._hasMipmaps=!1,e.dispatchEvent("load")}}},initWithString:function(t,e,i,n,r,c){return cc.log(cc._LogInfos.Texture2D_initWithString),null},initWithETCFile:function(t){return cc.log(cc._LogInfos.Texture2D_initWithETCFile_2),!1},initWithPVRFile:function(t){return cc.log(cc._LogInfos.Texture2D_initWithPVRFile_2),!1},initWithPVRTCData:function(t,e,i,n,r,c){return cc.log(cc._LogInfos.Texture2D_initWithPVRTCData_2),!1},setTexParameters:function(t,e,i,n){var r=this,c=cc._renderContext;void 0!==e&&(t={minFilter:t,magFilter:e,wrapS:i,wrapT:n}),cc.assert(r._pixelsWide===cc.NextPOT(r._pixelsWide)&&r._pixelsHigh===cc.NextPOT(r._pixelsHigh)||t.wrapS===c.CLAMP_TO_EDGE&&t.wrapT===c.CLAMP_TO_EDGE,"WebGLRenderingContext.CLAMP_TO_EDGE should be used in NPOT textures"),cc.glBindTexture2D(r),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,t.minFilter),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,t.magFilter),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,t.wrapS),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,t.wrapT)},setAntiAliasTexParameters:function(){var t=cc._renderContext;cc.glBindTexture2D(this),this._hasMipmaps?t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR_MIPMAP_NEAREST):t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR)},setAliasTexParameters:function(){var t=cc._renderContext;cc.glBindTexture2D(this),this._hasMipmaps?t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST_MIPMAP_NEAREST):t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST)},generateMipmap:function(){var t=this;cc.assert(t._pixelsWide===cc.NextPOT(t._pixelsWide)&&t._pixelsHigh===cc.NextPOT(t._pixelsHigh),"Mimpap texture only works in POT textures"),cc.glBindTexture2D(t),cc._renderContext.generateMipmap(cc._renderContext.TEXTURE_2D),t._hasMipmaps=!0},stringForFormat:function(){return cc.Texture2D._M[this._pixelFormat]},bitsPerPixelForFormat:function(t){t=t||this._pixelFormat;var e=cc.Texture2D._B[t];return null!=e?e:(cc.log(cc._LogInfos.Texture2D_bitsPerPixelForFormat,t),-1)},_initPremultipliedATextureWithImage:function(t,e,i){var n,r=cc.Texture2D,c=t.getData(),o=null,s=null,a=t.hasAlpha(),h=cc.size(t.getWidth(),t.getHeight()),l=r.defaultPixelFormat,u=t.getBitsPerComponent();a||(u>=8?l=r.PIXEL_FORMAT_RGB888:(cc.log(cc._LogInfos.Texture2D__initPremultipliedATextureWithImage),l=r.PIXEL_FORMAT_RGB565));var _=e*i;if(l===r.PIXEL_FORMAT_RGB565)if(a)for(c=new Uint16Array(e*i),o=t.getData(),n=0;n<_;++n)c[n]=(o[n]>>0&255)>>3<<11|(o[n]>>8&255)>>2<<5|(o[n]>>16&255)>>3<<0;else for(c=new Uint16Array(e*i),s=t.getData(),n=0;n<_;++n)c[n]=(255&s[n])>>3<<11|(255&s[n])>>2<<5|(255&s[n])>>3<<0;else if(l===r.PIXEL_FORMAT_RGBA4444)for(c=new Uint16Array(e*i),o=t.getData(),n=0;n<_;++n)c[n]=(o[n]>>0&255)>>4<<12|(o[n]>>8&255)>>4<<8|(o[n]>>16&255)>>4<<4|(o[n]>>24&255)>>4<<0;else if(l===r.PIXEL_FORMAT_RGB5A1)for(c=new Uint16Array(e*i),o=t.getData(),n=0;n<_;++n)c[n]=(o[n]>>0&255)>>3<<11|(o[n]>>8&255)>>3<<6|(o[n]>>16&255)>>3<<1|(o[n]>>24&255)>>7<<0;else if(l===r.PIXEL_FORMAT_A8)for(c=new Uint8Array(e*i),o=t.getData(),n=0;n<_;++n)c[n]=o>>24&255;if(a&&l===r.PIXEL_FORMAT_RGB888)for(o=t.getData(),c=new Uint8Array(e*i*3),n=0;n<_;++n)c[3*n]=o>>0&255,c[3*n+1]=o>>8&255,c[3*n+2]=o>>16&255;return this.initWithData(c,l,e,i,h),c!=t.getData()&&(c=null),this._hasPremultipliedAlpha=t.isPremultipliedAlpha(),!0},addLoadedEventListener:function(t,e){this.addEventListener("load",t,e)},removeLoadedEventListener:function(t){this.removeEventTarget("load",t)}})},cc._tmp.WebGLTextureAtlas=function(){var t=cc.TextureAtlas.prototype;t._setupVBO=function(){var t=this,e=cc._renderContext;t._buffersVBO[0]=e.createBuffer(),t._buffersVBO[1]=e.createBuffer(),t._quadsWebBuffer=e.createBuffer(),t._mapBuffers()},t._mapBuffers=function(){var t=this,e=cc._renderContext;e.bindBuffer(e.ARRAY_BUFFER,t._quadsWebBuffer),e.bufferData(e.ARRAY_BUFFER,t._quadsArrayBuffer,e.DYNAMIC_DRAW),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t._buffersVBO[1]),e.bufferData(e.ELEMENT_ARRAY_BUFFER,t._indices,e.STATIC_DRAW)},t.drawNumberOfQuads=function(t,e){var i=this;if(e=e||0,0!==t&&i.texture&&i.texture.isLoaded()){var n=cc._renderContext;cc.glBindTexture2D(i.texture),n.bindBuffer(n.ARRAY_BUFFER,i._quadsWebBuffer),i.dirty&&(n.bufferData(n.ARRAY_BUFFER,i._quadsArrayBuffer,n.DYNAMIC_DRAW),i.dirty=!1),n.enableVertexAttribArray(cc.VERTEX_ATTRIB_POSITION),n.enableVertexAttribArray(cc.VERTEX_ATTRIB_COLOR),n.enableVertexAttribArray(cc.VERTEX_ATTRIB_TEX_COORDS),n.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,3,n.FLOAT,!1,24,0),n.vertexAttribPointer(cc.VERTEX_ATTRIB_COLOR,4,n.UNSIGNED_BYTE,!0,24,12),n.vertexAttribPointer(cc.VERTEX_ATTRIB_TEX_COORDS,2,n.FLOAT,!1,24,16),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,i._buffersVBO[1]),cc.TEXTURE_ATLAS_USE_TRIANGLE_STRIP?n.drawElements(n.TRIANGLE_STRIP,6*t,n.UNSIGNED_SHORT,6*e*i._indices.BYTES_PER_ELEMENT):n.drawElements(n.TRIANGLES,6*t,n.UNSIGNED_SHORT,6*e*i._indices.BYTES_PER_ELEMENT),cc.g_NumberOfDraws++}}},cc._tmp.WebGLTextureCache=function(){var t=cc.textureCache;t.handleLoadedTexture=function(t){var e,i,n=this._textures;cc.game._rendererInitialized||(n=this._loadedTexturesBefore),e=n[t],e||(e=n[t]=new cc.Texture2D,e.url=t),i=cc.path.extname(t),".png"===i?e.handleLoadedTexture(!0):e.handleLoadedTexture()},t.addImage=function(t,e,i){cc.assert(t,cc._LogInfos.Texture2D_addImage_2);var n=this._textures;cc.game._rendererInitialized||(n=this._loadedTexturesBefore);var r=n[t]||n[cc.loader._getAliase(t)];if(r)return r.isLoaded()?(e&&e.call(i,r),r):(r.addEventListener("load",function(){e&&e.call(i,r)},i),r);r=n[t]=new cc.Texture2D,r.url=t;var c=cc.loader.getBasePath?cc.loader.getBasePath():cc.loader.resPath;return cc.loader.loadImg(cc.path.join(c||"",t),function(r,c){if(r)return e&&e.call(i,r);cc.loader.cache[t]||(cc.loader.cache[t]=c),cc.textureCache.handleLoadedTexture(t);var o=n[t];e&&e.call(i,o)}),r},t.addImageAsync=t.addImage,t=null},cc.ALIGN_CENTER=51,cc.ALIGN_TOP=19,cc.ALIGN_TOP_RIGHT=18,cc.ALIGN_RIGHT=50,cc.ALIGN_BOTTOM_RIGHT=34,cc.ALIGN_BOTTOM=35,cc.ALIGN_BOTTOM_LEFT=33,cc.ALIGN_LEFT=49,cc.ALIGN_TOP_LEFT=17,cc.PVRHaveAlphaPremultiplied_=!1,cc.game.addEventListener(cc.game.EVENT_RENDERER_INITED,function(){if(cc._renderType===cc.game.RENDER_TYPE_CANVAS){var t={_contentSize:null,_textureLoaded:!1,_htmlElementObj:null,url:null,_pattern:null,ctor:function(){this._contentSize=cc.size(0,0),this._textureLoaded=!1,this._htmlElementObj=null,this._pattern=""},getPixelsWide:function(){return this._contentSize.width},getPixelsHigh:function(){return this._contentSize.height},getContentSize:function(){var t=cc.contentScaleFactor();return cc.size(this._contentSize.width/t,this._contentSize.height/t)},_getWidth:function(){return this._contentSize.width/cc.contentScaleFactor()},_getHeight:function(){return this._contentSize.height/cc.contentScaleFactor()},getContentSizeInPixels:function(){return this._contentSize},initWithElement:function(t){t&&(this._htmlElementObj=t,this._contentSize.width=t.width,this._contentSize.height=t.height,this._textureLoaded=!0)},getHtmlElementObj:function(){return this._htmlElementObj},isLoaded:function(){return this._textureLoaded},handleLoadedTexture:function(){var t=this;if(!t._textureLoaded){if(!t._htmlElementObj){var e=cc.loader.getRes(t.url);if(!e)return;t.initWithElement(e)}var i=t._htmlElementObj;t._contentSize.width=i.width,t._contentSize.height=i.height,t.dispatchEvent("load")}},description:function(){return"<cc.Texture2D | width = "+this._contentSize.width+" height "+this._contentSize.height+">"},initWithData:function(t,e,i,n,r){return!1},initWithImage:function(t){return!1},initWithString:function(t,e,i,n,r,c){return!1},releaseTexture:function(){cc.loader.release(this.url)},getName:function(){return null},getMaxS:function(){return 1},setMaxS:function(t){},getMaxT:function(){return 1},setMaxT:function(t){},getPixelFormat:function(){return null},getShaderProgram:function(){return null},setShaderProgram:function(t){},hasPremultipliedAlpha:function(){return!1},hasMipmaps:function(){return!1},releaseData:function(t){t=null},keepData:function(t,e){return t},drawAtPoint:function(t){},drawInRect:function(t){},initWithETCFile:function(t){return cc.log(cc._LogInfos.Texture2D_initWithETCFile),!1},initWithPVRFile:function(t){return cc.log(cc._LogInfos.Texture2D_initWithPVRFile),!1},initWithPVRTCData:function(t,e,i,n,r,c){return cc.log(cc._LogInfos.Texture2D_initWithPVRTCData),!1},setTexParameters:function(t,e,i,n){return void 0!==e&&(t={
minFilter:t,magFilter:e,wrapS:i,wrapT:n}),t.wrapS===cc.REPEAT&&t.wrapT===cc.REPEAT?void(this._pattern="repeat"):t.wrapS===cc.REPEAT?void(this._pattern="repeat-x"):t.wrapT===cc.REPEAT?void(this._pattern="repeat-y"):void(this._pattern="")},setAntiAliasTexParameters:function(){},setAliasTexParameters:function(){},generateMipmap:function(){},stringForFormat:function(){return""},bitsPerPixelForFormat:function(t){return-1},addLoadedEventListener:function(t,e){this.addEventListener("load",t,e)},removeLoadedEventListener:function(t){this.removeEventTarget("load",t)},_generateColorTexture:function(){},_generateTextureCacheForColor:function(){if(this.channelCache)return this.channelCache;var t=[document.createElement("canvas"),document.createElement("canvas"),document.createElement("canvas"),document.createElement("canvas")];return e(this._htmlElementObj,t),this.channelCache=t},_grayElementObj:null,_backupElement:null,_isGray:!1,_switchToGray:function(t){this._textureLoaded&&this._isGray!==t&&(this._isGray=t,this._isGray?(this._backupElement=this._htmlElementObj,this._grayElementObj||(this._grayElementObj=cc.Texture2D._generateGrayTexture(this._htmlElementObj)),this._htmlElementObj=this._grayElementObj):null!==this._backupElement&&(this._htmlElementObj=this._backupElement))}},e=function(t,e){var i=t.width,n=t.height;e[0].width=i,e[0].height=n,e[1].width=i,e[1].height=n,e[2].width=i,e[2].height=n,e[3].width=i,e[3].height=n;var r=e[3].getContext("2d");r.drawImage(t,0,0);for(var c,o=r.getImageData(0,0,i,n).data,s=0;s<4;s++){c=e[s].getContext("2d");for(var a=c.getImageData(0,0,i,n),h=a.data,l=0;l<o.length;l+=4)h[l]=0===s?o[l]:0,h[l+1]=1===s?o[l+1]:0,h[l+2]=2===s?o[l+2]:0,h[l+3]=o[l+3];c.putImageData(a,0,0)}t.onload=null};cc.sys._supportCanvasNewBlendModes?t._generateColorTexture=function(t,e,i,n,r){var c=!1;r?c=!0:r=document.createElement("canvas");var o=this._htmlElementObj;n||(n=cc.rect(0,0,o.width,o.height)),r.width=n.width,r.height=n.height;var s=r.getContext("2d");if(s.globalCompositeOperation="source-over",s.fillStyle="rgb("+(0|t)+","+(0|e)+","+(0|i)+")",s.fillRect(0,0,n.width,n.height),s.globalCompositeOperation="multiply",s.drawImage(o,n.x,n.y,n.width,n.height,0,0,n.width,n.height),s.globalCompositeOperation="destination-atop",s.drawImage(o,n.x,n.y,n.width,n.height,0,0,n.width,n.height),c)return r;var a=new cc.Texture2D;return a.initWithElement(r),a.handleLoadedTexture(),a}:t._generateColorTexture=function(t,e,i,n,r){var c=!1;r?c=!0:r=document.createElement("canvas");var o=this._htmlElementObj;n||(n=cc.rect(0,0,o.width,o.height));var s,a,h,l;if(s=n.x,a=n.y,h=n.width,l=n.height,h&&l){r.width=h,r.height=l;var u=r.getContext("2d"),_=cc.textureCache.getTextureColors(this);if(u.globalCompositeOperation="lighter",u.drawImage(_[3],s,a,h,l,0,0,h,l),t>0&&(u.globalAlpha=t/255,u.drawImage(_[0],s,a,h,l,0,0,h,l)),e>0&&(u.globalAlpha=e/255,u.drawImage(_[1],s,a,h,l,0,0,h,l)),i>0&&(u.globalAlpha=i/255,u.drawImage(_[2],s,a,h,l,0,0,h,l)),c)return r;var d=new cc.Texture2D;return d.initWithElement(r),d.handleLoadedTexture(),d}},cc.Texture2D=cc.Class.extend(t),cc.Texture2D._generateGrayTexture=function(t,e,i){if(null===t)return null;i=i||document.createElement("canvas"),e=e||cc.rect(0,0,t.width,t.height),i.width=e.width,i.height=e.height;var n=i.getContext("2d");n.drawImage(t,e.x,e.y,e.width,e.height,0,0,e.width,e.height);for(var r=n.getImageData(0,0,e.width,e.height),c=r.data,o=0,s=c.length;o<s;o+=4)c[o]=c[o+1]=c[o+2]=.34*c[o]+.5*c[o+1]+.16*c[o+2];return n.putImageData(r,0,0),i}}else cc._renderType===cc.game.RENDER_TYPE_WEBGL&&(cc.assert(cc.isFunction(cc._tmp.WebGLTexture2D),cc._LogInfos.MissingFile,"TexturesWebGL.js"),cc._tmp.WebGLTexture2D(),delete cc._tmp.WebGLTexture2D);cc.EventHelper.prototype.apply(cc.Texture2D.prototype),cc.assert(cc.isFunction(cc._tmp.PrototypeTexture2D),cc._LogInfos.MissingFile,"TexturesPropertyDefine.js"),cc._tmp.PrototypeTexture2D(),delete cc._tmp.PrototypeTexture2D}),cc.textureCache={_textures:{},_textureColorsCache:{},_textureKeySeq:0|1e3*Math.random(),_loadedTexturesBefore:{},_initializingRenderer:function(){var t,e=this._loadedTexturesBefore,i=this._textures;for(t in e){var n=e[t];n.handleLoadedTexture(),i[t]=n}this._loadedTexturesBefore={}},addPVRTCImage:function(t){cc.log(cc._LogInfos.textureCache_addPVRTCImage)},addETCImage:function(t){cc.log(cc._LogInfos.textureCache_addETCImage)},description:function(){return"<TextureCache | Number of textures = "+this._textures.length+">"},textureForKey:function(t){return cc.log(cc._LogInfos.textureCache_textureForKey),this.getTextureForKey(t)},getTextureForKey:function(t){return this._textures[t]||this._textures[cc.loader._getAliase(t)]},getKeyByTexture:function(t){for(var e in this._textures)if(this._textures[e]===t)return e;return null},_generalTextureKey:function(t){return"_textureKey_"+t},getTextureColors:function(t){var e=t._htmlElementObj,i=this.getKeyByTexture(e);return i||(i=e instanceof HTMLImageElement?e.src:this._generalTextureKey(t.__instanceId)),this._textureColorsCache[i]||(this._textureColorsCache[i]=t._generateTextureCacheForColor()),this._textureColorsCache[i]},addPVRImage:function(t){cc.log(cc._LogInfos.textureCache_addPVRImage)},removeAllTextures:function(){var t=this._textures;for(var e in t)t[e]&&t[e].releaseTexture();this._textures={}},removeTexture:function(t){if(t){var e=this._textures;for(var i in e)e[i]===t&&(e[i].releaseTexture(),delete e[i])}},removeTextureForKey:function(t){null!=t&&this._textures[t]&&delete this._textures[t]},cacheImage:function(t,e){if(e instanceof cc.Texture2D)return void(this._textures[t]=e);var i=new cc.Texture2D;i.initWithElement(e),i.handleLoadedTexture(),this._textures[t]=i},addUIImage:function(t,e){if(cc.assert(t,cc._LogInfos.textureCache_addUIImage_2),e&&this._textures[e])return this._textures[e];var i=new cc.Texture2D;return i.initWithImage(t),null!=e?this._textures[e]=i:cc.log(cc._LogInfos.textureCache_addUIImage),i},dumpCachedTextureInfo:function(){var t=0,e=0,i=this._textures;for(var n in i){var r=i[n];t++,r.getHtmlElementObj()instanceof HTMLImageElement?cc.log(cc._LogInfos.textureCache_dumpCachedTextureInfo,n,r.getHtmlElementObj().src,r.pixelsWidth,r.pixelsHeight):cc.log(cc._LogInfos.textureCache_dumpCachedTextureInfo_2,n,r.pixelsWidth,r.pixelsHeight),e+=r.pixelsWidth*r.pixelsHeight*4}var c=this._textureColorsCache;for(n in c){var o=c[n];for(var s in o){var a=o[s];t++,cc.log(cc._LogInfos.textureCache_dumpCachedTextureInfo_2,n,a.width,a.height),e+=a.width*a.height*4}}cc.log(cc._LogInfos.textureCache_dumpCachedTextureInfo_3,t,e/1024,(e/1048576).toFixed(2))},_clear:function(){this._textures={},this._textureColorsCache={},this._textureKeySeq=0|1e3*Math.random(),this._loadedTexturesBefore={}}},cc.game.addEventListener(cc.game.EVENT_RENDERER_INITED,function(){if(cc._renderType===cc.game.RENDER_TYPE_CANVAS){var t=cc.textureCache;t.handleLoadedTexture=function(t){var e=this._textures,i=e[t];i||(i=e[t]=new cc.Texture2D,i.url=t),i.handleLoadedTexture()},t.addImage=function(t,e,i){cc.assert(t,cc._LogInfos.Texture2D_addImage);var n=this._textures,r=n[t]||n[cc.loader._getAliase(t)];if(r)return r.isLoaded()?(e&&e.call(i,r),r):(r.addEventListener("load",function(){e&&e.call(i,r)},i),r);r=n[t]=new cc.Texture2D,r.url=t;var c=cc.loader.getBasePath?cc.loader.getBasePath():cc.loader.resPath;return cc.loader.loadImg(cc.path.join(c||"",t),function(r,c){if(r)return e&&e.call(i,r);cc.loader.cache[t]||(cc.loader.cache[t]=c),cc.textureCache.handleLoadedTexture(t);var o=n[t];e&&e.call(i,o)}),r},t.addImageAsync=t.addImage,t=null}else cc._renderType===cc.game.RENDER_TYPE_WEBGL&&(cc.assert(cc.isFunction(cc._tmp.WebGLTextureCache),cc._LogInfos.MissingFile,"TexturesWebGL.js"),cc._tmp.WebGLTextureCache(),delete cc._tmp.WebGLTextureCache)}),cc.Scene=cc.Node.extend({_className:"Scene",ctor:function(){cc.Node.prototype.ctor.call(this),this._ignoreAnchorPointForPosition=!0,this.setAnchorPoint(.5,.5),this.setContentSize(cc.director.getWinSize())}}),cc.Scene.create=function(){return new cc.Scene},cc.LoaderScene=cc.Scene.extend({_interval:null,_label:null,_className:"LoaderScene",cb:null,target:null,init:function(){var t=this,e=160,i=200,n=t._bgLayer=new cc.LayerColor(cc.color(32,32,32,255));t.addChild(n,0);var r=24,c=-i/2+100;cc._loaderImage&&(cc.loader.loadImg(cc._loaderImage,{isCrossOrigin:!1},function(n,r){e=r.width,i=r.height,t._initStage(r,cc.visibleRect.center)}),r=14,c=-i/2-10);var o=t._label=new cc.LabelTTF("Loading... 0%","Arial",r);return o.setPosition(cc.pAdd(cc.visibleRect.center,cc.p(0,c))),o.setColor(cc.color(180,180,180)),n.addChild(this._label,10),!0},_initStage:function(t,e){var i=this,n=i._texture2d=new cc.Texture2D;n.initWithElement(t),n.handleLoadedTexture();var r=i._logo=new cc.Sprite(n);r.setScale(cc.contentScaleFactor()),r.x=e.x,r.y=e.y,i._bgLayer.addChild(r,10)},onEnter:function(){var t=this;cc.Node.prototype.onEnter.call(t),t.schedule(t._startLoading,.3)},onExit:function(){cc.Node.prototype.onExit.call(this);var t="Loading... 0%";this._label.setString(t)},initWithResources:function(t,e,i){cc.isString(t)&&(t=[t]),this.resources=t||[],this.cb=e,this.target=i},_startLoading:function(){var t=this;t.unschedule(t._startLoading);var e=t.resources;cc.loader.load(e,function(e,i,n){var r=n/i*100|0;r=Math.min(r,100),t._label.setString("Loading... "+r+"%")},function(){t.cb&&t.cb.call(t.target)})},_updateTransform:function(){this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty),this._bgLayer._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty),this._label._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty),this._logo._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)}}),cc.LoaderScene.preload=function(t,e,i){var n=cc;return n.loaderScene||(n.loaderScene=new cc.LoaderScene,n.loaderScene.init(),cc.eventManager.addCustomListener(cc.Director.EVENT_PROJECTION_CHANGED,function(){n.loaderScene._updateTransform()})),n.loaderScene.initWithResources(t,e,i),cc.director.runScene(n.loaderScene),n.loaderScene},cc.Layer=cc.Node.extend({_className:"Layer",ctor:function(){cc.Node.prototype.ctor.call(this),this._ignoreAnchorPointForPosition=!0,this.setAnchorPoint(.5,.5),this.setContentSize(cc.winSize)},init:function(){var t=this;return t._ignoreAnchorPointForPosition=!0,t.setAnchorPoint(.5,.5),t.setContentSize(cc.winSize),t._cascadeColorEnabled=!1,t._cascadeOpacityEnabled=!1,!0},bake:function(){this._renderCmd.bake()},unbake:function(){this._renderCmd.unbake()},isBaked:function(){return this._renderCmd._isBaked},addChild:function(t,e,i){cc.Node.prototype.addChild.call(this,t,e,i),this._renderCmd._bakeForAddChild(t)},_createRenderCmd:function(){return cc._renderType===cc.game.RENDER_TYPE_CANVAS?new cc.Layer.CanvasRenderCmd(this):new cc.Layer.WebGLRenderCmd(this)}}),cc.Layer.create=function(){return new cc.Layer},cc.LayerColor=cc.Layer.extend({_blendFunc:null,_className:"LayerColor",getBlendFunc:function(){return this._blendFunc},changeWidthAndHeight:function(t,e){this.width=t,this.height=e},changeWidth:function(t){this.width=t},changeHeight:function(t){this.height=t},setOpacityModifyRGB:function(t){},isOpacityModifyRGB:function(){return!1},ctor:function(t,e,i){cc.Layer.prototype.ctor.call(this),this._blendFunc=cc.BlendFunc._alphaNonPremultiplied(),cc.LayerColor.prototype.init.call(this,t,e,i)},init:function(t,e,i){var n=cc.director.getWinSize();t=t||cc.color(0,0,0,255),e=void 0===e?n.width:e,i=void 0===i?n.height:i;var r=this._realColor;return r.r=t.r,r.g=t.g,r.b=t.b,this._realOpacity=t.a,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.colorDirty|cc.Node._dirtyFlags.opacityDirty),cc.LayerColor.prototype.setContentSize.call(this,e,i),!0},setBlendFunc:function(t,e){var i=this._blendFunc;void 0===e?(i.src=t.src,i.dst=t.dst):(i.src=t,i.dst=e),this._renderCmd.updateBlendFunc(i)},_createRenderCmd:function(){return cc._renderType===cc.game.RENDER_TYPE_CANVAS?new cc.LayerColor.CanvasRenderCmd(this):new cc.LayerColor.WebGLRenderCmd(this)}}),cc.LayerColor.create=function(t,e,i){return new cc.LayerColor(t,e,i)},function(){var t=cc.LayerColor.prototype;cc.defineGetterSetter(t,"width",t._getWidth,t._setWidth),cc.defineGetterSetter(t,"height",t._getHeight,t._setHeight)}(),cc.LayerGradient=cc.LayerColor.extend({_endColor:null,_startOpacity:255,_endOpacity:255,_alongVector:null,_compressedInterpolation:!1,_className:"LayerGradient",_colorStops:[],ctor:function(t,e,i,n){cc.LayerColor.prototype.ctor.call(this),this._endColor=cc.color(0,0,0,255),this._alongVector=cc.p(0,-1),this._startOpacity=255,this._endOpacity=255,n&&n instanceof Array?(this._colorStops=n,n.splice(0,0,{p:0,color:t||cc.color.BLACK}),n.push({p:1,color:e||cc.color.BLACK})):this._colorStops=[{p:0,color:t||cc.color.BLACK},{p:1,color:e||cc.color.BLACK}],cc.LayerGradient.prototype.init.call(this,t,e,i,n)},init:function(t,e,i,n){t=t||cc.color(0,0,0,255),e=e||cc.color(0,0,0,255),i=i||cc.p(0,-1);var r=this,c=r._endColor;return r._startOpacity=t.a,c.r=e.r,c.g=e.g,c.b=e.b,r._endOpacity=e.a,r._alongVector=i,r._compressedInterpolation=!0,cc.LayerColor.prototype.init.call(r,cc.color(t.r,t.g,t.b,255)),this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.colorDirty|cc.Node._dirtyFlags.opacityDirty|cc.Node._dirtyFlags.gradientDirty),!0},setContentSize:function(t,e){cc.LayerColor.prototype.setContentSize.call(this,t,e),this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.gradientDirty)},_setWidth:function(t){cc.LayerColor.prototype._setWidth.call(this,t),this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.gradientDirty)},_setHeight:function(t){cc.LayerColor.prototype._setHeight.call(this,t),this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.gradientDirty)},getStartColor:function(){return cc.color(this._realColor)},setStartColor:function(t){this.color=t;var e=this._colorStops;if(e&&e.length>0){var i=e[0].color;i.r=t.r,i.g=t.g,i.b=t.b}},setEndColor:function(t){var e=this._endColor;e.r=t.r,e.g=t.g,e.b=t.b;var i=this._colorStops;if(i&&i.length>0){var n=i[i.length-1].color;n.r=t.r,n.g=t.g,n.b=t.b}this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.colorDirty)},getEndColor:function(){return cc.color(this._endColor)},setStartOpacity:function(t){this._startOpacity=t;var e=this._colorStops;e&&e.length>0&&(e[0].color.a=t),this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.opacityDirty)},getStartOpacity:function(){return this._startOpacity},setEndOpacity:function(t){this._endOpacity=t;var e=this._colorStops;e&&e.length>0&&(e[e.length-1].color.a=t),this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.opacityDirty)},getEndOpacity:function(){return this._endOpacity},setVector:function(t){this._alongVector.x=t.x,this._alongVector.y=t.y,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.gradientDirty)},getVector:function(){return cc.p(this._alongVector.x,this._alongVector.y)},isCompressedInterpolation:function(){return this._compressedInterpolation},setCompressedInterpolation:function(t){this._compressedInterpolation=t,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.gradientDirty)},getColorStops:function(){return this._colorStops},setColorStops:function(t){this._colorStops=t,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.colorDirty|cc.Node._dirtyFlags.opacityDirty|cc.Node._dirtyFlags.gradientDirty)},_createRenderCmd:function(){return cc._renderType===cc.game.RENDER_TYPE_CANVAS?new cc.LayerGradient.CanvasRenderCmd(this):new cc.LayerGradient.WebGLRenderCmd(this)}}),cc.LayerGradient.create=function(t,e,i,n){return new cc.LayerGradient(t,e,i,n)},function(){var t=cc.LayerGradient.prototype;t.startColor,cc.defineGetterSetter(t,"startColor",t.getStartColor,t.setStartColor),t.endColor,cc.defineGetterSetter(t,"endColor",t.getEndColor,t.setEndColor),t.startOpacity,cc.defineGetterSetter(t,"startOpacity",t.getStartOpacity,t.setStartOpacity),t.endOpacity,cc.defineGetterSetter(t,"endOpacity",t.getEndOpacity,t.setEndOpacity),t.vector,cc.defineGetterSetter(t,"vector",t.getVector,t.setVector),t.colorStops,cc.defineGetterSetter(t,"colorStops",t.getColorStops,t.setColorStops)}(),cc.LayerMultiplex=cc.Layer.extend({_enabledLayer:0,_layers:null,_className:"LayerMultiplex",ctor:function(t){cc.Layer.prototype.ctor.call(this),t instanceof Array?cc.LayerMultiplex.prototype.initWithLayers.call(this,t):cc.LayerMultiplex.prototype.initWithLayers.call(this,Array.prototype.slice.call(arguments))},initWithLayers:function(t){return t.length>0&&null==t[t.length-1]&&cc.log(cc._LogInfos.LayerMultiplex_initWithLayers),this._layers=t,this._enabledLayer=0,this.addChild(this._layers[this._enabledLayer]),!0},switchTo:function(t){return t>=this._layers.length?void cc.log(cc._LogInfos.LayerMultiplex_switchTo):(this.removeChild(this._layers[this._enabledLayer],!0),this._enabledLayer=t,void this.addChild(this._layers[t]))},switchToAndReleaseMe:function(t){return t>=this._layers.length?void cc.log(cc._LogInfos.LayerMultiplex_switchToAndReleaseMe):(this.removeChild(this._layers[this._enabledLayer],!0),this._layers[this._enabledLayer]=null,this._enabledLayer=t,void this.addChild(this._layers[t]))},addLayer:function(t){return t?void this._layers.push(t):void cc.log(cc._LogInfos.LayerMultiplex_addLayer)}}),cc.LayerMultiplex.create=function(){return new cc.LayerMultiplex(Array.prototype.slice.call(arguments))},function(){cc.Layer.CanvasRenderCmd=function(t){cc.Node.CanvasRenderCmd.call(this,t),this._isBaked=!1,this._bakeSprite=null,this._canUseDirtyRegion=!0,this._updateCache=2};var t=cc.Layer.CanvasRenderCmd.prototype=Object.create(cc.Node.CanvasRenderCmd.prototype);t.constructor=cc.Layer.CanvasRenderCmd,t._setCacheDirty=function(t){if(t&&0===this._updateCache&&(this._updateCache=2),this._cacheDirty===!1){this._cacheDirty=!0;var e=this._cachedParent;e&&e!==this&&e._setNodeDirtyForCache&&e._setNodeDirtyForCache()}},t.updateStatus=function(){var t=cc.Node._dirtyFlags,e=this._dirtyFlag;e&t.orderDirty&&(this._cacheDirty=!0,0===this._updateCache&&(this._updateCache=2),this._dirtyFlag=e&t.orderDirty^e),cc.Node.RenderCmd.prototype.updateStatus.call(this)},t._syncStatus=function(t){var e=cc.Node._dirtyFlags,i=this._dirtyFlag;i&e.orderDirty&&(this._cacheDirty=!0,0===this._updateCache&&(this._updateCache=2),this._dirtyFlag=i&e.orderDirty^i),cc.Node.RenderCmd.prototype._syncStatus.call(this,t)},t.transform=function(t,e){var i=this._worldTransform,n=i.a,r=i.b,c=i.c,o=i.d;i.tx,i.ty;cc.Node.CanvasRenderCmd.prototype.transform.call(this,t,e),i.a===n&&i.b===r&&i.c===c&&i.d===o||0!==this._updateCache||(this._updateCache=2)},t.bake=function(){if(!this._isBaked){this._needDraw=!0,cc.renderer.childrenOrderDirty=!0,this._isBaked=this._cacheDirty=!0,0===this._updateCache&&(this._updateCache=2);for(var t=this._node._children,e=0,i=t.length;e<i;e++)t[e]._renderCmd._setCachedParent(this);this._bakeSprite||(this._bakeSprite=new cc.BakeSprite,this._bakeSprite.setAnchorPoint(0,0))}},t.unbake=function(){if(this._isBaked){cc.renderer.childrenOrderDirty=!0,this._needDraw=!1,this._isBaked=!1,this._cacheDirty=!0,0===this._updateCache&&(this._updateCache=2);for(var t=this._node._children,e=0,i=t.length;e<i;e++)t[e]._renderCmd._setCachedParent(null)}},t.isBaked=function(){return this._isBaked},t.rendering=function(){if(this._cacheDirty){var t=this._node,e=t._children,i=this._bakeSprite;this.transform(this.getParentRenderCmd(),!0);var n=this._getBoundingBoxForBake();n.width=0|n.width+.5,n.height=0|n.height+.5;var r=i.getCacheContext(),c=r.getContext();if(i.setPosition(n.x,n.y),this._updateCache>0){i.resetCanvasSize(n.width,n.height),r.setOffset(0-n.x,c.canvas.height-n.height+n.y),t.sortAllChildren(),cc.renderer._turnToCacheMode(this.__instanceId);for(var o=0,s=e.length;o<s;o++)e[o].visit(this);cc.renderer._renderingToCacheCanvas(r,this.__instanceId),i.transform(),this._updateCache--}this._cacheDirty=!1}},t.visit=function(t){if(!this._isBaked)return void this.originVisit(t);var e=this._node,i=e._children,n=i.length;e._visible&&0!==n&&(this._syncStatus(t),cc.renderer.pushRenderCommand(this),this._bakeSprite.visit(this),this._dirtyFlag=0)},t._bakeForAddChild=function(t){t._parent===this._node&&this._isBaked&&t._renderCmd._setCachedParent(this)},t._getBoundingBoxForBake=function(){var t=null,e=this._node;if(!e._children||0===e._children.length)return cc.rect(0,0,10,10);for(var i=e.getNodeToWorldTransform(),n=e._children,r=0,c=n.length;r<c;r++){var o=n[r];if(o&&o._visible)if(t){var s=o._getBoundingBoxToCurrentNode(i);s&&(t=cc.rectUnion(t,s))}else t=o._getBoundingBoxToCurrentNode(i)}return t}}(),function(){cc.LayerColor.CanvasRenderCmd=function(t){cc.Layer.CanvasRenderCmd.call(this,t),this._needDraw=!0,this._blendFuncStr="source-over",this._bakeRenderCmd=new cc.CustomRenderCmd(this,this._bakeRendering)};var t=cc.LayerColor.CanvasRenderCmd.prototype=Object.create(cc.Layer.CanvasRenderCmd.prototype);t.constructor=cc.LayerColor.CanvasRenderCmd,t.unbake=function(){cc.Layer.CanvasRenderCmd.prototype.unbake.call(this),this._needDraw=!0},t.rendering=function(t,e,i){var n=t||cc._renderContext,r=n.getContext(),c=this._node,o=this._displayedColor,s=this._displayedOpacity/255,a=c._contentSize.width,h=c._contentSize.height;0!==s&&(n.setCompositeOperation(this._blendFuncStr),n.setGlobalAlpha(s),n.setFillStyle("rgba("+(0|o.r)+","+(0|o.g)+","+(0|o.b)+", 1)"),n.setTransform(this._worldTransform,e,i),r.fillRect(0,0,a,-h),cc.g_NumberOfDraws++)},t.updateBlendFunc=function(t){this._blendFuncStr=cc.Node.CanvasRenderCmd._getCompositeOperationByBlendFunc(t)},t._updateSquareVertices=t._updateSquareVerticesWidth=t._updateSquareVerticesHeight=function(){},t._bakeRendering=function(){if(this._cacheDirty){var t,e=this._node,i=this._bakeSprite,n=e._children,r=n.length;this.transform(this.getParentRenderCmd(),!0);var c=this._getBoundingBoxForBake();c.width=0|c.width+.5,c.height=0|c.height+.5;var o=i.getCacheContext(),s=o.getContext();if(i.setPosition(c.x,c.y),this._updateCache>0){s.fillStyle=o._currentFillStyle,i.resetCanvasSize(c.width,c.height),o.setOffset(0-c.x,s.canvas.height-c.height+c.y);var a;if(cc.renderer._turnToCacheMode(this.__instanceId),r>0){for(e.sortAllChildren(),t=0;t<r&&(a=n[t],a._localZOrder<0);t++)a._renderCmd.visit(this);for(cc.renderer.pushRenderCommand(this);t<r;t++)n[t]._renderCmd.visit(this)}else cc.renderer.pushRenderCommand(this);cc.renderer._renderingToCacheCanvas(o,this.__instanceId),i.transform(),this._updateCache--}this._cacheDirty=!1}},t.visit=function(t){if(!this._isBaked)return void this.originVisit();var e=this._node;e._visible&&(this._syncStatus(t),cc.renderer.pushRenderCommand(this._bakeRenderCmd),this._bakeSprite._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty),this._bakeSprite.visit(this),this._dirtyFlag=0)},t._getBoundingBoxForBake=function(){var t=this._node,e=cc.rect(0,0,t._contentSize.width,t._contentSize.height),i=t.getNodeToWorldTransform();if(e=cc.rectApplyAffineTransform(e,t.getNodeToWorldTransform()),!t._children||0===t._children.length)return e;for(var n=t._children,r=0;r<n.length;r++){var c=n[r];if(c&&c._visible){var o=c._getBoundingBoxToCurrentNode(i);e=cc.rectUnion(e,o)}}return e}}(),function(){cc.LayerGradient.CanvasRenderCmd=function(t){cc.LayerColor.CanvasRenderCmd.call(this,t),this._needDraw=!0,this._startPoint=cc.p(0,0),this._endPoint=cc.p(0,0),this._startStopStr=null,this._endStopStr=null};var t=cc.LayerGradient.CanvasRenderCmd.prototype=Object.create(cc.LayerColor.CanvasRenderCmd.prototype);t.constructor=cc.LayerGradient.CanvasRenderCmd,t.rendering=function(t,e,i){var n=t||cc._renderContext,r=n.getContext(),c=this._node,o=this._displayedOpacity/255;if(0!==o){var s=c._contentSize.width,a=c._contentSize.height;n.setCompositeOperation(this._blendFuncStr),n.setGlobalAlpha(o);var h=r.createLinearGradient(this._startPoint.x,this._startPoint.y,this._endPoint.x,this._endPoint.y);if(c._colorStops)for(var l=0;l<c._colorStops.length;l++){var u=c._colorStops[l];h.addColorStop(u.p,this._colorStopsStr[l])}else h.addColorStop(0,this._startStopStr),h.addColorStop(1,this._endStopStr);n.setFillStyle(h),n.setTransform(this._worldTransform,e,i),r.fillRect(0,0,s,-a),cc.g_NumberOfDraws++}},t.updateStatus=function(){var t=cc.Node._dirtyFlags,e=this._dirtyFlag;e&t.gradientDirty&&(this._dirtyFlag|=t.colorDirty,this._dirtyFlag=e&t.gradientDirty^e),cc.Node.RenderCmd.prototype.updateStatus.call(this)},t._syncStatus=function(t){var e=cc.Node._dirtyFlags,i=this._dirtyFlag;i&e.gradientDirty&&(this._dirtyFlag|=e.colorDirty,this._dirtyFlag=i&e.gradientDirty^i),cc.Node.RenderCmd.prototype._syncStatus.call(this,t)},t._updateColor=function(){var t=this._node,e=t._contentSize,i=.5*e.width,n=.5*e.height,r=cc.pAngleSigned(cc.p(0,-1),t._alongVector),c=cc.pRotateByAngle(cc.p(0,-1),cc.p(0,0),r),o=Math.min(Math.abs(1/c.x),Math.abs(1/c.y));this._startPoint.x=i*(-c.x*o)+i,this._startPoint.y=n*(c.y*o)-n,this._endPoint.x=i*(c.x*o)+i,this._endPoint.y=n*(-c.y*o)-n;var s=this._displayedColor,a=t._endColor,h=t._startOpacity/255,l=t._endOpacity/255;if(this._startStopStr="rgba("+Math.round(s.r)+","+Math.round(s.g)+","+Math.round(s.b)+","+h.toFixed(4)+")",this._endStopStr="rgba("+Math.round(a.r)+","+Math.round(a.g)+","+Math.round(a.b)+","+l.toFixed(4)+")",t._colorStops){this._startOpacity=0,this._endOpacity=0,this._colorStopsStr=[];for(var u=0;u<t._colorStops.length;u++){var _=t._colorStops[u].color,d=null==_.a?1:_.a/255;this._colorStopsStr.push("rgba("+Math.round(_.r)+","+Math.round(_.g)+","+Math.round(_.b)+","+d.toFixed(4)+")")}}}}(),cc._tmp.PrototypeSprite=function(){var t=cc.Sprite.prototype;cc.defineGetterSetter(t,"opacityModifyRGB",t.isOpacityModifyRGB,t.setOpacityModifyRGB),cc.defineGetterSetter(t,"opacity",t.getOpacity,t.setOpacity),cc.defineGetterSetter(t,"color",t.getColor,t.setColor),t.dirty,t.flippedX,cc.defineGetterSetter(t,"flippedX",t.isFlippedX,t.setFlippedX),t.flippedY,cc.defineGetterSetter(t,"flippedY",t.isFlippedY,t.setFlippedY),t.offsetX,cc.defineGetterSetter(t,"offsetX",t._getOffsetX),t.offsetY,cc.defineGetterSetter(t,"offsetY",t._getOffsetY),t.atlasIndex,t.texture,cc.defineGetterSetter(t,"texture",t.getTexture,t.setTexture),t.textureRectRotated,cc.defineGetterSetter(t,"textureRectRotated",t.isTextureRectRotated),t.textureAtlas,t.batchNode,cc.defineGetterSetter(t,"batchNode",t.getBatchNode,t.setBatchNode),t.quad,cc.defineGetterSetter(t,"quad",t.getQuad)},cc.Sprite=cc.Node.extend({dirty:!1,atlasIndex:0,textureAtlas:null,_batchNode:null,_recursiveDirty:null,_hasChildren:null,_shouldBeHidden:!1,_transformToBatch:null,_blendFunc:null,_texture:null,_rect:null,_rectRotated:!1,_offsetPosition:null,_unflippedOffsetPositionFromCenter:null,_opacityModifyRGB:!1,_flippedX:!1,_flippedY:!1,_textureLoaded:!1,_className:"Sprite",ctor:function(t,e,i){var n=this;cc.Node.prototype.ctor.call(n),this.setAnchorPoint(.5,.5),n._loader=new cc.Sprite.LoadManager,n._shouldBeHidden=!1,n._offsetPosition=cc.p(0,0),n._unflippedOffsetPositionFromCenter=cc.p(0,0),n._blendFunc={src:cc.BLEND_SRC,dst:cc.BLEND_DST},n._rect=cc.rect(0,0,0,0),n._softInit(t,e,i)},textureLoaded:function(){return this._textureLoaded},addLoadedEventListener:function(t,e){this.addEventListener("load",t,e)},isDirty:function(){return this.dirty},setDirty:function(t){this.dirty=t},isTextureRectRotated:function(){return this._rectRotated},getAtlasIndex:function(){return this.atlasIndex},setAtlasIndex:function(t){this.atlasIndex=t},getTextureRect:function(){return cc.rect(this._rect)},getTextureAtlas:function(){return this.textureAtlas},setTextureAtlas:function(t){this.textureAtlas=t},getOffsetPosition:function(){return cc.p(this._offsetPosition)},_getOffsetX:function(){return this._offsetPosition.x},_getOffsetY:function(){return this._offsetPosition.y},getBlendFunc:function(){return this._blendFunc},initWithSpriteFrame:function(t){return cc.assert(t,cc._LogInfos.Sprite_initWithSpriteFrame),this.setSpriteFrame(t)},initWithSpriteFrameName:function(t){cc.assert(t,cc._LogInfos.Sprite_initWithSpriteFrameName);var e=cc.spriteFrameCache.getSpriteFrame(t);return cc.assert(e,t+cc._LogInfos.Sprite_initWithSpriteFrameName1),this.initWithSpriteFrame(e)},useBatchNode:function(t){this.textureAtlas=t.getTextureAtlas(),this._batchNode=t},setVertexRect:function(t){var e=this._rect;e.x=t.x,e.y=t.y,e.width=t.width,e.height=t.height,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},sortAllChildren:function(){if(this._reorderChildDirty){var t=this._children;cc.Node.prototype.sortAllChildren.call(this),this._batchNode&&this._arrayMakeObjectsPerformSelector(t,cc.Node._stateCallbackType.sortAllChildren),this._reorderChildDirty=!1}},reorderChild:function(t,e){return cc.assert(t,cc._LogInfos.Sprite_reorderChild_2),this._children.indexOf(t)===-1?void cc.log(cc._LogInfos.Sprite_reorderChild):void(e!==t.zIndex&&(this._batchNode&&!this._reorderChildDirty&&(this._setReorderChildDirtyRecursively(),this._batchNode.reorderBatch(!0)),cc.Node.prototype.reorderChild.call(this,t,e)))},removeChild:function(t,e){this._batchNode&&this._batchNode.removeSpriteFromAtlas(t),cc.Node.prototype.removeChild.call(this,t,e)},setVisible:function(t){cc.Node.prototype.setVisible.call(this,t),this._renderCmd.setDirtyRecursively(!0)},removeAllChildren:function(t){var e=this._children,i=this._batchNode;if(i&&null!=e)for(var n=0,r=e.length;n<r;n++)i.removeSpriteFromAtlas(e[n]);cc.Node.prototype.removeAllChildren.call(this,t),this._hasChildren=!1},ignoreAnchorPointForPosition:function(t){return this._batchNode?void cc.log(cc._LogInfos.Sprite_ignoreAnchorPointForPosition):void cc.Node.prototype.ignoreAnchorPointForPosition.call(this,t)},setFlippedX:function(t){this._flippedX!==t&&(this._flippedX=t,this.setTextureRect(this._rect,this._rectRotated,this._contentSize),this.setNodeDirty(!0))},setFlippedY:function(t){this._flippedY!==t&&(this._flippedY=t,this.setTextureRect(this._rect,this._rectRotated,this._contentSize),this.setNodeDirty(!0))},isFlippedX:function(){return this._flippedX},isFlippedY:function(){return this._flippedY},setOpacityModifyRGB:function(t){this._opacityModifyRGB!==t&&(this._opacityModifyRGB=t,this._renderCmd._setColorDirty())},isOpacityModifyRGB:function(){return this._opacityModifyRGB},setDisplayFrameWithAnimationName:function(t,e){cc.assert(t,cc._LogInfos.Sprite_setDisplayFrameWithAnimationName_3);var i=cc.animationCache.getAnimation(t);if(!i)return void cc.log(cc._LogInfos.Sprite_setDisplayFrameWithAnimationName);var n=i.getFrames()[e];return n?void this.setSpriteFrame(n.getSpriteFrame()):void cc.log(cc._LogInfos.Sprite_setDisplayFrameWithAnimationName_2)},getBatchNode:function(){return this._batchNode},_setReorderChildDirtyRecursively:function(){if(!this._reorderChildDirty){this._reorderChildDirty=!0;for(var t=this._parent;t&&t!==this._batchNode;)t._setReorderChildDirtyRecursively(),t=t.parent}},getTexture:function(){return this._texture},_softInit:function(t,e,i){if(void 0===t)cc.Sprite.prototype.init.call(this);else if(cc.isString(t))if("#"===t[0]){var n=t.substr(1,t.length-1),r=cc.spriteFrameCache.getSpriteFrame(n);r?this.initWithSpriteFrame(r):cc.log("%s does not exist",t)}else cc.Sprite.prototype.init.call(this,t,e);else if("object"==typeof t)if(t instanceof cc.Texture2D)this.initWithTexture(t,e,i);else if(t instanceof cc.SpriteFrame)this.initWithSpriteFrame(t);else if(t instanceof HTMLImageElement||t instanceof HTMLCanvasElement){var c=new cc.Texture2D;c.initWithElement(t),c.handleLoadedTexture(),this.initWithTexture(c)}},getQuad:function(){return null},setBlendFunc:function(t,e){var i=this._blendFunc;void 0===e?(i.src=t.src,i.dst=t.dst):(i.src=t,i.dst=e),this._renderCmd.updateBlendFunc(i)},init:function(){var t=this;return arguments.length>0?t.initWithFile(arguments[0],arguments[1]):(cc.Node.prototype.init.call(t),t.dirty=t._recursiveDirty=!1,t._blendFunc.src=cc.BLEND_SRC,t._blendFunc.dst=cc.BLEND_DST,t.texture=null,t._flippedX=t._flippedY=!1,t.anchorX=.5,t.anchorY=.5,t._offsetPosition.x=0,t._offsetPosition.y=0,t._hasChildren=!1,t.setTextureRect(cc.rect(0,0,0,0),!1,cc.size(0,0)),!0)},initWithFile:function(t,e){cc.assert(t,cc._LogInfos.Sprite_initWithFile);var i=cc.textureCache.getTextureForKey(t);if(i||(i=cc.textureCache.addImage(t)),!i.isLoaded())return this._loader.clear(),
this._loader.once(i,function(){this.initWithFile(t,e),this.dispatchEvent("load")},this),!1;if(!e){var n=i.getContentSize();e=cc.rect(0,0,n.width,n.height)}return this.initWithTexture(i,e)},initWithTexture:function(t,e,i,n){var r=this;return cc.assert(0!==arguments.length,cc._LogInfos.CCSpriteBatchNode_initWithTexture),this._loader.clear(),r._textureLoaded=t.isLoaded(),r._textureLoaded?(i=i||!1,t=this._renderCmd._handleTextureForRotatedTexture(t,e,i,n),!!cc.Node.prototype.init.call(r)&&(r._batchNode=null,r._recursiveDirty=!1,r.dirty=!1,r._opacityModifyRGB=!0,r._blendFunc.src=cc.BLEND_SRC,r._blendFunc.dst=cc.BLEND_DST,r._flippedX=r._flippedY=!1,r._offsetPosition.x=0,r._offsetPosition.y=0,r._hasChildren=!1,r._rectRotated=i,e&&(r._rect.x=e.x,r._rect.y=e.y,r._rect.width=e.width,r._rect.height=e.height),e||(e=cc.rect(0,0,t.width,t.height)),this._renderCmd._checkTextureBoundary(t,e,i),r.setTexture(t),r.setTextureRect(e,i),r.setBatchNode(null),!0)):(this._loader.once(t,function(){this.initWithTexture(t,e,i,n),this.dispatchEvent("load")},this),!1)},setTextureRect:function(t,e,i,n){var r=this;r._rectRotated=e||!1,r.setContentSize(i||t),r.setVertexRect(t),r._renderCmd._setTextureCoords(t,n);var c=r._unflippedOffsetPositionFromCenter.x,o=r._unflippedOffsetPositionFromCenter.y;r._flippedX&&(c=-c),r._flippedY&&(o=-o);var s=r._rect;r._offsetPosition.x=c+(r._contentSize.width-s.width)/2,r._offsetPosition.y=o+(r._contentSize.height-s.height)/2},addChild:function(t,e,i){cc.assert(t,cc._LogInfos.CCSpriteBatchNode_addChild_2),null==e&&(e=t._localZOrder),null==i&&(i=t.tag),this._renderCmd._setBatchNodeForAddChild(t)&&(cc.Node.prototype.addChild.call(this,t,e,i),this._hasChildren=!0)},setSpriteFrame:function(t){var e=this;cc.isString(t)&&(t=cc.spriteFrameCache.getSpriteFrame(t),cc.assert(t,cc._LogInfos.Sprite_setSpriteFrame)),this._loader.clear(),this.setNodeDirty(!0);var i=t.getTexture();if(e._textureLoaded=t.textureLoaded(),this._loader.clear(),!e._textureLoaded)return this._loader.once(i,function(){this.setSpriteFrame(t),this.dispatchEvent("load")},this),!1;var n=t.getOffset();e._unflippedOffsetPositionFromCenter.x=n.x,e._unflippedOffsetPositionFromCenter.y=n.y,i!==e._texture&&(this._renderCmd._setTexture(i),e.setColor(e._realColor)),e.setTextureRect(t.getRect(),t.isRotated(),t.getOriginalSize())},setDisplayFrame:function(t){cc.log(cc._LogInfos.Sprite_setDisplayFrame),this.setSpriteFrame(t)},isFrameDisplayed:function(t){return this._renderCmd.isFrameDisplayed(t)},displayFrame:function(){return this.getSpriteFrame()},getSpriteFrame:function(){return new cc.SpriteFrame(this._texture,cc.rectPointsToPixels(this._rect),this._rectRotated,cc.pointPointsToPixels(this._unflippedOffsetPositionFromCenter),cc.sizePointsToPixels(this._contentSize))},setBatchNode:function(t){var e=this;e._batchNode=t,e._batchNode?(e._transformToBatch=cc.affineTransformIdentity(),e.textureAtlas=e._batchNode.getTextureAtlas()):(e.atlasIndex=cc.Sprite.INDEX_NOT_INITIALIZED,e.textureAtlas=null,e._recursiveDirty=!1,e.dirty=!1)},setTexture:function(t){if(!t)return this._renderCmd._setTexture(null);var e=cc.isString(t);return e&&(t=cc.textureCache.addImage(t)),this._loader.clear(),t._textureLoaded?(this._renderCmd._setTexture(t),e&&this._changeRectWithTexture(t),this.setColor(this._realColor),void(this._textureLoaded=!0)):(this._loader.once(t,function(){this.setTexture(t),this.dispatchEvent("load")},this),!1)},_changeRectWithTexture:function(t){var e=t._contentSize,i=cc.rect(0,0,e.width,e.height);this.setTextureRect(i)},_createRenderCmd:function(){return cc._renderType===cc.game.RENDER_TYPE_CANVAS?new cc.Sprite.CanvasRenderCmd(this):new cc.Sprite.WebGLRenderCmd(this)}}),cc.Sprite.create=function(t,e,i){return new cc.Sprite(t,e,i)},cc.Sprite.createWithTexture=cc.Sprite.create,cc.Sprite.createWithSpriteFrameName=cc.Sprite.create,cc.Sprite.createWithSpriteFrame=cc.Sprite.create,cc.Sprite.INDEX_NOT_INITIALIZED=-1,cc.EventHelper.prototype.apply(cc.Sprite.prototype),cc.assert(cc.isFunction(cc._tmp.PrototypeSprite),cc._LogInfos.MissingFile,"SpritesPropertyDefine.js"),cc._tmp.PrototypeSprite(),delete cc._tmp.PrototypeSprite,function(){var t=cc.Sprite.LoadManager=function(){this.list=[]};t.prototype.add=function(t,e,i){t&&t.addEventListener&&(t.addEventListener("load",e,i),this.list.push({source:t,listener:e,target:i}))},t.prototype.once=function(t,e,i){if(t&&t.addEventListener){var n=function(r){t.removeEventListener("load",n,i),e.call(i,r)};t.addEventListener("load",n,i),this.list.push({source:t,listener:n,target:i})}},t.prototype.clear=function(){for(;this.list.length>0;){var t=this.list.pop();t.source.removeEventListener("load",t.listener,t.target)}}}(),function(){cc.Sprite.CanvasRenderCmd=function(t){cc.Node.CanvasRenderCmd.call(this,t),this._needDraw=!0,this._textureCoord={renderX:0,renderY:0,x:0,y:0,width:0,height:0,validRect:!1},this._blendFuncStr="source-over",this._colorized=!1,this._canUseDirtyRegion=!0,this._textureToRender=null};var t=cc.Sprite.CanvasRenderCmd.prototype=Object.create(cc.Node.CanvasRenderCmd.prototype);t.constructor=cc.Sprite.CanvasRenderCmd,t.setDirtyRecursively=function(t){},t._setTexture=function(t){var e=this._node;e._texture!==t&&(t?e._textureLoaded=t._textureLoaded:e._textureLoaded=!1,e._texture=t,this._updateColor())},t._setColorDirty=function(){this.setDirtyFlag(cc.Node._dirtyFlags.colorDirty|cc.Node._dirtyFlags.opacityDirty)},t.isFrameDisplayed=function(t){var e=this._node;return t.getTexture()===e._texture&&cc.rectEqualToRect(t.getRect(),e._rect)},t.updateBlendFunc=function(t){this._blendFuncStr=cc.Node.CanvasRenderCmd._getCompositeOperationByBlendFunc(t)},t._setBatchNodeForAddChild=function(t){return!0},t._handleTextureForRotatedTexture=function(t,e,i,n){if(i&&t.isLoaded()){var r=t.getHtmlElementObj();r=cc.Sprite.CanvasRenderCmd._cutRotateImageToCanvas(r,e,n);var c=new cc.Texture2D;c.initWithElement(r),c.handleLoadedTexture(),t=c,e.x=e.y=0,this._node._rect=cc.rect(0,0,e.width,e.height)}return t},t._checkTextureBoundary=function(t,e,i){if(t&&t.url){var n=e.x+e.width,r=e.y+e.height;n>t.width&&cc.error(cc._LogInfos.RectWidth,t.url),r>t.height&&cc.error(cc._LogInfos.RectHeight,t.url)}},t.rendering=function(t,e,i){var n=this._node,r=this._textureCoord,c=this._displayedOpacity/255,o=this._textureToRender||n._texture;if((!o||0!==r.width&&0!==r.height&&o._textureLoaded)&&0!==c){var s,a=t||cc._renderContext,h=a.getContext(),l=n._offsetPosition.x,u=n._rect.height,_=n._rect.width,d=-n._offsetPosition.y-u;a.setTransform(this._worldTransform,e,i),a.setCompositeOperation(this._blendFuncStr),a.setGlobalAlpha(c),(n._flippedX||n._flippedY)&&a.save(),n._flippedX&&(l=-l-_,h.scale(-1,1)),n._flippedY&&(d=n._offsetPosition.y,h.scale(1,-1));var f,p,g,m,v,T,y,S;if(this._colorized?(f=0,p=0):(f=r.renderX,p=r.renderY),g=r.width,m=r.height,v=l,T=d,y=_,S=u,o&&o._htmlElementObj)s=o._htmlElementObj,""!==o._pattern?(a.setFillStyle(h.createPattern(s,o._pattern)),h.fillRect(v,T,y,S)):h.drawImage(s,f,p,g,m,v,T,y,S);else{var C=n._contentSize;if(r.validRect){var E=this._displayedColor;a.setFillStyle("rgba("+E.r+","+E.g+","+E.b+",1)"),h.fillRect(v,T,C.width*e,C.height*i)}}(n._flippedX||n._flippedY)&&a.restore(),cc.g_NumberOfDraws++}},t._updateColor=function(){var t=this._node,e=t._texture,i=this._textureCoord,n=this._displayedColor;e&&(255!==n.r||255!==n.g||255!==n.b?(this._textureToRender=e._generateColorTexture(n.r,n.g,n.b,i),this._colorized=!0):e&&(this._textureToRender=e,this._colorized=!1))},t._textureLoadedCallback=function(t){var e=this;if(!e._textureLoaded){e._textureLoaded=!0;var i=e._rect,n=this._renderCmd;i?cc._rectEqualToZero(i)&&(i.width=t.width,i.height=t.height):i=cc.rect(0,0,t.width,t.height),e.texture=t,e.setTextureRect(i,e._rectRotated);var r=n._displayedColor;255===r.r&&255===r.g&&255===r.b||n._updateColor(),e.setBatchNode(e._batchNode),e.dispatchEvent("load")}},t._setTextureCoords=function(t,e){void 0===e&&(e=!0);var i=this._textureCoord,n=e?cc.contentScaleFactor():1;i.renderX=i.x=0|t.x*n,i.renderY=i.y=0|t.y*n,i.width=0|t.width*n,i.height=0|t.height*n,i.validRect=!(0===i.width||0===i.height||i.x<0||i.y<0)},cc.Sprite.CanvasRenderCmd._cutRotateImageToCanvas=function(t,e,i){if(!t)return null;if(!e)return t;i=null==i||i;var n=document.createElement("canvas");n.width=e.width,n.height=e.height;var r=n.getContext("2d");return r.translate(n.width/2,n.height/2),i?r.rotate(-1.5707963267948966):r.rotate(1.5707963267948966),r.drawImage(t,e.x,e.y,e.height,e.width,-e.height/2,-e.width/2,e.height,e.width),n}}(),cc.BakeSprite=cc.Sprite.extend({_cacheCanvas:null,_cacheContext:null,ctor:function(){cc.Sprite.prototype.ctor.call(this);var t=document.createElement("canvas");t.width=t.height=10,this._cacheCanvas=t,this._cacheContext=new cc.CanvasContextWrapper(t.getContext("2d"));var e=new cc.Texture2D;e.initWithElement(t),e.handleLoadedTexture(),this.setTexture(e)},getCacheContext:function(){return this._cacheContext},getCacheCanvas:function(){return this._cacheCanvas},resetCanvasSize:function(t,e){var i=this._cacheCanvas,n=this._cacheContext,r=n._context.strokeStyle,c=n._context.fillStyle;void 0===e&&(e=t.height,t=t.width),i.width=t,i.height=e,r!==n._context.strokeStyle&&(n._context.strokeStyle=r),c!==n._context.fillStyle&&(n._context.fillStyle=c),this.getTexture().handleLoadedTexture(),this.setTextureRect(cc.rect(0,0,t,e),!1,null,!1)}}),cc.AnimationFrame=cc.Class.extend({_spriteFrame:null,_delayPerUnit:0,_userInfo:null,ctor:function(t,e,i){this._spriteFrame=t||null,this._delayPerUnit=e||0,this._userInfo=i||null},clone:function(){var t=new cc.AnimationFrame;return t.initWithSpriteFrame(this._spriteFrame.clone(),this._delayPerUnit,this._userInfo),t},copyWithZone:function(t){return cc.clone(this)},copy:function(t){var e=new cc.AnimationFrame;return e.initWithSpriteFrame(this._spriteFrame.clone(),this._delayPerUnit,this._userInfo),e},initWithSpriteFrame:function(t,e,i){return this._spriteFrame=t,this._delayPerUnit=e,this._userInfo=i,!0},getSpriteFrame:function(){return this._spriteFrame},setSpriteFrame:function(t){this._spriteFrame=t},getDelayUnits:function(){return this._delayPerUnit},setDelayUnits:function(t){this._delayPerUnit=t},getUserInfo:function(){return this._userInfo},setUserInfo:function(t){this._userInfo=t}}),cc.AnimationFrame.create=function(t,e,i){return new cc.AnimationFrame(t,e,i)},cc.Animation=cc.Class.extend({_frames:null,_loops:0,_restoreOriginalFrame:!1,_duration:0,_delayPerUnit:0,_totalDelayUnits:0,ctor:function(t,e,i){if(this._frames=[],void 0===t)this.initWithSpriteFrames(null,0);else{var n=t[0];n&&(n instanceof cc.SpriteFrame?this.initWithSpriteFrames(t,e,i):n instanceof cc.AnimationFrame&&this.initWithAnimationFrames(t,e,i))}},getFrames:function(){return this._frames},setFrames:function(t){this._frames=t},addSpriteFrame:function(t){var e=new cc.AnimationFrame;e.initWithSpriteFrame(t,1,null),this._frames.push(e),this._totalDelayUnits++},addSpriteFrameWithFile:function(t){var e=cc.textureCache.addImage(t),i=cc.rect(0,0,0,0);i.width=e.width,i.height=e.height;var n=new cc.SpriteFrame(e,i);this.addSpriteFrame(n)},addSpriteFrameWithTexture:function(t,e){var i=new cc.SpriteFrame(t,e);this.addSpriteFrame(i)},initWithAnimationFrames:function(t,e,i){cc.arrayVerifyType(t,cc.AnimationFrame),this._delayPerUnit=e,this._loops=void 0===i?1:i,this._totalDelayUnits=0;var n=this._frames;n.length=0;for(var r=0;r<t.length;r++){var c=t[r];n.push(c),this._totalDelayUnits+=c.getDelayUnits()}return!0},clone:function(){var t=new cc.Animation;return t.initWithAnimationFrames(this._copyFrames(),this._delayPerUnit,this._loops),t.setRestoreOriginalFrame(this._restoreOriginalFrame),t},copyWithZone:function(t){var e=new cc.Animation;return e.initWithAnimationFrames(this._copyFrames(),this._delayPerUnit,this._loops),e.setRestoreOriginalFrame(this._restoreOriginalFrame),e},_copyFrames:function(){for(var t=[],e=0;e<this._frames.length;e++)t.push(this._frames[e].clone());return t},copy:function(t){return this.copyWithZone(null)},getLoops:function(){return this._loops},setLoops:function(t){this._loops=t},setRestoreOriginalFrame:function(t){this._restoreOriginalFrame=t},getRestoreOriginalFrame:function(){return this._restoreOriginalFrame},getDuration:function(){return this._totalDelayUnits*this._delayPerUnit},getDelayPerUnit:function(){return this._delayPerUnit},setDelayPerUnit:function(t){this._delayPerUnit=t},getTotalDelayUnits:function(){return this._totalDelayUnits},initWithSpriteFrames:function(t,e,i){cc.arrayVerifyType(t,cc.SpriteFrame),this._loops=void 0===i?1:i,this._delayPerUnit=e||0,this._totalDelayUnits=0;var n=this._frames;if(n.length=0,t){for(var r=0;r<t.length;r++){var c=t[r],o=new cc.AnimationFrame;o.initWithSpriteFrame(c,1,null),n.push(o)}this._totalDelayUnits+=t.length}return!0},retain:function(){},release:function(){}}),cc.Animation.create=function(t,e,i){return new cc.Animation(t,e,i)},cc.Animation.createWithAnimationFrames=cc.Animation.create,cc.animationCache={_animations:{},addAnimation:function(t,e){this._animations[e]=t},removeAnimation:function(t){t&&this._animations[t]&&delete this._animations[t]},getAnimation:function(t){return this._animations[t]?this._animations[t]:null},_addAnimationsWithDictionary:function(t,e){var i=t.animations;if(!i)return void cc.log(cc._LogInfos.animationCache__addAnimationsWithDictionary);var n=1,r=t.properties;if(r){n=null!=r.format?parseInt(r.format):n;for(var c=r.spritesheets,o=cc.spriteFrameCache,s=cc.path,a=0;a<c.length;a++)o.addSpriteFrames(s.changeBasename(e,c[a]))}switch(n){case 1:this._parseVersion1(i);break;case 2:this._parseVersion2(i);break;default:cc.log(cc._LogInfos.animationCache__addAnimationsWithDictionary_2)}},addAnimations:function(t){cc.assert(t,cc._LogInfos.animationCache_addAnimations_2);var e=cc.loader.getRes(t);return e?void this._addAnimationsWithDictionary(e,t):void cc.log(cc._LogInfos.animationCache_addAnimations)},_parseVersion1:function(t){var e=cc.spriteFrameCache;for(var i in t){var n=t[i],r=n.frames,c=parseFloat(n.delay)||0,o=null;if(r){for(var s=[],a=0;a<r.length;a++){var h=e.getSpriteFrame(r[a]);if(h){var l=new cc.AnimationFrame;l.initWithSpriteFrame(h,1,null),s.push(l)}else cc.log(cc._LogInfos.animationCache__parseVersion1_2,i,r[a])}0!==s.length?(s.length!==r.length&&cc.log(cc._LogInfos.animationCache__parseVersion1_4,i),o=new cc.Animation(s,c,1),cc.animationCache.addAnimation(o,i)):cc.log(cc._LogInfos.animationCache__parseVersion1_3,i)}else cc.log(cc._LogInfos.animationCache__parseVersion1,i)}},_parseVersion2:function(t){var e=cc.spriteFrameCache;for(var i in t){var n=t[i],r=n.loop,c=parseInt(n.loops),o=r?cc.REPEAT_FOREVER:isNaN(c)?1:c,s=!(!n.restoreOriginalFrame||1!=n.restoreOriginalFrame),a=n.frames;if(a){for(var h=[],l=0;l<a.length;l++){var u=a[l],_=u.spriteframe,d=e.getSpriteFrame(_);if(d){var f=parseFloat(u.delayUnits)||0,p=u.notification,g=new cc.AnimationFrame;g.initWithSpriteFrame(d,f,p),h.push(g)}else cc.log(cc._LogInfos.animationCache__parseVersion2_2,i,_)}var m=parseFloat(n.delayPerUnit)||0,v=new cc.Animation;v.initWithAnimationFrames(h,m,o),v.setRestoreOriginalFrame(s),cc.animationCache.addAnimation(v,i)}else cc.log(cc._LogInfos.animationCache__parseVersion2,i)}},_clear:function(){this._animations={}}};cc.SpriteFrame=cc.Class.extend({_offset:null,_originalSize:null,_rectInPixels:null,_rotated:!1,_rect:null,_offsetInPixels:null,_originalSizeInPixels:null,_texture:null,_textureFilename:"",_textureLoaded:!1,ctor:function(t,e,i,n,r){this._offset=cc.p(0,0),this._offsetInPixels=cc.p(0,0),this._originalSize=cc.size(0,0),this._rotated=!1,this._originalSizeInPixels=cc.size(0,0),this._textureFilename="",this._texture=null,this._textureLoaded=!1,void 0!==t&&void 0!==e&&(void 0===i||void 0===n||void 0===r?this.initWithTexture(t,e):this.initWithTexture(t,e,i,n,r))},textureLoaded:function(){return this._textureLoaded},addLoadedEventListener:function(t,e){this.addEventListener("load",t,e)},getRectInPixels:function(){var t=this._rectInPixels;return cc.rect(t.x,t.y,t.width,t.height)},setRectInPixels:function(t){this._rectInPixels||(this._rectInPixels=cc.rect(0,0,0,0)),this._rectInPixels.x=t.x,this._rectInPixels.y=t.y,this._rectInPixels.width=t.width,this._rectInPixels.height=t.height,this._rect=cc.rectPixelsToPoints(t)},isRotated:function(){return this._rotated},setRotated:function(t){this._rotated=t},getRect:function(){var t=this._rect;return cc.rect(t.x,t.y,t.width,t.height)},setRect:function(t){this._rect||(this._rect=cc.rect(0,0,0,0)),this._rect.x=t.x,this._rect.y=t.y,this._rect.width=t.width,this._rect.height=t.height,this._rectInPixels=cc.rectPointsToPixels(this._rect)},getOffsetInPixels:function(){return cc.p(this._offsetInPixels)},setOffsetInPixels:function(t){this._offsetInPixels.x=t.x,this._offsetInPixels.y=t.y,cc._pointPixelsToPointsOut(this._offsetInPixels,this._offset)},getOriginalSizeInPixels:function(){return cc.size(this._originalSizeInPixels)},setOriginalSizeInPixels:function(t){this._originalSizeInPixels.width=t.width,this._originalSizeInPixels.height=t.height},getOriginalSize:function(){return cc.size(this._originalSize)},setOriginalSize:function(t){this._originalSize.width=t.width,this._originalSize.height=t.height},getTexture:function(){if(this._texture)return this._texture;if(""!==this._textureFilename){var t=cc.textureCache.addImage(this._textureFilename);return t&&(this._textureLoaded=t.isLoaded()),t}return null},setTexture:function(t){if(this._texture!==t){var e=t.isLoaded();this._textureLoaded=e,this._texture=t,e||t.addEventListener("load",function(t){if(this._textureLoaded=!0,this._rotated&&cc._renderType===cc.game.RENDER_TYPE_CANVAS){var e=t.getHtmlElementObj();e=cc.Sprite.CanvasRenderCmd._cutRotateImageToCanvas(e,this.getRect());var i=new cc.Texture2D;i.initWithElement(e),i.handleLoadedTexture(),this.setTexture(i);var n=this.getRect();this.setRect(cc.rect(0,0,n.width,n.height))}var r=this._rect;if(0===r.width&&0===r.height){var c=t.width,o=t.height;this._rect.width=c,this._rect.height=o,this._rectInPixels=cc.rectPointsToPixels(this._rect),this._originalSizeInPixels.width=this._rectInPixels.width,this._originalSizeInPixels.height=this._rectInPixels.height,this._originalSize.width=c,this._originalSize.height=o}this.dispatchEvent("load")},this)}},getOffset:function(){return cc.p(this._offset)},setOffset:function(t){this._offset.x=t.x,this._offset.y=t.y},clone:function(){var t=new cc.SpriteFrame;return t.initWithTexture(this._textureFilename,this._rectInPixels,this._rotated,this._offsetInPixels,this._originalSizeInPixels),t.setTexture(this._texture),t},copyWithZone:function(){var t=new cc.SpriteFrame;return t.initWithTexture(this._textureFilename,this._rectInPixels,this._rotated,this._offsetInPixels,this._originalSizeInPixels),t.setTexture(this._texture),t},copy:function(){return this.copyWithZone()},initWithTexture:function(t,e,i,n,r){if(2===arguments.length&&(e=cc.rectPointsToPixels(e)),n=n||cc.p(0,0),r=r||e,i=i||!1,cc.isString(t)?(this._texture=null,this._textureFilename=t):t instanceof cc.Texture2D&&this.setTexture(t),t=this.getTexture(),this._rectInPixels=e,this._rect=cc.rectPixelsToPoints(e),t&&t.url&&t.isLoaded()){var c,o;i?(c=e.x+e.height,o=e.y+e.width):(c=e.x+e.width,o=e.y+e.height),c>t.getPixelsWide()&&cc.error(cc._LogInfos.RectWidth,t.url),o>t.getPixelsHigh()&&cc.error(cc._LogInfos.RectHeight,t.url)}return this._offsetInPixels.x=n.x,this._offsetInPixels.y=n.y,cc._pointPixelsToPointsOut(n,this._offset),this._originalSizeInPixels.width=r.width,this._originalSizeInPixels.height=r.height,cc._sizePixelsToPointsOut(r,this._originalSize),this._rotated=i,!0}});cc.EventHelper.prototype.apply(cc.SpriteFrame.prototype),cc.SpriteFrame.create=function(t,e,i,n,r){return new cc.SpriteFrame(t,e,i,n,r)},cc.SpriteFrame.createWithTexture=cc.SpriteFrame.create,cc.SpriteFrame._frameWithTextureForCanvas=function(t,e,i,n,r){var c=new cc.SpriteFrame;return c._texture=t,c._rectInPixels=e,c._rect=cc.rectPixelsToPoints(e),c._offsetInPixels.x=n.x,c._offsetInPixels.y=n.y,cc._pointPixelsToPointsOut(c._offsetInPixels,c._offset),c._originalSizeInPixels.width=r.width,c._originalSizeInPixels.height=r.height,cc._sizePixelsToPointsOut(c._originalSizeInPixels,c._originalSize),c._rotated=i,c},cc.spriteFrameCache={_CCNS_REG1:/^\s*\{\s*([\-]?\d+[.]?\d*)\s*,\s*([\-]?\d+[.]?\d*)\s*\}\s*$/,_CCNS_REG2:/^\s*\{\s*\{\s*([\-]?\d+[.]?\d*)\s*,\s*([\-]?\d+[.]?\d*)\s*\}\s*,\s*\{\s*([\-]?\d+[.]?\d*)\s*,\s*([\-]?\d+[.]?\d*)\s*\}\s*\}\s*$/,_spriteFrames:{},_spriteFramesAliases:{},_frameConfigCache:{},_rectFromString:function(t){var e=this._CCNS_REG2.exec(t);return e?cc.rect(parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3]),parseFloat(e[4])):cc.rect(0,0,0,0)},_pointFromString:function(t){var e=this._CCNS_REG1.exec(t);return e?cc.p(parseFloat(e[1]),parseFloat(e[2])):cc.p(0,0)},_sizeFromString:function(t){var e=this._CCNS_REG1.exec(t);return e?cc.size(parseFloat(e[1]),parseFloat(e[2])):cc.size(0,0)},_getFrameConfig:function(t){var e=cc.loader.getRes(t);return cc.assert(e,cc._LogInfos.spriteFrameCache__getFrameConfig_2,t),cc.loader.release(t),e._inited?(this._frameConfigCache[t]=e,e):(this._frameConfigCache[t]=this._parseFrameConfig(e),this._frameConfigCache[t])},_getFrameConfigByJsonObject:function(t,e){return cc.assert(e,cc._LogInfos.spriteFrameCache__getFrameConfig_2,t),this._frameConfigCache[t]=this._parseFrameConfig(e),this._frameConfigCache[t]},_parseFrameConfig:function(t){var e=t.frames,i=t.metadata||t.meta,n={},r={},c=0;if(i){var o=i.format;c=o.length<=1?parseInt(o):o,r.image=i.textureFileName||i.textureFileName||i.image}for(var s in e){var a=e[s];if(a){var h={};if(0==c){h.rect=cc.rect(a.x,a.y,a.width,a.height),h.rotated=!1,h.offset=cc.p(a.offsetX,a.offsetY);var l=a.originalWidth,u=a.originalHeight;l&&u||cc.log(cc._LogInfos.spriteFrameCache__getFrameConfig),l=Math.abs(l),u=Math.abs(u),h.size=cc.size(l,u)}else if(1==c||2==c)h.rect=this._rectFromString(a.frame),h.rotated=a.rotated||!1,h.offset=this._pointFromString(a.offset),h.size=this._sizeFromString(a.sourceSize);else if(3==c){var _=this._sizeFromString(a.spriteSize),d=this._rectFromString(a.textureRect);_&&(d=cc.rect(d.x,d.y,_.width,_.height)),h.rect=d,h.rotated=a.textureRotated||!1,h.offset=this._pointFromString(a.spriteOffset),h.size=this._sizeFromString(a.spriteSourceSize),h.aliases=a.aliases}else{var f=a.frame,p=a.sourceSize;s=a.filename||s,h.rect=cc.rect(f.x,f.y,f.w,f.h),h.rotated=a.rotated||!1,h.offset=cc.p(0,0),h.size=cc.size(p.w,p.h)}n[s]=h}}return{_inited:!0,frames:n,meta:r}},_addSpriteFramesByObject:function(t,e,i){if(cc.assert(t,cc._LogInfos.spriteFrameCache_addSpriteFrames_2),e&&e.frames){var n=this._frameConfigCache[t]||this._getFrameConfigByJsonObject(t,e);this._createSpriteFrames(t,n,i)}},_createSpriteFrames:function(t,e,i){var n=e.frames,r=e.meta;if(i)i instanceof cc.Texture2D||(cc.isString(i)?i=cc.textureCache.addImage(i):cc.assert(0,cc._LogInfos.spriteFrameCache_addSpriteFrames_3));else{var c=cc.path.changeBasename(t,r.image||".png");i=cc.textureCache.addImage(c)}var o=this._spriteFramesAliases,s=this._spriteFrames;for(var a in n){var h=n[a],l=s[a];if(!l){l=new cc.SpriteFrame(i,h.rect,h.rotated,h.offset,h.size);var u=h.aliases;if(u)for(var _=0,d=u.length;_<d;_++){var f=u[_];o[f]&&cc.log(cc._LogInfos.spriteFrameCache_addSpriteFrames,f),o[f]=a}if(cc._renderType===cc.game.RENDER_TYPE_CANVAS&&l.isRotated()){var p=l.getTexture();if(p.isLoaded()){var g=l.getTexture().getHtmlElementObj();g=cc.Sprite.CanvasRenderCmd._cutRotateImageToCanvas(g,l.getRectInPixels());var m=new cc.Texture2D;m.initWithElement(g),m.handleLoadedTexture(),l.setTexture(m);var v=l._rect;l.setRect(cc.rect(0,0,v.width,v.height))}}s[a]=l}}},addSpriteFrames:function(t,e){cc.assert(t,cc._LogInfos.spriteFrameCache_addSpriteFrames_2);var i=this._frameConfigCache[t]||cc.loader.getRes(t);if(i&&i.frames){var n=this._frameConfigCache[t]||this._getFrameConfig(t);this._createSpriteFrames(t,n,e)}},_checkConflict:function(t){var e=t.frames;for(var i in e)this._spriteFrames[i]&&cc.log(cc._LogInfos.spriteFrameCache__checkConflict,i)},addSpriteFrame:function(t,e){this._spriteFrames[e]=t},removeSpriteFrames:function(){this._spriteFrames={},this._spriteFramesAliases={}},removeSpriteFrameByName:function(t){t&&(this._spriteFramesAliases[t]&&delete this._spriteFramesAliases[t],this._spriteFrames[t]&&delete this._spriteFrames[t])},removeSpriteFramesFromFile:function(t){var e=this,i=e._spriteFrames,n=e._spriteFramesAliases,r=e._frameConfigCache[t];if(r){var c=r.frames;for(var o in c)if(i[o]){delete i[o];for(var s in n)n[s]===o&&delete n[s]}}},removeSpriteFramesFromTexture:function(t){var e=this,i=e._spriteFrames,n=e._spriteFramesAliases;for(var r in i){var c=i[r];if(c&&c.getTexture()===t){delete i[r];for(var o in n)n[o]===r&&delete n[o]}}},getSpriteFrame:function(t){var e=this,i=e._spriteFrames[t];if(!i){var n=e._spriteFramesAliases[t];n&&(i=e._spriteFrames[n.toString()],i||delete e._spriteFramesAliases[t])}return i},_clear:function(){this._spriteFrames={},this._spriteFramesAliases={},this._frameConfigCache={}}},cc.g_NumberOfDraws=0,cc.Director=cc.Class.extend({_landscape:!1,_nextDeltaTimeZero:!1,_paused:!1,_purgeDirectorInNextLoop:!1,_sendCleanupToScene:!1,_animationInterval:0,_oldAnimationInterval:0,_projection:0,_contentScaleFactor:1,_deltaTime:0,_winSizeInPoints:null,_lastUpdate:null,_nextScene:null,_notificationNode:null,_openGLView:null,_scenesStack:null,_projectionDelegate:null,_runningScene:null,_totalFrames:0,_secondsPerFrame:0,_dirtyRegion:null,_scheduler:null,_actionManager:null,_eventProjectionChanged:null,_eventAfterUpdate:null,_eventAfterVisit:null,_eventAfterDraw:null,ctor:function(){var t=this;t._lastUpdate=Date.now(),cc.eventManager.addCustomListener(cc.game.EVENT_SHOW,function(){t._lastUpdate=Date.now()})},init:function(){return this._oldAnimationInterval=this._animationInterval=1/cc.defaultFPS,this._scenesStack=[],this._projection=cc.Director.PROJECTION_DEFAULT,this._projectionDelegate=null,this._totalFrames=0,this._lastUpdate=Date.now(),this._paused=!1,this._purgeDirectorInNextLoop=!1,this._winSizeInPoints=cc.size(0,0),this._openGLView=null,this._contentScaleFactor=1,this._scheduler=new cc.Scheduler,cc.ActionManager?(this._actionManager=new cc.ActionManager,this._scheduler.scheduleUpdate(this._actionManager,cc.Scheduler.PRIORITY_SYSTEM,!1)):this._actionManager=null,this._eventAfterUpdate=new cc.EventCustom(cc.Director.EVENT_AFTER_UPDATE),this._eventAfterUpdate.setUserData(this),this._eventAfterVisit=new cc.EventCustom(cc.Director.EVENT_AFTER_VISIT),this._eventAfterVisit.setUserData(this),this._eventAfterDraw=new cc.EventCustom(cc.Director.EVENT_AFTER_DRAW),this._eventAfterDraw.setUserData(this),this._eventProjectionChanged=new cc.EventCustom(cc.Director.EVENT_PROJECTION_CHANGED),this._eventProjectionChanged.setUserData(this),!0},calculateDeltaTime:function(){var t=Date.now();this._nextDeltaTimeZero?(this._deltaTime=0,this._nextDeltaTimeZero=!1):this._deltaTime=(t-this._lastUpdate)/1e3,cc.game.config[cc.game.CONFIG_KEY.debugMode]>0&&this._deltaTime>.2&&(this._deltaTime=1/60),this._lastUpdate=t},convertToGL:function(t){var e=document.documentElement,i=cc.view,n=element.getBoundingClientRect();n.left+=window.pageXOffset-e.clientLeft,n.top+=window.pageYOffset-e.clientTop;var r=i._devicePixelRatio*(t.x-n.left),c=i._devicePixelRatio*(n.top+n.height-t.y);return i._isRotated?{x:i._viewPortRect.width-c,y:r}:{x:r,y:c}},convertToUI:function(t){var e=document.documentElement,i=cc.view,n=element.getBoundingClientRect();n.left+=window.pageXOffset-e.clientLeft,n.top+=window.pageYOffset-e.clientTop;var r={x:0,y:0};return i._isRotated?(r.x=n.left+t.y/i._devicePixelRatio,r.y=n.top+n.height-(i._viewPortRect.width-t.x)/i._devicePixelRatio):(r.x=n.left+t.x/i._devicePixelRatio,r.y=n.top+n.height-t.y/i._devicePixelRatio),r},drawScene:function(){var t=cc.renderer;this.calculateDeltaTime(),this._paused||(this._scheduler.update(this._deltaTime),cc.eventManager.dispatchEvent(this._eventAfterUpdate)),this._nextScene&&this.setNextScene(),this._beforeVisitScene&&this._beforeVisitScene(),this._runningScene&&(t.childrenOrderDirty?(cc.renderer.clearRenderCommands(),cc.renderer.assignedZ=0,this._runningScene._renderCmd._curLevel=0,this._runningScene.visit(),t.resetFlag()):t.transformDirty()&&t.transform()),t.clear(),this._notificationNode&&this._notificationNode.visit(),cc.eventManager.dispatchEvent(this._eventAfterVisit),cc.g_NumberOfDraws=0,this._afterVisitScene&&this._afterVisitScene(),t.rendering(cc._renderContext),this._totalFrames++,cc.eventManager.dispatchEvent(this._eventAfterDraw),this._calculateMPF()},_beforeVisitScene:null,_afterVisitScene:null,end:function(){this._purgeDirectorInNextLoop=!0},getContentScaleFactor:function(){return this._contentScaleFactor},getNotificationNode:function(){return this._notificationNode},getWinSize:function(){return cc.size(this._winSizeInPoints)},getWinSizeInPixels:function(){return cc.size(this._winSizeInPoints.width*this._contentScaleFactor,this._winSizeInPoints.height*this._contentScaleFactor)},getVisibleSize:null,getVisibleOrigin:null,getZEye:null,pause:function(){this._paused||(this._oldAnimationInterval=this._animationInterval,this.setAnimationInterval(.25),this._paused=!0)},popScene:function(){cc.assert(this._runningScene,cc._LogInfos.Director_popScene),this._scenesStack.pop();var t=this._scenesStack.length;0===t?this.end():(this._sendCleanupToScene=!0,this._nextScene=this._scenesStack[t-1])},purgeCachedData:function(){cc.animationCache._clear(),cc.spriteFrameCache._clear(),cc.textureCache._clear()},purgeDirector:function(){this.getScheduler().unscheduleAll(),cc.eventManager&&cc.eventManager.setEnabled(!1),this._runningScene&&(this._runningScene.onExitTransitionDidStart(),this._runningScene.onExit(),this._runningScene.cleanup()),this._runningScene=null,this._nextScene=null,this._scenesStack.length=0,this.stopAnimation(),this.purgeCachedData(),cc.checkGLErrorDebug()},pushScene:function(t){cc.assert(t,cc._LogInfos.Director_pushScene),this._sendCleanupToScene=!1,this._scenesStack.push(t),this._nextScene=t},runScene:function(t){if(cc.assert(t,cc._LogInfos.Director_pushScene),this._runningScene){var e=this._scenesStack.length;0===e?(this._sendCleanupToScene=!0,this._scenesStack[e]=t,this._nextScene=t):(this._sendCleanupToScene=!0,this._scenesStack[e-1]=t,this._nextScene=t)}else this.pushScene(t),this.startAnimation()},resume:function(){this._paused&&(this.setAnimationInterval(this._oldAnimationInterval),this._lastUpdate=Date.now(),this._lastUpdate||cc.log(cc._LogInfos.Director_resume),this._paused=!1,this._deltaTime=0)},setContentScaleFactor:function(t){t!==this._contentScaleFactor&&(this._contentScaleFactor=t)},setDepthTest:null,setClearColor:null,setDefaultValues:function(){},setNextDeltaTimeZero:function(t){this._nextDeltaTimeZero=t},setNextScene:function(){var t=!1,e=!1;if(cc.TransitionScene&&(t=!!this._runningScene&&this._runningScene instanceof cc.TransitionScene,e=!!this._nextScene&&this._nextScene instanceof cc.TransitionScene),!e){var i=this._runningScene;i&&(i.onExitTransitionDidStart(),i.onExit()),this._sendCleanupToScene&&i&&i.cleanup()}this._runningScene=this._nextScene,cc.renderer.childrenOrderDirty=!0,this._nextScene=null,t||null===this._runningScene||(this._runningScene.onEnter(),this._runningScene.onEnterTransitionDidFinish())},setNotificationNode:function(t){cc.renderer.childrenOrderDirty=!0,this._notificationNode&&(this._notificationNode.onExitTransitionDidStart(),this._notificationNode.onExit(),this._notificationNode.cleanup()),this._notificationNode=t,t&&(this._notificationNode.onEnter(),this._notificationNode.onEnterTransitionDidFinish())},getDelegate:function(){return this._projectionDelegate},setDelegate:function(t){this._projectionDelegate=t},setOpenGLView:null,setProjection:null,setViewport:null,getOpenGLView:null,getProjection:null,setAlphaBlending:null,isSendCleanupToScene:function(){return this._sendCleanupToScene},getRunningScene:function(){return this._runningScene},getAnimationInterval:function(){return this._animationInterval;
},isDisplayStats:function(){return!!cc.profiler&&cc.profiler.isShowingStats()},setDisplayStats:function(t){cc.profiler&&(t?cc.profiler.showStats():cc.profiler.hideStats())},getSecondsPerFrame:function(){return this._secondsPerFrame},isNextDeltaTimeZero:function(){return this._nextDeltaTimeZero},isPaused:function(){return this._paused},getTotalFrames:function(){return this._totalFrames},popToRootScene:function(){this.popToSceneStackLevel(1)},popToSceneStackLevel:function(t){cc.assert(this._runningScene,cc._LogInfos.Director_popToSceneStackLevel_2);var e=this._scenesStack,i=e.length;if(0===t)return void this.end();if(!(t>=i)){for(;i>t;){var n=e.pop();n.running&&(n.onExitTransitionDidStart(),n.onExit()),n.cleanup(),i--}this._nextScene=e[e.length-1],this._sendCleanupToScene=!0}},getScheduler:function(){return this._scheduler},setScheduler:function(t){this._scheduler!==t&&(this._scheduler=t)},getActionManager:function(){return this._actionManager},setActionManager:function(t){this._actionManager!==t&&(this._actionManager=t)},getDeltaTime:function(){return this._deltaTime},_calculateMPF:function(){var t=Date.now();this._secondsPerFrame=(t-this._lastUpdate)/1e3}}),cc.Director.EVENT_PROJECTION_CHANGED="director_projection_changed",cc.Director.EVENT_AFTER_UPDATE="director_after_update",cc.Director.EVENT_AFTER_VISIT="director_after_visit",cc.Director.EVENT_AFTER_DRAW="director_after_draw",cc.DisplayLinkDirector=cc.Director.extend({invalid:!1,startAnimation:function(){this._nextDeltaTimeZero=!0,this.invalid=!1},mainLoop:function(){this._purgeDirectorInNextLoop?(this._purgeDirectorInNextLoop=!1,this.purgeDirector()):this.invalid||this.drawScene()},stopAnimation:function(){this.invalid=!0},setAnimationInterval:function(t){this._animationInterval=t,this.invalid||(this.stopAnimation(),this.startAnimation())}}),cc.Director.sharedDirector=null,cc.Director.firstUseDirector=!0,cc.Director._getInstance=function(){return cc.Director.firstUseDirector&&(cc.Director.firstUseDirector=!1,cc.Director.sharedDirector=new cc.DisplayLinkDirector,cc.Director.sharedDirector.init()),cc.Director.sharedDirector},cc.defaultFPS=60,cc.Director.PROJECTION_2D=0,cc.Director.PROJECTION_3D=1,cc.Director.PROJECTION_CUSTOM=3,cc.Director.PROJECTION_DEFAULT=cc.Director.PROJECTION_2D,cc.game.addEventListener(cc.game.EVENT_RENDERER_INITED,function(){if(cc._renderType===cc.game.RENDER_TYPE_CANVAS){var t=cc.Director.prototype;t.getProjection=function(t){return this._projection},t.setProjection=function(t){this._projection=t,cc.eventManager.dispatchEvent(this._eventProjectionChanged)},t.setDepthTest=function(){},t.setClearColor=function(t){cc.renderer._clearColor=t,cc.renderer._clearFillStyle="rgb("+t.r+","+t.g+","+t.b+")"},t.setOpenGLView=function(t){this._winSizeInPoints.width=cc._canvas.width,this._winSizeInPoints.height=cc._canvas.height,this._openGLView=t||cc.view,cc.eventManager&&cc.eventManager.setEnabled(!0)},t.getVisibleSize=function(){return this.getWinSize()},t.getVisibleOrigin=function(){return cc.p(0,0)}}else cc.Director._fpsImage=new Image,cc.Director._fpsImage.addEventListener("load",function(){cc.Director._fpsImageLoaded=!0}),cc._fpsImage&&(cc.Director._fpsImage.src=cc._fpsImage)}),cc.PRIORITY_NON_SYSTEM=cc.PRIORITY_SYSTEM+1,cc.ListEntry=function(t,e,i,n,r,c,o){this.prev=t,this.next=e,this.callback=i,this.target=n,this.priority=r,this.paused=c,this.markedForDeletion=o},cc.HashUpdateEntry=function(t,e,i,n,r){this.list=t,this.entry=e,this.target=i,this.callback=n,this.hh=r},cc.HashTimerEntry=cc.hashSelectorEntry=function(t,e,i,n,r,c,o){var s=this;s.timers=t,s.target=e,s.timerIndex=i,s.currentTimer=n,s.currentTimerSalvaged=r,s.paused=c,s.hh=o},cc.Timer=cc.Class.extend({_scheduler:null,_elapsed:0,_runForever:!1,_useDelay:!1,_timesExecuted:0,_repeat:0,_delay:0,_interval:0,getInterval:function(){return this._interval},setInterval:function(t){this._interval=t},setupTimerWithInterval:function(t,e,i){this._elapsed=-1,this._interval=t,this._delay=i,this._useDelay=this._delay>0,this._repeat=e,this._runForever=this._repeat===cc.REPEAT_FOREVER},trigger:function(){return 0},cancel:function(){return 0},ctor:function(){this._scheduler=null,this._elapsed=-1,this._runForever=!1,this._useDelay=!1,this._timesExecuted=0,this._repeat=0,this._delay=0,this._interval=0},update:function(t){this._elapsed===-1?(this._elapsed=0,this._timesExecuted=0):(this._elapsed+=t,this._runForever&&!this._useDelay?this._elapsed>=this._interval&&(this.trigger(),this._elapsed=0):(this._useDelay?this._elapsed>=this._delay&&(this.trigger(),this._elapsed-=this._delay,this._timesExecuted+=1,this._useDelay=!1):this._elapsed>=this._interval&&(this.trigger(),this._elapsed=0,this._timesExecuted+=1),!this._runForever&&this._timesExecuted>this._repeat&&this.cancel()))}}),cc.TimerTargetSelector=cc.Timer.extend({_target:null,_selector:null,ctor:function(){this._target=null,this._selector=null},initWithSelector:function(t,e,i,n,r,c){return this._scheduler=t,this._target=i,this._selector=e,this.setupTimerWithInterval(n,r,c),!0},getSelector:function(){return this._selector},trigger:function(){this._target&&this._selector&&this._target.call(this._selector,this._elapsed)},cancel:function(){this._scheduler.unschedule(this._selector,this._target)}}),cc.TimerTargetCallback=cc.Timer.extend({_target:null,_callback:null,_key:null,ctor:function(){this._target=null,this._callback=null},initWithCallback:function(t,e,i,n,r,c,o){return this._scheduler=t,this._target=i,this._callback=e,this._key=n,this.setupTimerWithInterval(r,c,o),!0},getCallback:function(){return this._callback},getKey:function(){return this._key},trigger:function(){this._callback&&this._callback.call(this._target,this._elapsed)},cancel:function(){this._scheduler.unschedule(this._callback,this._target)}}),cc.Scheduler=cc.Class.extend({_timeScale:1,_updatesNegList:null,_updates0List:null,_updatesPosList:null,_hashForTimers:null,_arrayForTimers:null,_hashForUpdates:null,_currentTarget:null,_currentTargetSalvaged:!1,_updateHashLocked:!1,ctor:function(){this._timeScale=1,this._updatesNegList=[],this._updates0List=[],this._updatesPosList=[],this._hashForUpdates={},this._hashForTimers={},this._currentTarget=null,this._currentTargetSalvaged=!1,this._updateHashLocked=!1,this._arrayForTimers=[]},_schedulePerFrame:function(t,e,i,n){var r=this._hashForUpdates[e.__instanceId];if(r&&r.entry){if(r.entry.priority===i)return r.entry.markedForDeletion=!1,void(r.entry.paused=n);if(this._updateHashLocked)return cc.log("warning: you CANNOT change update priority in scheduled function"),r.entry.markedForDeletion=!1,void(r.entry.paused=n);this.unscheduleUpdate(e)}0===i?this._appendIn(this._updates0List,t,e,n):i<0?this._priorityIn(this._updatesNegList,t,e,i,n):this._priorityIn(this._updatesPosList,t,e,i,n)},_removeHashElement:function(t){delete this._hashForTimers[t.target.__instanceId],cc.arrayRemoveObject(this._arrayForTimers,t),t.Timer=null,t.target=null,t=null},_removeUpdateFromHash:function(t){var e=this,i=e._hashForUpdates[t.target.__instanceId];i&&(cc.arrayRemoveObject(i.list,i.entry),delete e._hashForUpdates[i.target.__instanceId],i.entry=null,i.target=null)},_priorityIn:function(t,e,i,n,r){var c=this,o=new cc.ListEntry(null,null,e,i,n,r,!1);if(t){for(var s=t.length-1,a=0;a<=s;a++)if(n<t[a].priority){s=a;break}t.splice(a,0,o)}else t=[],t.push(o);return c._hashForUpdates[i.__instanceId]=new cc.HashUpdateEntry(t,o,i,null),t},_appendIn:function(t,e,i,n){var r=this,c=new cc.ListEntry(null,null,e,i,0,n,!1);t.push(c),r._hashForUpdates[i.__instanceId]=new cc.HashUpdateEntry(t,c,i,null,null)},setTimeScale:function(t){this._timeScale=t},getTimeScale:function(){return this._timeScale},update:function(t){this._updateHashLocked=!0,1!==this._timeScale&&(t*=this._timeScale);var e,i,n,r;for(e=0,i=this._updatesNegList,n=i.length;e<n;e++)r=i[e],r.paused||r.markedForDeletion||r.callback(t);for(e=0,i=this._updates0List,n=i.length;e<n;e++)r=i[e],r.paused||r.markedForDeletion||r.callback(t);for(e=0,i=this._updatesPosList,n=i.length;e<n;e++)r=i[e],r.paused||r.markedForDeletion||r.callback(t);var c,o=this._arrayForTimers;for(e=0;e<o.length;e++){if(c=o[e],this._currentTarget=c,this._currentTargetSalvaged=!1,!c.paused)for(c.timerIndex=0;c.timerIndex<c.timers.length;++c.timerIndex)c.currentTimer=c.timers[c.timerIndex],c.currentTimerSalvaged=!1,c.currentTimer.update(t),c.currentTimer=null;this._currentTargetSalvaged&&0===this._currentTarget.timers.length&&this._removeHashElement(this._currentTarget)}for(e=0,i=this._updatesNegList;e<i.length;)r=i[e],r.markedForDeletion?this._removeUpdateFromHash(r):e++;for(e=0,i=this._updates0List;e<i.length;)r=i[e],r.markedForDeletion?this._removeUpdateFromHash(r):e++;for(e=0,i=this._updatesPosList;e<i.length;)r=i[e],r.markedForDeletion?this._removeUpdateFromHash(r):e++;this._updateHashLocked=!1,this._currentTarget=null},scheduleCallbackForTarget:function(t,e,i,n,r,c){this.schedule(e,t,i,n,r,c,t.__instanceId+"")},schedule:function(t,e,i,n,r,c,o){var s=!1;if("function"!=typeof t){var a=t;s=!0}s===!1?4!==arguments.length&&5!==arguments.length||(o=r,c=n,r=0,n=cc.REPEAT_FOREVER):4===arguments.length&&(c=n,n=cc.REPEAT_FOREVER,r=0),void 0===o&&(o=e.__instanceId+""),cc.assert(e,cc._LogInfos.Scheduler_scheduleCallbackForTarget_3);var h=this._hashForTimers[e.__instanceId];h?cc.assert(h.paused===c,""):(h=new cc.HashTimerEntry(null,e,0,null,null,c,null),this._arrayForTimers.push(h),this._hashForTimers[e.__instanceId]=h);var l,u;if(null==h.timers)h.timers=[];else if(s===!1){for(u=0;u<h.timers.length;u++)if(l=h.timers[u],t===l._callback)return cc.log(cc._LogInfos.Scheduler_scheduleCallbackForTarget,l.getInterval().toFixed(4),i.toFixed(4)),void(l._interval=i)}else for(u=0;u<h.timers.length;++u)if(l=h.timers[u],l&&a===l.getSelector())return cc.log("CCScheduler#scheduleSelector. Selector already scheduled. Updating interval from: %.4f to %.4f",l.getInterval(),i),void l.setInterval(i);s===!1?(l=new cc.TimerTargetCallback,l.initWithCallback(this,t,e,o,i,n,r),h.timers.push(l)):(l=new cc.TimerTargetSelector,l.initWithSelector(this,a,e,i,n,r),h.timers.push(l))},scheduleUpdate:function(t,e,i){this._schedulePerFrame(function(e){t.update(e)},t,e,i)},_getUnscheduleMark:function(t,e){switch(typeof t){case"number":case"string":return t===e.getKey();case"function":return t===e._callback;default:return t===e.getSelector()}},unschedule:function(t,e){if(e&&t){var i=this,n=i._hashForTimers[e.__instanceId];if(n)for(var r=n.timers,c=0,o=r.length;c<o;c++){var s=r[c];if(this._getUnscheduleMark(t,s))return s!==n.currentTimer||n.currentTimerSalvaged||(n.currentTimerSalvaged=!0),r.splice(c,1),n.timerIndex>=c&&n.timerIndex--,void(0===r.length&&(i._currentTarget===n?i._currentTargetSalvaged=!0:i._removeHashElement(n)))}}},unscheduleUpdate:function(t){if(null!=t){var e=this._hashForUpdates[t.__instanceId];e&&(this._updateHashLocked?e.entry.markedForDeletion=!0:this._removeUpdateFromHash(e.entry))}},unscheduleAllForTarget:function(t){if(null!=t){var e=this._hashForTimers[t.__instanceId];e&&(e.timers.indexOf(e.currentTimer)>-1&&!e.currentTimerSalvaged&&(e.currentTimerSalvaged=!0),e.timers.length=0,this._currentTarget===e?this._currentTargetSalvaged=!0:this._removeHashElement(e)),this.unscheduleUpdate(t)}},unscheduleAll:function(){this.unscheduleAllWithMinPriority(cc.Scheduler.PRIORITY_SYSTEM)},unscheduleAllWithMinPriority:function(t){var e,i,n=this._arrayForTimers;for(e=n.length-1;e>=0;e--)i=n[e],this.unscheduleAllForTarget(i.target);var r,c=0;if(t<0)for(e=0;e<this._updatesNegList.length;)c=this._updatesNegList.length,r=this._updatesNegList[e],r&&r.priority>=t&&this.unscheduleUpdate(r.target),c==this._updatesNegList.length&&e++;if(t<=0)for(e=0;e<this._updates0List.length;)c=this._updates0List.length,r=this._updates0List[e],r&&this.unscheduleUpdate(r.target),c==this._updates0List.length&&e++;for(e=0;e<this._updatesPosList.length;)c=this._updatesPosList.length,r=this._updatesPosList[e],r&&r.priority>=t&&this.unscheduleUpdate(r.target),c==this._updatesPosList.length&&e++},isScheduled:function(t,e){cc.assert(t,"Argument key must not be empty"),cc.assert(e,"Argument target must be non-nullptr");var i=this._hashForUpdates[e.__instanceId];if(!i)return!1;if(null==i.timers)return!1;for(var n=i.timers,r=0;r<n.length;++r){var c=n[r];if(t===c.getKey())return!0}return!1},pauseAllTargets:function(){return this.pauseAllTargetsWithMinPriority(cc.Scheduler.PRIORITY_SYSTEM)},pauseAllTargetsWithMinPriority:function(t){var e,i,n,r=[],c=this,o=c._arrayForTimers;for(i=0,n=o.length;i<n;i++)e=o[i],e&&(e.paused=!0,r.push(e.target));var s;if(t<0)for(i=0;i<this._updatesNegList.length;i++)s=this._updatesNegList[i],s&&s.priority>=t&&(s.paused=!0,r.push(s.target));if(t<=0)for(i=0;i<this._updates0List.length;i++)s=this._updates0List[i],s&&(s.paused=!0,r.push(s.target));for(i=0;i<this._updatesPosList.length;i++)s=this._updatesPosList[i],s&&s.priority>=t&&(s.paused=!0,r.push(s.target));return r},resumeTargets:function(t){if(t)for(var e=0;e<t.length;e++)this.resumeTarget(t[e])},pauseTarget:function(t){cc.assert(t,cc._LogInfos.Scheduler_pauseTarget);var e=this,i=e._hashForTimers[t.__instanceId];i&&(i.paused=!0);var n=e._hashForUpdates[t.__instanceId];n&&(n.entry.paused=!0)},resumeTarget:function(t){cc.assert(t,cc._LogInfos.Scheduler_resumeTarget);var e=this,i=e._hashForTimers[t.__instanceId];i&&(i.paused=!1);var n=e._hashForUpdates[t.__instanceId];n&&(n.entry.paused=!1)},isTargetPaused:function(t){cc.assert(t,cc._LogInfos.Scheduler_isTargetPaused);var e=this._hashForTimers[t.__instanceId];if(e)return e.paused;var i=this._hashForUpdates[t.__instanceId];return!!i&&i.entry.paused},scheduleUpdateForTarget:function(t,e,i){this.scheduleUpdate(t,e,i)},unscheduleCallbackForTarget:function(t,e){this.unschedule(e,t)},unscheduleUpdateForTarget:function(t){this.unscheduleUpdate(t)},unscheduleAllCallbacksForTarget:function(t){this.unschedule(t.__instanceId+"",t)},unscheduleAllCallbacks:function(){this.unscheduleAllWithMinPriority(cc.Scheduler.PRIORITY_SYSTEM)},unscheduleAllCallbacksWithMinPriority:function(t){this.unscheduleAllWithMinPriority(t)}}),cc.Scheduler.PRIORITY_SYSTEM=-2147483648,cc._tmp.PrototypeLabelTTF=function(){var t=cc.LabelTTF.prototype;cc.defineGetterSetter(t,"color",t.getColor,t.setColor),cc.defineGetterSetter(t,"opacity",t.getOpacity,t.setOpacity),t.string,cc.defineGetterSetter(t,"string",t.getString,t.setString),t.textAlign,cc.defineGetterSetter(t,"textAlign",t.getHorizontalAlignment,t.setHorizontalAlignment),t.verticalAlign,cc.defineGetterSetter(t,"verticalAlign",t.getVerticalAlignment,t.setVerticalAlignment),t.fontSize,cc.defineGetterSetter(t,"fontSize",t.getFontSize,t.setFontSize),t.fontName,cc.defineGetterSetter(t,"fontName",t.getFontName,t.setFontName),t.font,cc.defineGetterSetter(t,"font",t._getFont,t._setFont),t.boundingSize,t.boundingWidth,cc.defineGetterSetter(t,"boundingWidth",t._getBoundingWidth,t._setBoundingWidth),t.boundingHeight,cc.defineGetterSetter(t,"boundingHeight",t._getBoundingHeight,t._setBoundingHeight),t.fillStyle,cc.defineGetterSetter(t,"fillStyle",t._getFillStyle,t.setFontFillColor),t.strokeStyle,cc.defineGetterSetter(t,"strokeStyle",t._getStrokeStyle,t._setStrokeStyle),t.lineWidth,cc.defineGetterSetter(t,"lineWidth",t._getLineWidth,t._setLineWidth),t.shadowOffset,t.shadowOffsetX,cc.defineGetterSetter(t,"shadowOffsetX",t._getShadowOffsetX,t._setShadowOffsetX),t.shadowOffsetY,cc.defineGetterSetter(t,"shadowOffsetY",t._getShadowOffsetY,t._setShadowOffsetY),t.shadowOpacity,cc.defineGetterSetter(t,"shadowOpacity",t._getShadowOpacity,t._setShadowOpacity),t.shadowBlur,cc.defineGetterSetter(t,"shadowBlur",t._getShadowBlur,t._setShadowBlur)},cc.LabelTTF=cc.Sprite.extend({_dimensions:null,_hAlignment:cc.TEXT_ALIGNMENT_CENTER,_vAlignment:cc.VERTICAL_TEXT_ALIGNMENT_TOP,_fontName:null,_fontSize:0,_string:"",_originalText:null,_onCacheCanvasMode:!0,_shadowEnabled:!1,_shadowOffset:null,_shadowOpacity:0,_shadowBlur:0,_shadowColor:null,_strokeEnabled:!1,_strokeColor:null,_strokeSize:0,_textFillColor:null,_strokeShadowOffsetX:0,_strokeShadowOffsetY:0,_needUpdateTexture:!1,_lineWidths:null,_className:"LabelTTF",_fontStyle:"normal",_fontWeight:"normal",_lineHeight:"normal",initWithString:function(t,e,i,n,r,c){var o;return o=t?t+"":"",i=i||16,n=n||cc.size(0,0),r=r||cc.TEXT_ALIGNMENT_LEFT,c=c||cc.VERTICAL_TEXT_ALIGNMENT_TOP,this._opacityModifyRGB=!1,this._dimensions=cc.size(n.width,n.height),this._fontName=e||"Arial",this._hAlignment=r,this._vAlignment=c,this._fontSize=i,this._renderCmd._setFontStyle(this._fontName,i,this._fontStyle,this._fontWeight),this.string=o,this._renderCmd._setColorsString(),this._renderCmd._updateTexture(),this._setUpdateTextureDirty(),this._scaleX=this._scaleY=1/cc.view.getDevicePixelRatio(),!0},_setUpdateTextureDirty:function(){this._needUpdateTexture=!0,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.textDirty)},ctor:function(t,e,i,n,r,c){cc.Sprite.prototype.ctor.call(this),this._dimensions=cc.size(0,0),this._hAlignment=cc.TEXT_ALIGNMENT_LEFT,this._vAlignment=cc.VERTICAL_TEXT_ALIGNMENT_TOP,this._opacityModifyRGB=!1,this._fontName="Arial",this._shadowEnabled=!1,this._shadowOffset=cc.p(0,0),this._shadowOpacity=0,this._shadowBlur=0,this._strokeEnabled=!1,this._strokeColor=cc.color(255,255,255,255),this._strokeSize=0,this._textFillColor=cc.color(255,255,255,255),this._strokeShadowOffsetX=0,this._strokeShadowOffsetY=0,this._needUpdateTexture=!1,this._lineWidths=[],this._renderCmd._setColorsString(),this._textureLoaded=!0,e&&e instanceof cc.FontDefinition?this.initWithStringAndTextDefinition(t,e):cc.LabelTTF.prototype.initWithString.call(this,t,e,i,n,r,c)},init:function(){return this.initWithString(" ",this._fontName,this._fontSize)},description:function(){return"<cc.LabelTTF | FontName ="+this._fontName+" FontSize = "+this._fontSize.toFixed(1)+">"},getLineHeight:function(){return!this._lineHeight||this._lineHeight.charAt?this._renderCmd._getFontClientHeight():this._lineHeight||this._renderCmd._getFontClientHeight()},setLineHeight:function(t){this._lineHeight=t},getString:function(){return this._string},getHorizontalAlignment:function(){return this._hAlignment},getVerticalAlignment:function(){return this._vAlignment},getDimensions:function(){return cc.size(this._dimensions)},getFontSize:function(){return this._fontSize},getFontName:function(){return this._fontName},initWithStringAndTextDefinition:function(t,e){return this._updateWithTextDefinition(e,!1),this.string=t,!0},setTextDefinition:function(t){t&&this._updateWithTextDefinition(t,!0)},getTextDefinition:function(){return this._prepareTextDefinition(!1)},enableShadow:function(t,e,i,n){null!=t.r&&null!=t.g&&null!=t.b&&null!=t.a?this._enableShadow(t,e,i):this._enableShadowNoneColor(t,e,i,n)},_enableShadowNoneColor:function(t,e,i,n){i=i||.5,!1===this._shadowEnabled&&(this._shadowEnabled=!0);var r=this._shadowOffset;(r&&r.x!==t||r._y!==e)&&(r.x=t,r.y=e),this._shadowOpacity!==i&&(this._shadowOpacity=i),this._renderCmd._setColorsString(),this._shadowBlur!==n&&(this._shadowBlur=n),this._setUpdateTextureDirty()},_enableShadow:function(t,e,i){this._shadowColor||(this._shadowColor=cc.color(255,255,255,128)),this._shadowColor.r=t.r,this._shadowColor.g=t.g,this._shadowColor.b=t.b;var n,r,c,o;n=e.width||e.x||0,r=e.height||e.y||0,c=null!=t.a?t.a/255:.5,o=i,this._enableShadowNoneColor(n,r,c,o)},_getShadowOffsetX:function(){return this._shadowOffset.x},_setShadowOffsetX:function(t){!1===this._shadowEnabled&&(this._shadowEnabled=!0),this._shadowOffset.x!==t&&(this._shadowOffset.x=t,this._setUpdateTextureDirty())},_getShadowOffsetY:function(){return this._shadowOffset._y},_setShadowOffsetY:function(t){!1===this._shadowEnabled&&(this._shadowEnabled=!0),this._shadowOffset._y!==t&&(this._shadowOffset._y=t,this._setUpdateTextureDirty())},_getShadowOffset:function(){return cc.p(this._shadowOffset.x,this._shadowOffset.y)},_setShadowOffset:function(t){!1===this._shadowEnabled&&(this._shadowEnabled=!0),this._shadowOffset.x===t.x&&this._shadowOffset.y===t.y||(this._shadowOffset.x=t.x,this._shadowOffset.y=t.y,this._setUpdateTextureDirty())},_getShadowOpacity:function(){return this._shadowOpacity},_setShadowOpacity:function(t){!1===this._shadowEnabled&&(this._shadowEnabled=!0),this._shadowOpacity!==t&&(this._shadowOpacity=t,this._renderCmd._setColorsString(),this._setUpdateTextureDirty())},_getShadowBlur:function(){return this._shadowBlur},_setShadowBlur:function(t){!1===this._shadowEnabled&&(this._shadowEnabled=!0),this._shadowBlur!==t&&(this._shadowBlur=t,this._setUpdateTextureDirty())},disableShadow:function(){this._shadowEnabled&&(this._shadowEnabled=!1,this._setUpdateTextureDirty())},enableStroke:function(t,e){this._strokeEnabled===!1&&(this._strokeEnabled=!0);var i=this._strokeColor;i.r===t.r&&i.g===t.g&&i.b===t.b||(i.r=t.r,i.g=t.g,i.b=t.b,this._renderCmd._setColorsString()),this._strokeSize!==e&&(this._strokeSize=e||0),this._setUpdateTextureDirty()},_getStrokeStyle:function(){return this._strokeColor},_setStrokeStyle:function(t){this._strokeEnabled===!1&&(this._strokeEnabled=!0);var e=this._strokeColor;e.r===t.r&&e.g===t.g&&e.b===t.b||(e.r=t.r,e.g=t.g,e.b=t.b,this._renderCmd._setColorsString(),this._setUpdateTextureDirty())},_getLineWidth:function(){return this._strokeSize},_setLineWidth:function(t){this._strokeEnabled===!1&&(this._strokeEnabled=!0),this._strokeSize!==t&&(this._strokeSize=t||0,this._setUpdateTextureDirty())},disableStroke:function(){this._strokeEnabled&&(this._strokeEnabled=!1,this._setUpdateTextureDirty())},setFontFillColor:function(t){var e=this._textFillColor;e.r===t.r&&e.g===t.g&&e.b===t.b||(e.r=t.r,e.g=t.g,e.b=t.b,this._renderCmd._setColorsString(),this._needUpdateTexture=!0)},_getFillStyle:function(){return this._textFillColor},_updateWithTextDefinition:function(t,e){t.fontDimensions?(this._dimensions.width=t.boundingWidth,this._dimensions.height=t.boundingHeight):(this._dimensions.width=0,this._dimensions.height=0),this._hAlignment=t.textAlign,this._vAlignment=t.verticalAlign,this._fontName=t.fontName,this._fontSize=t.fontSize||12,t.lineHeight?this._lineHeight=t.lineHeight:this._lineHeight=this._fontSize,this._renderCmd._setFontStyle(t),t.shadowEnabled&&this.enableShadow(t.shadowOffsetX,t.shadowOffsetY,t.shadowOpacity,t.shadowBlur),t.strokeEnabled&&this.enableStroke(t.strokeStyle,t.lineWidth),this.setFontFillColor(t.fillStyle),e&&this._renderCmd._updateTexture();var i=cc.Node._dirtyFlags;this._renderCmd.setDirtyFlag(i.colorDirty|i.opacityDirty|i.textDirty)},_prepareTextDefinition:function(t){var e=new cc.FontDefinition;if(t?(e.fontSize=this._fontSize,e.boundingWidth=cc.contentScaleFactor()*this._dimensions.width,e.boundingHeight=cc.contentScaleFactor()*this._dimensions.height):(e.fontSize=this._fontSize,e.boundingWidth=this._dimensions.width,e.boundingHeight=this._dimensions.height),e.fontName=this._fontName,e.textAlign=this._hAlignment,e.verticalAlign=this._vAlignment,this._strokeEnabled){e.strokeEnabled=!0;var i=this._strokeColor;e.strokeStyle=cc.color(i.r,i.g,i.b),e.lineWidth=this._strokeSize}else e.strokeEnabled=!1;this._shadowEnabled?(e.shadowEnabled=!0,e.shadowBlur=this._shadowBlur,e.shadowOpacity=this._shadowOpacity,e.shadowOffsetX=(t?cc.contentScaleFactor():1)*this._shadowOffset.x,e.shadowOffsetY=(t?cc.contentScaleFactor():1)*this._shadowOffset.y):e._shadowEnabled=!1;var n=this._textFillColor;return e.fillStyle=cc.color(n.r,n.g,n.b),e},getScale:function(){return this._scaleX!==this._scaleY&&cc.log(cc._LogInfos.Node_getScale),this._scaleX*cc.view.getDevicePixelRatio()},setScale:function(t,e){this._scaleX=t/cc.view.getDevicePixelRatio(),this._scaleY=(e||0===e?e:t)/cc.view.getDevicePixelRatio(),this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},getScaleX:function(){return this._scaleX*cc.view.getDevicePixelRatio()},setScaleX:function(t){this._scaleX=t/cc.view.getDevicePixelRatio(),this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},getScaleY:function(){return this._scaleY*cc.view.getDevicePixelRatio()},setScaleY:function(t){this._scaleY=t/cc.view.getDevicePixelRatio(),this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},setString:function(t){t=String(t),this._originalText!==t&&(this._originalText=t+"",this._updateString(),this._setUpdateTextureDirty(),this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty))},_updateString:function(){this._string&&""!==this._string||this._string===this._originalText||(cc.renderer.childrenOrderDirty=!0),this._string=this._originalText},setHorizontalAlignment:function(t){t!==this._hAlignment&&(this._hAlignment=t,this._setUpdateTextureDirty())},setVerticalAlignment:function(t){t!==this._vAlignment&&(this._vAlignment=t,this._setUpdateTextureDirty())},setDimensions:function(t,e){var i;void 0===e?(i=t.width,e=t.height):i=t,i===this._dimensions.width&&e===this._dimensions.height||(this._dimensions.width=i,this._dimensions.height=e,this._updateString(),this._setUpdateTextureDirty())},_getBoundingWidth:function(){return this._dimensions.width},_setBoundingWidth:function(t){t!==this._dimensions.width&&(this._dimensions.width=t,this._updateString(),this._setUpdateTextureDirty())},_getBoundingHeight:function(){return this._dimensions.height},_setBoundingHeight:function(t){t!==this._dimensions.height&&(this._dimensions.height=t,this._updateString(),this._setUpdateTextureDirty())},setFontSize:function(t){this._fontSize!==t&&(this._fontSize=t,this._renderCmd._setFontStyle(this._fontName,this._fontSize,this._fontStyle,this._fontWeight),this._setUpdateTextureDirty())},setFontName:function(t){this._fontName&&this._fontName!==t&&(this._fontName=t,this._renderCmd._setFontStyle(this._fontName,this._fontSize,this._fontStyle,this._fontWeight),this._setUpdateTextureDirty())},_getFont:function(){return this._renderCmd._getFontStyle()},_setFont:function(t){var e=cc.LabelTTF._fontStyleRE.exec(t);e&&(this._fontSize=parseInt(e[1]),this._fontName=e[2],this._renderCmd._setFontStyle(this._fontName,this._fontSize,this._fontStyle,this._fontWeight),this._setUpdateTextureDirty())},getContentSize:function(){return this._needUpdateTexture&&this._renderCmd._updateTTF(),cc.size(this._contentSize)},_getWidth:function(){return this._needUpdateTexture&&this._renderCmd._updateTTF(),this._contentSize.width},_getHeight:function(){return this._needUpdateTexture&&this._renderCmd._updateTTF(),this._contentSize.height},setTextureRect:function(t,e,i){cc.Sprite.prototype.setTextureRect.call(this,t,e,i,!1)},setDrawMode:function(t){this._onCacheCanvasMode=t},_createRenderCmd:function(){return cc._renderType===cc.game.RENDER_TYPE_WEBGL?new cc.LabelTTF.WebGLRenderCmd(this):this._onCacheCanvasMode?new cc.LabelTTF.CacheCanvasRenderCmd(this):new cc.LabelTTF.CanvasRenderCmd(this)},_setFontStyle:function(t){this._fontStyle!==t&&(this._fontStyle=t,this._renderCmd._setFontStyle(this._fontName,this._fontSize,this._fontStyle,this._fontWeight),this._setUpdateTextureDirty())},_getFontStyle:function(){return this._fontStyle},_setFontWeight:function(t){this._fontWeight!==t&&(this._fontWeight=t,this._renderCmd._setFontStyle(this._fontName,this._fontSize,this._fontStyle,this._fontWeight),this._setUpdateTextureDirty())},_getFontWeight:function(){return this._fontWeight}}),cc.assert(cc.isFunction(cc._tmp.PrototypeLabelTTF),cc._LogInfos.MissingFile,"LabelTTFPropertyDefine.js"),cc._tmp.PrototypeLabelTTF(),delete cc._tmp.PrototypeLabelTTF,cc.LabelTTF._fontStyleRE=/^(\d+)px\s+['"]?([\w\s\d]+)['"]?$/,cc.LabelTTF.create=function(t,e,i,n,r,c){return new cc.LabelTTF(t,e,i,n,r,c)},cc.LabelTTF.createWithFontDefinition=cc.LabelTTF.create,cc.LabelTTF.__labelHeightDiv=document.createElement("div"),cc.LabelTTF.__labelHeightDiv.style.fontFamily="Arial",cc.LabelTTF.__labelHeightDiv.style.position="absolute",cc.LabelTTF.__labelHeightDiv.style.left="-100px",cc.LabelTTF.__labelHeightDiv.style.top="-100px",cc.LabelTTF.__labelHeightDiv.style.lineHeight="normal",document.body?document.body.appendChild(cc.LabelTTF.__labelHeightDiv):window.addEventListener("load",function(){this.removeEventListener("load",arguments.callee,!1),document.body.appendChild(cc.LabelTTF.__labelHeightDiv)},!1),cc.LabelTTF.__getFontHeightByDiv=function(t,e){var i,n=cc.LabelTTF.__labelHeightDiv;if(t instanceof cc.FontDefinition){var r=t;if(i=cc.LabelTTF.__fontHeightCache[r._getCanvasFontStr()],i>0)return i;n.innerHTML="ajghl~!",n.style.fontFamily=r.fontName,n.style.fontSize=r.fontSize+"px",n.style.fontStyle=r.fontStyle,n.style.fontWeight=r.fontWeight,i=n.clientHeight,cc.LabelTTF.__fontHeightCache[r._getCanvasFontStr()]=i,n.innerHTML=""}else{if(i=cc.LabelTTF.__fontHeightCache[t+"."+e],i>0)return i;n.innerHTML="ajghl~!",n.style.fontFamily=t,n.style.fontSize=e+"px",i=n.clientHeight,cc.LabelTTF.__fontHeightCache[t+"."+e]=i,n.innerHTML=""}return i},cc.LabelTTF.__fontHeightCache={},cc.LabelTTF._textAlign=["left","center","right"],cc.LabelTTF._textBaseline=["top","middle","bottom"],cc.LabelTTF.wrapInspection=!0,cc.LabelTTF._wordRex=/([a-zA-Z0-9]+|\S)/,cc.LabelTTF._symbolRex=/^[!,.:;}\]%\?>]/,cc.LabelTTF._lastWordRex=/([a-zA-Z0-9]+|\S)$/,cc.LabelTTF._lastEnglish=/[a-zA-Z0-9]+$/,cc.LabelTTF._firsrEnglish=/^[a-zA-Z0-9]/,function(){cc.LabelTTF.RenderCmd=function(){this._fontClientHeight=18,this._fontStyleStr="",this._shadowColorStr="rgba(128, 128, 128, 0.5)",this._strokeColorStr="",this._fillColorStr="rgba(255,255,255,1)",this._labelCanvas=null,this._labelContext=null,this._lineWidths=[],this._strings=[],this._isMultiLine=!1,this._status=[],this._renderingIndex=0,this._texRect=cc.rect(),this._canUseDirtyRegion=!0};var t=cc.LabelTTF.RenderCmd.prototype;t.constructor=cc.LabelTTF.RenderCmd,t._setFontStyle=function(t,e,i,n){if(t instanceof cc.FontDefinition)this._fontStyleStr=t._getCanvasFontStr(),this._fontClientHeight=cc.LabelTTF.__getFontHeightByDiv(t);else{var r=e*cc.view.getDevicePixelRatio();this._fontStyleStr=i+" "+n+" "+r+"px '"+t+"'",this._fontClientHeight=cc.LabelTTF.__getFontHeightByDiv(t,e)}},t._getFontStyle=function(){return this._fontStyleStr},t._getFontClientHeight=function(){return this._fontClientHeight},t._updateColor=function(){this._setColorsString(),this._updateTexture()},t._setColorsString=function(){var t=this._displayedColor,e=this._node,i=e._shadowColor||this._displayedColor,n=e._strokeColor,r=e._textFillColor,c=t.r/255,o=t.g/255,s=t.b/255;this._shadowColorStr="rgba("+(0|c*i.r)+","+(0|o*i.g)+","+(0|s*i.b)+","+e._shadowOpacity+")",this._fillColorStr="rgba("+(0|c*r.r)+","+(0|o*r.g)+","+(0|s*r.b)+", 1)",this._strokeColorStr="rgba("+(0|c*n.r)+","+(0|o*n.g)+","+(0|s*n.b)+", 1)"};var e=new cc.Rect;t.getLocalBB=function(){var t=this._node;e.x=e.y=0;var i=cc.view.getDevicePixelRatio();return e.width=t._getWidth()*i,e.height=t._getHeight()*i,e},t._updateTTF=function(){var t,e,i=this._node,n=cc.view.getDevicePixelRatio(),r=i._dimensions.width*n,c=this._lineWidths;if(c.length=0,this._isMultiLine=!1,this._measureConfig(),0!==r)for(this._strings=i._string.split("\n"),t=0;t<this._strings.length;t++)this._checkWarp(this._strings,t,r);else for(this._strings=i._string.split("\n"),t=0,e=this._strings.length;t<e;t++)c.push(this._measure(this._strings[t]));this._strings.length>1&&(this._isMultiLine=!0);var o,s=0,a=0;if(i._strokeEnabled&&(s=a=2*i._strokeSize),i._shadowEnabled){var h=i._shadowOffset;s+=2*Math.abs(h.x),a+=2*Math.abs(h.y)}o=0===r?this._isMultiLine?cc.size(Math.ceil(Math.max.apply(Math,c)+s),Math.ceil(this._fontClientHeight*n*this._strings.length+a)):cc.size(Math.ceil(this._measure(i._string)+s),Math.ceil(this._fontClientHeight*n+a)):0===i._dimensions.height?this._isMultiLine?cc.size(Math.ceil(r+s),Math.ceil(i.getLineHeight()*n*this._strings.length+a)):cc.size(Math.ceil(r+s),Math.ceil(i.getLineHeight()*n+a)):cc.size(Math.ceil(r+s),Math.ceil(i._dimensions.height*n+a)),"normal"!==i._getFontStyle()&&(o.width=Math.ceil(o.width+.3*i._fontSize)),0===this._strings.length?(this._texRect.width=1,this._texRect.height=o.height||1):(this._texRect.width=o.width,this._texRect.height=o.height);
var l=o.width/n,u=o.height/n;i.setContentSize(l,u),i._strokeShadowOffsetX=s,i._strokeShadowOffsetY=a;var _=i._anchorPoint;this._anchorPointInPoints.x=.5*s+(o.width-s)*_.x,this._anchorPointInPoints.y=.5*a+(o.height-a)*_.y},t._saveStatus=function(){var t=this._node,e=cc.view.getDevicePixelRatio(),i=t._strokeShadowOffsetX,n=t._strokeShadowOffsetY,r=t._contentSize.height*e-n,c=t._vAlignment,o=t._hAlignment,s=.5*i,a=r+.5*n,h=0,l=0,u=[],_=t._contentSize.width*e-i,d=t.getLineHeight()*e,f=(d-this._fontClientHeight*e)/2;if(h+=o===cc.TEXT_ALIGNMENT_RIGHT?_:o===cc.TEXT_ALIGNMENT_CENTER?_/2:0,this._isMultiLine){var p=this._strings.length;c===cc.VERTICAL_TEXT_ALIGNMENT_BOTTOM?l=d-2*f+r-d*p:c===cc.VERTICAL_TEXT_ALIGNMENT_CENTER&&(l=(d-2*f)/2+(r-d*p)/2);for(var g=0;g<p;g++){var m=-r+(d*g+f)+l;u.push(m)}}else c===cc.VERTICAL_TEXT_ALIGNMENT_BOTTOM||(l-=c===cc.VERTICAL_TEXT_ALIGNMENT_TOP?r:.5*r),u.push(l);var v={contextTransform:cc.p(s,a),xOffset:h,OffsetYArray:u};this._status.push(v)},t._drawTTFInCanvas=function(t){if(t){var e=this._status.pop();t.setTransform(1,0,0,1,e.contextTransform.x,e.contextTransform.y);var i=e.xOffset,n=e.OffsetYArray;this.drawLabels(t,i,n)}},t._checkWarp=function(t,e,i){var n=t[e],r=this._measure(n);if(r>i&&n.length>1){for(var c,o=n.length*(i/r)|0,s=n.substr(o),a=r-this._measure(s),h=0,l=0;a>i&&l++<100;)o*=i/a,o|=0,s=n.substr(o),a=r-this._measure(s);for(l=0;a<i&&l++<100;){if(s){var u=cc.LabelTTF._wordRex.exec(s);h=u?u[0].length:1,c=s}o+=h,s=n.substr(o),a=r-this._measure(s)}o-=h,0===o&&(o=1,c=c.substr(1));var _,d=n.substr(0,o);cc.LabelTTF.wrapInspection&&cc.LabelTTF._symbolRex.test(c||s)&&(_=cc.LabelTTF._lastWordRex.exec(d),o-=_?_[0].length:0,0===o&&(o=1),c=n.substr(o),d=n.substr(0,o)),cc.LabelTTF._firsrEnglish.test(c)&&(_=cc.LabelTTF._lastEnglish.exec(d),_&&d!==_[0]&&(o-=_[0].length,c=n.substr(o),d=n.substr(0,o))),t[e]=c||s,t.splice(e,0,d)}},t.updateStatus=function(){var t=cc.Node._dirtyFlags,e=this._dirtyFlag;e&t.textDirty&&this._updateTexture(),cc.Node.RenderCmd.prototype.updateStatus.call(this),this._dirtyFlag&t.transformDirty&&(this.transform(this.getParentRenderCmd(),!0),this._dirtyFlag=this._dirtyFlag&cc.Node._dirtyFlags.transformDirty^this._dirtyFlag)},t._syncStatus=function(t){var e=cc.Node._dirtyFlags,i=this._dirtyFlag;i&e.textDirty&&this._updateTexture(),cc.Node.RenderCmd.prototype._syncStatus.call(this,t),(cc._renderType===cc.game.RENDER_TYPE_WEBGL||i&e.transformDirty)&&this.transform(t)},t.drawLabels=function(t,e,i){var n=this._node;if(n._shadowEnabled){var r=n._shadowOffset;t.shadowColor=this._shadowColorStr,t.shadowOffsetX=r.x,t.shadowOffsetY=-r.y,t.shadowBlur=n._shadowBlur}var c=n._hAlignment,o=n._vAlignment,s=n._strokeSize;t.font!==this._fontStyleStr&&(t.font=this._fontStyleStr),t.fillStyle=this._fillColorStr;var a=n._strokeEnabled;a&&(t.lineWidth=2*s,t.strokeStyle=this._strokeColorStr),t.textBaseline=cc.LabelTTF._textBaseline[o],t.textAlign=cc.LabelTTF._textAlign[c];for(var h=this._strings.length,l=0;l<h;l++){var u=this._strings[l];a&&t.strokeText(u,e,i[l]),t.fillText(u,e,i[l])}cc.g_NumberOfDraws++}}(),function(){cc.LabelTTF.CacheRenderCmd=function(t){cc.LabelTTF.RenderCmd.call(this,t);var e=this._labelCanvas=document.createElement("canvas");e.width=1,e.height=1,this._labelContext=e.getContext("2d"),this._texRect=cc.rect()},cc.LabelTTF.CacheRenderCmd.prototype=Object.create(cc.LabelTTF.RenderCmd.prototype),cc.inject(cc.LabelTTF.RenderCmd.prototype,cc.LabelTTF.CacheRenderCmd.prototype);var t=cc.LabelTTF.CacheRenderCmd.prototype;t.constructor=cc.LabelTTF.CacheRenderCmd,t._updateTexture=function(){this._dirtyFlag=this._dirtyFlag&cc.Node._dirtyFlags.textDirty^this._dirtyFlag;var t=this._node;this._updateTTF();var e=this._texRect.width,i=this._texRect.height,n=this._labelContext,r=this._labelCanvas;if(!t._texture){var c=new cc.Texture2D;c.initWithElement(this._labelCanvas),t.setTexture(c)}if(0===t._string.length)return r.width=e,r.height=i,t._texture&&t._texture.handleLoadedTexture(),t.setTextureRect(this._texRect),!0;n.font=this._fontStyleStr;var o=r.width===e&&r.height===i;return r.width=this._texRect.width,r.height=this._texRect.height,o&&n.clearRect(0,0,e,i),this._saveStatus(),this._drawTTFInCanvas(n),t._texture&&t._texture.handleLoadedTexture(),t.setTextureRect(this._texRect),!0},t._measureConfig=function(){this._labelContext.font=this._fontStyleStr},t._measure=function(t){return this._labelContext.measureText(t).width}}(),function(){cc.LabelTTF.CacheCanvasRenderCmd=function(t){cc.Sprite.CanvasRenderCmd.call(this,t),cc.LabelTTF.CacheRenderCmd.call(this)};var t=cc.LabelTTF.CacheCanvasRenderCmd.prototype=Object.create(cc.Sprite.CanvasRenderCmd.prototype);cc.inject(cc.LabelTTF.CacheRenderCmd.prototype,t),t.constructor=cc.LabelTTF.CacheCanvasRenderCmd}(),function(){cc.LabelTTF.CanvasRenderCmd=function(t){cc.Sprite.CanvasRenderCmd.call(this,t),cc.LabelTTF.RenderCmd.call(this)},cc.LabelTTF.CanvasRenderCmd.prototype=Object.create(cc.Sprite.CanvasRenderCmd.prototype),cc.inject(cc.LabelTTF.RenderCmd.prototype,cc.LabelTTF.CanvasRenderCmd.prototype);var t=cc.LabelTTF.CanvasRenderCmd.prototype;t.constructor=cc.LabelTTF.CanvasRenderCmd,t._measureConfig=function(){},t._measure=function(t){var e=cc._renderContext.getContext();return e.font=this._fontStyleStr,e.measureText(t).width},t._updateTexture=function(){this._dirtyFlag=this._dirtyFlag&cc.Node._dirtyFlags.textDirty^this._dirtyFlag;var t=this._node;cc.view.getDevicePixelRatio();return this._updateTTF(),0===t._string.length?(t.setTextureRect(this._texRect),!0):(this._saveStatus(),t.setTextureRect(this._texRect),!0)},t.rendering=function(t){var e=cc.view.getScaleX(),i=cc.view.getScaleY(),n=t||cc._renderContext,r=n.getContext();if(r){var c=this._node;if(n.computeRealOffsetY(),!(this._status.length<=0)){var o=this._renderingIndex>=this._status.length?this._renderingIndex-this._status.length:this._renderingIndex,s=this._status[o];this._renderingIndex=o+1;var a=c._rect.height,h=c._offsetPosition.x,l=-c._offsetPosition.y-a,u=this._displayedOpacity/255;n.setTransform(this._worldTransform,e,i),n.setCompositeOperation(this._blendFuncStr),n.setGlobalAlpha(u),n.save(),c._flippedX&&(h=-h-c._rect.width,r.scale(-1,1)),c._flippedY&&(l=c._offsetPosition.y,r.scale(1,-1));for(var _=s.xOffset+s.contextTransform.x+h*e,d=[],f=this._strings.length,p=0;p<f;p++)d.push(s.OffsetYArray[p]+s.contextTransform.y+l*i);this.drawLabels(r,_,d),n.restore()}}}}();var cc=cc||{};cc._tmp=cc._tmp||{},cc.associateWithNative=function(t,e){},cc.KEY={none:0,back:6,menu:18,backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,pause:19,capslock:20,escape:27,space:32,pageup:33,pagedown:34,end:35,home:36,left:37,up:38,right:39,down:40,select:41,insert:45,Delete:46,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,num0:96,num1:97,num2:98,num3:99,num4:100,num5:101,num6:102,num7:103,num8:104,num9:105,"*":106,"+":107,"-":109,numdel:110,"/":111,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123,numlock:144,scrolllock:145,";":186,semicolon:186,equal:187,"=":187,",":188,comma:188,dash:189,".":190,period:190,forwardslash:191,grave:192,"[":219,openbracket:219,backslash:220,"]":221,closebracket:221,quote:222,dpadLeft:1e3,dpadRight:1001,dpadUp:1003,dpadDown:1004,dpadCenter:1005},cc.FMT_JPG=0,cc.FMT_PNG=1,cc.FMT_TIFF=2,cc.FMT_RAWDATA=3,cc.FMT_WEBP=4,cc.FMT_UNKNOWN=5,cc.getImageFormatByData=function(t){return t.length>8&&137===t[0]&&80===t[1]&&78===t[2]&&71===t[3]&&13===t[4]&&10===t[5]&&26===t[6]&&10===t[7]?cc.FMT_PNG:t.length>2&&(73===t[0]&&73===t[1]||77===t[0]&&77===t[1]||255===t[0]&&216===t[1])?cc.FMT_TIFF:cc.FMT_UNKNOWN},cc.inherits=function(t,e){function i(){}i.prototype=e.prototype,t.superClass_=e.prototype,t.prototype=new i,t.prototype.constructor=t},cc.base=function(t,e,i){var n=arguments.callee.caller;if(n.superClass_)return ret=n.superClass_.constructor.apply(t,Array.prototype.slice.call(arguments,1)),ret;for(var r=Array.prototype.slice.call(arguments,2),c=!1,o=t.constructor;o;o=o.superClass_&&o.superClass_.constructor)if(o.prototype[e]===n)c=!0;else if(c)return o.prototype[e].apply(t,r);if(t[e]===n)return t.constructor.prototype[e].apply(t,r);throw Error("cc.base called from a method of one name to a method of a different name")};var GlobalVertexBuffer=function(){var t=888,e=function(e){this.gl=e,this.vertexBuffer=e.createBuffer(),this.size=t,this.byteLength=4*t*cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,this.data=new ArrayBuffer(this.byteLength),this.dataArray=new Float32Array(this.data),e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),e.bufferData(e.ARRAY_BUFFER,this.dataArray,e.DYNAMIC_DRAW),this._dirty=!1,this._spaces={0:this.byteLength}};return e.prototype={constructor:e,allocBuffer:function(t,e){var i=this._spaces[t];if(i&&i>=e){if(delete this._spaces[t],i>e){var n=t+e;this._spaces[n]=i-e}return!0}return!1},requestBuffer:function(t){var e,i,n;for(e in this._spaces)if(i=parseInt(e),n=this._spaces[e],n>=t&&this.allocBuffer(i,t))return{buffer:this,offset:i,size:t};return null},freeBuffer:function(t,e){var i,n,r,c=this._spaces;for(n in c){if(i=parseInt(n),i>t)break;if(i+c[n]>=t){e=e+t-i,t=i;break}}r=t+e,this._spaces[r]&&(e+=this._spaces[r],delete this._spaces[r]),this._spaces[t]=e},setDirty:function(){this._dirty=!0},update:function(){this._dirty&&(this.gl.bindBuffer(gl.ARRAY_BUFFER,this.vertexBuffer),this.gl.bufferSubData(gl.ARRAY_BUFFER,0,this.dataArray),this._dirty=!1)},destroy:function(){this.gl.deleteBuffer(this.vertexBuffer),this.data=null,this.positions=null,this.colors=null,this.texCoords=null,this.vertexBuffer=null}},e}();cc.rendererCanvas={childrenOrderDirty:!0,assignedZ:0,assignedZStep:1e-4,_transformNodePool:[],_renderCmds:[],_isCacheToCanvasOn:!1,_cacheToCanvasCmds:{},_cacheInstanceIds:[],_currentID:0,_clearColor:cc.color(),_clearFillStyle:"rgb(0, 0, 0)",_dirtyRegion:null,_allNeedDraw:!0,_enableDirtyRegion:!1,_debugDirtyRegion:!1,_canUseDirtyRegion:!1,_dirtyRegionCountThreshold:10,getRenderCmd:function(t){return t._createRenderCmd()},enableDirtyRegion:function(t){this._enableDirtyRegion=t},isDirtyRegionEnabled:function(){return this._enableDirtyRegion},setDirtyRegionCountThreshold:function(t){this._dirtyRegionCountThreshold=t},_collectDirtyRegion:function(){var t,e,i=this._renderCmds,n=this._dirtyRegion,r=0,c=!0,o=cc.Node.CanvasRenderCmd.RegionStatus;for(t=0,e=i.length;t<e;t++){var s=i[t],a=s._regionFlag,h=s._oldRegion,l=s._currentRegion;a>o.NotDirty&&(++r,r>this._dirtyRegionCountThreshold&&(c=!1),c&&(!l.isEmpty()&&n.addRegion(l),s._regionFlag>o.Dirty&&!h.isEmpty()&&n.addRegion(h)),s._regionFlag=o.NotDirty)}return c},_beginDrawDirtyRegion:function(t){var e=t.getContext(),i=this._dirtyRegion.getDirtyRegions();e.save();var n=t._scaleX,r=t._scaleY;t.setTransform({a:1,b:0,c:0,d:1,tx:0,ty:0},n,r),e.beginPath();for(var c=0,o=i.length;c<o;++c){var s=i[c];e.rect(s._minX,-s._maxY,s._width,s._height)}e.clip()},_endDrawDirtyRegion:function(t){t.restore()},_debugDrawDirtyRegion:function(t){if(this._debugDirtyRegion){var e=t.getContext(),i=this._dirtyRegion.getDirtyRegions(),n=t._scaleX,r=t._scaleY;t.setTransform({a:1,b:0,c:0,d:1,tx:0,ty:0},n,r),e.beginPath();for(var c=0,o=i.length;c<o;++c){var s=i[c];e.rect(s._minX,-s._maxY,s._width,s._height)}var a=e.fillStyle;e.fillStyle="green",e.fill(),e.fillStyle=a}},rendering:function(t){var e=this._dirtyRegion=this._dirtyRegion||new cc.DirtyRegion,i=cc._canvas,n=t||cc._renderContext,r=n.getContext(),c=cc.view.getScaleX(),o=cc.view.getScaleY();n.setViewScale(c,o),n.computeRealOffsetY();var s,a,h=this._dirtyRegion.getDirtyRegions(),l=this._renderCmds,u=this._allNeedDraw||!this._enableDirtyRegion||!this._canUseDirtyRegion,_=!0;for(u||(_=this._collectDirtyRegion()),u=u||!_,u||this._beginDrawDirtyRegion(n),r.setTransform(1,0,0,1,0,0),r.clearRect(0,0,i.width,i.height),0===this._clearColor.r&&0===this._clearColor.g&&0===this._clearColor.b||(n.setFillStyle(this._clearFillStyle),n.setGlobalAlpha(this._clearColor.a),r.fillRect(0,0,i.width,i.height)),s=0,a=l.length;s<a;s++){var d=l[s],f=!1,p=d._currentRegion;if(!p||u)f=!0;else for(var g=0,m=h.length;g<m;++g)if(h[g].intersects(p)){f=!0;break}f&&d.rendering(n,c,o)}u||(this._debugDrawDirtyRegion(n),this._endDrawDirtyRegion(r)),e.clear(),this._allNeedDraw=!1},_renderingToCacheCanvas:function(t,e,i,n){t||cc.log("The context of RenderTexture is invalid."),i=cc.isUndefined(i)?1:i,n=cc.isUndefined(n)?1:n,e=e||this._currentID;var r,c,o=this._cacheToCanvasCmds[e];for(t.computeRealOffsetY(),r=0,c=o.length;r<c;r++)o[r].rendering(t,i,n);this._removeCache(e);var s=this._cacheInstanceIds;0===s.length?this._isCacheToCanvasOn=!1:this._currentID=s[s.length-1]},_turnToCacheMode:function(t){this._isCacheToCanvasOn=!0,t=t||0,this._cacheToCanvasCmds[t]=[],this._cacheInstanceIds.indexOf(t)===-1&&this._cacheInstanceIds.push(t),this._currentID=t},_turnToNormalMode:function(){this._isCacheToCanvasOn=!1},_removeCache:function(t){t=t||this._currentID;var e=this._cacheToCanvasCmds[t];e&&(e.length=0,delete this._cacheToCanvasCmds[t]);var i=this._cacheInstanceIds;cc.arrayRemoveObject(i,t)},resetFlag:function(){this.childrenOrderDirty=!1,this._transformNodePool.length=0},transform:function(){var t=this._transformNodePool;t.sort(this._sortNodeByLevelAsc);for(var e=0,i=t.length;e<i;e++)0!==t[e]._dirtyFlag&&t[e].updateStatus();t.length=0},transformDirty:function(){return this._transformNodePool.length>0},_sortNodeByLevelAsc:function(t,e){return t._curLevel-e._curLevel},pushDirtyNode:function(t){this._transformNodePool.push(t)},clear:function(){},clearRenderCommands:function(){this._renderCmds.length=0,this._cacheInstanceIds.length=0,this._isCacheToCanvasOn=!1,this._allNeedDraw=!0,this._canUseDirtyRegion=!0},pushRenderCommand:function(t){if(t.needDraw())if(t._canUseDirtyRegion||(this._canUseDirtyRegion=!1),this._isCacheToCanvasOn){var e=this._currentID,i=this._cacheToCanvasCmds,n=i[e];n.indexOf(t)===-1&&n.push(t)}else this._renderCmds.indexOf(t)===-1&&this._renderCmds.push(t)}},function(){cc.CanvasContextWrapper=function(t){this._context=t,this._saveCount=0,this._currentAlpha=t.globalAlpha,this._currentCompositeOperation=t.globalCompositeOperation,this._currentFillStyle=t.fillStyle,this._currentStrokeStyle=t.strokeStyle,this._offsetX=0,this._offsetY=0,this._realOffsetY=this.height,this._armatureMode=0};var t=cc.CanvasContextWrapper.prototype;t.resetCache=function(){var t=this._context;this._currentAlpha=t.globalAlpha,this._currentCompositeOperation=t.globalCompositeOperation,this._currentFillStyle=t.fillStyle,this._currentStrokeStyle=t.strokeStyle,this._realOffsetY=this._context.canvas.height+this._offsetY},t.setOffset=function(t,e){this._offsetX=t,this._offsetY=e,this._realOffsetY=this._context.canvas.height+this._offsetY},t.computeRealOffsetY=function(){this._realOffsetY=this._context.canvas.height+this._offsetY},t.setViewScale=function(t,e){this._scaleX=t,this._scaleY=e},t.getContext=function(){return this._context},t.save=function(){this._context.save(),this._saveCount++},t.restore=function(){this._context.restore(),this._saveCount--},t.setGlobalAlpha=function(t){this._saveCount>0?this._context.globalAlpha=t:this._currentAlpha!==t&&(this._currentAlpha=t,this._context.globalAlpha=t)},t.setCompositeOperation=function(t){this._saveCount>0?this._context.globalCompositeOperation=t:this._currentCompositeOperation!==t&&(this._currentCompositeOperation=t,this._context.globalCompositeOperation=t)},t.setFillStyle=function(t){this._saveCount>0?this._context.fillStyle=t:this._currentFillStyle!==t&&(this._currentFillStyle=t,this._context.fillStyle=t)},t.setStrokeStyle=function(t){this._saveCount>0?this._context.strokeStyle=t:this._currentStrokeStyle!==t&&(this._currentStrokeStyle=t,this._context.strokeStyle=t)},t.setTransform=function(t,e,i){this._armatureMode>0?(this.restore(),this.save(),this._context.transform(t.a*e,-t.b*i,-t.c*e,t.d*i,t.tx*e,-(t.ty*i))):this._context.setTransform(t.a*e,-t.b*i,-t.c*e,t.d*i,this._offsetX+t.tx*e,this._realOffsetY-t.ty*i)},t._switchToArmatureMode=function(t,e,i,n){t?(this._armatureMode++,this._context.setTransform(e.a,e.c,e.b,e.d,this._offsetX+e.tx*i,this._realOffsetY-e.ty*n),this.save()):(this._armatureMode--,this.restore())}}();var Region=function(){this._minX=0,this._minY=0,this._maxX=0,this._maxY=0,this._width=0,this._height=0,this._area=0},regionProto=Region.prototype,regionPool=[];regionProto.setTo=function(t,e,i,n){return this._minX=t,this._minY=e,this._maxX=i,this._maxY=n,this.updateArea(),this},regionProto.intValues=function(){this._minX=Math.floor(this._minX),this._minY=Math.floor(this._minY),this._maxX=Math.ceil(this._maxX),this._maxY=Math.ceil(this._maxY),this.updateArea()},regionProto.updateArea=function(){this._width=this._maxX-this._minX,this._height=this._maxY-this._minY,this._area=this._width*this._height},regionProto.union=function(t){return this._width<=0||this._height<=0?void this.setTo(t._minX,t._minY,t._maxX,t._maxY):(this._minX>t._minX&&(this._minX=t._minX),this._minY>t._minY&&(this._minY=t._minY),this._maxX<t._maxX&&(this._maxX=t._maxX),this._maxY<t._maxY&&(this._maxY=t._maxY),void this.updateArea())},regionProto.setEmpty=function(){this._minX=0,this._minY=0,this._maxX=0,this._maxY=0,this._width=0,this._height=0,this._area=0},regionProto.isEmpty=function(){return this._width<=0||this._height<=0},regionProto.intersects=function(t){if(this._width<=0||this._height<=0||t._width<=0||t._height<=0)return!1;var e=this._minX>t._minX?this._minX:t._minX,i=this._maxX<t._maxX?this._maxX:t._maxX;return!(e>i)&&(e=this._minY>t._minY?this._minY:t._minY,i=this._maxY<t._maxY?this._maxY:t._maxY,e<=i)},regionProto.updateRegion=function(t,e){if(0==t.width||0==t.height)return void this.setEmpty();var i,n,r,c,o=e,s=o.a,a=o.b,h=o.c,l=o.d,u=o.tx,_=o.ty,d=t.x,f=t.y,p=d+t.width,g=f+t.height;if(1==s&&0==a&&0==h&&1==l)i=d+u-1,n=f+_-1,r=p+u+1,c=g+_+1;else{var m=s*d+h*f+u,v=a*d+l*f+_,T=s*p+h*f+u,y=a*p+l*f+_,S=s*p+h*g+u,C=a*p+l*g+_,E=s*d+h*g+u,b=a*d+l*g+_,x=0;m>T&&(x=m,m=T,T=x),S>E&&(x=S,S=E,E=x),i=(m<S?m:S)-1,r=(T>E?T:E)+1,v>y&&(x=v,v=y,y=x),C>b&&(x=C,C=b,b=x),n=(v<C?v:C)-1,c=(y>b?y:b)+1}this._minX=i,this._minY=n,this._maxX=r,this._maxY=c,this._width=r-i,this._height=c-n,this._area=this._width*this._height};var DirtyRegion=function(){this.dirtyList=[],this.hasClipRect=!1,this.clipWidth=0,this.clipHeight=0,this.clipArea=0,this.clipRectChanged=!1},dirtyRegionProto=DirtyRegion.prototype;dirtyRegionProto.setClipRect=function(t,e){this.hasClipRect=!0,this.clipRectChanged=!0,this.clipWidth=Math.ceil(t),this.clipHeight=Math.ceil(e),this.clipArea=this.clipWidth*this.clipHeight},dirtyRegionProto.addRegion=function(t){var e=t._minX,i=t._minY,n=t._maxX,r=t._maxY;if(this.hasClipRect&&(e<0&&(e=0),i<0&&(i=0),n>this.clipWidth&&(n=this.clipWidth),r>this.clipHeight&&(r=this.clipHeight)),e>=n||i>=r)return!1;if(this.clipRectChanged)return!0;var c=this.dirtyList,o=regionCreate();return c.push(o.setTo(e,i,n,r)),this.mergeDirtyList(c),!0},dirtyRegionProto.clear=function(){for(var t=this.dirtyList,e=t.length,i=0;i<e;i++)regionRelease(t[i]);t.length=0},dirtyRegionProto.getDirtyRegions=function(){var t=this.dirtyList;if(this.clipRectChanged){this.clipRectChanged=!1,this.clear();var e=regionCreate();t.push(e.setTo(0,0,this.clipWidth,this.clipHeight))}else for(;this.mergeDirtyList(t););var i=this.dirtyList.length;if(i>0)for(var n=0;n<i;n++)this.dirtyList[n].intValues();return this.dirtyList},dirtyRegionProto.mergeDirtyList=function(t){var e=t.length;if(e<2)return!1;for(var i=this.hasClipRect,n=e>3?Number.POSITIVE_INFINITY:0,r=0,c=0,o=0,s=0;s<e-1;s++){var a=t[s];i&&(o+=a.area);for(var h=s+1;h<e;h++){var l=t[h],u=unionArea(a,l)-a.area-l.area;n>u&&(r=s,c=h,n=u)}}if(i&&o/this.clipArea>.95&&(this.clipRectChanged=!0),r!=c){var _=t[c];return t[r].union(_),regionRelease(_),t.splice(c,1),!0}return!1},cc.Region=Region,cc.DirtyRegion=DirtyRegion,cc.profiler=function(){var t=!1,e=!1,i=0,n=0,r=0,c=0,o=null,s=document.createElement("div"),a=document.createElement("div"),h=document.createElement("div"),l=document.createElement("div"),u=.6,_=10,d=[0,10,20,30],f=[0,0,0,0],p=3,g=0,m=0;l.id="fps",l.style.position="absolute",l.style.padding="3px",l.style.textAlign="left",l.style.backgroundColor="rgb(0, 0, 34)",l.style.bottom=cc.DIRECTOR_STATS_POSITION.y+"0px",l.style.left=cc.DIRECTOR_STATS_POSITION.x+"px",l.style.width="45px",l.style.height="60px";for(var v=[h,a,s],T=0;T<3;++T){var y=v[T].style;y.color="rgb(0, 255, 255)",y.font="bold 12px Helvetica, Arial",y.lineHeight="20px",y.width="100%",l.appendChild(v[T])}var S=function(t){var e,i=d.length-1,n=i,r=0;for(g++,m+=t;n>=0;n--)if(t>=d[n]){f[n]++;break}if(g>=_){for(r=m/_,n=i;n>0;n--)if(e=f[n]/_,e>=u&&r>=d[n]){n!=p&&(p=n,E.onFrameRateChange&&E.onFrameRateChange(r.toFixed(2)));break}for(_changeCount=0,g=0,m=0,n=i;n>0;n--)f[n]=0}},C=function(){r=cc.director.getSecondsPerFrame(),i++,c+=cc.director.getDeltaTime(),c>cc.DIRECTOR_FPS_INTERVAL&&(n=i/c,i=0,c=0,E.onFrameRateChange&&S(n),t&&(a.innerText=r.toFixed(3),s.innerText=n.toFixed(1),h.innerText=(0|cc.g_NumberOfDraws).toString()))},E={onFrameRateChange:null,getSecondsPerFrame:function(){return r},getFrameRate:function(){return n},setProfileDuration:function(t){!isNaN(t)&&t>0&&(_=t/cc.DIRECTOR_FPS_INTERVAL)},resumeProfiling:function(){cc.eventManager.addListener(o,1)},stopProfiling:function(){cc.eventManager.removeListener(o)},isShowingStats:function(){return t},showStats:function(){e||this.init(),null===l.parentElement&&cc.container.appendChild(l),t=!0},hideStats:function(){t=!1,l.parentElement===cc.container&&cc.container.removeChild(l)},init:function(){e||(o=cc.eventManager.addCustomListener(cc.Director.EVENT_AFTER_VISIT,C),e=!0)}};return E}(),cc.game.addEventListener(cc.game.EVENT_RENDERER_INITED,function(){if(cc._renderType===cc.game.RENDER_TYPE_WEBGL){cc.DirectorDelegate=cc.Class.extend({updateProjection:function(){}});var t=cc.Director.prototype,e=function(t){if(t&&t._renderCmd){t._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty);var i,n=t._children;for(i=0;i<n.length;i++)e(n[i])}};cc.eventManager.addCustomListener(cc.Director.EVENT_PROJECTION_CHANGED,function(){for(var t=(cc.director,cc.director._scenesStack),i=0;i<t.length;i++)e(t[i])}),t.setProjection=function(t){var e=this,i=e._winSizeInPoints;e.setViewport();var n=e._openGLView,r=n._viewPortRect.x/n._scaleX,c=n._viewPortRect.y/n._scaleY;switch(t){case cc.Director.PROJECTION_2D:cc.kmGLMatrixMode(cc.KM_GL_PROJECTION),cc.kmGLLoadIdentity();var o=cc.math.Matrix4.createOrthographicProjection(0,i.width,0,i.height,-1024,1024);cc.kmGLMultMatrix(o),cc.kmGLMatrixMode(cc.KM_GL_MODELVIEW),cc.kmGLLoadIdentity();break;case cc.Director.PROJECTION_3D:var s=e.getZEye(),a=new cc.math.Matrix4,h=new cc.math.Matrix4;cc.kmGLMatrixMode(cc.KM_GL_PROJECTION),cc.kmGLLoadIdentity(),a=cc.math.Matrix4.createPerspectiveProjection(60,i.width/i.height,.1,2*s),cc.kmGLMultMatrix(a),cc.kmGLMatrixMode(cc.KM_GL_MODELVIEW),cc.kmGLLoadIdentity();var l=new cc.math.Vec3(-r+i.width/2,-c+i.height/2,s),u=new cc.math.Vec3(-r+i.width/2,-c+i.height/2,0),_=new cc.math.Vec3(0,1,0);h.lookAt(l,u,_),cc.kmGLMultMatrix(h);break;case cc.Director.PROJECTION_CUSTOM:e._projectionDelegate&&e._projectionDelegate.updateProjection();break;default:cc.log(cc._LogInfos.Director_setProjection)}e._projection=t,cc.eventManager.dispatchEvent(e._eventProjectionChanged),cc.setProjectionMatrixDirty(),cc.renderer.childrenOrderDirty=!0},t.setDepthTest=function(t){cc.renderer.setDepthTest(t)},t.setClearColor=function(t){cc.renderer._clearColor=t},t.setOpenGLView=function(t){var e=this;e._winSizeInPoints.width=cc._canvas.width,e._winSizeInPoints.height=cc._canvas.height,e._openGLView=t||cc.view;var i=cc.configuration;i.gatherGPUInfo(),i.dumpInfo(),e.setGLDefaultValues(),cc.eventManager&&cc.eventManager.setEnabled(!0)},t._clear=function(){var t=cc._renderContext;t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT)},t.getVisibleSize=function(){return this._openGLView.getVisibleSize()},t.getVisibleOrigin=function(){return this._openGLView.getVisibleOrigin()},t.getZEye=function(){return this._winSizeInPoints.height/1.1566},t.setViewport=function(){var t=this._openGLView;if(t){var e=this._winSizeInPoints;t.setViewPortInPoints(-t._viewPortRect.x/t._scaleX,-t._viewPortRect.y/t._scaleY,e.width,e.height)}},t.getOpenGLView=function(){return this._openGLView},t.getProjection=function(){return this._projection},t.setAlphaBlending=function(t){t?cc.glBlendFunc(cc.BLEND_SRC,cc.BLEND_DST):cc.glBlendFunc(cc._renderContext.ONE,cc._renderContext.ZERO)},t.setGLDefaultValues=function(){var t=this;t.setAlphaBlending(!0),t.setProjection(t._projection),cc._renderContext.clearColor(0,0,0,0)}}}),cc.configuration={ERROR:0,STRING:1,INT:2,DOUBLE:3,BOOLEAN:4,_maxTextureSize:0,_maxModelviewStackDepth:0,_supportsPVRTC:!1,_supportsNPOT:!1,_supportsBGRA8888:!1,_supportsDiscardFramebuffer:!1,_supportsShareableVAO:!1,_maxSamplesAllowed:0,_maxTextureUnits:0,_GlExtensions:"",_valueDict:{},_inited:!1,_init:function(){var t=this._valueDict;t["cocos2d.x.version"]=cc.ENGINE_VERSION,t["cocos2d.x.compiled_with_profiler"]=!1,t["cocos2d.x.compiled_with_gl_state_cache"]=cc.ENABLE_GL_STATE_CACHE,this._inited=!0},getMaxTextureSize:function(){return this._maxTextureSize},getMaxModelviewStackDepth:function(){return this._maxModelviewStackDepth},getMaxTextureUnits:function(){return this._maxTextureUnits},supportsNPOT:function(){return this._supportsNPOT},supportsPVRTC:function(){return this._supportsPVRTC},supportsETC:function(){return!1},supportsS3TC:function(){return!1},supportsATITC:function(){return!1},supportsBGRA8888:function(){return this._supportsBGRA8888},supportsDiscardFramebuffer:function(){return this._supportsDiscardFramebuffer},supportsShareableVAO:function(){return this._supportsShareableVAO},checkForGLExtension:function(t){return this._GlExtensions.indexOf(t)>-1},getValue:function(t,e){this._inited||this._init();var i=this._valueDict;return i[t]?i[t]:e},setValue:function(t,e){this._valueDict[t]=e},dumpInfo:function(){0===cc.ENABLE_GL_STATE_CACHE&&(cc.log(""),cc.log(cc._LogInfos.configuration_dumpInfo),cc.log(""))},gatherGPUInfo:function(){if(cc._renderType!==cc.game.RENDER_TYPE_CANVAS){this._inited||this._init();var t=cc._renderContext,e=this._valueDict;e["gl.vendor"]=t.getParameter(t.VENDOR),e["gl.renderer"]=t.getParameter(t.RENDERER),e["gl.version"]=t.getParameter(t.VERSION),this._GlExtensions="";for(var i=t.getSupportedExtensions(),n=0;n<i.length;n++)this._GlExtensions+=i[n]+" ";this._maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),e["gl.max_texture_size"]=this._maxTextureSize,this._maxTextureUnits=t.getParameter(t.MAX_COMBINED_TEXTURE_IMAGE_UNITS),e["gl.max_texture_units"]=this._maxTextureUnits,this._supportsPVRTC=this.checkForGLExtension("GL_IMG_texture_compression_pvrtc"),e["gl.supports_PVRTC"]=this._supportsPVRTC,this._supportsNPOT=!1,e["gl.supports_NPOT"]=this._supportsNPOT,this._supportsBGRA8888=this.checkForGLExtension("GL_IMG_texture_format_BGRA888"),e["gl.supports_BGRA8888"]=this._supportsBGRA8888,this._supportsDiscardFramebuffer=this.checkForGLExtension("GL_EXT_discard_framebuffer"),e["gl.supports_discard_framebuffer"]=this._supportsDiscardFramebuffer,this._supportsShareableVAO=this.checkForGLExtension("vertex_array_object"),e["gl.supports_vertex_array_object"]=this._supportsShareableVAO,cc.checkGLErrorDebug()}},loadConfigFile:function(t){this._inited||this._init();var e=cc.loader.getRes(t);if(!e)throw new Error("Please load the resource first : "+t);cc.assert(e,cc._LogInfos.configuration_loadConfigFile_2,t);var i=e.data;if(!i)return void cc.log(cc._LogInfos.configuration_loadConfigFile,t);for(var n in i)this._valueDict[n]=i[n]}},cc.rendererWebGL=function(){function t(t){var e=cc._renderContext;if(n){e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,n);for(var i=new Uint16Array(6*t),o=0,_=0,d=6*t;_<d;_+=6)i[_]=o+0,i[_+1]=o+1,i[_+2]=o+2,i[_+3]=o+1,i[_+4]=o+2,i[_+5]=o+3,o+=4;e.bufferData(e.ELEMENT_ARRAY_BUFFER,i,e.STATIC_DRAW)}if(r){h=4*t*s;var f=4*h;a=new ArrayBuffer(f),l=new Float32Array(a),u=new Uint32Array(a),e.bindBuffer(e.ARRAY_BUFFER,r),e.bufferData(e.ARRAY_BUFFER,l,e.DYNAMIC_DRAW)}c=4*t}function e(e){var i=cc._renderContext;null===n?(r=i.createBuffer(),n=i.createBuffer(),t(e)):t(e)}var i={texture:null,blendSrc:null,blendDst:null,shader:null},n=null,r=null,c=0,o=0,s=6,a=null,h=0,l=null,u=null,_=!1;return{mat4Identity:null,childrenOrderDirty:!0,assignedZ:0,assignedZStep:.01,_transformNodePool:[],_renderCmds:[],_isCacheToBufferOn:!1,_cacheToBufferCmds:{},_cacheInstanceIds:[],_currentID:0,_clearColor:cc.color(),init:function(){var t=cc._renderContext;t.disable(t.CULL_FACE),t.disable(t.DEPTH_TEST),this.mat4Identity=new cc.math.Matrix4,this.mat4Identity.identity(),e(2e3),cc.sys.os===cc.sys.OS_IOS&&(_=!0)},getVertexSize:function(){return c},getRenderCmd:function(t){return t._createRenderCmd()},_turnToCacheMode:function(t){this._isCacheToBufferOn=!0,t=t||0,this._cacheToBufferCmds[t]?this._cacheToBufferCmds[t].length=0:this._cacheToBufferCmds[t]=[],this._cacheInstanceIds.indexOf(t)===-1&&this._cacheInstanceIds.push(t),this._currentID=t},_turnToNormalMode:function(){this._isCacheToBufferOn=!1},_removeCache:function(t){t=t||this._currentID;var e=this._cacheToBufferCmds[t];e&&(e.length=0,delete this._cacheToBufferCmds[t]);var i=this._cacheInstanceIds;cc.arrayRemoveObject(i,t)},_renderingToBuffer:function(t){t=t||this._currentID;var e=this._cacheToBufferCmds[t],i=cc._renderContext;this.rendering(i,e),this._removeCache(t);var n=this._cacheInstanceIds;0===n.length?this._isCacheToBufferOn=!1:this._currentID=n[n.length-1]},resetFlag:function(){this.childrenOrderDirty&&(this.childrenOrderDirty=!1),this._transformNodePool.length=0},transform:function(){var t=this._transformNodePool;t.sort(this._sortNodeByLevelAsc);var e,i,n;for(e=0,i=t.length;e<i;e++)n=t[e],n.updateStatus();t.length=0},transformDirty:function(){return this._transformNodePool.length>0},_sortNodeByLevelAsc:function(t,e){return t._curLevel-e._curLevel},pushDirtyNode:function(t){this._transformNodePool.push(t)},clearRenderCommands:function(){this._renderCmds.length=0},clear:function(){var t=cc._renderContext;t.clearColor(this._clearColor.r,this._clearColor.g,this._clearColor.b,this._clearColor.a),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT)},setDepthTest:function(t){var e=cc._renderContext;t?(e.clearDepth(1),e.enable(e.DEPTH_TEST),e.depthFunc(e.LEQUAL)):e.disable(e.DEPTH_TEST)},pushRenderCommand:function(t){if(t.needDraw())if(this._isCacheToBufferOn){var e=this._currentID,i=this._cacheToBufferCmds,n=i[e];n.indexOf(t)===-1&&n.push(t)}else this._renderCmds.indexOf(t)===-1&&this._renderCmds.push(t)},_increaseBatchingSize:function(t){o+=t},_uploadBufferData:function(t){o>=c&&this._batchRendering();var e=t._node._texture,n=t._node._blendFunc.src,r=t._node._blendFunc.dst,a=t._shaderProgram;i.texture===e&&i.blendSrc===n&&i.blendDst===r&&i.shader===a||(this._batchRendering(),i.texture=e,i.blendSrc=n,i.blendDst=r,i.shader=a);var h=t.uploadData(l,u,o*s);h>0&&(o+=h)},_batchRendering:function(){if(0!==o&&i.texture){var t=cc._renderContext,e=i.texture,a=i.shader,h=o/4;a&&(a.use(),a._updateProjectionUniform()),cc.glBlendFunc(i.blendSrc,i.blendDst),cc.glBindTexture2DN(0,e);var u=!t.bindBuffer(t.ARRAY_BUFFER,r);if(o>.5*c)t.bufferData(t.ARRAY_BUFFER,l,t.DYNAMIC_DRAW);else{var _=l.subarray(0,o*s);t.bufferData(t.ARRAY_BUFFER,_,t.DYNAMIC_DRAW)}u&&(t.enableVertexAttribArray(cc.VERTEX_ATTRIB_POSITION),t.enableVertexAttribArray(cc.VERTEX_ATTRIB_COLOR),t.enableVertexAttribArray(cc.VERTEX_ATTRIB_TEX_COORDS),t.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,3,t.FLOAT,!1,24,0),t.vertexAttribPointer(cc.VERTEX_ATTRIB_COLOR,4,t.UNSIGNED_BYTE,!0,24,12),t.vertexAttribPointer(cc.VERTEX_ATTRIB_TEX_COORDS,2,t.FLOAT,!1,24,16)),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,n),t.drawElements(t.TRIANGLES,6*h,t.UNSIGNED_SHORT,0),cc.g_NumberOfDraws++,o=0}},rendering:function(t,e){var n,r,c,s=e||this._renderCmds,a=t||cc._renderContext;for(a.bindBuffer(gl.ARRAY_BUFFER,null),
n=0,r=s.length;n<r;++n)c=s[n],c.uploadData?this._uploadBufferData(c):(o>0&&this._batchRendering(),c.rendering(a));this._batchRendering(),i.texture=null}}}(),function(){cc.Node.WebGLRenderCmd=function(t){cc.Node.RenderCmd.call(this,t),this._shaderProgram=null};var t=cc.Node.WebGLRenderCmd.prototype=Object.create(cc.Node.RenderCmd.prototype);t.constructor=cc.Node.WebGLRenderCmd,t._updateColor=function(){},t.setShaderProgram=function(t){this._shaderProgram=t},t.getShaderProgram=function(){return this._shaderProgram}}(),function(){cc.Layer.WebGLRenderCmd=function(t){cc.Node.WebGLRenderCmd.call(this,t)};var t=cc.Layer.WebGLRenderCmd.prototype=Object.create(cc.Node.WebGLRenderCmd.prototype);t.constructor=cc.Layer.WebGLRenderCmd,t.bake=function(){},t.unbake=function(){},t._bakeForAddChild=function(){}}(),function(){cc.LayerColor.WebGLRenderCmd=function(t){cc.Layer.WebGLRenderCmd.call(this,t),this._needDraw=!0,this._matrix=new cc.math.Matrix4,this._matrix.identity();var e=this;e._squareVerticesAB=new ArrayBuffer(48),e._squareColorsAB=new ArrayBuffer(16);var i=e._squareVerticesAB,n=e._squareColorsAB,r=cc.Vertex3F.BYTES_PER_ELEMENT,c=cc.Color.BYTES_PER_ELEMENT;e._squareVertices=[new cc.Vertex3F(0,0,0,i,0),new cc.Vertex3F(0,0,0,i,r),new cc.Vertex3F(0,0,0,i,2*r),new cc.Vertex3F(0,0,0,i,3*r)],e._squareColors=[cc.color(0,0,0,255,n,0),cc.color(0,0,0,255,n,c),cc.color(0,0,0,255,n,2*c),cc.color(0,0,0,255,n,3*c)],e._verticesFloat32Buffer=cc._renderContext.createBuffer(),e._colorsUint8Buffer=cc._renderContext.createBuffer(),this._shaderProgram=cc.shaderCache.programForKey(cc.SHADER_POSITION_COLOR)};var t=cc.LayerColor.WebGLRenderCmd.prototype=Object.create(cc.Layer.WebGLRenderCmd.prototype);t.constructor=cc.LayerColor.WebGLRenderCmd,t.rendering=function(t){var e=t||cc._renderContext,i=this._node,n=this._worldTransform;this._matrix.mat[0]=n.a,this._matrix.mat[4]=n.c,this._matrix.mat[12]=n.tx,this._matrix.mat[1]=n.b,this._matrix.mat[5]=n.d,this._matrix.mat[13]=n.ty,this._shaderProgram.use(),this._shaderProgram._setUniformForMVPMatrixWithMat4(this._matrix),e.enableVertexAttribArray(cc.VERTEX_ATTRIB_POSITION),e.enableVertexAttribArray(cc.VERTEX_ATTRIB_COLOR),cc.glBlendFunc(i._blendFunc.src,i._blendFunc.dst),e.bindBuffer(e.ARRAY_BUFFER,this._verticesFloat32Buffer),e.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,3,e.FLOAT,!1,0,0),e.bindBuffer(e.ARRAY_BUFFER,this._colorsUint8Buffer),e.vertexAttribPointer(cc.VERTEX_ATTRIB_COLOR,4,e.UNSIGNED_BYTE,!0,0,0),e.drawArrays(e.TRIANGLE_STRIP,0,this._squareVertices.length)},t.transform=function(t,e){this.originTransform(t,e);var i=this._node,n=i._contentSize.width,r=i._contentSize.height,c=this._squareVertices;c[1].x=n,c[2].y=r,c[3].x=n,c[3].y=r,c[0].z=c[1].z=c[2].z=c[3].z=i._vertexZ,this._bindLayerVerticesBufferData()},t._updateColor=function(){for(var t=this._displayedColor,e=this._displayedOpacity,i=this._squareColors,n=0;n<4;n++)i[n].r=t.r,i[n].g=t.g,i[n].b=t.b,i[n].a=e;this._bindLayerColorsBufferData()},t._bindLayerVerticesBufferData=function(){var t=cc._renderContext;t.bindBuffer(t.ARRAY_BUFFER,this._verticesFloat32Buffer),t.bufferData(t.ARRAY_BUFFER,this._squareVerticesAB,t.DYNAMIC_DRAW)},t._bindLayerColorsBufferData=function(){var t=cc._renderContext;t.bindBuffer(t.ARRAY_BUFFER,this._colorsUint8Buffer),t.bufferData(t.ARRAY_BUFFER,this._squareColorsAB,t.STATIC_DRAW)},t.updateBlendFunc=function(t){}}(),function(){cc.LayerGradient.WebGLRenderCmd=function(t){cc.LayerColor.WebGLRenderCmd.call(this,t),this._needDraw=!0,this._clipRect=new cc.Rect,this._clippingRectDirty=!1};var t=cc.LayerGradient.WebGLRenderCmd.prototype=Object.create(cc.LayerColor.WebGLRenderCmd.prototype);t.constructor=cc.LayerGradient.WebGLRenderCmd,t.updateStatus=function(){var t=cc.Node._dirtyFlags,e=this._dirtyFlag;e&t.gradientDirty&&(this._dirtyFlag|=t.colorDirty,this._updateVertex(),this._dirtyFlag=e&t.gradientDirty^e),cc.Node.RenderCmd.prototype.updateStatus.call(this)},t._syncStatus=function(t){var e=cc.Node._dirtyFlags,i=this._dirtyFlag;i&e.gradientDirty&&(this._dirtyFlag|=e.colorDirty,this._updateVertex(),this._dirtyFlag=i&e.gradientDirty^i),cc.Node.RenderCmd.prototype._syncStatus.call(this,t)},t.transform=function(t,e){this.originTransform(t,e),this._updateVertex()},t._updateVertex=function(){var t=this._node,e=t._colorStops;if(e&&!(e.length<2)){this._clippingRectDirty=!0;var i,n=e.length,r=2*n,c=t._contentSize,o=this._squareVertices;if(o.length<r){this._squareVerticesAB=new ArrayBuffer(12*r),o.length=0;var s=this._squareVerticesAB,a=cc.Vertex3F.BYTES_PER_ELEMENT;for(i=0;i<r;i++)o.push(new cc.Vertex3F(0,0,0,s,a*i))}var h=Math.PI+cc.pAngleSigned(cc.p(0,-1),t._alongVector),l=cc.p(c.width/2,c.height/2),u=Math.round(cc.radiansToDegrees(h)),_=cc.affineTransformMake(1,0,0,1,l.x,l.y);_=cc.affineTransformRotate(_,h);var d,f;u<90?(d=cc.p(-l.x,l.y),f=cc.p(l.x,l.y)):u<180?(d=cc.p(l.x,l.y),f=cc.p(l.x,-l.y)):u<270?(d=cc.p(l.x,-l.y),f=cc.p(-l.x,-l.y)):(d=cc.p(-l.x,-l.y),f=cc.p(-l.x,l.y));var p=Math.sin(h),g=Math.cos(h),m=Math.abs((d.x*g-d.y*p)/l.x),v=Math.abs((f.x*p+f.y*g)/l.y);for(_=cc.affineTransformScale(_,m,v),i=0;i<n;i++){var T=e[i],y=T.p*c.height,S=cc.pointApplyAffineTransform(-l.x,y-l.y,_);o[2*i].x=S.x,o[2*i].y=S.y,o[2*i].z=t._vertexZ;var C=cc.pointApplyAffineTransform(c.width-l.x,y-l.y,_);o[2*i+1].x=C.x,o[2*i+1].y=C.y,o[2*i+1].z=t._vertexZ}this._bindLayerVerticesBufferData()}},t._updateColor=function(){var t=this._node,e=t._colorStops;if(e&&!(e.length<2)){var n=e.length,r=this._squareColors,c=2*n;if(r.length<c){this._squareColorsAB=new ArrayBuffer(4*c),r.length=0;var o=this._squareColorsAB,s=cc.Color.BYTES_PER_ELEMENT;for(i=0;i<c;i++)r.push(cc.color(0,0,0,255,o,s*i))}var a=this._displayedOpacity/255;for(i=0;i<n;i++){var h=e[i].color,l=r[2*i],u=r[2*i+1];l.r=h.r,l.g=h.g,l.b=h.b,l.a=h.a*a,u.r=h.r,u.g=h.g,u.b=h.b,u.a=h.a*a}this._bindLayerColorsBufferData()}},t.rendering=function(t){var e=t||cc._renderContext,i=this._node,n=this._getClippingRect();e.enable(e.SCISSOR_TEST),cc.view.setScissorInPoints(n.x,n.y,n.width,n.height);var r=this._worldTransform;this._matrix.mat[0]=r.a,this._matrix.mat[4]=r.c,this._matrix.mat[12]=r.tx,this._matrix.mat[1]=r.b,this._matrix.mat[5]=r.d,this._matrix.mat[13]=r.ty,this._shaderProgram.use(),this._shaderProgram._setUniformForMVPMatrixWithMat4(this._matrix),e.enableVertexAttribArray(cc.VERTEX_ATTRIB_POSITION),e.enableVertexAttribArray(cc.VERTEX_ATTRIB_COLOR),cc.glBlendFunc(i._blendFunc.src,i._blendFunc.dst),e.bindBuffer(e.ARRAY_BUFFER,this._verticesFloat32Buffer),e.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,3,e.FLOAT,!1,0,0),e.bindBuffer(e.ARRAY_BUFFER,this._colorsUint8Buffer),e.vertexAttribPointer(cc.VERTEX_ATTRIB_COLOR,4,e.UNSIGNED_BYTE,!0,0,0),e.drawArrays(e.TRIANGLE_STRIP,0,this._squareVertices.length),e.disable(e.SCISSOR_TEST)},t._getClippingRect=function(){if(this._clippingRectDirty){var t=this._node,e=cc.rect(0,0,t._contentSize.width,t._contentSize.height),i=t.getNodeToWorldTransform();this._clipRect=cc._rectApplyAffineTransformIn(e,i)}return this._clipRect}}(),function(){cc.Sprite.WebGLRenderCmd=function(t){cc.Node.WebGLRenderCmd.call(this,t),this._needDraw=!0,this._vertices=[{x:0,y:0,u:0,v:0},{x:0,y:0,u:0,v:0},{x:0,y:0,u:0,v:0},{x:0,y:0,u:0,v:0}],this._color=new Uint32Array(1),this._dirty=!1,this._recursiveDirty=!1,this._shaderProgram=cc.shaderCache.programForKey(cc.SHADER_SPRITE_POSITION_TEXTURECOLORALPHATEST)};var t=cc.Sprite.WebGLRenderCmd.prototype=Object.create(cc.Node.WebGLRenderCmd.prototype);t.constructor=cc.Sprite.WebGLRenderCmd,t.updateBlendFunc=function(t){},t.setDirtyFlag=function(t){cc.Node.WebGLRenderCmd.prototype.setDirtyFlag.call(this,t),this._dirty=!0},t.setDirtyRecursively=function(t){this._recursiveDirty=t,this._dirty=t;for(var e,i=this._node._children,n=i?i.length:0,r=0;r<n;r++)e=i[r],e instanceof cc.Sprite&&e._renderCmd.setDirtyRecursively(t)},t._setBatchNodeForAddChild=function(t){var e=this._node;if(e._batchNode){if(!(t instanceof cc.Sprite))return cc.log(cc._LogInfos.Sprite_addChild),!1;t.texture._webTextureObj!==e.textureAtlas.texture._webTextureObj&&cc.log(cc._LogInfos.Sprite_addChild_2),e._batchNode.appendChild(t),e._reorderChildDirty||e._setReorderChildDirtyRecursively()}return!0},t._handleTextureForRotatedTexture=function(t){return t},t.isFrameDisplayed=function(t){var e=this._node;return cc.rectEqualToRect(t.getRect(),e._rect)&&t.getTexture().getName()===e._texture.getName()&&cc.pointEqualToPoint(t.getOffset(),e._unflippedOffsetPositionFromCenter)},t._textureLoadedCallback=function(t){if(!this._textureLoaded){this._textureLoaded=!0;var e=this._rect;e?cc._rectEqualToZero(e)&&(e.width=t.width,e.height=t.height):e=cc.rect(0,0,t.width,t.height),this.texture=t,this.setTextureRect(e,this._rectRotated),this.setBatchNode(this._batchNode),this.dispatchEvent("load"),cc.renderer.childrenOrderDirty=!0}},t._setTextureCoords=function(t,e){void 0===e&&(e=!0),e&&(t=cc.rectPointsToPixels(t));var i=this._node,n=i._batchNode?i.textureAtlas.texture:i._texture,r=this._vertices;if(n){var c,o,s,a,h,l=n.pixelsWidth,u=n.pixelsHeight;i._rectRotated?(cc.FIX_ARTIFACTS_BY_STRECHING_TEXEL?(c=(2*t.x+1)/(2*l),o=c+(2*t.height-2)/(2*l),s=(2*t.y+1)/(2*u),a=s+(2*t.width-2)/(2*u)):(c=t.x/l,o=(t.x+t.height)/l,s=t.y/u,a=(t.y+t.width)/u),i._flippedX&&(h=s,s=a,a=h),i._flippedY&&(h=c,c=o,o=h),r[0].u=o,r[0].v=s,r[1].u=c,r[1].v=s,r[2].u=o,r[2].v=a,r[3].u=c,r[3].v=a):(cc.FIX_ARTIFACTS_BY_STRECHING_TEXEL?(c=(2*t.x+1)/(2*l),o=c+(2*t.width-2)/(2*l),s=(2*t.y+1)/(2*u),a=s+(2*t.height-2)/(2*u)):(c=t.x/l,o=(t.x+t.width)/l,s=t.y/u,a=(t.y+t.height)/u),i._flippedX&&(h=c,c=o,o=h),i._flippedY&&(h=s,s=a,a=h),r[0].u=c,r[0].v=s,r[1].u=c,r[1].v=a,r[2].u=o,r[2].v=s,r[3].u=o,r[3].v=a)}},t._setColorDirty=function(){},t._updateBlendFunc=function(){if(this._batchNode)return void cc.log(cc._LogInfos.Sprite__updateBlendFunc);var t=this._node,e=t._blendFunc;t._texture&&t._texture.hasPremultipliedAlpha()?(e.src===cc.SRC_ALPHA&&e.dst===cc.BLEND_DST&&(e.src=cc.ONE),t.opacityModifyRGB=!0):(e.src===cc.ONE&&e.dst===cc.BLEND_DST&&(e.src=cc.SRC_ALPHA),t.opacityModifyRGB=!1)},t._setTexture=function(t){var e=this._node;if(e._batchNode){if(e._batchNode.texture!==t)return void cc.log(cc._LogInfos.Sprite_setTexture)}else e._texture!==t&&(e._textureLoaded=!!t&&t._textureLoaded,e._texture=t,this._updateBlendFunc(),e._textureLoaded&&(cc.renderer.childrenOrderDirty=!0))},t._checkTextureBoundary=function(t,e,i){if(t&&t.url){var n,r;i?(n=e.x+e.height,r=e.y+e.width):(n=e.x+e.width,r=e.y+e.height),n>t.width&&cc.error(cc._LogInfos.RectWidth,t.url),r>t.height&&cc.error(cc._LogInfos.RectHeight,t.url)}},t.transform=function(t,e){this.originTransform(t,e);var i=this._node,n=i._offsetPosition.x,r=n+i._rect.width,c=i._offsetPosition.y,o=c+i._rect.height,s=this._worldTransform,a=this._vertices;a[0].x=n*s.a+o*s.c+s.tx,a[0].y=n*s.b+o*s.d+s.ty,a[1].x=n*s.a+c*s.c+s.tx,a[1].y=n*s.b+c*s.d+s.ty,a[2].x=r*s.a+o*s.c+s.tx,a[2].y=r*s.b+o*s.d+s.ty,a[3].x=r*s.a+c*s.c+s.tx,a[3].y=r*s.b+c*s.d+s.ty},t.needDraw=function(){var t=this._node,e=t._texture;return this._needDraw&&e},t.uploadData=function(t,e,i){var n=this._node,r=n._texture;if(!(r&&r._textureLoaded&&n._rect.width&&n._rect.height&&this._displayedOpacity))return!1;var c=this._displayedOpacity,o=this._displayedColor.r,s=this._displayedColor.g,a=this._displayedColor.b;if(n._opacityModifyRGB){var h=c/255;o*=h,s*=h,a*=h}this._color[0]=c<<24|a<<16|s<<8|o;var l,u,_=n._vertexZ,d=this._vertices,f=d.length,p=i;for(l=0;l<f;++l)u=d[l],t[p]=u.x,t[p+1]=u.y,t[p+2]=_,e[p+3]=this._color[0],t[p+4]=u.u,t[p+5]=u.v,p+=6;return f}}(),function(){cc.LabelTTF.WebGLRenderCmd=function(t){cc.Sprite.WebGLRenderCmd.call(this,t),cc.LabelTTF.CacheRenderCmd.call(this)};var t=cc.LabelTTF.WebGLRenderCmd.prototype=Object.create(cc.Sprite.WebGLRenderCmd.prototype);cc.inject(cc.LabelTTF.CacheRenderCmd.prototype,t),t.constructor=cc.LabelTTF.WebGLRenderCmd,t._updateColor=function(){}}(),cc.DrawingPrimitiveWebGL=cc.Class.extend({_renderContext:null,_initialized:!1,_shader:null,_colorLocation:"u_color",_colorArray:null,_pointSizeLocation:"u_pointSize",_pointSize:-1,ctor:function(t){if(null==t&&(t=cc._renderContext),!t instanceof WebGLRenderingContext)throw new Error("Can't initialise DrawingPrimitiveWebGL. context need is WebGLRenderingContext");this._renderContext=t,this._colorArray=new Float32Array([1,1,1,1])},lazy_init:function(){var t=this;t._initialized||(t._shader=cc.shaderCache.programForKey(cc.SHADER_POSITION_UCOLOR),t._shader._addUniformLocation(this._colorLocation),t._shader._addUniformLocation(this._pointSizeLocation),t._initialized=!0)},drawInit:function(){this._initialized=!1},drawPoint:function(t){this.lazy_init();var e=this._renderContext;this._shader.use(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),e.enableVertexAttribArray(cc.VERTEX_ATTRIB_POSITION),this._shader.setUniformLocationWith4fv(this._colorLocation,this._colorArray),this._shader.setUniformLocationWith1f(this._pointSizeLocation,this._pointSize);var i=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,i),e.bufferData(e.ARRAY_BUFFER,new Float32Array([t.x,t.y]),e.STATIC_DRAW),e.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,e.FLOAT,!1,0,0),e.drawArrays(e.POINTS,0,1),e.deleteBuffer(i),cc.incrementGLDraws(1)},drawPoints:function(t,e){if(t&&0!==t.length){this.lazy_init();var i=this._renderContext;this._shader.use(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),i.enableVertexAttribArray(cc.VERTEX_ATTRIB_POSITION),this._shader.setUniformLocationWith4fv(this._colorLocation,this._colorArray),this._shader.setUniformLocationWith1f(this._pointSizeLocation,this._pointSize);var n=i.createBuffer();i.bindBuffer(i.ARRAY_BUFFER,n),i.bufferData(i.ARRAY_BUFFER,this._pointsToTypeArray(t),i.STATIC_DRAW),i.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,i.FLOAT,!1,0,0),i.drawArrays(i.POINTS,0,t.length),i.deleteBuffer(n),cc.incrementGLDraws(1)}},_pointsToTypeArray:function(t){for(var e=new Float32Array(2*t.length),i=0;i<t.length;i++)e[2*i]=t[i].x,e[2*i+1]=t[i].y;return e},drawLine:function(t,e){this.lazy_init();var i=this._renderContext;this._shader.use(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),i.enableVertexAttribArray(cc.VERTEX_ATTRIB_POSITION),this._shader.setUniformLocationWith4fv(this._colorLocation,this._colorArray);var n=i.createBuffer();i.bindBuffer(i.ARRAY_BUFFER,n),i.bufferData(i.ARRAY_BUFFER,this._pointsToTypeArray([t,e]),i.STATIC_DRAW),i.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,i.FLOAT,!1,0,0),i.drawArrays(i.LINES,0,2),i.deleteBuffer(n),cc.incrementGLDraws(1)},drawRect:function(t,e){this.drawLine(cc.p(t.x,t.y),cc.p(e.x,t.y)),this.drawLine(cc.p(e.x,t.y),cc.p(e.x,e.y)),this.drawLine(cc.p(e.x,e.y),cc.p(t.x,e.y)),this.drawLine(cc.p(t.x,e.y),cc.p(t.x,t.y))},drawSolidRect:function(t,e,i){var n=[t,cc.p(e.x,t.y),e,cc.p(t.x,e.y)];this.drawSolidPoly(n,4,i)},drawPoly:function(t,e,i){this.lazy_init();var n=this._renderContext;this._shader.use(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),n.enableVertexAttribArray(cc.VERTEX_ATTRIB_POSITION),this._shader.setUniformLocationWith4fv(this._colorLocation,this._colorArray);var r=n.createBuffer();n.bindBuffer(n.ARRAY_BUFFER,r),n.bufferData(n.ARRAY_BUFFER,this._pointsToTypeArray(t),n.STATIC_DRAW),n.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,n.FLOAT,!1,0,0),i?n.drawArrays(n.LINE_LOOP,0,t.length):n.drawArrays(n.LINE_STRIP,0,t.length),n.deleteBuffer(r),cc.incrementGLDraws(1)},drawSolidPoly:function(t,e,i){this.lazy_init(),i&&this.setDrawColor(i.r,i.g,i.b,i.a);var n=this._renderContext;this._shader.use(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),n.enableVertexAttribArray(cc.VERTEX_ATTRIB_POSITION),this._shader.setUniformLocationWith4fv(this._colorLocation,this._colorArray);var r=n.createBuffer();n.bindBuffer(n.ARRAY_BUFFER,r),n.bufferData(n.ARRAY_BUFFER,this._pointsToTypeArray(t),n.STATIC_DRAW),n.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,n.FLOAT,!1,0,0),n.drawArrays(n.TRIANGLE_FAN,0,t.length),n.deleteBuffer(r),cc.incrementGLDraws(1)},drawCircle:function(t,e,i,n,r){this.lazy_init();var c=1;r&&c++;var o=2*Math.PI/n,s=new Float32Array(2*(n+2));if(s){for(var a=0;a<=n;a++){var h=a*o,l=e*Math.cos(h+i)+t.x,u=e*Math.sin(h+i)+t.y;s[2*a]=l,s[2*a+1]=u}s[2*(n+1)]=t.x,s[2*(n+1)+1]=t.y;var _=this._renderContext;this._shader.use(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),_.enableVertexAttribArray(cc.VERTEX_ATTRIB_POSITION),this._shader.setUniformLocationWith4fv(this._colorLocation,this._colorArray);var d=_.createBuffer();_.bindBuffer(_.ARRAY_BUFFER,d),_.bufferData(_.ARRAY_BUFFER,s,_.STATIC_DRAW),_.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,_.FLOAT,!1,0,0),_.drawArrays(_.LINE_STRIP,0,n+c),_.deleteBuffer(d),cc.incrementGLDraws(1)}},drawQuadBezier:function(t,e,i,n){this.lazy_init();for(var r=new Float32Array(2*(n+1)),c=0,o=0;o<n;o++)r[2*o]=Math.pow(1-c,2)*t.x+2*(1-c)*c*e.x+c*c*i.x,r[2*o+1]=Math.pow(1-c,2)*t.y+2*(1-c)*c*e.y+c*c*i.y,c+=1/n;r[2*n]=i.x,r[2*n+1]=i.y;var s=this._renderContext;this._shader.use(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),s.enableVertexAttribArray(cc.VERTEX_ATTRIB_POSITION),this._shader.setUniformLocationWith4fv(this._colorLocation,this._colorArray);var a=s.createBuffer();s.bindBuffer(s.ARRAY_BUFFER,a),s.bufferData(s.ARRAY_BUFFER,r,s.STATIC_DRAW),s.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,s.FLOAT,!1,0,0),s.drawArrays(s.LINE_STRIP,0,n+1),s.deleteBuffer(a),cc.incrementGLDraws(1)},drawCubicBezier:function(t,e,i,n,r){this.lazy_init();for(var c=new Float32Array(2*(r+1)),o=0,s=0;s<r;s++)c[2*s]=Math.pow(1-o,3)*t.x+3*Math.pow(1-o,2)*o*e.x+3*(1-o)*o*o*i.x+o*o*o*n.x,c[2*s+1]=Math.pow(1-o,3)*t.y+3*Math.pow(1-o,2)*o*e.y+3*(1-o)*o*o*i.y+o*o*o*n.y,o+=1/r;c[2*r]=n.x,c[2*r+1]=n.y;var a=this._renderContext;this._shader.use(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),a.enableVertexAttribArray(cc.VERTEX_ATTRIB_POSITION),this._shader.setUniformLocationWith4fv(this._colorLocation,this._colorArray);var h=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,h),a.bufferData(a.ARRAY_BUFFER,c,a.STATIC_DRAW),a.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,a.FLOAT,!1,0,0),a.drawArrays(a.LINE_STRIP,0,r+1),a.deleteBuffer(h),cc.incrementGLDraws(1)},drawCatmullRom:function(t,e){this.drawCardinalSpline(t,.5,e)},drawCardinalSpline:function(t,e,i){this.lazy_init();for(var n,r,c=new Float32Array(2*(i+1)),o=1/t.length,s=0;s<i+1;s++){var a=s/i;1===a?(n=t.length-1,r=1):(n=0|a/o,r=(a-o*n)/o);var h=cc.cardinalSplineAt(cc.getControlPointAt(t,n-1),cc.getControlPointAt(t,n),cc.getControlPointAt(t,n+1),cc.getControlPointAt(t,n+2),e,r);c[2*s]=h.x,c[2*s+1]=h.y}var l=this._renderContext;this._shader.use(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),l.enableVertexAttribArray(cc.VERTEX_ATTRIB_POSITION),this._shader.setUniformLocationWith4fv(this._colorLocation,this._colorArray);var u=l.createBuffer();l.bindBuffer(l.ARRAY_BUFFER,u),l.bufferData(l.ARRAY_BUFFER,c,l.STATIC_DRAW),l.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,l.FLOAT,!1,0,0),l.drawArrays(l.LINE_STRIP,0,i+1),l.deleteBuffer(u),cc.incrementGLDraws(1)},setDrawColor:function(t,e,i,n){this._colorArray[0]=t/255,this._colorArray[1]=e/255,this._colorArray[2]=i/255,this._colorArray[3]=n/255},setPointSize:function(t){this._pointSize=t*cc.contentScaleFactor()},setLineWidth:function(t){this._renderContext.lineWidth&&this._renderContext.lineWidth(t)}});var _p=cc.inputManager;_p.setAccelerometerEnabled=function(t){var e=this;if(e._accelEnabled!==t){e._accelEnabled=t;var i=cc.director.getScheduler();e._accelEnabled?(e._accelCurTime=0,i.scheduleUpdate(e)):(e._accelCurTime=0,i.scheduleUpdate(e))}},_p.setAccelerometerInterval=function(t){this._accelInterval!==t&&(this._accelInterval=t)},_p._registerKeyboardEvent=function(){cc._canvas.addEventListener("keydown",function(t){cc.eventManager.dispatchEvent(new cc.EventKeyboard(t.keyCode,!0)),t.stopPropagation(),t.preventDefault()},!1),cc._canvas.addEventListener("keyup",function(t){cc.eventManager.dispatchEvent(new cc.EventKeyboard(t.keyCode,!1)),t.stopPropagation(),t.preventDefault()},!1)},_p._registerAccelerometerEvent=function(){var t=window,e=this;e._acceleration=new cc.Acceleration,e._accelDeviceEvent=t.DeviceMotionEvent||t.DeviceOrientationEvent,cc.sys.browserType===cc.sys.BROWSER_TYPE_MOBILE_QQ&&(e._accelDeviceEvent=window.DeviceOrientationEvent);var i=e._accelDeviceEvent===t.DeviceMotionEvent?"devicemotion":"deviceorientation",n=navigator.userAgent;(/Android/.test(n)||/Adr/.test(n)&&cc.sys.browserType===cc.BROWSER_TYPE_UC)&&(e._minus=-1),t.addEventListener(i,e.didAccelerate.bind(e),!1)},_p.didAccelerate=function(t){var e=this,i=window;if(e._accelEnabled){var n,r,c,o=e._acceleration;if(e._accelDeviceEvent===window.DeviceMotionEvent){var s=t.accelerationIncludingGravity;n=e._accelMinus*s.x*.1,r=e._accelMinus*s.y*.1,c=.1*s.z}else n=t.gamma/90*.981,r=.981*-(t.beta/90),c=t.alpha/90*.981;o.x=n,o.y=r,o.z=c,o.timestamp=t.timeStamp||Date.now();var a=o.x;i.orientation===cc.UIInterfaceOrientationLandscapeRight?(o.x=-o.y,o.y=a):i.orientation===cc.UIInterfaceOrientationLandscapeLeft?(o.x=o.y,o.y=-a):i.orientation===cc.UIInterfaceOrientationPortraitUpsideDown&&(o.x=-o.x,o.y=-o.y)}},delete _p,cc.vertexLineToPolygon=function(t,e,i,n,r){if(r+=n,!(r<=1)){e*=.5;for(var c,o=r-1,s=n;s<r;s++){c=2*s;var a,h=cc.p(t[2*s],t[2*s+1]);if(0===s)a=cc.pPerp(cc.pNormalize(cc.pSub(h,cc.p(t[2*(s+1)],t[2*(s+1)+1]))));else if(s===o)a=cc.pPerp(cc.pNormalize(cc.pSub(cc.p(t[2*(s-1)],t[2*(s-1)+1]),h)));else{var l=cc.p(t[2*(s-1)],t[2*(s-1)+1]),u=cc.p(t[2*(s+1)],t[2*(s+1)+1]),_=cc.pNormalize(cc.pSub(u,h)),d=cc.pNormalize(cc.pSub(l,h)),f=Math.acos(cc.pDot(_,d));a=f<cc.degreesToRadians(70)?cc.pPerp(cc.pNormalize(cc.pMidpoint(_,d))):f<cc.degreesToRadians(170)?cc.pNormalize(cc.pMidpoint(_,d)):cc.pPerp(cc.pNormalize(cc.pSub(u,l)))}a=cc.pMult(a,e),i[2*c]=h.x+a.x,i[2*c+1]=h.y+a.y,i[2*(c+1)]=h.x-a.x,i[2*(c+1)+1]=h.y-a.y}for(n=0===n?0:n-1,s=n;s<o;s++){c=2*s;var p=c+2,g=cc.vertex2(i[2*c],i[2*c+1]),m=cc.vertex2(i[2*(c+1)],i[2*(c+1)+1]),v=cc.vertex2(i[2*p],i[2*p]),T=cc.vertex2(i[2*(p+1)],i[2*(p+1)+1]),y=!cc.vertexLineIntersect(g.x,g.y,T.x,T.y,m.x,m.y,v.x,v.y);y.isSuccess||(y.value<0||y.value>1)&&(y.isSuccess=!0),y.isSuccess&&(i[2*p]=T.x,i[2*p+1]=T.y,i[2*(p+1)]=v.x,i[2*(p+1)+1]=v.y)}}},cc.vertexLineIntersect=function(t,e,i,n,r,c,o,s){var a,h,l,u;if(t===i&&e===n||r===o&&c===s)return{isSuccess:!1,value:0};if(i-=t,n-=e,r-=t,c-=e,o-=t,s-=e,a=Math.sqrt(i*i+n*n),h=i/a,l=n/a,u=r*h+c*l,c=c*h-r*l,r=u,u=o*h+s*l,s=s*h-o*l,o=u,c===s)return{isSuccess:!1,value:0};var _=(o+(r-o)*s/(s-c))/a;return{isSuccess:!0,value:_}},cc.vertexListIsClockwise=function(t){for(var e=0,i=t.length;e<i;e++){var n=t[e],r=t[(e+1)%i],c=t[(e+2)%i];if(cc.pCross(cc.pSub(r,n),cc.pSub(c,r))>0)return!1}return!0},cc.CGAffineToGL=function(t,e){e[2]=e[3]=e[6]=e[7]=e[8]=e[9]=e[11]=e[14]=0,e[10]=e[15]=1,e[0]=t.a,e[4]=t.c,e[12]=t.tx,e[1]=t.b,e[5]=t.d,e[13]=t.ty},cc.GLToCGAffine=function(t,e){e.a=t[0],e.c=t[4],e.tx=t[12],e.b=t[1],e.d=t[5],e.ty=t[13]},cc.EventAcceleration=cc.Event.extend({_acc:null,ctor:function(t){cc.Event.prototype.ctor.call(this,cc.Event.ACCELERATION),this._acc=t}}),cc.EventKeyboard=cc.Event.extend({_keyCode:0,_isPressed:!1,ctor:function(t,e){cc.Event.prototype.ctor.call(this,cc.Event.KEYBOARD),this._keyCode=t,this._isPressed=e}}),cc._EventListenerAcceleration=cc.EventListener.extend({_onAccelerationEvent:null,ctor:function(t){this._onAccelerationEvent=t;var e=this,i=function(t){e._onAccelerationEvent(t._acc,t)};cc.EventListener.prototype.ctor.call(this,cc.EventListener.ACCELERATION,cc._EventListenerAcceleration.LISTENER_ID,i)},checkAvailable:function(){return cc.assert(this._onAccelerationEvent,cc._LogInfos._EventListenerAcceleration_checkAvailable),!0},clone:function(){return new cc._EventListenerAcceleration(this._onAccelerationEvent)}}),cc._EventListenerAcceleration.LISTENER_ID="__cc_acceleration",cc._EventListenerAcceleration.create=function(t){return new cc._EventListenerAcceleration(t)},cc._EventListenerKeyboard=cc.EventListener.extend({onKeyPressed:null,onKeyReleased:null,ctor:function(){var t=this,e=function(e){e._isPressed?t.onKeyPressed&&t.onKeyPressed(e._keyCode,e):t.onKeyReleased&&t.onKeyReleased(e._keyCode,e)};cc.EventListener.prototype.ctor.call(this,cc.EventListener.KEYBOARD,cc._EventListenerKeyboard.LISTENER_ID,e)},clone:function(){var t=new cc._EventListenerKeyboard;return t.onKeyPressed=this.onKeyPressed,t.onKeyReleased=this.onKeyReleased,t},checkAvailable:function(){return null!==this.onKeyPressed||null!==this.onKeyReleased||(cc.log(cc._LogInfos._EventListenerKeyboard_checkAvailable),!1)}}),cc._EventListenerKeyboard.LISTENER_ID="__cc_keyboard",cc._EventListenerKeyboard.create=function(){return new cc._EventListenerKeyboard},cc.AtlasNode=cc.Node.extend({textureAtlas:null,quadsToDraw:0,_itemsPerRow:0,_itemsPerColumn:0,_itemWidth:0,_itemHeight:0,_opacityModifyRGB:!1,_blendFunc:null,_ignoreContentScaleFactor:!1,_className:"AtlasNode",_texture:null,_textureForCanvas:null,ctor:function(t,e,i,n){cc.Node.prototype.ctor.call(this),this._blendFunc={src:cc.BLEND_SRC,dst:cc.BLEND_DST},this._ignoreContentScaleFactor=!1,void 0!==n&&this.initWithTileFile(t,e,i,n)},_createRenderCmd:function(){cc._renderType===cc.game.RENDER_TYPE_CANVAS?this._renderCmd=new cc.AtlasNode.CanvasRenderCmd(this):this._renderCmd=new cc.AtlasNode.WebGLRenderCmd(this)},updateAtlasValues:function(){cc.log(cc._LogInfos.AtlasNode_updateAtlasValues)},getColor:function(){return this._opacityModifyRGB?this._renderCmd._colorUnmodified:cc.Node.prototype.getColor.call(this)},setOpacityModifyRGB:function(t){var e=this.color;this._opacityModifyRGB=t,this.setColor(e)},isOpacityModifyRGB:function(){return this._opacityModifyRGB},getBlendFunc:function(){return this._blendFunc},setBlendFunc:function(t,e){void 0===e?this._blendFunc=t:this._blendFunc={src:t,dst:e}},setTextureAtlas:function(t){this.textureAtlas=t},getTextureAtlas:function(){return this.textureAtlas},getQuadsToDraw:function(){return this.quadsToDraw},setQuadsToDraw:function(t){this.quadsToDraw=t},initWithTileFile:function(t,e,i,n){if(!t)throw new Error("cc.AtlasNode.initWithTileFile(): title should not be null");var r=cc.textureCache.addImage(t);return this.initWithTexture(r,e,i,n)},initWithTexture:function(t,e,i,n){return this._renderCmd.initWithTexture(t,e,i,n)},setColor:function(t){this._renderCmd.setColor(t)},setOpacity:function(t){this._renderCmd.setOpacity(t)},getTexture:function(){return this._texture},setTexture:function(t){this._texture=t},_setIgnoreContentScaleFactor:function(t){this._ignoreContentScaleFactor=t}});var _p=cc.AtlasNode.prototype;cc.defineGetterSetter(_p,"opacity",_p.getOpacity,_p.setOpacity),cc.defineGetterSetter(_p,"color",_p.getColor,_p.setColor),_p.texture,cc.defineGetterSetter(_p,"texture",_p.getTexture,_p.setTexture),_p.textureAtlas,_p.quadsToDraw,cc.EventHelper.prototype.apply(_p),cc.AtlasNode.create=function(t,e,i,n){return new cc.AtlasNode(t,e,i,n)},function(){cc.AtlasNode.CanvasRenderCmd=function(t){cc.Node.CanvasRenderCmd.call(this,t),this._needDraw=!1,this._colorUnmodified=cc.color.WHITE,this._textureToRender=null};var t=cc.AtlasNode.CanvasRenderCmd.prototype=Object.create(cc.Node.CanvasRenderCmd.prototype);t.constructor=cc.AtlasNode.CanvasRenderCmd,t.initWithTexture=function(t,e,i,n){var r=this._node;return r._itemWidth=e,r._itemHeight=i,r._opacityModifyRGB=!0,r._texture=t,r._texture?(this._textureToRender=t,this._calculateMaxItems(),r.quadsToDraw=n,!0):(cc.log(cc._LogInfos.AtlasNode__initWithTexture),!1)},t.setColor=function(t){var e=this._node,i=e._realColor;i.r===t.r&&i.g===t.g&&i.b===t.b||(this._colorUnmodified=t,this._changeTextureColor())},t._changeTextureColor=function(){var t=this._node,e=t._texture,i=this._colorUnmodified,n=e.getHtmlElementObj(),r=cc.rect(0,0,n.width,n.height);e===this._textureToRender?this._textureToRender=e._generateColorTexture(i.r,i.g,i.b,r):e._generateColorTexture(i.r,i.g,i.b,r,this._textureToRender.getHtmlElementObj())},t.setOpacity=function(t){var e=this._node;cc.Node.prototype.setOpacity.call(e,t)},t._calculateMaxItems=function(){var t=this._node,e=t._texture,i=e.getContentSize();t._itemsPerColumn=0|i.height/t._itemHeight,t._itemsPerRow=0|i.width/t._itemWidth}}(),cc.TextureAtlas=cc.Class.extend({dirty:!1,texture:null,_indices:null,_buffersVBO:null,_capacity:0,_quads:null,_quadsArrayBuffer:null,_quadsWebBuffer:null,_quadsReader:null,ctor:function(t,e){this._buffersVBO=[],cc.isString(t)?this.initWithFile(t,e):t instanceof cc.Texture2D&&this.initWithTexture(t,e)},getTotalQuads:function(){return this._totalQuads},getCapacity:function(){return this._capacity},getTexture:function(){return this.texture},setTexture:function(t){this.texture=t},setDirty:function(t){this.dirty=t},isDirty:function(){return this.dirty},getQuads:function(){return this._quads},setQuads:function(t){this._quads=t},_copyQuadsToTextureAtlas:function(t,e){if(t)for(var i=0;i<t.length;i++)this._setQuadToArray(t[i],e+i)},_setQuadToArray:function(t,e){var i=this._quads;return i[e]?(i[e].bl=t.bl,i[e].br=t.br,i[e].tl=t.tl,void(i[e].tr=t.tr)):void(i[e]=new cc.V3F_C4B_T2F_Quad(t.tl,t.bl,t.tr,t.br,this._quadsArrayBuffer,e*cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT))},description:function(){return"<cc.TextureAtlas | totalQuads ="+this._totalQuads+">"},_setupIndices:function(){if(0!==this._capacity)for(var t=this._indices,e=this._capacity,i=0;i<e;i++)cc.TEXTURE_ATLAS_USE_TRIANGLE_STRIP?(t[6*i+0]=4*i+0,t[6*i+1]=4*i+0,t[6*i+2]=4*i+2,t[6*i+3]=4*i+1,t[6*i+4]=4*i+3,t[6*i+5]=4*i+3):(t[6*i+0]=4*i+0,t[6*i+1]=4*i+1,t[6*i+2]=4*i+2,t[6*i+3]=4*i+3,t[6*i+4]=4*i+2,t[6*i+5]=4*i+1)},_setupVBO:function(){var t=cc._renderContext;this._buffersVBO[0]=t.createBuffer(),this._buffersVBO[1]=t.createBuffer(),this._quadsWebBuffer=t.createBuffer(),this._mapBuffers()},_mapBuffers:function(){var t=cc._renderContext;t.bindBuffer(t.ARRAY_BUFFER,this._quadsWebBuffer),t.bufferData(t.ARRAY_BUFFER,this._quadsArrayBuffer,t.DYNAMIC_DRAW),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this._buffersVBO[1]),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this._indices,t.STATIC_DRAW)},initWithFile:function(t,e){var i=cc.textureCache.addImage(t);return i?this.initWithTexture(i,e):(cc.log(cc._LogInfos.TextureAtlas_initWithFile,t),!1)},initWithTexture:function(t,e){cc.assert(t,cc._LogInfos.TextureAtlas_initWithTexture),e|=0,this._capacity=e,this._totalQuads=0,this.texture=t,this._quads=[],this._indices=new Uint16Array(6*e);var i=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT;if(this._quadsArrayBuffer=new ArrayBuffer(i*e),this._quadsReader=new Uint8Array(this._quadsArrayBuffer),(!this._quads||!this._indices)&&e>0)return!1;for(var n=this._quads,r=0;r<e;r++)n[r]=new cc.V3F_C4B_T2F_Quad(null,null,null,null,this._quadsArrayBuffer,r*i);return this._setupIndices(),this._setupVBO(),this.dirty=!0,!0},updateQuad:function(t,e){cc.assert(t,cc._LogInfos.TextureAtlas_updateQuad),cc.assert(e>=0&&e<this._capacity,cc._LogInfos.TextureAtlas_updateQuad_2),this._totalQuads=Math.max(e+1,this._totalQuads),this._setQuadToArray(t,e),this.dirty=!0},insertQuad:function(t,e){if(cc.assert(e<this._capacity,cc._LogInfos.TextureAtlas_insertQuad_2),this._totalQuads++,this._totalQuads>this._capacity)return void cc.log(cc._LogInfos.TextureAtlas_insertQuad);var i=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,n=this._totalQuads-1-e,r=e*i,c=n*i;this._quads[this._totalQuads-1]=new cc.V3F_C4B_T2F_Quad(null,null,null,null,this._quadsArrayBuffer,(this._totalQuads-1)*i),this._quadsReader.set(this._quadsReader.subarray(r,r+c),r+i),this._setQuadToArray(t,e),this.dirty=!0},insertQuads:function(t,e,i){i=i||t.length,cc.assert(e+i<=this._capacity,cc._LogInfos.TextureAtlas_insertQuads);var n=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT;if(this._totalQuads+=i,this._totalQuads>this._capacity)return void cc.log(cc._LogInfos.TextureAtlas_insertQuad);var r,c=this._totalQuads-1-e-i,o=e*n,s=c*n,a=this._totalQuads-1-i;for(r=0;r<i;r++)this._quads[a+r]=new cc.V3F_C4B_T2F_Quad(null,null,null,null,this._quadsArrayBuffer,(this._totalQuads-1)*n);for(this._quadsReader.set(this._quadsReader.subarray(o,o+s),o+n*i),
r=0;r<i;r++)this._setQuadToArray(t[r],e+r);this.dirty=!0},insertQuadFromIndex:function(t,e){if(t!==e){cc.assert(e>=0||e<this._totalQuads,cc._LogInfos.TextureAtlas_insertQuadFromIndex),cc.assert(t>=0||t<this._totalQuads,cc._LogInfos.TextureAtlas_insertQuadFromIndex_2);var i,n,r=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,c=this._quadsReader,o=c.subarray(t*r,r);t>e?(i=e*r,n=(t-e)*r,c.set(c.subarray(i,i+n),i+r),c.set(o,i)):(i=(t+1)*r,n=(e-t)*r,c.set(c.subarray(i,i+n),i-r),c.set(o,e*r)),this.dirty=!0}},removeQuadAtIndex:function(t){cc.assert(t<this._totalQuads,cc._LogInfos.TextureAtlas_removeQuadAtIndex);var e=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT;if(this._totalQuads--,this._quads.length=this._totalQuads,t!==this._totalQuads){var i=(t+1)*e,n=(this._totalQuads-t)*e;this._quadsReader.set(this._quadsReader.subarray(i,i+n),i-e)}this.dirty=!0},removeQuadsAtIndex:function(t,e){if(cc.assert(t+e<=this._totalQuads,cc._LogInfos.TextureAtlas_removeQuadsAtIndex),this._totalQuads-=e,t!==this._totalQuads){var i=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,n=(t+e)*i,r=(this._totalQuads-t)*i,c=t*i;this._quadsReader.set(this._quadsReader.subarray(n,n+r),c)}this.dirty=!0},removeAllQuads:function(){this._quads.length=0,this._totalQuads=0},_setDirty:function(t){this.dirty=t},resizeCapacity:function(t){if(t===this._capacity)return!0;var e=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,i=this._capacity;this._totalQuads=Math.min(this._totalQuads,t),this._capacity=0|t;var n,r=this._capacity,c=this._totalQuads;if(null===this._quads)for(this._quads=[],this._quadsArrayBuffer=new ArrayBuffer(e*r),this._quadsReader=new Uint8Array(this._quadsArrayBuffer),n=0;n<r;n++)this._quads=new cc.V3F_C4B_T2F_Quad(null,null,null,null,this._quadsArrayBuffer,n*e);else{var o,s,a=this._quads;if(r>i){for(o=[],s=new ArrayBuffer(e*r),n=0;n<c;n++)o[n]=new cc.V3F_C4B_T2F_Quad(a[n].tl,a[n].bl,a[n].tr,a[n].br,s,n*e);for(;n<r;n++)o[n]=new cc.V3F_C4B_T2F_Quad(null,null,null,null,s,n*e);this._quadsReader=new Uint8Array(s),this._quads=o,this._quadsArrayBuffer=s}else{var h=Math.max(c,r);for(o=[],s=new ArrayBuffer(e*r),n=0;n<h;n++)o[n]=new cc.V3F_C4B_T2F_Quad(a[n].tl,a[n].bl,a[n].tr,a[n].br,s,n*e);this._quadsReader=new Uint8Array(s),this._quads=o,this._quadsArrayBuffer=s}}if(null===this._indices)this._indices=new Uint16Array(6*r);else if(r>i){var l=new Uint16Array(6*r);l.set(this._indices,0),this._indices=l}else this._indices=this._indices.subarray(0,6*r);return this._setupIndices(),this._mapBuffers(),this.dirty=!0,!0},increaseTotalQuadsWith:function(t){this._totalQuads+=t},moveQuadsFromIndex:function(t,e,i){if(void 0===i){if(i=e,e=this._totalQuads-t,cc.assert(i+(this._totalQuads-t)<=this._capacity,cc._LogInfos.TextureAtlas_moveQuadsFromIndex),0===e)return}else if(cc.assert(i+e<=this._totalQuads,cc._LogInfos.TextureAtlas_moveQuadsFromIndex_2),cc.assert(t<this._totalQuads,cc._LogInfos.TextureAtlas_moveQuadsFromIndex_3),t===i)return;var n,r,c=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,o=t*c,s=e*c,a=this._quadsReader,h=a.subarray(o,o+s),l=i*c;i<t?(n=(t-i)*c,r=i*c,a.set(a.subarray(r,r+n),r+s)):(n=(i-t)*c,r=(t+e)*c,a.set(a.subarray(r,r+n),o)),a.set(h,l),this.dirty=!0},fillWithEmptyQuadsFromIndex:function(t,e){for(var i=e*cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,n=new Uint8Array(this._quadsArrayBuffer,t*cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,i),r=0;r<i;r++)n[r]=0},drawQuads:function(){this.drawNumberOfQuads(this._totalQuads,0)},_releaseBuffer:function(){var t=cc._renderContext;this._buffersVBO&&(this._buffersVBO[0]&&t.deleteBuffer(this._buffersVBO[0]),this._buffersVBO[1]&&t.deleteBuffer(this._buffersVBO[1])),this._quadsWebBuffer&&t.deleteBuffer(this._quadsWebBuffer)}});var _p=cc.TextureAtlas.prototype;_p.totalQuads,cc.defineGetterSetter(_p,"totalQuads",_p.getTotalQuads),_p.capacity,cc.defineGetterSetter(_p,"capacity",_p.getCapacity),_p.quads,cc.defineGetterSetter(_p,"quads",_p.getQuads,_p.setQuads),cc.TextureAtlas.create=function(t,e){return new cc.TextureAtlas(t,e)},cc.TextureAtlas.createWithTexture=cc.TextureAtlas.create,cc.game.addEventListener(cc.game.EVENT_RENDERER_INITED,function(){cc._renderType===cc.game.RENDER_TYPE_WEBGL&&(cc.assert(cc.isFunction(cc._tmp.WebGLTextureAtlas),cc._LogInfos.MissingFile,"TexturesWebGL.js"),cc._tmp.WebGLTextureAtlas(),delete cc._tmp.WebGLTextureAtlas)}),cc.assert(cc.isFunction(cc._tmp.PrototypeTextureAtlas),cc._LogInfos.MissingFile,"TexturesPropertyDefine.js"),cc._tmp.PrototypeTextureAtlas(),delete cc._tmp.PrototypeTextureAtlas,cc.PI2=2*Math.PI,cc.DrawingPrimitiveCanvas=cc.Class.extend({_cacheArray:[],_renderContext:null,ctor:function(t){this._renderContext=t},drawPoint:function(t,e){e||(e=1);var i=cc.view.getScaleX(),n=cc.view.getScaleY(),r=cc.p(t.x*i,t.y*n),c=this._renderContext.getContext();c.beginPath(),c.arc(r.x,-r.y,e*i,0,2*Math.PI,!1),c.closePath(),c.fill()},drawPoints:function(t,e,i){if(null!=t){i||(i=1);var n=this._renderContext.getContext(),r=cc.view.getScaleX(),c=cc.view.getScaleY();n.beginPath();for(var o=0,s=t.length;o<s;o++)n.arc(t[o].x*r,-t[o].y*c,i*r,0,2*Math.PI,!1);n.closePath(),n.fill()}},drawLine:function(t,e){var i=this._renderContext.getContext();cc.view.getScaleX(),cc.view.getScaleY();i.beginPath(),i.moveTo(t.x,-t.y),i.lineTo(e.x,-e.y),i.closePath(),i.stroke()},drawRect:function(t,e){this.drawLine(cc.p(t.x,t.y),cc.p(e.x,t.y)),this.drawLine(cc.p(e.x,t.y),cc.p(e.x,e.y)),this.drawLine(cc.p(e.x,e.y),cc.p(t.x,e.y)),this.drawLine(cc.p(t.x,e.y),cc.p(t.x,t.y))},drawSolidRect:function(t,e,i){var n=[t,cc.p(e.x,t.y),e,cc.p(t.x,e.y)];this.drawSolidPoly(n,4,i)},drawPoly:function(t,e,i,n){if(n=n||!1,null!=t){if(t.length<3)throw new Error("Polygon's point must greater than 2");var r=t[0],c=this._renderContext.getContext();cc.view.getScaleX(),cc.view.getScaleY();c.beginPath(),c.moveTo(r.x,-r.y);for(var o=1,s=t.length;o<s;o++)c.lineTo(t[o].x,-t[o].y);i&&c.closePath(),n?c.fill():c.stroke()}},drawSolidPoly:function(t,e,i){this.setDrawColor(i.r,i.g,i.b,i.a),this.drawPoly(t,e,!0,!0)},drawCircle:function(t,e,i,n,r){r=r||!1;var c=this._renderContext.getContext();cc.view.getScaleX(),cc.view.getScaleY();c.beginPath();var o=i-2*Math.PI;c.arc(0|t.x,0|-t.y,e,-i,-o,!1),r&&c.lineTo(0|t.x,0|-t.y),c.stroke()},drawQuadBezier:function(t,e,i,n){var r=this._cacheArray;r.length=0;for(var c=0,o=0;o<n;o++){var s=Math.pow(1-c,2)*t.x+2*(1-c)*c*e.x+c*c*i.x,a=Math.pow(1-c,2)*t.y+2*(1-c)*c*e.y+c*c*i.y;r.push(cc.p(s,a)),c+=1/n}r.push(cc.p(i.x,i.y)),this.drawPoly(r,n+1,!1,!1)},drawCubicBezier:function(t,e,i,n,r){var c=this._cacheArray;c.length=0;for(var o=0,s=0;s<r;s++){var a=Math.pow(1-o,3)*t.x+3*Math.pow(1-o,2)*o*e.x+3*(1-o)*o*o*i.x+o*o*o*n.x,h=Math.pow(1-o,3)*t.y+3*Math.pow(1-o,2)*o*e.y+3*(1-o)*o*o*i.y+o*o*o*n.y;c.push(cc.p(a,h)),o+=1/r}c.push(cc.p(n.x,n.y)),this.drawPoly(c,r+1,!1,!1)},drawCatmullRom:function(t,e){this.drawCardinalSpline(t,.5,e)},drawCardinalSpline:function(t,e,i){cc._renderContext.setStrokeStyle("rgba(255,255,255,1)");var n=this._cacheArray;n.length=0;for(var r,c,o=1/t.length,s=0;s<i+1;s++){var a=s/i;1===a?(r=t.length-1,c=1):(r=0|a/o,c=(a-o*r)/o);var h=cc.CardinalSplineAt(cc.getControlPointAt(t,r-1),cc.getControlPointAt(t,r-0),cc.getControlPointAt(t,r+1),cc.getControlPointAt(t,r+2),e,c);n.push(h)}this.drawPoly(n,i+1,!1,!1)},drawImage:function(t,e,i,n,r){var c=arguments.length,o=this._renderContext.getContext();switch(c){case 2:var s=t.height;o.drawImage(t,e.x,-(e.y+s));break;case 3:o.drawImage(t,e.x,-(e.y+i.height),i.width,i.height);break;case 5:o.drawImage(t,e.x,e.y,i.width,i.height,n.x,-(n.y+r.height),r.width,r.height);break;default:throw new Error("Argument must be non-nil")}},drawStar:function(t,e,i){var n=t||this._renderContext,r=n.getContext(),c="rgba("+(0|i.r)+","+(0|i.g)+","+(0|i.b);n.setFillStyle(c+",1)");var o=e/10;r.beginPath(),r.moveTo(-e,e),r.lineTo(0,o),r.lineTo(e,e),r.lineTo(o,0),r.lineTo(e,-e),r.lineTo(0,-o),r.lineTo(-e,-e),r.lineTo(-o,0),r.lineTo(-e,e),r.closePath(),r.fill();var s=r.createRadialGradient(0,0,o,0,0,e);s.addColorStop(0,c+", 1)"),s.addColorStop(.3,c+", 0.8)"),s.addColorStop(1,c+", 0.0)"),n.setFillStyle(s),r.beginPath();var a=0,h=cc.PI2;r.arc(0,0,e-o,a,h,!1),r.closePath(),r.fill()},drawColorBall:function(t,e,i){var n=t||this._renderContext,r=n.getContext();e*=cc.view.getScaleX();var c="rgba("+(0|i.r)+","+(0|i.g)+","+(0|i.b),o=e/10,s=r.createRadialGradient(0,0,o,0,0,e);s.addColorStop(0,c+", 1)"),s.addColorStop(.3,c+", 0.8)"),s.addColorStop(.6,c+", 0.4)"),s.addColorStop(1,c+", 0.0)"),n.setFillStyle(s),r.beginPath();var a=0,h=cc.PI2;r.arc(0,0,e,a,h,!1),r.closePath(),r.fill()},fillText:function(t,e,i){this._renderContext.getContext().fillText(t,e,-i)},setDrawColor:function(t,e,i,n){this._renderContext.setFillStyle("rgba("+t+","+e+","+i+","+n/255+")"),this._renderContext.setStrokeStyle("rgba("+t+","+e+","+i+","+n/255+")")},setPointSize:function(t){},setLineWidth:function(t){this._renderContext.getContext().lineWidth=t*cc.view.getScaleX()}}),function(){cc.AtlasNode.WebGLRenderCmd=function(t){cc.Node.WebGLRenderCmd.call(this,t),this._needDraw=!0,this._textureAtlas=null,this._colorUnmodified=cc.color.WHITE,this._colorF32Array=null,this._uniformColor=null,this._matrix=new cc.math.Matrix4,this._matrix.identity(),this._shaderProgram=cc.shaderCache.programForKey(cc.SHADER_POSITION_TEXTURE_UCOLOR),this._uniformColor=cc._renderContext.getUniformLocation(this._shaderProgram.getProgram(),"u_color")};var t=cc.AtlasNode.WebGLRenderCmd.prototype=Object.create(cc.Node.WebGLRenderCmd.prototype);t.constructor=cc.AtlasNode.WebGLRenderCmd,t._updateBlendFunc=function(){var t=this._node;this._textureAtlas.texture.hasPremultipliedAlpha()||(t._blendFunc.src=cc.SRC_ALPHA,t._blendFunc.dst=cc.ONE_MINUS_SRC_ALPHA)},t._updateOpacityModifyRGB=function(){this._node._opacityModifyRGB=this._textureAtlas.texture.hasPremultipliedAlpha()},t.rendering=function(t){var e=t||cc._renderContext,i=this._node,n=this._worldTransform;this._matrix.mat[0]=n.a,this._matrix.mat[4]=n.c,this._matrix.mat[12]=n.tx,this._matrix.mat[1]=n.b,this._matrix.mat[5]=n.d,this._matrix.mat[13]=n.ty,this._shaderProgram.use(),this._shaderProgram._setUniformForMVPMatrixWithMat4(this._matrix),cc.glBlendFunc(i._blendFunc.src,i._blendFunc.dst),this._uniformColor&&this._colorF32Array&&(e.uniform4fv(this._uniformColor,this._colorF32Array),this._textureAtlas.drawNumberOfQuads(i.quadsToDraw,0))},t.initWithTexture=function(t,e,i,n){var r=this._node;r._itemWidth=e,r._itemHeight=i,this._colorUnmodified=cc.color.WHITE,r._opacityModifyRGB=!0,r._blendFunc.src=cc.BLEND_SRC,r._blendFunc.dst=cc.BLEND_DST;var c=r._realColor;return this._colorF32Array=new Float32Array([c.r/255,c.g/255,c.b/255,r._realOpacity/255]),this._textureAtlas=new cc.TextureAtlas,this._textureAtlas.initWithTexture(t,n),this._textureAtlas?(this._updateBlendFunc(),this._updateOpacityModifyRGB(),this._calculateMaxItems(),r.quadsToDraw=n,!0):(cc.log(cc._LogInfos.AtlasNode__initWithTexture),!1)},t.setColor=function(t){var e=cc.color(t.r,t.g,t.b),i=this._node;this._colorUnmodified=t;var n=this._displayedOpacity;i._opacityModifyRGB&&(e.r=e.r*n/255,e.g=e.g*n/255,e.b=e.b*n/255),cc.Node.prototype.setColor.call(i,e)},t.setOpacity=function(t){var e=this._node;cc.Node.prototype.setOpacity.call(e,t),e._opacityModifyRGB&&(e.color=this._colorUnmodified)},t._updateColor=function(){if(this._colorF32Array){var t=this._displayedColor;this._colorF32Array[0]=t.r/255,this._colorF32Array[1]=t.g/255,this._colorF32Array[2]=t.b/255,this._colorF32Array[3]=this._displayedOpacity/255}},t.getTexture=function(){return this._textureAtlas.texture},t.setTexture=function(t){this._textureAtlas.texture=t,this._updateBlendFunc(),this._updateOpacityModifyRGB()},t._calculateMaxItems=function(){var t=this._node,e=this._textureAtlas.texture,i=e.getContentSize();t._ignoreContentScaleFactor&&(i=e.getContentSizeInPixels()),t._itemsPerColumn=0|i.height/t._itemHeight,t._itemsPerRow=0|i.width/t._itemWidth}}(),cc.HashElement=cc.Class.extend({actions:null,target:null,actionIndex:0,currentAction:null,currentActionSalvaged:!1,paused:!1,hh:null,ctor:function(){this.actions=[],this.target=null,this.actionIndex=0,this.currentAction=null,this.currentActionSalvaged=!1,this.paused=!1,this.hh=null}}),cc.ActionManager=cc.Class.extend({_hashTargets:null,_arrayTargets:null,_currentTarget:null,_currentTargetSalvaged:!1,_searchElementByTarget:function(t,e){for(var i=0;i<t.length;i++)if(e===t[i].target)return t[i];return null},ctor:function(){this._hashTargets={},this._arrayTargets=[],this._currentTarget=null,this._currentTargetSalvaged=!1},addAction:function(t,e,i){if(!t)throw new Error("cc.ActionManager.addAction(): action must be non-null");if(!e)throw new Error("cc.ActionManager.addAction(): action must be non-null");var n=this._hashTargets[e.__instanceId];n||(n=new cc.HashElement,n.paused=i,n.target=e,this._hashTargets[e.__instanceId]=n,this._arrayTargets.push(n)),this._actionAllocWithHashElement(n),n.actions.push(t),t.startWithTarget(e)},removeAllActions:function(){for(var t=this._arrayTargets,e=0;e<t.length;e++){var i=t[e];i&&this.removeAllActionsFromTarget(i.target,!0)}},removeAllActionsFromTarget:function(t,e){if(null!=t){var i=this._hashTargets[t.__instanceId];i&&(i.actions.indexOf(i.currentAction)===-1||i.currentActionSalvaged||(i.currentActionSalvaged=!0),i.actions.length=0,this._currentTarget!==i||e?this._deleteHashElement(i):this._currentTargetSalvaged=!0)}},removeAction:function(t){if(null!=t){var e=t.getOriginalTarget(),i=this._hashTargets[e.__instanceId];if(i){for(var n=0;n<i.actions.length;n++)if(i.actions[n]===t){i.actions.splice(n,1);break}}else cc.log(cc._LogInfos.ActionManager_removeAction)}},removeActionByTag:function(t,e){t===cc.ACTION_TAG_INVALID&&cc.log(cc._LogInfos.ActionManager_addAction),cc.assert(e,cc._LogInfos.ActionManager_addAction);var i=this._hashTargets[e.__instanceId];if(i)for(var n=i.actions.length,r=0;r<n;++r){var c=i.actions[r];if(c&&c.getTag()===t&&c.getOriginalTarget()===e){this._removeActionAtIndex(r,i);break}}},getActionByTag:function(t,e){t===cc.ACTION_TAG_INVALID&&cc.log(cc._LogInfos.ActionManager_getActionByTag);var i=this._hashTargets[e.__instanceId];if(i){if(null!=i.actions)for(var n=0;n<i.actions.length;++n){var r=i.actions[n];if(r&&r.getTag()===t)return r}cc.log(cc._LogInfos.ActionManager_getActionByTag_2,t)}return null},numberOfRunningActionsInTarget:function(t){var e=this._hashTargets[t.__instanceId];return e&&e.actions?e.actions.length:0},pauseTarget:function(t){var e=this._hashTargets[t.__instanceId];e&&(e.paused=!0)},resumeTarget:function(t){var e=this._hashTargets[t.__instanceId];e&&(e.paused=!1)},pauseAllRunningActions:function(){for(var t=[],e=this._arrayTargets,i=0;i<e.length;i++){var n=e[i];n&&!n.paused&&(n.paused=!0,t.push(n.target))}return t},resumeTargets:function(t){if(t)for(var e=0;e<t.length;e++)t[e]&&this.resumeTarget(t[e])},purgeSharedManager:function(){cc.director.getScheduler().unscheduleUpdate(this)},_removeActionAtIndex:function(t,e){var i=e.actions[t];i!==e.currentAction||e.currentActionSalvaged||(e.currentActionSalvaged=!0),e.actions.splice(t,1),e.actionIndex>=t&&e.actionIndex--,0===e.actions.length&&(this._currentTarget===e?this._currentTargetSalvaged=!0:this._deleteHashElement(e))},_deleteHashElement:function(t){var e=!1;return t&&(this._hashTargets[t.target.__instanceId]&&(delete this._hashTargets[t.target.__instanceId],cc.arrayRemoveObject(this._arrayTargets,t),e=!0),t.actions=null,t.target=null),e},_actionAllocWithHashElement:function(t){null==t.actions&&(t.actions=[])},update:function(t){for(var e,i=this._arrayTargets,n=0;n<i.length;n++){if(this._currentTarget=i[n],e=this._currentTarget,!e.paused)for(e.actionIndex=0;e.actionIndex<(e.actions?e.actions.length:0);e.actionIndex++)if(e.currentAction=e.actions[e.actionIndex],e.currentAction){if(e.currentActionSalvaged=!1,e.currentAction.step(t*(e.currentAction._speedMethod?e.currentAction._speed:1)),e.currentActionSalvaged)e.currentAction=null;else if(e.currentAction.isDone()){e.currentAction.stop();var r=e.currentAction;e.currentAction=null,this.removeAction(r)}e.currentAction=null}this._currentTargetSalvaged&&0===e.actions.length&&this._deleteHashElement(e)&&n--}}}),cc.ACTION_TAG_INVALID=-1,cc.Action=cc.Class.extend({originalTarget:null,target:null,tag:cc.ACTION_TAG_INVALID,ctor:function(){this.originalTarget=null,this.target=null,this.tag=cc.ACTION_TAG_INVALID},copy:function(){return cc.log("copy is deprecated. Please use clone instead."),this.clone()},clone:function(){var t=new cc.Action;return t.originalTarget=null,t.target=null,t.tag=this.tag,t},isDone:function(){return!0},startWithTarget:function(t){this.originalTarget=t,this.target=t},stop:function(){this.target=null},step:function(t){cc.log("[Action step]. override me")},update:function(t){cc.log("[Action update]. override me")},getTarget:function(){return this.target},setTarget:function(t){this.target=t},getOriginalTarget:function(){return this.originalTarget},setOriginalTarget:function(t){this.originalTarget=t},getTag:function(){return this.tag},setTag:function(t){this.tag=t},retain:function(){},release:function(){}}),cc.action=function(){return new cc.Action},cc.Action.create=cc.action,cc.FiniteTimeAction=cc.Action.extend({_duration:0,ctor:function(){cc.Action.prototype.ctor.call(this),this._duration=0},getDuration:function(){return this._duration*(this._timesForRepeat||1)},setDuration:function(t){this._duration=t},reverse:function(){return cc.log("cocos2d: FiniteTimeAction#reverse: Implement me"),null},clone:function(){return new cc.FiniteTimeAction}}),cc.Speed=cc.Action.extend({_speed:0,_innerAction:null,ctor:function(t,e){cc.Action.prototype.ctor.call(this),this._speed=0,this._innerAction=null,t&&this.initWithAction(t,e)},getSpeed:function(){return this._speed},setSpeed:function(t){this._speed=t},initWithAction:function(t,e){if(!t)throw new Error("cc.Speed.initWithAction(): action must be non nil");return this._innerAction=t,this._speed=e,!0},clone:function(){var t=new cc.Speed;return t.initWithAction(this._innerAction.clone(),this._speed),t},startWithTarget:function(t){cc.Action.prototype.startWithTarget.call(this,t),this._innerAction.startWithTarget(t)},stop:function(){this._innerAction.stop(),cc.Action.prototype.stop.call(this)},step:function(t){this._innerAction.step(t*this._speed)},isDone:function(){return this._innerAction.isDone()},reverse:function(){return new cc.Speed(this._innerAction.reverse(),this._speed)},setInnerAction:function(t){this._innerAction!==t&&(this._innerAction=t)},getInnerAction:function(){return this._innerAction}}),cc.speed=function(t,e){return new cc.Speed(t,e)},cc.Speed.create=cc.speed,cc.Follow=cc.Action.extend({_followedNode:null,_boundarySet:!1,_boundaryFullyCovered:!1,_halfScreenSize:null,_fullScreenSize:null,_worldRect:null,leftBoundary:0,rightBoundary:0,topBoundary:0,bottomBoundary:0,ctor:function(t,e){cc.Action.prototype.ctor.call(this),this._followedNode=null,this._boundarySet=!1,this._boundaryFullyCovered=!1,this._halfScreenSize=null,this._fullScreenSize=null,this.leftBoundary=0,this.rightBoundary=0,this.topBoundary=0,this.bottomBoundary=0,this._worldRect=cc.rect(0,0,0,0),t&&(e?this.initWithTarget(t,e):this.initWithTarget(t))},clone:function(){var t=new cc.Follow,e=this._worldRect,i=new cc.Rect(e.x,e.y,e.width,e.height);return t.initWithTarget(this._followedNode,i),t},isBoundarySet:function(){return this._boundarySet},setBoudarySet:function(t){this._boundarySet=t},initWithTarget:function(t,e){if(!t)throw new Error("cc.Follow.initWithAction(): followedNode must be non nil");var i=this;e=e||cc.rect(0,0,0,0),i._followedNode=t,i._worldRect=e,i._boundarySet=!cc._rectEqualToZero(e),i._boundaryFullyCovered=!1;var n=cc.director.getWinSize();return i._fullScreenSize=cc.p(n.width,n.height),i._halfScreenSize=cc.pMult(i._fullScreenSize,.5),i._boundarySet&&(i.leftBoundary=-(e.x+e.width-i._fullScreenSize.x),i.rightBoundary=-e.x,i.topBoundary=-e.y,i.bottomBoundary=-(e.y+e.height-i._fullScreenSize.y),i.rightBoundary<i.leftBoundary&&(i.rightBoundary=i.leftBoundary=(i.leftBoundary+i.rightBoundary)/2),i.topBoundary<i.bottomBoundary&&(i.topBoundary=i.bottomBoundary=(i.topBoundary+i.bottomBoundary)/2),i.topBoundary===i.bottomBoundary&&i.leftBoundary===i.rightBoundary&&(i._boundaryFullyCovered=!0)),!0},step:function(t){var e=this._followedNode.x,i=this._followedNode.y;if(e=this._halfScreenSize.x-e,i=this._halfScreenSize.y-i,this.target._renderCmd._dirtyFlag=0,this._boundarySet){if(this._boundaryFullyCovered)return;this.target.setPosition(cc.clampf(e,this.leftBoundary,this.rightBoundary),cc.clampf(i,this.bottomBoundary,this.topBoundary))}else this.target.setPosition(e,i)},isDone:function(){return!this._followedNode.running},stop:function(){this.target=null,cc.Action.prototype.stop.call(this)}}),cc.follow=function(t,e){return new cc.Follow(t,e)},cc.Follow.create=cc.follow,cc.ActionInterval=cc.FiniteTimeAction.extend({_elapsed:0,_firstTick:!1,_easeList:null,_timesForRepeat:1,_repeatForever:!1,_repeatMethod:!1,_speed:1,_speedMethod:!1,ctor:function(t){this._speed=1,this._timesForRepeat=1,this._repeatForever=!1,this.MAX_VALUE=2,this._repeatMethod=!1,this._speedMethod=!1,cc.FiniteTimeAction.prototype.ctor.call(this),void 0!==t&&this.initWithDuration(t)},getElapsed:function(){return this._elapsed},initWithDuration:function(t){return this._duration=0===t?cc.FLT_EPSILON:t,this._elapsed=0,this._firstTick=!0,!0},isDone:function(){return this._elapsed>=this._duration},_cloneDecoration:function(t){t._repeatForever=this._repeatForever,t._speed=this._speed,t._timesForRepeat=this._timesForRepeat,t._easeList=this._easeList,t._speedMethod=this._speedMethod,t._repeatMethod=this._repeatMethod},_reverseEaseList:function(t){if(this._easeList){t._easeList=[];for(var e=0;e<this._easeList.length;e++)t._easeList.push(this._easeList[e].reverse())}},clone:function(){var t=new cc.ActionInterval(this._duration);return this._cloneDecoration(t),t},easing:function(t){this._easeList?this._easeList.length=0:this._easeList=[];for(var e=0;e<arguments.length;e++)this._easeList.push(arguments[e]);return this},_computeEaseTime:function(t){var e=this._easeList;if(!e||0===e.length)return t;for(var i=0,n=e.length;i<n;i++)t=e[i].easing(t);return t},step:function(t){this._firstTick?(this._firstTick=!1,this._elapsed=0):this._elapsed+=t;var e=this._elapsed/(this._duration>1.192092896e-7?this._duration:1.192092896e-7);e=1>e?e:1,this.update(e>0?e:0),this._repeatMethod&&this._timesForRepeat>1&&this.isDone()&&(this._repeatForever||this._timesForRepeat--,this.startWithTarget(this.target),this.step(this._elapsed-this._duration))},startWithTarget:function(t){cc.Action.prototype.startWithTarget.call(this,t),this._elapsed=0,this._firstTick=!0},reverse:function(){return cc.log("cc.IntervalAction: reverse not implemented."),null},setAmplitudeRate:function(t){cc.log("cc.ActionInterval.setAmplitudeRate(): it should be overridden in subclass.")},getAmplitudeRate:function(){return cc.log("cc.ActionInterval.getAmplitudeRate(): it should be overridden in subclass."),0},speed:function(t){return t<=0?(cc.log("The speed parameter error"),this):(this._speedMethod=!0,this._speed*=t,this)},getSpeed:function(){return this._speed},setSpeed:function(t){return this._speed=t,this},repeat:function(t){return t=Math.round(t),isNaN(t)||t<1?(cc.log("The repeat parameter error"),this):(this._repeatMethod=!0,this._timesForRepeat*=t,this)},repeatForever:function(){return this._repeatMethod=!0,this._timesForRepeat=this.MAX_VALUE,this._repeatForever=!0,this}}),cc.actionInterval=function(t){return new cc.ActionInterval(t)},cc.ActionInterval.create=cc.actionInterval,cc.Sequence=cc.ActionInterval.extend({_actions:null,_split:null,_last:0,ctor:function(t){cc.ActionInterval.prototype.ctor.call(this),this._actions=[];var e=t instanceof Array?t:arguments,i=e.length-1;if(i>=0&&null==e[i]&&cc.log("parameters should not be ending with null in Javascript"),i>=0){for(var n,r=e[0],c=1;c<i;c++)e[c]&&(n=r,r=cc.Sequence._actionOneTwo(n,e[c]));this.initWithTwoActions(r,e[i])}},initWithTwoActions:function(t,e){if(!t||!e)throw new Error("cc.Sequence.initWithTwoActions(): arguments must all be non nil");var i=t._duration+e._duration;return this.initWithDuration(i),this._actions[0]=t,this._actions[1]=e,!0},clone:function(){var t=new cc.Sequence;return this._cloneDecoration(t),t.initWithTwoActions(this._actions[0].clone(),this._actions[1].clone()),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._split=this._actions[0]._duration/this._duration,this._last=-1},stop:function(){this._last!==-1&&this._actions[this._last].stop(),cc.Action.prototype.stop.call(this)},update:function(t){var e,i,n=0,r=this._split,c=this._actions,o=this._last;t=this._computeEaseTime(t),t<r?(e=0!==r?t/r:1,0===n&&1===o&&(c[1].update(0),c[1].stop())):(n=1,e=1===r?1:(t-r)/(1-r),o===-1&&(c[0].startWithTarget(this.target),c[0].update(1),c[0].stop()),o||(c[0].update(1),c[0].stop())),i=c[n],o===n&&i.isDone()||(o!==n&&i.startWithTarget(this.target),e*=i._timesForRepeat,i.update(e>1?e%1:e),this._last=n)},reverse:function(){var t=cc.Sequence._actionOneTwo(this._actions[1].reverse(),this._actions[0].reverse());return this._cloneDecoration(t),this._reverseEaseList(t),t}}),cc.sequence=function(t){var e=t instanceof Array?t:arguments;e.length>0&&null==e[e.length-1]&&cc.log("parameters should not be ending with null in Javascript");for(var i,n,r,c;e&&e.length>0;)for(n=Array.prototype.shift.call(e),c=n._timesForRepeat||1,n._repeatMethod=!1,n._timesForRepeat=1,r=0,i||(i=n,r=1),r;r<c;r++)i=cc.Sequence._actionOneTwo(i,n);return i},cc.Sequence.create=cc.sequence,cc.Sequence._actionOneTwo=function(t,e){var i=new cc.Sequence;return i.initWithTwoActions(t,e),i},cc.Repeat=cc.ActionInterval.extend({_times:0,_total:0,_nextDt:0,_actionInstant:!1,_innerAction:null,ctor:function(t,e){cc.ActionInterval.prototype.ctor.call(this),void 0!==e&&this.initWithAction(t,e)},initWithAction:function(t,e){var i=t._duration*e;return!!this.initWithDuration(i)&&(this._times=e,this._innerAction=t,t instanceof cc.ActionInstant&&(this._actionInstant=!0,this._times-=1),this._total=0,!0)},clone:function(){var t=new cc.Repeat;return this._cloneDecoration(t),t.initWithAction(this._innerAction.clone(),this._times),t},startWithTarget:function(t){this._total=0,this._nextDt=this._innerAction._duration/this._duration,cc.ActionInterval.prototype.startWithTarget.call(this,t),this._innerAction.startWithTarget(t)},stop:function(){this._innerAction.stop(),cc.Action.prototype.stop.call(this)},update:function(t){t=this._computeEaseTime(t);var e=this._innerAction,i=this._duration,n=this._times,r=this._nextDt;if(t>=r){for(;t>r&&this._total<n;)e.update(1),this._total++,e.stop(),e.startWithTarget(this.target),r+=e._duration/i,this._nextDt=r;t>=1&&this._total<n&&this._total++,this._actionInstant||(this._total===n?(e.update(1),e.stop()):e.update(t-(r-e._duration/i)))}else e.update(t*n%1)},isDone:function(){return this._total===this._times},reverse:function(){var t=new cc.Repeat(this._innerAction.reverse(),this._times);return this._cloneDecoration(t),this._reverseEaseList(t),t},setInnerAction:function(t){this._innerAction!==t&&(this._innerAction=t)},getInnerAction:function(){return this._innerAction}}),cc.repeat=function(t,e){return new cc.Repeat(t,e)},cc.Repeat.create=cc.repeat,cc.RepeatForever=cc.ActionInterval.extend({_innerAction:null,ctor:function(t){cc.ActionInterval.prototype.ctor.call(this),this._innerAction=null,t&&this.initWithAction(t)},initWithAction:function(t){if(!t)throw new Error("cc.RepeatForever.initWithAction(): action must be non null");return this._innerAction=t,!0},clone:function(){var t=new cc.RepeatForever;return this._cloneDecoration(t),t.initWithAction(this._innerAction.clone()),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._innerAction.startWithTarget(t)},step:function(t){var e=this._innerAction;e.step(t),e.isDone()&&(e.startWithTarget(this.target),e.step(e.getElapsed()-e._duration))},isDone:function(){return!1},reverse:function(){var t=new cc.RepeatForever(this._innerAction.reverse());return this._cloneDecoration(t),this._reverseEaseList(t),t},setInnerAction:function(t){this._innerAction!==t&&(this._innerAction=t)},getInnerAction:function(){return this._innerAction}}),cc.repeatForever=function(t){return new cc.RepeatForever(t)},cc.RepeatForever.create=cc.repeatForever,cc.Spawn=cc.ActionInterval.extend({_one:null,_two:null,ctor:function(t){cc.ActionInterval.prototype.ctor.call(this),this._one=null,this._two=null;var e=t instanceof Array?t:arguments,i=e.length-1;if(i>=0&&null==e[i]&&cc.log("parameters should not be ending with null in Javascript"),i>=0){for(var n,r=e[0],c=1;c<i;c++)e[c]&&(n=r,r=cc.Spawn._actionOneTwo(n,e[c]));this.initWithTwoActions(r,e[i])}},initWithTwoActions:function(t,e){if(!t||!e)throw new Error("cc.Spawn.initWithTwoActions(): arguments must all be non null");var i=!1,n=t._duration,r=e._duration;return this.initWithDuration(Math.max(n,r))&&(this._one=t,this._two=e,n>r?this._two=cc.Sequence._actionOneTwo(e,cc.delayTime(n-r)):n<r&&(this._one=cc.Sequence._actionOneTwo(t,cc.delayTime(r-n))),i=!0),i},clone:function(){var t=new cc.Spawn;return this._cloneDecoration(t),t.initWithTwoActions(this._one.clone(),this._two.clone()),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._one.startWithTarget(t),this._two.startWithTarget(t)},stop:function(){this._one.stop(),this._two.stop(),cc.Action.prototype.stop.call(this)},update:function(t){t=this._computeEaseTime(t),this._one&&this._one.update(t),this._two&&this._two.update(t)},reverse:function(){var t=cc.Spawn._actionOneTwo(this._one.reverse(),this._two.reverse());return this._cloneDecoration(t),this._reverseEaseList(t),t}}),cc.spawn=function(t){var e=t instanceof Array?t:arguments;e.length>0&&null==e[e.length-1]&&cc.log("parameters should not be ending with null in Javascript");for(var i=e[0],n=1;n<e.length;n++)null!=e[n]&&(i=cc.Spawn._actionOneTwo(i,e[n]));return i},cc.Spawn.create=cc.spawn,cc.Spawn._actionOneTwo=function(t,e){var i=new cc.Spawn;return i.initWithTwoActions(t,e),i},cc.RotateTo=cc.ActionInterval.extend({_dstAngleX:0,_startAngleX:0,_diffAngleX:0,_dstAngleY:0,_startAngleY:0,_diffAngleY:0,ctor:function(t,e,i){cc.ActionInterval.prototype.ctor.call(this),void 0!==e&&this.initWithDuration(t,e,i)},initWithDuration:function(t,e,i){return!!cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(this._dstAngleX=e||0,this._dstAngleY=i||this._dstAngleX,!0)},clone:function(){var t=new cc.RotateTo;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._dstAngleX,this._dstAngleY),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t);var e=t.rotationX%360,i=this._dstAngleX-e;i>180&&(i-=360),i<-180&&(i+=360),this._startAngleX=e,this._diffAngleX=i,this._startAngleY=t.rotationY%360;var n=this._dstAngleY-this._startAngleY;n>180&&(n-=360),n<-180&&(n+=360),this._diffAngleY=n},reverse:function(){cc.log("cc.RotateTo.reverse(): it should be overridden in subclass.")},update:function(t){t=this._computeEaseTime(t),this.target&&(this.target.rotationX=this._startAngleX+this._diffAngleX*t,this.target.rotationY=this._startAngleY+this._diffAngleY*t)}}),cc.rotateTo=function(t,e,i){return new cc.RotateTo(t,e,i)},cc.RotateTo.create=cc.rotateTo,cc.RotateBy=cc.ActionInterval.extend({_angleX:0,_startAngleX:0,_angleY:0,_startAngleY:0,ctor:function(t,e,i){cc.ActionInterval.prototype.ctor.call(this),void 0!==e&&this.initWithDuration(t,e,i)},initWithDuration:function(t,e,i){return!!cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(this._angleX=e||0,this._angleY=i||this._angleX,!0)},clone:function(){var t=new cc.RotateBy;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._angleX,this._angleY),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._startAngleX=t.rotationX,this._startAngleY=t.rotationY},update:function(t){t=this._computeEaseTime(t),this.target&&(this.target.rotationX=this._startAngleX+this._angleX*t,
this.target.rotationY=this._startAngleY+this._angleY*t)},reverse:function(){var t=new cc.RotateBy(this._duration,-this._angleX,-this._angleY);return this._cloneDecoration(t),this._reverseEaseList(t),t}}),cc.rotateBy=function(t,e,i){return new cc.RotateBy(t,e,i)},cc.RotateBy.create=cc.rotateBy,cc.MoveBy=cc.ActionInterval.extend({_positionDelta:null,_startPosition:null,_previousPosition:null,ctor:function(t,e,i){cc.ActionInterval.prototype.ctor.call(this),this._positionDelta=cc.p(0,0),this._startPosition=cc.p(0,0),this._previousPosition=cc.p(0,0),void 0!==e&&this.initWithDuration(t,e,i)},initWithDuration:function(t,e,i){return!!cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(void 0!==e.x&&(i=e.y,e=e.x),this._positionDelta.x=e,this._positionDelta.y=i,!0)},clone:function(){var t=new cc.MoveBy;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._positionDelta),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t);var e=t.getPositionX(),i=t.getPositionY();this._previousPosition.x=e,this._previousPosition.y=i,this._startPosition.x=e,this._startPosition.y=i},update:function(t){if(t=this._computeEaseTime(t),this.target){var e=this._positionDelta.x*t,i=this._positionDelta.y*t,n=this._startPosition;if(cc.ENABLE_STACKABLE_ACTIONS){var r=this.target.getPositionX(),c=this.target.getPositionY(),o=this._previousPosition;n.x=n.x+r-o.x,n.y=n.y+c-o.y,e+=n.x,i+=n.y,o.x=e,o.y=i,this.target.setPosition(e,i)}else this.target.setPosition(n.x+e,n.y+i)}},reverse:function(){var t=new cc.MoveBy(this._duration,cc.p(-this._positionDelta.x,-this._positionDelta.y));return this._cloneDecoration(t),this._reverseEaseList(t),t}}),cc.moveBy=function(t,e,i){return new cc.MoveBy(t,e,i)},cc.MoveBy.create=cc.moveBy,cc.MoveTo=cc.MoveBy.extend({_endPosition:null,ctor:function(t,e,i){cc.MoveBy.prototype.ctor.call(this),this._endPosition=cc.p(0,0),void 0!==e&&this.initWithDuration(t,e,i)},initWithDuration:function(t,e,i){return!!cc.MoveBy.prototype.initWithDuration.call(this,t,e,i)&&(void 0!==e.x&&(i=e.y,e=e.x),this._endPosition.x=e,this._endPosition.y=i,!0)},clone:function(){var t=new cc.MoveTo;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._endPosition),t},startWithTarget:function(t){cc.MoveBy.prototype.startWithTarget.call(this,t),this._positionDelta.x=this._endPosition.x-t.getPositionX(),this._positionDelta.y=this._endPosition.y-t.getPositionY()}}),cc.moveTo=function(t,e,i){return new cc.MoveTo(t,e,i)},cc.MoveTo.create=cc.moveTo,cc.SkewTo=cc.ActionInterval.extend({_skewX:0,_skewY:0,_startSkewX:0,_startSkewY:0,_endSkewX:0,_endSkewY:0,_deltaX:0,_deltaY:0,ctor:function(t,e,i){cc.ActionInterval.prototype.ctor.call(this),void 0!==i&&this.initWithDuration(t,e,i)},initWithDuration:function(t,e,i){var n=!1;return cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(this._endSkewX=e,this._endSkewY=i,n=!0),n},clone:function(){var t=new cc.SkewTo;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._endSkewX,this._endSkewY),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._startSkewX=t.skewX%180,this._deltaX=this._endSkewX-this._startSkewX,this._deltaX>180&&(this._deltaX-=360),this._deltaX<-180&&(this._deltaX+=360),this._startSkewY=t.skewY%360,this._deltaY=this._endSkewY-this._startSkewY,this._deltaY>180&&(this._deltaY-=360),this._deltaY<-180&&(this._deltaY+=360)},update:function(t){t=this._computeEaseTime(t),this.target.skewX=this._startSkewX+this._deltaX*t,this.target.skewY=this._startSkewY+this._deltaY*t}}),cc.skewTo=function(t,e,i){return new cc.SkewTo(t,e,i)},cc.SkewTo.create=cc.skewTo,cc.SkewBy=cc.SkewTo.extend({ctor:function(t,e,i){cc.SkewTo.prototype.ctor.call(this),void 0!==i&&this.initWithDuration(t,e,i)},initWithDuration:function(t,e,i){var n=!1;return cc.SkewTo.prototype.initWithDuration.call(this,t,e,i)&&(this._skewX=e,this._skewY=i,n=!0),n},clone:function(){var t=new cc.SkewBy;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._skewX,this._skewY),t},startWithTarget:function(t){cc.SkewTo.prototype.startWithTarget.call(this,t),this._deltaX=this._skewX,this._deltaY=this._skewY,this._endSkewX=this._startSkewX+this._deltaX,this._endSkewY=this._startSkewY+this._deltaY},reverse:function(){var t=new cc.SkewBy(this._duration,-this._skewX,-this._skewY);return this._cloneDecoration(t),this._reverseEaseList(t),t}}),cc.skewBy=function(t,e,i){return new cc.SkewBy(t,e,i)},cc.SkewBy.create=cc.skewBy,cc.JumpBy=cc.ActionInterval.extend({_startPosition:null,_delta:null,_height:0,_jumps:0,_previousPosition:null,ctor:function(t,e,i,n,r){cc.ActionInterval.prototype.ctor.call(this),this._startPosition=cc.p(0,0),this._previousPosition=cc.p(0,0),this._delta=cc.p(0,0),void 0!==n&&this.initWithDuration(t,e,i,n,r)},initWithDuration:function(t,e,i,n,r){return!!cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(void 0===r&&(r=n,n=i,i=e.y,e=e.x),this._delta.x=e,this._delta.y=i,this._height=n,this._jumps=r,!0)},clone:function(){var t=new cc.JumpBy;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._delta,this._height,this._jumps),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t);var e=t.getPositionX(),i=t.getPositionY();this._previousPosition.x=e,this._previousPosition.y=i,this._startPosition.x=e,this._startPosition.y=i},update:function(t){if(t=this._computeEaseTime(t),this.target){var e=t*this._jumps%1,i=4*this._height*e*(1-e);i+=this._delta.y*t;var n=this._delta.x*t,r=this._startPosition;if(cc.ENABLE_STACKABLE_ACTIONS){var c=this.target.getPositionX(),o=this.target.getPositionY(),s=this._previousPosition;r.x=r.x+c-s.x,r.y=r.y+o-s.y,n+=r.x,i+=r.y,s.x=n,s.y=i,this.target.setPosition(n,i)}else this.target.setPosition(r.x+n,r.y+i)}},reverse:function(){var t=new cc.JumpBy(this._duration,cc.p(-this._delta.x,-this._delta.y),this._height,this._jumps);return this._cloneDecoration(t),this._reverseEaseList(t),t}}),cc.jumpBy=function(t,e,i,n,r){return new cc.JumpBy(t,e,i,n,r)},cc.JumpBy.create=cc.jumpBy,cc.JumpTo=cc.JumpBy.extend({_endPosition:null,ctor:function(t,e,i,n,r){cc.JumpBy.prototype.ctor.call(this),this._endPosition=cc.p(0,0),void 0!==n&&this.initWithDuration(t,e,i,n,r)},initWithDuration:function(t,e,i,n,r){return!!cc.JumpBy.prototype.initWithDuration.call(this,t,e,i,n,r)&&(void 0===r&&(i=e.y,e=e.x),this._endPosition.x=e,this._endPosition.y=i,!0)},startWithTarget:function(t){cc.JumpBy.prototype.startWithTarget.call(this,t),this._delta.x=this._endPosition.x-this._startPosition.x,this._delta.y=this._endPosition.y-this._startPosition.y},clone:function(){var t=new cc.JumpTo;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._endPosition,this._height,this._jumps),t}}),cc.jumpTo=function(t,e,i,n,r){return new cc.JumpTo(t,e,i,n,r)},cc.JumpTo.create=cc.jumpTo,cc.bezierAt=function(t,e,i,n,r){return Math.pow(1-r,3)*t+3*r*Math.pow(1-r,2)*e+3*Math.pow(r,2)*(1-r)*i+Math.pow(r,3)*n},cc.BezierBy=cc.ActionInterval.extend({_config:null,_startPosition:null,_previousPosition:null,ctor:function(t,e){cc.ActionInterval.prototype.ctor.call(this),this._config=[],this._startPosition=cc.p(0,0),this._previousPosition=cc.p(0,0),e&&this.initWithDuration(t,e)},initWithDuration:function(t,e){return!!cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(this._config=e,!0)},clone:function(){var t=new cc.BezierBy;this._cloneDecoration(t);for(var e=[],i=0;i<this._config.length;i++){var n=this._config[i];e.push(cc.p(n.x,n.y))}return t.initWithDuration(this._duration,e),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t);var e=t.getPositionX(),i=t.getPositionY();this._previousPosition.x=e,this._previousPosition.y=i,this._startPosition.x=e,this._startPosition.y=i},update:function(t){if(t=this._computeEaseTime(t),this.target){var e=this._config,i=0,n=e[0].x,r=e[1].x,c=e[2].x,o=0,s=e[0].y,a=e[1].y,h=e[2].y,l=cc.bezierAt(i,n,r,c,t),u=cc.bezierAt(o,s,a,h,t),_=this._startPosition;if(cc.ENABLE_STACKABLE_ACTIONS){var d=this.target.getPositionX(),f=this.target.getPositionY(),p=this._previousPosition;_.x=_.x+d-p.x,_.y=_.y+f-p.y,l+=_.x,u+=_.y,p.x=l,p.y=u,this.target.setPosition(l,u)}else this.target.setPosition(_.x+l,_.y+u)}},reverse:function(){var t=this._config,e=[cc.pAdd(t[1],cc.pNeg(t[2])),cc.pAdd(t[0],cc.pNeg(t[2])),cc.pNeg(t[2])],i=new cc.BezierBy(this._duration,e);return this._cloneDecoration(i),this._reverseEaseList(i),i}}),cc.bezierBy=function(t,e){return new cc.BezierBy(t,e)},cc.BezierBy.create=cc.bezierBy,cc.BezierTo=cc.BezierBy.extend({_toConfig:null,ctor:function(t,e){cc.BezierBy.prototype.ctor.call(this),this._toConfig=[],e&&this.initWithDuration(t,e)},initWithDuration:function(t,e){return!!cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(this._toConfig=e,!0)},clone:function(){var t=new cc.BezierTo;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._toConfig),t},startWithTarget:function(t){cc.BezierBy.prototype.startWithTarget.call(this,t);var e=this._startPosition,i=this._toConfig,n=this._config;n[0]=cc.pSub(i[0],e),n[1]=cc.pSub(i[1],e),n[2]=cc.pSub(i[2],e)}}),cc.bezierTo=function(t,e){return new cc.BezierTo(t,e)},cc.BezierTo.create=cc.bezierTo,cc.ScaleTo=cc.ActionInterval.extend({_scaleX:1,_scaleY:1,_startScaleX:1,_startScaleY:1,_endScaleX:0,_endScaleY:0,_deltaX:0,_deltaY:0,ctor:function(t,e,i){cc.ActionInterval.prototype.ctor.call(this),void 0!==e&&this.initWithDuration(t,e,i)},initWithDuration:function(t,e,i){return!!cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(this._endScaleX=e,this._endScaleY=null!=i?i:e,!0)},clone:function(){var t=new cc.ScaleTo;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._endScaleX,this._endScaleY),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._startScaleX=t.scaleX,this._startScaleY=t.scaleY,this._deltaX=this._endScaleX-this._startScaleX,this._deltaY=this._endScaleY-this._startScaleY},update:function(t){t=this._computeEaseTime(t),this.target&&(this.target.scaleX=this._startScaleX+this._deltaX*t,this.target.scaleY=this._startScaleY+this._deltaY*t)}}),cc.scaleTo=function(t,e,i){return new cc.ScaleTo(t,e,i)},cc.ScaleTo.create=cc.scaleTo,cc.ScaleBy=cc.ScaleTo.extend({startWithTarget:function(t){cc.ScaleTo.prototype.startWithTarget.call(this,t),this._deltaX=this._startScaleX*this._endScaleX-this._startScaleX,this._deltaY=this._startScaleY*this._endScaleY-this._startScaleY},reverse:function(){var t=new cc.ScaleBy(this._duration,1/this._endScaleX,1/this._endScaleY);return this._cloneDecoration(t),this._reverseEaseList(t),t},clone:function(){var t=new cc.ScaleBy;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._endScaleX,this._endScaleY),t}}),cc.scaleBy=function(t,e,i){return new cc.ScaleBy(t,e,i)},cc.ScaleBy.create=cc.scaleBy,cc.Blink=cc.ActionInterval.extend({_times:0,_originalState:!1,ctor:function(t,e){cc.ActionInterval.prototype.ctor.call(this),void 0!==e&&this.initWithDuration(t,e)},initWithDuration:function(t,e){return!!cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(this._times=e,!0)},clone:function(){var t=new cc.Blink;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._times),t},update:function(t){if(t=this._computeEaseTime(t),this.target&&!this.isDone()){var e=1/this._times,i=t%e;this.target.visible=i>e/2}},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._originalState=t.visible},stop:function(){this.target.visible=this._originalState,cc.ActionInterval.prototype.stop.call(this)},reverse:function(){var t=new cc.Blink(this._duration,this._times);return this._cloneDecoration(t),this._reverseEaseList(t),t}}),cc.blink=function(t,e){return new cc.Blink(t,e)},cc.Blink.create=cc.blink,cc.FadeTo=cc.ActionInterval.extend({_toOpacity:0,_fromOpacity:0,ctor:function(t,e){cc.ActionInterval.prototype.ctor.call(this),void 0!==e&&this.initWithDuration(t,e)},initWithDuration:function(t,e){return!!cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(this._toOpacity=e,!0)},clone:function(){var t=new cc.FadeTo;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._toOpacity),t},update:function(t){t=this._computeEaseTime(t);var e=void 0!==this._fromOpacity?this._fromOpacity:255;this.target.opacity=e+(this._toOpacity-e)*t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._fromOpacity=t.opacity}}),cc.fadeTo=function(t,e){return new cc.FadeTo(t,e)},cc.FadeTo.create=cc.fadeTo,cc.FadeIn=cc.FadeTo.extend({_reverseAction:null,ctor:function(t){cc.FadeTo.prototype.ctor.call(this),null==t&&(t=0),this.initWithDuration(t,255)},reverse:function(){var t=new cc.FadeOut;return t.initWithDuration(this._duration,0),this._cloneDecoration(t),this._reverseEaseList(t),t},clone:function(){var t=new cc.FadeIn;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._toOpacity),t},startWithTarget:function(t){this._reverseAction&&(this._toOpacity=this._reverseAction._fromOpacity),cc.FadeTo.prototype.startWithTarget.call(this,t)}}),cc.fadeIn=function(t){return new cc.FadeIn(t)},cc.FadeIn.create=cc.fadeIn,cc.FadeOut=cc.FadeTo.extend({ctor:function(t){cc.FadeTo.prototype.ctor.call(this),null==t&&(t=0),this.initWithDuration(t,0)},reverse:function(){var t=new cc.FadeIn;return t._reverseAction=this,t.initWithDuration(this._duration,255),this._cloneDecoration(t),this._reverseEaseList(t),t},clone:function(){var t=new cc.FadeOut;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._toOpacity),t}}),cc.fadeOut=function(t){return new cc.FadeOut(t)},cc.FadeOut.create=cc.fadeOut,cc.TintTo=cc.ActionInterval.extend({_to:null,_from:null,ctor:function(t,e,i,n){cc.ActionInterval.prototype.ctor.call(this),this._to=cc.color(0,0,0),this._from=cc.color(0,0,0),void 0!==n&&this.initWithDuration(t,e,i,n)},initWithDuration:function(t,e,i,n){return!!cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(this._to=cc.color(e,i,n),!0)},clone:function(){var t=new cc.TintTo;this._cloneDecoration(t);var e=this._to;return t.initWithDuration(this._duration,e.r,e.g,e.b),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._from=this.target.color},update:function(t){t=this._computeEaseTime(t);var e=this._from,i=this._to;e&&this.target.setColor(cc.color(e.r+(i.r-e.r)*t,e.g+(i.g-e.g)*t,e.b+(i.b-e.b)*t))}}),cc.tintTo=function(t,e,i,n){return new cc.TintTo(t,e,i,n)},cc.TintTo.create=cc.tintTo,cc.TintBy=cc.ActionInterval.extend({_deltaR:0,_deltaG:0,_deltaB:0,_fromR:0,_fromG:0,_fromB:0,ctor:function(t,e,i,n){cc.ActionInterval.prototype.ctor.call(this),void 0!==n&&this.initWithDuration(t,e,i,n)},initWithDuration:function(t,e,i,n){return!!cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(this._deltaR=e,this._deltaG=i,this._deltaB=n,!0)},clone:function(){var t=new cc.TintBy;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._deltaR,this._deltaG,this._deltaB),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t);var e=t.color;this._fromR=e.r,this._fromG=e.g,this._fromB=e.b},update:function(t){t=this._computeEaseTime(t),this.target.color=cc.color(this._fromR+this._deltaR*t,this._fromG+this._deltaG*t,this._fromB+this._deltaB*t)},reverse:function(){var t=new cc.TintBy(this._duration,-this._deltaR,-this._deltaG,-this._deltaB);return this._cloneDecoration(t),this._reverseEaseList(t),t}}),cc.tintBy=function(t,e,i,n){return new cc.TintBy(t,e,i,n)},cc.TintBy.create=cc.tintBy,cc.DelayTime=cc.ActionInterval.extend({update:function(t){},reverse:function(){var t=new cc.DelayTime(this._duration);return this._cloneDecoration(t),this._reverseEaseList(t),t},clone:function(){var t=new cc.DelayTime;return this._cloneDecoration(t),t.initWithDuration(this._duration),t}}),cc.delayTime=function(t){return new cc.DelayTime(t)},cc.DelayTime.create=cc.delayTime,cc.ReverseTime=cc.ActionInterval.extend({_other:null,ctor:function(t){cc.ActionInterval.prototype.ctor.call(this),this._other=null,t&&this.initWithAction(t)},initWithAction:function(t){if(!t)throw new Error("cc.ReverseTime.initWithAction(): action must be non null");if(t===this._other)throw new Error("cc.ReverseTime.initWithAction(): the action was already passed in.");return!!cc.ActionInterval.prototype.initWithDuration.call(this,t._duration)&&(this._other=t,!0)},clone:function(){var t=new cc.ReverseTime;return this._cloneDecoration(t),t.initWithAction(this._other.clone()),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._other.startWithTarget(t)},update:function(t){t=this._computeEaseTime(t),this._other&&this._other.update(1-t)},reverse:function(){return this._other.clone()},stop:function(){this._other.stop(),cc.Action.prototype.stop.call(this)}}),cc.reverseTime=function(t){return new cc.ReverseTime(t)},cc.ReverseTime.create=cc.reverseTime,cc.Animate=cc.ActionInterval.extend({_animation:null,_nextFrame:0,_origFrame:null,_executedLoops:0,_splitTimes:null,_currFrameIndex:0,ctor:function(t){cc.ActionInterval.prototype.ctor.call(this),this._splitTimes=[],t&&this.initWithAnimation(t)},getAnimation:function(){return this._animation},setAnimation:function(t){this._animation=t},getCurrentFrameIndex:function(){return this._currFrameIndex},initWithAnimation:function(t){if(!t)throw new Error("cc.Animate.initWithAnimation(): animation must be non-NULL");var e=t.getDuration();if(this.initWithDuration(e*t.getLoops())){this._nextFrame=0,this.setAnimation(t),this._origFrame=null,this._executedLoops=0;var i=this._splitTimes;i.length=0;var n=0,r=e/t.getTotalDelayUnits(),c=t.getFrames();cc.arrayVerifyType(c,cc.AnimationFrame);for(var o=0;o<c.length;o++){var s=c[o],a=n*r/e;n+=s.getDelayUnits(),i.push(a)}return!0}return!1},clone:function(){var t=new cc.Animate;return this._cloneDecoration(t),t.initWithAnimation(this._animation.clone()),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._animation.getRestoreOriginalFrame()&&(this._origFrame=t.displayFrame()),this._nextFrame=0,this._executedLoops=0},update:function(t){if(t=this._computeEaseTime(t),t<1){t*=this._animation.getLoops();var e=0|t;e>this._executedLoops&&(this._nextFrame=0,this._executedLoops++),t%=1}for(var i=this._animation.getFrames(),n=i.length,r=this._splitTimes,c=this._nextFrame;c<n&&r[c]<=t;c++)_currFrameIndex=c,this.target.setSpriteFrame(i[_currFrameIndex].getSpriteFrame()),this._nextFrame=c+1},reverse:function(){var t=this._animation,e=t.getFrames(),i=[];if(cc.arrayVerifyType(e,cc.AnimationFrame),e.length>0)for(var n=e.length-1;n>=0;n--){var r=e[n];if(!r)break;i.push(r.clone())}var c=new cc.Animation(i,t.getDelayPerUnit(),t.getLoops());c.setRestoreOriginalFrame(t.getRestoreOriginalFrame());var o=new cc.Animate(c);return this._cloneDecoration(o),this._reverseEaseList(o),o},stop:function(){this._animation.getRestoreOriginalFrame()&&this.target&&this.target.setSpriteFrame(this._origFrame),cc.Action.prototype.stop.call(this)}}),cc.animate=function(t){return new cc.Animate(t)},cc.Animate.create=cc.animate,cc.TargetedAction=cc.ActionInterval.extend({_action:null,_forcedTarget:null,ctor:function(t,e){cc.ActionInterval.prototype.ctor.call(this),e&&this.initWithTarget(t,e)},initWithTarget:function(t,e){return!!this.initWithDuration(e._duration)&&(this._forcedTarget=t,this._action=e,!0)},clone:function(){var t=new cc.TargetedAction;return this._cloneDecoration(t),t.initWithTarget(this._forcedTarget,this._action.clone()),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._action.startWithTarget(this._forcedTarget)},stop:function(){this._action.stop()},update:function(t){t=this._computeEaseTime(t),this._action.update(t)},getForcedTarget:function(){return this._forcedTarget},setForcedTarget:function(t){this._forcedTarget!==t&&(this._forcedTarget=t)}}),cc.targetedAction=function(t,e){return new cc.TargetedAction(t,e)},cc.TargetedAction.create=cc.targetedAction,cc.ActionInstant=cc.FiniteTimeAction.extend({isDone:function(){return!0},step:function(t){this.update(1)},update:function(t){},reverse:function(){return this.clone()},clone:function(){return new cc.ActionInstant}}),cc.Show=cc.ActionInstant.extend({update:function(t){this.target.visible=!0},reverse:function(){return new cc.Hide},clone:function(){return new cc.Show}}),cc.show=function(){return new cc.Show},cc.Show.create=cc.show,cc.Hide=cc.ActionInstant.extend({update:function(t){this.target.visible=!1},reverse:function(){return new cc.Show},clone:function(){return new cc.Hide}}),cc.hide=function(){return new cc.Hide},cc.Hide.create=cc.hide,cc.ToggleVisibility=cc.ActionInstant.extend({update:function(t){this.target.visible=!this.target.visible},reverse:function(){return new cc.ToggleVisibility},clone:function(){return new cc.ToggleVisibility}}),cc.toggleVisibility=function(){return new cc.ToggleVisibility},cc.ToggleVisibility.create=cc.toggleVisibility,cc.RemoveSelf=cc.ActionInstant.extend({_isNeedCleanUp:!0,ctor:function(t){cc.FiniteTimeAction.prototype.ctor.call(this),void 0!==t&&this.init(t)},update:function(t){this.target.removeFromParent(this._isNeedCleanUp)},init:function(t){return this._isNeedCleanUp=t,!0},reverse:function(){return new cc.RemoveSelf(this._isNeedCleanUp)},clone:function(){return new cc.RemoveSelf(this._isNeedCleanUp)}}),cc.removeSelf=function(t){return new cc.RemoveSelf(t)},cc.RemoveSelf.create=cc.removeSelf,cc.FlipX=cc.ActionInstant.extend({_flippedX:!1,ctor:function(t){cc.FiniteTimeAction.prototype.ctor.call(this),this._flippedX=!1,void 0!==t&&this.initWithFlipX(t)},initWithFlipX:function(t){return this._flippedX=t,!0},update:function(t){this.target.flippedX=this._flippedX},reverse:function(){return new cc.FlipX(!this._flippedX)},clone:function(){var t=new cc.FlipX;return t.initWithFlipX(this._flippedX),t}}),cc.flipX=function(t){return new cc.FlipX(t)},cc.FlipX.create=cc.flipX,cc.FlipY=cc.ActionInstant.extend({_flippedY:!1,ctor:function(t){cc.FiniteTimeAction.prototype.ctor.call(this),this._flippedY=!1,void 0!==t&&this.initWithFlipY(t)},initWithFlipY:function(t){return this._flippedY=t,!0},update:function(t){this.target.flippedY=this._flippedY},reverse:function(){return new cc.FlipY(!this._flippedY)},clone:function(){var t=new cc.FlipY;return t.initWithFlipY(this._flippedY),t}}),cc.flipY=function(t){return new cc.FlipY(t)},cc.FlipY.create=cc.flipY,cc.Place=cc.ActionInstant.extend({_x:0,_y:0,ctor:function(t,e){cc.FiniteTimeAction.prototype.ctor.call(this),this._x=0,this._y=0,void 0!==t&&(void 0!==t.x&&(e=t.y,t=t.x),this.initWithPosition(t,e))},initWithPosition:function(t,e){return this._x=t,this._y=e,!0},update:function(t){this.target.setPosition(this._x,this._y)},clone:function(){var t=new cc.Place;return t.initWithPosition(this._x,this._y),t}}),cc.place=function(t,e){return new cc.Place(t,e)},cc.Place.create=cc.place,cc.CallFunc=cc.ActionInstant.extend({_selectorTarget:null,_function:null,_data:null,ctor:function(t,e,i){cc.FiniteTimeAction.prototype.ctor.call(this),this.initWithFunction(t,e,i)},initWithFunction:function(t,e,i){return t&&(this._function=t),e&&(this._selectorTarget=e),void 0!==i&&(this._data=i),!0},execute:function(){this._function&&this._function.call(this._selectorTarget,this.target,this._data)},update:function(t){this.execute()},getTargetCallback:function(){return this._selectorTarget},setTargetCallback:function(t){t!==this._selectorTarget&&(this._selectorTarget&&(this._selectorTarget=null),this._selectorTarget=t)},clone:function(){var t=new cc.CallFunc;return t.initWithFunction(this._function,this._selectorTarget,this._data),t}}),cc.callFunc=function(t,e,i){return new cc.CallFunc(t,e,i)},cc.CallFunc.create=cc.callFunc,cc.ActionEase=cc.ActionInterval.extend({_inner:null,ctor:function(t){cc.ActionInterval.prototype.ctor.call(this),t&&this.initWithAction(t)},initWithAction:function(t){if(!t)throw new Error("cc.ActionEase.initWithAction(): action must be non nil");return!!this.initWithDuration(t.getDuration())&&(this._inner=t,!0)},clone:function(){var t=new cc.ActionEase;return t.initWithAction(this._inner.clone()),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._inner.startWithTarget(this.target)},stop:function(){this._inner.stop(),cc.ActionInterval.prototype.stop.call(this)},update:function(t){this._inner.update(t)},reverse:function(){return new cc.ActionEase(this._inner.reverse())},getInnerAction:function(){return this._inner}}),cc.actionEase=function(t){return new cc.ActionEase(t)},cc.ActionEase.create=cc.actionEase,cc.EaseRateAction=cc.ActionEase.extend({_rate:0,ctor:function(t,e){cc.ActionEase.prototype.ctor.call(this),void 0!==e&&this.initWithAction(t,e)},setRate:function(t){this._rate=t},getRate:function(){return this._rate},initWithAction:function(t,e){return!!cc.ActionEase.prototype.initWithAction.call(this,t)&&(this._rate=e,!0)},clone:function(){var t=new cc.EaseRateAction;return t.initWithAction(this._inner.clone(),this._rate),t},reverse:function(){return new cc.EaseRateAction(this._inner.reverse(),1/this._rate)}}),cc.easeRateAction=function(t,e){return new cc.EaseRateAction(t,e)},cc.EaseRateAction.create=cc.easeRateAction,cc.EaseIn=cc.EaseRateAction.extend({update:function(t){this._inner.update(Math.pow(t,this._rate))},reverse:function(){return new cc.EaseIn(this._inner.reverse(),1/this._rate)},clone:function(){var t=new cc.EaseIn;return t.initWithAction(this._inner.clone(),this._rate),t}}),cc.EaseIn.create=function(t,e){return new cc.EaseIn(t,e)},cc.easeIn=function(t){return{_rate:t,easing:function(t){return Math.pow(t,this._rate)},reverse:function(){return cc.easeIn(1/this._rate)}}},cc.EaseOut=cc.EaseRateAction.extend({update:function(t){this._inner.update(Math.pow(t,1/this._rate))},reverse:function(){return new cc.EaseOut(this._inner.reverse(),1/this._rate)},clone:function(){var t=new cc.EaseOut;return t.initWithAction(this._inner.clone(),this._rate),t}}),cc.EaseOut.create=function(t,e){return new cc.EaseOut(t,e)},cc.easeOut=function(t){return{_rate:t,easing:function(t){return Math.pow(t,1/this._rate)},reverse:function(){return cc.easeOut(1/this._rate)}}},cc.EaseInOut=cc.EaseRateAction.extend({update:function(t){t*=2,t<1?this._inner.update(.5*Math.pow(t,this._rate)):this._inner.update(1-.5*Math.pow(2-t,this._rate))},clone:function(){var t=new cc.EaseInOut;return t.initWithAction(this._inner.clone(),this._rate),t},reverse:function(){return new cc.EaseInOut(this._inner.reverse(),this._rate)}}),cc.EaseInOut.create=function(t,e){return new cc.EaseInOut(t,e)},cc.easeInOut=function(t){return{_rate:t,easing:function(t){return t*=2,t<1?.5*Math.pow(t,this._rate):1-.5*Math.pow(2-t,this._rate)},reverse:function(){return cc.easeInOut(this._rate)}}},cc.EaseExponentialIn=cc.ActionEase.extend({update:function(t){this._inner.update(0===t?0:Math.pow(2,10*(t-1)))},reverse:function(){return new cc.EaseExponentialOut(this._inner.reverse())},clone:function(){var t=new cc.EaseExponentialIn;return t.initWithAction(this._inner.clone()),t}}),cc.EaseExponentialIn.create=function(t){return new cc.EaseExponentialIn(t)},cc._easeExponentialInObj={easing:function(t){return 0===t?0:Math.pow(2,10*(t-1))},reverse:function(){return cc._easeExponentialOutObj}},cc.easeExponentialIn=function(){return cc._easeExponentialInObj},cc.EaseExponentialOut=cc.ActionEase.extend({update:function(t){this._inner.update(1===t?1:-Math.pow(2,-10*t)+1)},reverse:function(){return new cc.EaseExponentialIn(this._inner.reverse())},clone:function(){var t=new cc.EaseExponentialOut;return t.initWithAction(this._inner.clone()),t}}),cc.EaseExponentialOut.create=function(t){return new cc.EaseExponentialOut(t)},cc._easeExponentialOutObj={easing:function(t){return 1===t?1:-Math.pow(2,-10*t)+1},reverse:function(){return cc._easeExponentialInObj}},cc.easeExponentialOut=function(){return cc._easeExponentialOutObj},cc.EaseExponentialInOut=cc.ActionEase.extend({update:function(t){1!==t&&0!==t&&(t*=2,t=t<1?.5*Math.pow(2,10*(t-1)):.5*(-Math.pow(2,-10*(t-1))+2)),this._inner.update(t)},reverse:function(){return new cc.EaseExponentialInOut(this._inner.reverse())},clone:function(){var t=new cc.EaseExponentialInOut;return t.initWithAction(this._inner.clone()),t}}),cc.EaseExponentialInOut.create=function(t){return new cc.EaseExponentialInOut(t)},cc._easeExponentialInOutObj={easing:function(t){return 1!==t&&0!==t?(t*=2,t<1?.5*Math.pow(2,10*(t-1)):.5*(-Math.pow(2,-10*(t-1))+2)):t},reverse:function(){return cc._easeExponentialInOutObj}},cc.easeExponentialInOut=function(){return cc._easeExponentialInOutObj},cc.EaseSineIn=cc.ActionEase.extend({update:function(t){t=0===t||1===t?t:-1*Math.cos(t*Math.PI/2)+1,this._inner.update(t)},reverse:function(){return new cc.EaseSineOut(this._inner.reverse())},clone:function(){var t=new cc.EaseSineIn;return t.initWithAction(this._inner.clone()),t}}),cc.EaseSineIn.create=function(t){return new cc.EaseSineIn(t)},cc._easeSineInObj={easing:function(t){return 0===t||1===t?t:-1*Math.cos(t*Math.PI/2)+1},reverse:function(){return cc._easeSineOutObj}},cc.easeSineIn=function(){return cc._easeSineInObj},cc.EaseSineOut=cc.ActionEase.extend({update:function(t){t=0===t||1===t?t:Math.sin(t*Math.PI/2),this._inner.update(t)},reverse:function(){return new cc.EaseSineIn(this._inner.reverse())},clone:function(){var t=new cc.EaseSineOut;return t.initWithAction(this._inner.clone()),t}}),cc.EaseSineOut.create=function(t){return new cc.EaseSineOut(t)},cc._easeSineOutObj={easing:function(t){return 0===t||1===t?t:Math.sin(t*Math.PI/2)},reverse:function(){return cc._easeSineInObj}},cc.easeSineOut=function(){return cc._easeSineOutObj},cc.EaseSineInOut=cc.ActionEase.extend({update:function(t){t=0===t||1===t?t:-.5*(Math.cos(Math.PI*t)-1),this._inner.update(t)},clone:function(){var t=new cc.EaseSineInOut;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseSineInOut(this._inner.reverse())}}),cc.EaseSineInOut.create=function(t){return new cc.EaseSineInOut(t)},cc._easeSineInOutObj={easing:function(t){return 0===t||1===t?t:-.5*(Math.cos(Math.PI*t)-1)},reverse:function(){return cc._easeSineInOutObj}},cc.easeSineInOut=function(){return cc._easeSineInOutObj},cc.EaseElastic=cc.ActionEase.extend({_period:.3,ctor:function(t,e){cc.ActionEase.prototype.ctor.call(this),t&&this.initWithAction(t,e)},getPeriod:function(){return this._period},setPeriod:function(t){this._period=t},initWithAction:function(t,e){return cc.ActionEase.prototype.initWithAction.call(this,t),this._period=null==e?.3:e,!0},reverse:function(){return cc.log("cc.EaseElastic.reverse(): it should be overridden in subclass."),null},clone:function(){var t=new cc.EaseElastic;return t.initWithAction(this._inner.clone(),this._period),t}}),cc.EaseElastic.create=function(t,e){return new cc.EaseElastic(t,e)},cc.EaseElasticIn=cc.EaseElastic.extend({update:function(t){var e=0;if(0===t||1===t)e=t;else{var i=this._period/4;t-=1,e=-Math.pow(2,10*t)*Math.sin((t-i)*Math.PI*2/this._period)}this._inner.update(e)},reverse:function(){return new cc.EaseElasticOut(this._inner.reverse(),this._period)},clone:function(){var t=new cc.EaseElasticIn;return t.initWithAction(this._inner.clone(),this._period),t}}),cc.EaseElasticIn.create=function(t,e){return new cc.EaseElasticIn(t,e)},cc._easeElasticInObj={easing:function(t){return 0===t||1===t?t:(t-=1,-Math.pow(2,10*t)*Math.sin((t-.075)*Math.PI*2/.3))},reverse:function(){return cc._easeElasticOutObj}},cc.easeElasticIn=function(t){return t&&.3!==t?{_period:t,easing:function(t){return 0===t||1===t?t:(t-=1,-Math.pow(2,10*t)*Math.sin((t-this._period/4)*Math.PI*2/this._period))},reverse:function(){return cc.easeElasticOut(this._period)}}:cc._easeElasticInObj},cc.EaseElasticOut=cc.EaseElastic.extend({update:function(t){var e=0;if(0===t||1===t)e=t;else{var i=this._period/4;e=Math.pow(2,-10*t)*Math.sin((t-i)*Math.PI*2/this._period)+1}this._inner.update(e)},reverse:function(){
return new cc.EaseElasticIn(this._inner.reverse(),this._period)},clone:function(){var t=new cc.EaseElasticOut;return t.initWithAction(this._inner.clone(),this._period),t}}),cc.EaseElasticOut.create=function(t,e){return new cc.EaseElasticOut(t,e)},cc._easeElasticOutObj={easing:function(t){return 0===t||1===t?t:Math.pow(2,-10*t)*Math.sin((t-.075)*Math.PI*2/.3)+1},reverse:function(){return cc._easeElasticInObj}},cc.easeElasticOut=function(t){return t&&.3!==t?{_period:t,easing:function(t){return 0===t||1===t?t:Math.pow(2,-10*t)*Math.sin((t-this._period/4)*Math.PI*2/this._period)+1},reverse:function(){return cc.easeElasticIn(this._period)}}:cc._easeElasticOutObj},cc.EaseElasticInOut=cc.EaseElastic.extend({update:function(t){var e=0,i=this._period;if(0===t||1===t)e=t;else{t*=2,i||(i=this._period=.3*1.5);var n=i/4;t-=1,e=t<0?-.5*Math.pow(2,10*t)*Math.sin((t-n)*Math.PI*2/i):Math.pow(2,-10*t)*Math.sin((t-n)*Math.PI*2/i)*.5+1}this._inner.update(e)},reverse:function(){return new cc.EaseElasticInOut(this._inner.reverse(),this._period)},clone:function(){var t=new cc.EaseElasticInOut;return t.initWithAction(this._inner.clone(),this._period),t}}),cc.EaseElasticInOut.create=function(t,e){return new cc.EaseElasticInOut(t,e)},cc.easeElasticInOut=function(t){return t=t||.3,{_period:t,easing:function(t){var e=0,i=this._period;if(0===t||1===t)e=t;else{t*=2,i||(i=this._period=.3*1.5);var n=i/4;t-=1,e=t<0?-.5*Math.pow(2,10*t)*Math.sin((t-n)*Math.PI*2/i):Math.pow(2,-10*t)*Math.sin((t-n)*Math.PI*2/i)*.5+1}return e},reverse:function(){return cc.easeElasticInOut(this._period)}}},cc.EaseBounce=cc.ActionEase.extend({bounceTime:function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?(t-=1.5/2.75,7.5625*t*t+.75):t<2.5/2.75?(t-=2.25/2.75,7.5625*t*t+.9375):(t-=2.625/2.75,7.5625*t*t+.984375)},clone:function(){var t=new cc.EaseBounce;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseBounce(this._inner.reverse())}}),cc.EaseBounce.create=function(t){return new cc.EaseBounce(t)},cc.EaseBounceIn=cc.EaseBounce.extend({update:function(t){var e=1-this.bounceTime(1-t);this._inner.update(e)},reverse:function(){return new cc.EaseBounceOut(this._inner.reverse())},clone:function(){var t=new cc.EaseBounceIn;return t.initWithAction(this._inner.clone()),t}}),cc.EaseBounceIn.create=function(t){return new cc.EaseBounceIn(t)},cc._bounceTime=function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?(t-=1.5/2.75,7.5625*t*t+.75):t<2.5/2.75?(t-=2.25/2.75,7.5625*t*t+.9375):(t-=2.625/2.75,7.5625*t*t+.984375)},cc._easeBounceInObj={easing:function(t){return 1-cc._bounceTime(1-t)},reverse:function(){return cc._easeBounceOutObj}},cc.easeBounceIn=function(){return cc._easeBounceInObj},cc.EaseBounceOut=cc.EaseBounce.extend({update:function(t){var e=this.bounceTime(t);this._inner.update(e)},reverse:function(){return new cc.EaseBounceIn(this._inner.reverse())},clone:function(){var t=new cc.EaseBounceOut;return t.initWithAction(this._inner.clone()),t}}),cc.EaseBounceOut.create=function(t){return new cc.EaseBounceOut(t)},cc._easeBounceOutObj={easing:function(t){return cc._bounceTime(t)},reverse:function(){return cc._easeBounceInObj}},cc.easeBounceOut=function(){return cc._easeBounceOutObj};cc.EaseBounceInOut=cc.EaseBounce.extend({update:function(t){var e=0;t<.5?(t*=2,e=.5*(1-this.bounceTime(1-t))):e=.5*this.bounceTime(2*t-1)+.5,this._inner.update(e)},clone:function(){var t=new cc.EaseBounceInOut;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseBounceInOut(this._inner.reverse())}});cc.EaseBounceInOut.create=function(t){return new cc.EaseBounceInOut(t)},cc._easeBounceInOutObj={easing:function(t){var e;return t<.5?(t*=2,e=.5*(1-cc._bounceTime(1-t))):e=.5*cc._bounceTime(2*t-1)+.5,e},reverse:function(){return cc._easeBounceInOutObj}},cc.easeBounceInOut=function(){return cc._easeBounceInOutObj},cc.EaseBackIn=cc.ActionEase.extend({update:function(t){var e=1.70158;t=0===t||1===t?t:t*t*((e+1)*t-e),this._inner.update(t)},reverse:function(){return new cc.EaseBackOut(this._inner.reverse())},clone:function(){var t=new cc.EaseBackIn;return t.initWithAction(this._inner.clone()),t}}),cc.EaseBackIn.create=function(t){return new cc.EaseBackIn(t)},cc._easeBackInObj={easing:function(t){var e=1.70158;return 0===t||1===t?t:t*t*((e+1)*t-e)},reverse:function(){return cc._easeBackOutObj}},cc.easeBackIn=function(){return cc._easeBackInObj},cc.EaseBackOut=cc.ActionEase.extend({update:function(t){var e=1.70158;t-=1,this._inner.update(t*t*((e+1)*t+e)+1)},reverse:function(){return new cc.EaseBackIn(this._inner.reverse())},clone:function(){var t=new cc.EaseBackOut;return t.initWithAction(this._inner.clone()),t}}),cc.EaseBackOut.create=function(t){return new cc.EaseBackOut(t)},cc._easeBackOutObj={easing:function(t){var e=1.70158;return t-=1,t*t*((e+1)*t+e)+1},reverse:function(){return cc._easeBackInObj}},cc.easeBackOut=function(){return cc._easeBackOutObj},cc.EaseBackInOut=cc.ActionEase.extend({update:function(t){var e=2.5949095;t*=2,t<1?this._inner.update(t*t*((e+1)*t-e)/2):(t-=2,this._inner.update(t*t*((e+1)*t+e)/2+1))},clone:function(){var t=new cc.EaseBackInOut;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseBackInOut(this._inner.reverse())}}),cc.EaseBackInOut.create=function(t){return new cc.EaseBackInOut(t)},cc._easeBackInOutObj={easing:function(t){var e=2.5949095;return t*=2,t<1?t*t*((e+1)*t-e)/2:(t-=2,t*t*((e+1)*t+e)/2+1)},reverse:function(){return cc._easeBackInOutObj}},cc.easeBackInOut=function(){return cc._easeBackInOutObj},cc.EaseBezierAction=cc.ActionEase.extend({_p0:null,_p1:null,_p2:null,_p3:null,ctor:function(t){cc.ActionEase.prototype.ctor.call(this,t)},_updateTime:function(t,e,i,n,r){return Math.pow(1-r,3)*t+3*r*Math.pow(1-r,2)*e+3*Math.pow(r,2)*(1-r)*i+Math.pow(r,3)*n},update:function(t){var e=this._updateTime(this._p0,this._p1,this._p2,this._p3,t);this._inner.update(e)},clone:function(){var t=new cc.EaseBezierAction;return t.initWithAction(this._inner.clone()),t.setBezierParamer(this._p0,this._p1,this._p2,this._p3),t},reverse:function(){var t=new cc.EaseBezierAction(this._inner.reverse());return t.setBezierParamer(this._p3,this._p2,this._p1,this._p0),t},setBezierParamer:function(t,e,i,n){this._p0=t||0,this._p1=e||0,this._p2=i||0,this._p3=n||0}}),cc.EaseBezierAction.create=function(t){return new cc.EaseBezierAction(t)},cc.easeBezierAction=function(t,e,i,n){return{easing:function(r){return cc.EaseBezierAction.prototype._updateTime(t,e,i,n,r)},reverse:function(){return cc.easeBezierAction(n,i,e,t)}}},cc.EaseQuadraticActionIn=cc.ActionEase.extend({_updateTime:function(t){return Math.pow(t,2)},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new cc.EaseQuadraticActionIn;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseQuadraticActionIn(this._inner.reverse())}}),cc.EaseQuadraticActionIn.create=function(t){return new cc.EaseQuadraticActionIn(t)},cc._easeQuadraticActionIn={easing:cc.EaseQuadraticActionIn.prototype._updateTime,reverse:function(){return cc._easeQuadraticActionIn}},cc.easeQuadraticActionIn=function(){return cc._easeQuadraticActionIn},cc.EaseQuadraticActionOut=cc.ActionEase.extend({_updateTime:function(t){return-t*(t-2)},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new cc.EaseQuadraticActionOut;return t.initWithAction(),t},reverse:function(){return new cc.EaseQuadraticActionOut(this._inner.reverse())}}),cc.EaseQuadraticActionOut.create=function(t){return new cc.EaseQuadraticActionOut(t)},cc._easeQuadraticActionOut={easing:cc.EaseQuadraticActionOut.prototype._updateTime,reverse:function(){return cc._easeQuadraticActionOut}},cc.easeQuadraticActionOut=function(){return cc._easeQuadraticActionOut},cc.EaseQuadraticActionInOut=cc.ActionEase.extend({_updateTime:function(t){var e=t;return t*=2,t<1?e=t*t*.5:(--t,e=-.5*(t*(t-2)-1)),e},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new cc.EaseQuadraticActionInOut;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseQuadraticActionInOut(this._inner.reverse())}}),cc.EaseQuadraticActionInOut.create=function(t){return new cc.EaseQuadraticActionInOut(t)},cc._easeQuadraticActionInOut={easing:cc.EaseQuadraticActionInOut.prototype._updateTime,reverse:function(){return cc._easeQuadraticActionInOut}},cc.easeQuadraticActionInOut=function(){return cc._easeQuadraticActionInOut},cc.EaseQuarticActionIn=cc.ActionEase.extend({_updateTime:function(t){return t*t*t*t},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new cc.EaseQuarticActionIn;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseQuarticActionIn(this._inner.reverse())}}),cc.EaseQuarticActionIn.create=function(t){return new cc.EaseQuarticActionIn(t)},cc._easeQuarticActionIn={easing:cc.EaseQuarticActionIn.prototype._updateTime,reverse:function(){return cc._easeQuarticActionIn}},cc.easeQuarticActionIn=function(){return cc._easeQuarticActionIn},cc.EaseQuarticActionOut=cc.ActionEase.extend({_updateTime:function(t){return t-=1,-(t*t*t*t-1)},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new cc.EaseQuarticActionOut;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseQuarticActionOut(this._inner.reverse())}}),cc.EaseQuarticActionOut.create=function(t){return new cc.EaseQuarticActionOut(t)},cc._easeQuarticActionOut={easing:cc.EaseQuarticActionOut.prototype._updateTime,reverse:function(){return cc._easeQuarticActionOut}},cc.easeQuarticActionOut=function(){return cc._easeQuarticActionOut},cc.EaseQuarticActionInOut=cc.ActionEase.extend({_updateTime:function(t){return t*=2,t<1?.5*t*t*t*t:(t-=2,-.5*(t*t*t*t-2))},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new cc.EaseQuarticActionInOut;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseQuarticActionInOut(this._inner.reverse())}}),cc.EaseQuarticActionInOut.create=function(t){return new cc.EaseQuarticActionInOut(t)},cc._easeQuarticActionInOut={easing:cc.EaseQuarticActionInOut.prototype._updateTime,reverse:function(){return cc._easeQuarticActionInOut}},cc.easeQuarticActionInOut=function(){return cc._easeQuarticActionInOut},cc.EaseQuinticActionIn=cc.ActionEase.extend({_updateTime:function(t){return t*t*t*t*t},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new cc.EaseQuinticActionIn;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseQuinticActionIn(this._inner.reverse())}}),cc.EaseQuinticActionIn.create=function(t){return new cc.EaseQuinticActionIn(t)},cc._easeQuinticActionIn={easing:cc.EaseQuinticActionIn.prototype._updateTime,reverse:function(){return cc._easeQuinticActionIn}},cc.easeQuinticActionIn=function(){return cc._easeQuinticActionIn},cc.EaseQuinticActionOut=cc.ActionEase.extend({_updateTime:function(t){return t-=1,t*t*t*t*t+1},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new cc.EaseQuinticActionOut;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseQuinticActionOut(this._inner.reverse())}}),cc.EaseQuinticActionOut.create=function(t){return new cc.EaseQuinticActionOut(t)},cc._easeQuinticActionOut={easing:cc.EaseQuinticActionOut.prototype._updateTime,reverse:function(){return cc._easeQuinticActionOut}},cc.easeQuinticActionOut=function(){return cc._easeQuinticActionOut},cc.EaseQuinticActionInOut=cc.ActionEase.extend({_updateTime:function(t){return t*=2,t<1?.5*t*t*t*t*t:(t-=2,.5*(t*t*t*t*t+2))},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new cc.EaseQuinticActionInOut;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseQuinticActionInOut(this._inner.reverse())}}),cc.EaseQuinticActionInOut.create=function(t){return new cc.EaseQuinticActionInOut(t)},cc._easeQuinticActionInOut={easing:cc.EaseQuinticActionInOut.prototype._updateTime,reverse:function(){return cc._easeQuinticActionInOut}},cc.easeQuinticActionInOut=function(){return cc._easeQuinticActionInOut},cc.EaseCircleActionIn=cc.ActionEase.extend({_updateTime:function(t){return-1*(Math.sqrt(1-t*t)-1)},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new cc.EaseCircleActionIn;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseCircleActionIn(this._inner.reverse())}}),cc.EaseCircleActionIn.create=function(t){return new cc.EaseCircleActionIn(t)},cc._easeCircleActionIn={easing:cc.EaseCircleActionIn.prototype._updateTime,reverse:function(){return cc._easeCircleActionIn}},cc.easeCircleActionIn=function(){return cc._easeCircleActionIn},cc.EaseCircleActionOut=cc.ActionEase.extend({_updateTime:function(t){return t-=1,Math.sqrt(1-t*t)},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new cc.EaseCircleActionOut;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseCircleActionOut(this._inner.reverse())}}),cc.EaseCircleActionOut.create=function(t){return new cc.EaseCircleActionOut(t)},cc._easeCircleActionOut={easing:cc.EaseCircleActionOut.prototype._updateTime,reverse:function(){return cc._easeCircleActionOut}},cc.easeCircleActionOut=function(){return cc._easeCircleActionOut},cc.EaseCircleActionInOut=cc.ActionEase.extend({_updateTime:function(t){return t*=2,t<1?-.5*(Math.sqrt(1-t*t)-1):(t-=2,.5*(Math.sqrt(1-t*t)+1))},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new cc.EaseCircleActionInOut;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseCircleActionInOut(this._inner.reverse())}}),cc.EaseCircleActionInOut.create=function(t){return new cc.EaseCircleActionInOut(t)},cc._easeCircleActionInOut={easing:cc.EaseCircleActionInOut.prototype._updateTime,reverse:function(){return cc._easeCircleActionInOut}},cc.easeCircleActionInOut=function(){return cc._easeCircleActionInOut},cc.EaseCubicActionIn=cc.ActionEase.extend({_updateTime:function(t){return t*t*t},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new cc.EaseCubicActionIn;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseCubicActionIn(this._inner.reverse())}}),cc.EaseCubicActionIn.create=function(t){return new cc.EaseCubicActionIn(t)},cc._easeCubicActionIn={easing:cc.EaseCubicActionIn.prototype._updateTime,reverse:function(){return cc._easeCubicActionIn}},cc.easeCubicActionIn=function(){return cc._easeCubicActionIn},cc.EaseCubicActionOut=cc.ActionEase.extend({_updateTime:function(t){return t-=1,t*t*t+1},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new cc.EaseCubicActionOut;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseCubicActionOut(this._inner.reverse())}}),cc.EaseCubicActionOut.create=function(t){return new cc.EaseCubicActionOut(t)},cc._easeCubicActionOut={easing:cc.EaseCubicActionOut.prototype._updateTime,reverse:function(){return cc._easeCubicActionOut}},cc.easeCubicActionOut=function(){return cc._easeCubicActionOut},cc.EaseCubicActionInOut=cc.ActionEase.extend({_updateTime:function(t){return t*=2,t<1?.5*t*t*t:(t-=2,.5*(t*t*t+2))},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new cc.EaseCubicActionInOut;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseCubicActionInOut(this._inner.reverse())}}),cc.EaseCubicActionInOut.create=function(t){return new cc.EaseCubicActionInOut(t)},cc._easeCubicActionInOut={easing:cc.EaseCubicActionInOut.prototype._updateTime,reverse:function(){return cc._easeCubicActionInOut}},cc.easeCubicActionInOut=function(){return cc._easeCubicActionInOut},cc.cardinalSplineAt=function(t,e,i,n,r,c){var o=c*c,s=o*c,a=(1-r)/2,h=a*(-s+2*o-c),l=a*(-s+o)+(2*s-3*o+1),u=a*(s-2*o+c)+(-2*s+3*o),_=a*(s-o),d=t.x*h+e.x*l+i.x*u+n.x*_,f=t.y*h+e.y*l+i.y*u+n.y*_;return cc.p(d,f)},cc.reverseControlPoints=function(t){for(var e=[],i=t.length-1;i>=0;i--)e.push(cc.p(t[i].x,t[i].y));return e},cc.cloneControlPoints=function(t){for(var e=[],i=0;i<t.length;i++)e.push(cc.p(t[i].x,t[i].y));return e},cc.copyControlPoints=cc.cloneControlPoints,cc.getControlPointAt=function(t,e){var i=Math.min(t.length-1,Math.max(e,0));return t[i]},cc.reverseControlPointsInline=function(t){for(var e=t.length,i=0|e/2,n=0;n<i;++n){var r=t[n];t[n]=t[e-n-1],t[e-n-1]=r}},cc.CardinalSplineTo=cc.ActionInterval.extend({_points:null,_deltaT:0,_tension:0,_previousPosition:null,_accumulatedDiff:null,ctor:function(t,e,i){cc.ActionInterval.prototype.ctor.call(this),this._points=[],void 0!==i&&this.initWithDuration(t,e,i)},initWithDuration:function(t,e,i){if(!e||0===e.length)throw new Error("Invalid configuration. It must at least have one control point");return!!cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(this.setPoints(e),this._tension=i,!0)},clone:function(){var t=new cc.CardinalSplineTo;return t.initWithDuration(this._duration,cc.copyControlPoints(this._points),this._tension),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._deltaT=1/(this._points.length-1),this._previousPosition=cc.p(this.target.getPositionX(),this.target.getPositionY()),this._accumulatedDiff=cc.p(0,0)},update:function(t){t=this._computeEaseTime(t);var e,i,n=this._points;if(1===t)e=n.length-1,i=1;else{var r=this._deltaT;e=0|t/r,i=(t-r*e)/r}var c=cc.cardinalSplineAt(cc.getControlPointAt(n,e-1),cc.getControlPointAt(n,e-0),cc.getControlPointAt(n,e+1),cc.getControlPointAt(n,e+2),this._tension,i);if(cc.ENABLE_STACKABLE_ACTIONS){var o,s;if(o=this.target.getPositionX()-this._previousPosition.x,s=this.target.getPositionY()-this._previousPosition.y,0!==o||0!==s){var a=this._accumulatedDiff;o=a.x+o,s=a.y+s,a.x=o,a.y=s,c.x+=o,c.y+=s}}this.updatePosition(c)},reverse:function(){var t=cc.reverseControlPoints(this._points);return cc.cardinalSplineTo(this._duration,t,this._tension)},updatePosition:function(t){this.target.setPosition(t),this._previousPosition=t},getPoints:function(){return this._points},setPoints:function(t){this._points=t}}),cc.cardinalSplineTo=function(t,e,i){return new cc.CardinalSplineTo(t,e,i)},cc.CardinalSplineTo.create=cc.cardinalSplineTo,cc.CardinalSplineBy=cc.CardinalSplineTo.extend({_startPosition:null,ctor:function(t,e,i){cc.CardinalSplineTo.prototype.ctor.call(this),this._startPosition=cc.p(0,0),void 0!==i&&this.initWithDuration(t,e,i)},startWithTarget:function(t){cc.CardinalSplineTo.prototype.startWithTarget.call(this,t),this._startPosition.x=t.getPositionX(),this._startPosition.y=t.getPositionY()},reverse:function(){for(var t,e=this._points.slice(),i=e[0],n=1;n<e.length;++n)t=e[n],e[n]=cc.pSub(t,i),i=t;var r=cc.reverseControlPoints(e);i=r[r.length-1],r.pop(),i.x=-i.x,i.y=-i.y,r.unshift(i);for(var n=1;n<r.length;++n)t=r[n],t.x=-t.x,t.y=-t.y,t.x+=i.x,t.y+=i.y,r[n]=t,i=t;return cc.cardinalSplineBy(this._duration,r,this._tension)},updatePosition:function(t){var e=this._startPosition,i=t.x+e.x,n=t.y+e.y;this._previousPosition.x=i,this._previousPosition.y=n,this.target.setPosition(i,n)},clone:function(){var t=new cc.CardinalSplineBy;return t.initWithDuration(this._duration,cc.copyControlPoints(this._points),this._tension),t}}),cc.cardinalSplineBy=function(t,e,i){return new cc.CardinalSplineBy(t,e,i)},cc.CardinalSplineBy.create=cc.cardinalSplineBy,cc.CatmullRomTo=cc.CardinalSplineTo.extend({ctor:function(t,e){e&&this.initWithDuration(t,e)},initWithDuration:function(t,e){return cc.CardinalSplineTo.prototype.initWithDuration.call(this,t,e,.5)},clone:function(){var t=new cc.CatmullRomTo;return t.initWithDuration(this._duration,cc.copyControlPoints(this._points)),t}}),cc.catmullRomTo=function(t,e){return new cc.CatmullRomTo(t,e)},cc.CatmullRomTo.create=cc.catmullRomTo,cc.CatmullRomBy=cc.CardinalSplineBy.extend({ctor:function(t,e){cc.CardinalSplineBy.prototype.ctor.call(this),e&&this.initWithDuration(t,e)},initWithDuration:function(t,e){return cc.CardinalSplineTo.prototype.initWithDuration.call(this,t,e,.5)},clone:function(){var t=new cc.CatmullRomBy;return t.initWithDuration(this._duration,cc.copyControlPoints(this._points)),t}}),cc.catmullRomBy=function(t,e){return new cc.CatmullRomBy(t,e)},cc.CatmullRomBy.create=cc.catmullRomBy,cc.ActionTweenDelegate=cc.Class.extend({updateTweenAction:function(t,e){}}),cc.ActionTween=cc.ActionInterval.extend({key:"",from:0,to:0,delta:0,ctor:function(t,e,i,n){cc.ActionInterval.prototype.ctor.call(this),this.key="",void 0!==n&&this.initWithDuration(t,e,i,n)},initWithDuration:function(t,e,i,n){return!!cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(this.key=e,this.to=n,this.from=i,!0)},startWithTarget:function(t){if(!t||!t.updateTweenAction)throw new Error("cc.ActionTween.startWithTarget(): target must be non-null, and target must implement updateTweenAction function");cc.ActionInterval.prototype.startWithTarget.call(this,t),this.delta=this.to-this.from},update:function(t){this.target.updateTweenAction(this.to-this.delta*(1-t),this.key)},reverse:function(){return new cc.ActionTween(this.duration,this.key,this.to,this.from)},clone:function(){var t=new cc.ActionTween;return t.initWithDuration(this._duration,this.key,this.from,this.to),t}}),cc.actionTween=function(t,e,i,n){return new cc.ActionTween(t,e,i,n)},cc.ActionTween.create=cc.actionTween,cc._globalFontSize=cc.ITEM_SIZE,cc._globalFontName="Arial",cc._globalFontNameRelease=!1,cc.MenuItem=cc.Node.extend({_enabled:!1,_target:null,_callback:null,_isSelected:!1,_className:"MenuItem",ctor:function(t,e){var i=cc.Node.prototype;i.ctor.call(this),this._target=null,this._callback=null,this._isSelected=!1,this._enabled=!1,i.setAnchorPoint.call(this,.5,.5),this._target=e||null,this._callback=t||null,this._callback&&(this._enabled=!0)},isSelected:function(){return this._isSelected},setOpacityModifyRGB:function(t){},isOpacityModifyRGB:function(){return!1},setTarget:function(t,e){this._target=e,this._callback=t},isEnabled:function(){return this._enabled},setEnabled:function(t){this._enabled=t},initWithCallback:function(t,e){return this.anchorX=.5,this.anchorY=.5,this._target=e,this._callback=t,this._enabled=!0,this._isSelected=!1,!0},rect:function(){var t=this._position,e=this._contentSize,i=this._anchorPoint;return cc.rect(t.x-e.width*i.x,t.y-e.height*i.y,e.width,e.height)},selected:function(){this._isSelected=!0},unselected:function(){this._isSelected=!1},setCallback:function(t,e){this._target=e,this._callback=t},activate:function(){if(this._enabled){var t=this._target,e=this._callback;if(!e)return;t&&cc.isString(e)?t[e](this):t&&cc.isFunction(e)?e.call(t,this):e(this)}}});var _p=cc.MenuItem.prototype;_p.enabled,cc.defineGetterSetter(_p,"enabled",_p.isEnabled,_p.setEnabled),cc.MenuItem.create=function(t,e){return new cc.MenuItem(t,e)},cc.MenuItemLabel=cc.MenuItem.extend({_disabledColor:null,_label:null,_originalScale:0,_colorBackup:null,ctor:function(t,e,i){cc.MenuItem.prototype.ctor.call(this,e,i),this._disabledColor=null,this._label=null,this._colorBackup=null,t&&(this._originalScale=1,this._colorBackup=cc.color.WHITE,this._disabledColor=cc.color(126,126,126),this.setLabel(t),t.textureLoaded&&!t.textureLoaded()&&t.addEventListener("load",function(t){this.width=t.width,this.height=t.height,this.parent instanceof cc.Menu&&this.parent.updateAlign()},this),this.setCascadeColorEnabled(!0),this.setCascadeOpacityEnabled(!0))},getDisabledColor:function(){return this._disabledColor},setDisabledColor:function(t){this._disabledColor=t},getLabel:function(){return this._label},setLabel:function(t){t&&(this.addChild(t),t.anchorX=0,t.anchorY=0,this.width=t.width,this.height=t.height,t.setCascadeColorEnabled(!0)),this._label&&this.removeChild(this._label,!0),this._label=t},setEnabled:function(t){this._enabled!==t&&(t?this.setColor(this._colorBackup):(this._colorBackup=this.color,this.setColor(this._disabledColor))),cc.MenuItem.prototype.setEnabled.call(this,t)},initWithLabel:function(t,e,i){return this.initWithCallback(e,i),this._originalScale=1,this._colorBackup=cc.color.WHITE,this._disabledColor=cc.color(126,126,126),this.setLabel(t),this.setCascadeColorEnabled(!0),this.setCascadeOpacityEnabled(!0),!0},setString:function(t){this._label.string=t,this.width=this._label.width,this.height=this._label.height},getString:function(){return this._label.string},activate:function(){this._enabled&&(this.stopAllActions(),this.scale=this._originalScale,cc.MenuItem.prototype.activate.call(this))},selected:function(){if(this._enabled){cc.MenuItem.prototype.selected.call(this);var t=this.getActionByTag(cc.ZOOM_ACTION_TAG);t?this.stopAction(t):this._originalScale=this.scale;var e=cc.scaleTo(.1,1.2*this._originalScale);e.setTag(cc.ZOOM_ACTION_TAG),this.runAction(e)}},unselected:function(){if(this._enabled){cc.MenuItem.prototype.unselected.call(this),this.stopActionByTag(cc.ZOOM_ACTION_TAG);var t=cc.scaleTo(.1,this._originalScale);t.setTag(cc.ZOOM_ACTION_TAG),this.runAction(t)}}});var _p=cc.MenuItemLabel.prototype;_p.string,cc.defineGetterSetter(_p,"string",_p.getString,_p.setString),_p.disabledColor,cc.defineGetterSetter(_p,"disabledColor",_p.getDisabledColor,_p.setDisabledColor),_p.label,cc.defineGetterSetter(_p,"label",_p.getLabel,_p.setLabel),cc.MenuItemLabel.create=function(t,e,i){return new cc.MenuItemLabel(t,e,i)},cc.MenuItemAtlasFont=cc.MenuItemLabel.extend({ctor:function(t,e,i,n,r,c,o){var s;t&&t.length>0&&(s=new cc.LabelAtlas(t,e,i,n,r)),cc.MenuItemLabel.prototype.ctor.call(this,s,c,o)},initWithString:function(t,e,i,n,r,c,o){if(!t||0===t.length)throw new Error("cc.MenuItemAtlasFont.initWithString(): value should be non-null and its length should be greater than 0");var s=new cc.LabelAtlas;return s.initWithString(t,e,i,n,r),this.initWithLabel(s,c,o),!0}}),cc.MenuItemAtlasFont.create=function(t,e,i,n,r,c,o){return new cc.MenuItemAtlasFont(t,e,i,n,r,c,o)},cc.MenuItemFont=cc.MenuItemLabel.extend({_fontSize:null,_fontName:null,ctor:function(t,e,i){var n;t&&t.length>0?(this._fontName=cc._globalFontName,this._fontSize=cc._globalFontSize,n=new cc.LabelTTF(t,this._fontName,this._fontSize)):(this._fontSize=0,this._fontName=""),cc.MenuItemLabel.prototype.ctor.call(this,n,e,i)},initWithString:function(t,e,i){if(!t||0===t.length)throw new Error("Value should be non-null and its length should be greater than 0");this._fontName=cc._globalFontName,this._fontSize=cc._globalFontSize;var n=new cc.LabelTTF(t,this._fontName,this._fontSize);return this.initWithLabel(n,e,i),!0},setFontSize:function(t){this._fontSize=t,this._recreateLabel()},getFontSize:function(){return this._fontSize},setFontName:function(t){this._fontName=t,this._recreateLabel()},getFontName:function(){return this._fontName},_recreateLabel:function(){var t=new cc.LabelTTF(this._label.string,this._fontName,this._fontSize);this.setLabel(t)}}),cc.MenuItemFont.setFontSize=function(t){cc._globalFontSize=t},cc.MenuItemFont.fontSize=function(){return cc._globalFontSize},cc.MenuItemFont.setFontName=function(t){cc._globalFontNameRelease&&(cc._globalFontName=""),cc._globalFontName=t,cc._globalFontNameRelease=!0};var _p=cc.MenuItemFont.prototype;_p.fontSize,cc.defineGetterSetter(_p,"fontSize",_p.getFontSize,_p.setFontSize),_p.fontName,cc.defineGetterSetter(_p,"fontName",_p.getFontName,_p.setFontName),cc.MenuItemFont.fontName=function(){return cc._globalFontName},cc.MenuItemFont.create=function(t,e,i){return new cc.MenuItemFont(t,e,i)},cc.MenuItemSprite=cc.MenuItem.extend({_normalImage:null,_selectedImage:null,_disabledImage:null,ctor:function(t,e,i,n,r){if(cc.MenuItem.prototype.ctor.call(this),this._normalImage=null,this._selectedImage=null,this._disabledImage=null,this._loader=new cc.Sprite.LoadManager,void 0!==t){e=e||null;var c,o,s;return void 0!==r?(c=i,s=n,o=r):void 0!==n&&cc.isFunction(n)?(c=i,s=n):void 0!==n&&cc.isFunction(i)?(o=n,s=i,c=null):void 0===i&&(c=null),this._loader.clear(),t.textureLoaded&&!t.textureLoaded()?(this._loader.once(t,function(){this.initWithNormalSprite(t,e,c,s,o)},this),!1):(this.initWithNormalSprite(t,e,c,s,o),!0)}},getNormalImage:function(){return this._normalImage},setNormalImage:function(t){this._normalImage!==t&&(t&&(this.addChild(t,0,cc.NORMAL_TAG),t.anchorX=0,t.anchorY=0),this._normalImage&&this.removeChild(this._normalImage,!0),this._normalImage=t,this._normalImage&&(this.width=this._normalImage.width,this.height=this._normalImage.height,this._updateImagesVisibility(),t.textureLoaded&&!t.textureLoaded()&&t.addEventListener("load",function(t){this.width=t.width,this.height=t.height,this.parent instanceof cc.Menu&&this.parent.updateAlign()},this)))},getSelectedImage:function(){return this._selectedImage},setSelectedImage:function(t){this._selectedImage!==t&&(t&&(this.addChild(t,0,cc.SELECTED_TAG),t.anchorX=0,t.anchorY=0),this._selectedImage&&this.removeChild(this._selectedImage,!0),this._selectedImage=t,this._updateImagesVisibility())},getDisabledImage:function(){return this._disabledImage},setDisabledImage:function(t){this._disabledImage!==t&&(t&&(this.addChild(t,0,cc.DISABLE_TAG),t.anchorX=0,t.anchorY=0),this._disabledImage&&this.removeChild(this._disabledImage,!0),this._disabledImage=t,this._updateImagesVisibility())},initWithNormalSprite:function(t,e,i,n,r){if(this._loader.clear(),t.textureLoaded&&!t.textureLoaded())return this._loader.once(t,function(){this.initWithNormalSprite(t,e,i,n,r)},this),!1;this.initWithCallback(n,r),this.setNormalImage(t),this.setSelectedImage(e),this.setDisabledImage(i);var c=this._normalImage;return c&&(this.width=c.width,this.height=c.height),this.setCascadeColorEnabled(!0),this.setCascadeOpacityEnabled(!0),!0},selected:function(){cc.MenuItem.prototype.selected.call(this),this._normalImage&&(this._disabledImage&&(this._disabledImage.visible=!1),this._selectedImage?(this._normalImage.visible=!1,this._selectedImage.visible=!0):this._normalImage.visible=!0)},unselected:function(){cc.MenuItem.prototype.unselected.call(this),this._normalImage&&(this._normalImage.visible=!0,this._selectedImage&&(this._selectedImage.visible=!1),this._disabledImage&&(this._disabledImage.visible=!1))},setEnabled:function(t){this._enabled!==t&&(cc.MenuItem.prototype.setEnabled.call(this,t),this._updateImagesVisibility())},_updateImagesVisibility:function(){var t=this._normalImage,e=this._selectedImage,i=this._disabledImage;this._enabled?(t&&(t.visible=!0),e&&(e.visible=!1),i&&(i.visible=!1)):i?(t&&(t.visible=!1),e&&(e.visible=!1),i&&(i.visible=!0)):(t&&(t.visible=!0),e&&(e.visible=!1))}});var _p=cc.MenuItemSprite.prototype;_p.normalImage,cc.defineGetterSetter(_p,"normalImage",_p.getNormalImage,_p.setNormalImage),_p.selectedImage,cc.defineGetterSetter(_p,"selectedImage",_p.getSelectedImage,_p.setSelectedImage),_p.disabledImage,cc.defineGetterSetter(_p,"disabledImage",_p.getDisabledImage,_p.setDisabledImage),cc.MenuItemSprite.create=function(t,e,i,n,r){return new cc.MenuItemSprite(t,e,i,n,r||void 0)},cc.MenuItemImage=cc.MenuItemSprite.extend({ctor:function(t,e,i,n,r){var c=null,o=null,s=null,a=null,h=null;void 0===t||null===t?cc.MenuItemSprite.prototype.ctor.call(this):(c=new cc.Sprite(t),e&&(o=new cc.Sprite(e)),void 0===n?a=i:void 0===r?(a=i,h=n):r&&(s=new cc.Sprite(i),a=n,h=r),cc.MenuItemSprite.prototype.ctor.call(this,c,o,s,a,h))},setNormalSpriteFrame:function(t){this.setNormalImage(new cc.Sprite(t))},setSelectedSpriteFrame:function(t){this.setSelectedImage(new cc.Sprite(t))},setDisabledSpriteFrame:function(t){this.setDisabledImage(new cc.Sprite(t))},initWithNormalImage:function(t,e,i,n,r){var c=null,o=null,s=null;return t&&(c=new cc.Sprite(t)),e&&(o=new cc.Sprite(e)),i&&(s=new cc.Sprite(i)),this.initWithNormalSprite(c,o,s,n,r)}}),cc.MenuItemImage.create=function(t,e,i,n,r){return new cc.MenuItemImage(t,e,i,n,r)},cc.MenuItemToggle=cc.MenuItem.extend({subItems:null,_selectedIndex:0,_opacity:null,_color:null,ctor:function(){cc.MenuItem.prototype.ctor.call(this),
this._selectedIndex=0,this.subItems=[],this._opacity=0,this._color=cc.color.WHITE,arguments.length>0&&this.initWithItems(Array.prototype.slice.apply(arguments))},getOpacity:function(){return this._opacity},setOpacity:function(t){if(this._opacity=t,this.subItems&&this.subItems.length>0)for(var e=0;e<this.subItems.length;e++)this.subItems[e].opacity=t;this._color.a=t},getColor:function(){var t=this._color;return cc.color(t.r,t.g,t.b,t.a)},setColor:function(t){var e=this._color;if(e.r=t.r,e.g=t.g,e.b=t.b,this.subItems&&this.subItems.length>0)for(var i=0;i<this.subItems.length;i++)this.subItems[i].setColor(t);void 0===t.a||t.a_undefined||this.setOpacity(t.a)},getSelectedIndex:function(){return this._selectedIndex},setSelectedIndex:function(t){if(t!==this._selectedIndex){this._selectedIndex=t;var e=this.getChildByTag(cc.CURRENT_ITEM);e&&e.removeFromParent(!1);var i=this.subItems[this._selectedIndex];this.addChild(i,0,cc.CURRENT_ITEM);var n=i.width,r=i.height;this.width=n,this.height=r,i.setPosition(n/2,r/2)}},getSubItems:function(){return this.subItems},setSubItems:function(t){this.subItems=t},initWithItems:function(t){var e=t.length;cc.isFunction(t[t.length-2])?(this.initWithCallback(t[t.length-2],t[t.length-1]),e-=2):cc.isFunction(t[t.length-1])?(this.initWithCallback(t[t.length-1],null),e-=1):this.initWithCallback(null,null);var i=this.subItems;i.length=0;for(var n=0;n<e;n++)t[n]&&i.push(t[n]);return this._selectedIndex=cc.UINT_MAX,this.setSelectedIndex(0),this.setCascadeColorEnabled(!0),this.setCascadeOpacityEnabled(!0),!0},addSubItem:function(t){this.subItems.push(t)},activate:function(){if(this._enabled){var t=(this._selectedIndex+1)%this.subItems.length;this.setSelectedIndex(t)}cc.MenuItem.prototype.activate.call(this)},selected:function(){cc.MenuItem.prototype.selected.call(this),this.subItems[this._selectedIndex].selected()},unselected:function(){cc.MenuItem.prototype.unselected.call(this),this.subItems[this._selectedIndex].unselected()},setEnabled:function(t){if(this._enabled!==t){cc.MenuItem.prototype.setEnabled.call(this,t);var e=this.subItems;if(e&&e.length>0)for(var i=0;i<e.length;i++)e[i].enabled=t}},selectedItem:function(){return this.subItems[this._selectedIndex]},getSelectedItem:function(){return this.subItems[this._selectedIndex]},onEnter:function(){cc.Node.prototype.onEnter.call(this),this.setSelectedIndex(this._selectedIndex)}});var _p=cc.MenuItemToggle.prototype;_p.selectedIndex,cc.defineGetterSetter(_p,"selectedIndex",_p.getSelectedIndex,_p.setSelectedIndex),cc.MenuItemToggle.create=function(){arguments.length>0&&null==arguments[arguments.length-1]&&cc.log("parameters should not be ending with null in Javascript");var t=new cc.MenuItemToggle;return t.initWithItems(Array.prototype.slice.apply(arguments)),t},cc.MENU_STATE_WAITING=0,cc.MENU_STATE_TRACKING_TOUCH=1,cc.MENU_HANDLER_PRIORITY=-128,cc.DEFAULT_PADDING=5,cc.Menu=cc.Layer.extend({enabled:!1,_selectedItem:null,_state:-1,_touchListener:null,_className:"Menu",ctor:function(t){cc.Layer.prototype.ctor.call(this),this._color=cc.color.WHITE,this.enabled=!1,this._opacity=255,this._selectedItem=null,this._state=-1,this._touchListener=cc.EventListener.create({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:!0,onTouchBegan:this._onTouchBegan,onTouchMoved:this._onTouchMoved,onTouchEnded:this._onTouchEnded,onTouchCancelled:this._onTouchCancelled}),arguments.length>0&&null==arguments[arguments.length-1]&&cc.log("parameters should not be ending with null in Javascript");var e,i=arguments.length;if(0===i)e=[];else if(1===i)e=t instanceof Array?t:[t];else if(i>1){e=[];for(var n=0;n<i;n++)arguments[n]&&e.push(arguments[n])}this.initWithArray(e)},onEnter:function(){var t=this._touchListener;t._isRegistered()||cc.eventManager.addListener(t,this),cc.Node.prototype.onEnter.call(this)},isEnabled:function(){return this.enabled},setEnabled:function(t){this.enabled=t},initWithItems:function(t){var e=[];if(t)for(var i=0;i<t.length;i++)t[i]&&e.push(t[i]);return this.initWithArray(e)},initWithArray:function(t){if(cc.Layer.prototype.init.call(this)){this.enabled=!0;var e=cc.winSize;if(this.setPosition(e.width/2,e.height/2),this.setContentSize(e),this.setAnchorPoint(.5,.5),this.ignoreAnchorPointForPosition(!0),t)for(var i=0;i<t.length;i++)this.addChild(t[i],i);return this._selectedItem=null,this._state=cc.MENU_STATE_WAITING,this.cascadeColor=!0,this.cascadeOpacity=!0,!0}return!1},addChild:function(t,e,i){if(!(t instanceof cc.MenuItem))throw new Error("cc.Menu.addChild() : Menu only supports MenuItem objects as children");cc.Layer.prototype.addChild.call(this,t,e,i)},updateAlign:function(){switch(this._align){case"vertically":this.alignItemsVertically();break;case"horizontally":this.alignItemsHorizontally()}},alignItemsVertically:function(){this.alignItemsVerticallyWithPadding(cc.DEFAULT_PADDING)},alignItemsVerticallyWithPadding:function(t){this._align="vertically";var e,i,n,r,c,o=-t,s=this._children;if(s&&s.length>0){for(i=0,e=s.length;i<e;i++)o+=s[i].height*s[i].scaleY+t;var a=o/2;for(i=0,e=s.length;i<e;i++)c=s[i],r=c.height,n=c.scaleY,c.setPosition(0,a-r*n/2),a-=r*n+t}},alignItemsHorizontally:function(){this.alignItemsHorizontallyWithPadding(cc.DEFAULT_PADDING)},alignItemsHorizontallyWithPadding:function(t){this._align="horizontally";var e,i,n,r,c,o=-t,s=this._children;if(s&&s.length>0){for(e=0,i=s.length;e<i;e++)o+=s[e].width*s[e].scaleX+t;var a=-o/2;for(e=0,i=s.length;e<i;e++)c=s[e],n=c.scaleX,r=s[e].width,c.setPosition(a+r*n/2,0),a+=r*n+t}},alignItemsInColumns:function(){arguments.length>0&&null==arguments[arguments.length-1]&&cc.log("parameters should not be ending with null in Javascript");for(var t=[],e=0;e<arguments.length;e++)t.push(arguments[e]);var i,n,r,c=-5,o=0,s=0,a=0,h=this._children;if(h&&h.length>0)for(e=0,r=h.length;e<r;e++)o>=t.length||(i=t[o],i&&(n=h[e].height,s=s>=n||isNaN(n)?s:n,++a,a>=i&&(c+=s+5,a=0,s=0,++o)));var l=cc.director.getWinSize();o=0,s=0,i=0;var u=0,_=0,d=c/2;if(h&&h.length>0)for(e=0,r=h.length;e<r;e++){var f=h[e];0===i&&(i=t[o],u=l.width/(1+i),_=u),n=f._getHeight(),s=s>=n||isNaN(n)?s:n,f.setPosition(_-l.width/2,d-n/2),_+=u,++a,a>=i&&(d-=s+5,a=0,i=0,s=0,++o)}},alignItemsInRows:function(){arguments.length>0&&null==arguments[arguments.length-1]&&cc.log("parameters should not be ending with null in Javascript");var t,e=[];for(t=0;t<arguments.length;t++)e.push(arguments[t]);var i,n,r,c,o=[],s=[],a=-10,h=-5,l=0,u=0,_=0,d=this._children;if(d&&d.length>0)for(t=0,r=d.length;t<r;t++)n=d[t],l>=e.length||(i=e[l],i&&(c=n.width,u=u>=c||isNaN(c)?u:c,h+=n.height+5,++_,_>=i&&(o.push(u),s.push(h),a+=u+10,_=0,u=0,h=-5,++l)));var f=cc.director.getWinSize();l=0,u=0,i=0;var p=-a/2,g=0;if(d&&d.length>0)for(t=0,r=d.length;t<r;t++)n=d[t],0===i&&(i=e[l],g=s[l]),c=n._getWidth(),u=u>=c||isNaN(c)?u:c,n.setPosition(p+o[l]/2,g-f.height/2),g-=n.height+10,++_,_>=i&&(p+=u+5,_=0,i=0,u=0,++l)},removeChild:function(t,e){if(null!=t){if(!(t instanceof cc.MenuItem))return void cc.log("cc.Menu.removeChild():Menu only supports MenuItem objects as children");this._selectedItem===t&&(this._selectedItem=null),cc.Node.prototype.removeChild.call(this,t,e)}},_onTouchBegan:function(t,e){var i=e.getCurrentTarget();if(i._state!==cc.MENU_STATE_WAITING||!i._visible||!i.enabled)return!1;for(var n=i.parent;null!=n;n=n.parent)if(!n.isVisible())return!1;return i._selectedItem=i._itemForTouch(t),!!i._selectedItem&&(i._state=cc.MENU_STATE_TRACKING_TOUCH,i._selectedItem.selected(),i._selectedItem.setNodeDirty(),!0)},_onTouchEnded:function(t,e){var i=e.getCurrentTarget();return i._state!==cc.MENU_STATE_TRACKING_TOUCH?void cc.log("cc.Menu.onTouchEnded(): invalid state"):(i._selectedItem&&(i._selectedItem.unselected(),i._selectedItem.setNodeDirty(),i._selectedItem.activate()),void(i._state=cc.MENU_STATE_WAITING))},_onTouchCancelled:function(t,e){var i=e.getCurrentTarget();return i._state!==cc.MENU_STATE_TRACKING_TOUCH?void cc.log("cc.Menu.onTouchCancelled(): invalid state"):(i._selectedItem&&(i._selectedItem.unselected(),i._selectedItem.setNodeDirty()),void(i._state=cc.MENU_STATE_WAITING))},_onTouchMoved:function(t,e){var i=e.getCurrentTarget();if(i._state!==cc.MENU_STATE_TRACKING_TOUCH)return void cc.log("cc.Menu.onTouchMoved(): invalid state");var n=i._itemForTouch(t);n!==i._selectedItem&&(i._selectedItem&&(i._selectedItem.unselected(),i._selectedItem.setNodeDirty()),i._selectedItem=n,i._selectedItem&&(i._selectedItem.selected(),i._selectedItem.setNodeDirty()))},onExit:function(){this._state===cc.MENU_STATE_TRACKING_TOUCH&&(this._selectedItem&&(this._selectedItem.unselected(),this._selectedItem=null),this._state=cc.MENU_STATE_WAITING),cc.Node.prototype.onExit.call(this)},setOpacityModifyRGB:function(t){},isOpacityModifyRGB:function(){return!1},_itemForTouch:function(t){var e,i=t.getLocation(),n=this._children;if(n&&n.length>0)for(var r=n.length-1;r>=0;r--)if(e=n[r],e.isVisible()&&e.isEnabled()){var c=e.convertToNodeSpace(i),o=e.rect();if(o.x=0,o.y=0,cc.rectContainsPoint(o,c))return e}return null}});var _p=cc.Menu.prototype;if(_p.enabled,cc.Menu.create=function(t){var e=arguments.length;e>0&&null==arguments[e-1]&&cc.log("parameters should not be ending with null in Javascript");var i;return i=0===e?new cc.Menu:1===e?new cc.Menu(t):new cc.Menu(Array.prototype.slice.call(arguments,0))},cc.math=cc.math||{},cc.math.EPSILON=1/64,cc.math.square=function(t){return t*t},cc.math.almostEqual=function(t,e){return t+cc.math.EPSILON>e&&t-cc.math.EPSILON<e},function(t){t.math.Vec2=function(t,e){void 0===e?(this.x=t.x,this.y=t.y):(this.x=t||0,this.y=e||0)};var e=t.math.Vec2.prototype;e.fill=function(t,e){this.x=t,this.y=e},e.length=function(){return Math.sqrt(t.math.square(this.x)+t.math.square(this.y))},e.lengthSq=function(){return t.math.square(this.x)+t.math.square(this.y)},e.normalize=function(){var t=1/this.length();return this.x*=t,this.y*=t,this},t.math.Vec2.add=function(t,e,i){return t.x=e.x+i.x,t.y=e.y+i.y,t},e.add=function(t){return this.x+=t.x,this.y+=t.y,this},e.dot=function(t){return this.x*t.x+this.y*t.y},t.math.Vec2.subtract=function(t,e,i){return t.x=e.x-i.x,t.y=e.y-i.y,t},e.subtract=function(t){return this.x-=t.x,this.y-=t.y,this},e.transform=function(t){var e=this.x,i=this.y;return this.x=e*t.mat[0]+i*t.mat[3]+t.mat[6],this.y=e*t.mat[1]+i*t.mat[4]+t.mat[7],this},t.math.Vec2.scale=function(t,e,i){return t.x=e.x*i,t.y=e.y*i,t},e.scale=function(t){return this.x*=t,this.y*=t,this},e.equals=function(e){return this.x<e.x+t.math.EPSILON&&this.x>e.x-t.math.EPSILON&&this.y<e.y+t.math.EPSILON&&this.y>e.y-t.math.EPSILON}}(cc),function(t){t.math.Vec3=t.kmVec3=function(t,e,i){t&&void 0===e?(this.x=t.x,this.y=t.y,this.z=t.z):(this.x=t||0,this.y=e||0,this.z=i||0)},t.math.vec3=function(e,i,n){return new t.math.Vec3(e,i,n)};var e=t.math.Vec3.prototype;e.fill=function(t,e,i){return t&&void 0===e?(this.x=t.x,this.y=t.y,this.z=t.z):(this.x=t,this.y=e,this.z=i),this},e.length=function(){return Math.sqrt(t.math.square(this.x)+t.math.square(this.y)+t.math.square(this.z))},e.lengthSq=function(){return t.math.square(this.x)+t.math.square(this.y)+t.math.square(this.z)},e.normalize=function(){var t=1/this.length();return this.x*=t,this.y*=t,this.z*=t,this},e.cross=function(t){var e=this.x,i=this.y,n=this.z;return this.x=i*t.z-n*t.y,this.y=n*t.x-e*t.z,this.z=e*t.y-i*t.x,this},e.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z},e.add=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this},e.subtract=function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this},e.transform=function(t){var e=this.x,i=this.y,n=this.z,r=t.mat;return this.x=e*r[0]+i*r[4]+n*r[8]+r[12],this.y=e*r[1]+i*r[5]+n*r[9]+r[13],this.z=e*r[2]+i*r[6]+n*r[10]+r[14],this},e.transformNormal=function(t){var e=this.x,i=this.y,n=this.z,r=t.mat;return this.x=e*r[0]+i*r[4]+n*r[8],this.y=e*r[1]+i*r[5]+n*r[9],this.z=e*r[2]+i*r[6]+n*r[10],this},e.transformCoord=function(e){var i=new t.math.Vec4(this.x,this.y,this.z,1);return i.transform(e),this.x=i.x/i.w,this.y=i.y/i.w,this.z=i.z/i.w,this},e.scale=function(t){return this.x*=t,this.y*=t,this.z*=t,this},e.equals=function(e){var i=t.math.EPSILON;return this.x<e.x+i&&this.x>e.x-i&&this.y<e.y+i&&this.y>e.y-i&&this.z<e.z+i&&this.z>e.z-i},e.inverseTransform=function(e){var i=e.mat,n=new t.math.Vec3(this.x-i[12],this.y-i[13],this.z-i[14]);return this.x=n.x*i[0]+n.y*i[1]+n.z*i[2],this.y=n.x*i[4]+n.y*i[5]+n.z*i[6],this.z=n.x*i[8]+n.y*i[9]+n.z*i[10],this},e.inverseTransformNormal=function(t){var e=this.x,i=this.y,n=this.z,r=t.mat;return this.x=e*r[0]+i*r[1]+n*r[2],this.y=e*r[4]+i*r[5]+n*r[6],this.z=e*r[8]+i*r[9]+n*r[10],this},e.assignFrom=function(t){return t?(this.x=t.x,this.y=t.y,this.z=t.z,this):this},t.math.Vec3.zero=function(t){return t.x=t.y=t.z=0,t},e.toTypeArray=function(){var t=new Float32Array(3);return t[0]=this.x,t[1]=this.y,t[2]=this.z,t}}(cc),function(t){t.math.Vec4=function(t,e,i,n){t&&void 0===e?(this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w):(this.x=t||0,this.y=e||0,this.z=i||0,this.w=n||0)},t.kmVec4=t.math.Vec4;var e=t.math.Vec4.prototype;e.fill=function(t,e,i,n){t&&void 0===e?(this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w):(this.x=t,this.y=e,this.z=i,this.w=n)},e.add=function(t){return t?(this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this):this},e.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w},e.length=function(){return Math.sqrt(t.math.square(this.x)+t.math.square(this.y)+t.math.square(this.z)+t.math.square(this.w))},e.lengthSq=function(){return t.math.square(this.x)+t.math.square(this.y)+t.math.square(this.z)+t.math.square(this.w)},e.lerp=function(t,e){return this},e.normalize=function(){var t=1/this.length();return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},e.scale=function(t){return this.normalize(),this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},e.subtract=function(t){this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w},e.transform=function(t){var e=this.x,i=this.y,n=this.z,r=this.w,c=t.mat;return this.x=e*c[0]+i*c[4]+n*c[8]+r*c[12],this.y=e*c[1]+i*c[5]+n*c[9]+r*c[13],this.z=e*c[2]+i*c[6]+n*c[10]+r*c[14],this.w=e*c[3]+i*c[7]+n*c[11]+r*c[15],this},t.math.Vec4.transformArray=function(e,i){for(var n=[],r=0;r<e.length;r++){var c=new t.math.Vec4(e[r]);c.transform(i),n.push(c)}return n},e.equals=function(e){var i=t.math.EPSILON;return this.x<e.x+i&&this.x>e.x-i&&this.y<e.y+i&&this.y>e.y-i&&this.z<e.z+i&&this.z>e.z-i&&this.w<e.w+i&&this.w>e.w-i},e.assignFrom=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},e.toTypeArray=function(){var t=new Float32Array(4);return t[0]=this.x,t[1]=this.y,t[2]=this.z,t[3]=this.w,t}}(cc),function(t){function e(e,i,n){var r=new t.math.Vec2(i);r.subtract(e),n.x=-r.y,n.y=r.x,n.normalize()}t.math.Ray2=function(e,i){this.start=e||new t.math.Vec2,this.dir=i||new t.math.Vec2},t.math.Ray2.prototype.fill=function(t,e,i,n){this.start.x=t,this.start.y=e,this.dir.x=i,this.dir.y=n},t.math.Ray2.prototype.intersectLineSegment=function(e,i,n){var r,c,o,s=this.start.x,a=this.start.y,h=this.start.x+this.dir.x,l=this.start.y+this.dir.y,u=e.x,_=e.y,d=i.x,f=i.y,p=(f-_)*(h-s)-(d-u)*(l-a);return!(p>-t.math.EPSILON&&p<t.math.EPSILON)&&(r=((d-u)*(a-_)-(f-_)*(s-u))/p,c=s+r*(h-s),o=a+r*(l-a),!(c<Math.min(e.x,i.x)-t.math.EPSILON||c>Math.max(e.x,i.x)+t.math.EPSILON||o<Math.min(e.y,i.y)-t.math.EPSILON||o>Math.max(e.y,i.y)+t.math.EPSILON)&&(!(c<Math.min(s,h)-t.math.EPSILON||c>Math.max(s,h)+t.math.EPSILON||o<Math.min(a,l)-t.math.EPSILON||o>Math.max(a,l)+t.math.EPSILON)&&(n.x=c,n.y=o,!0)))},t.math.Ray2.prototype.intersectTriangle=function(i,n,r,c,o){var s,a=new t.math.Vec2,h=new t.math.Vec2,l=new t.math.Vec2,u=1e4,_=!1;return this.intersectLineSegment(i,n,a)&&(_=!0,s=a.subtract(this.start).length(),s<u&&(h.x=a.x,h.y=a.y,u=s,e(i,n,l))),this.intersectLineSegment(n,r,a)&&(_=!0,s=a.subtract(this.start).length(),s<u&&(h.x=a.x,h.y=a.y,u=s,e(n,r,l))),this.intersectLineSegment(r,i,a)&&(_=!0,s=a.subtract(this.start).length(),s<u&&(h.x=a.x,h.y=a.y,u=s,e(r,i,l))),_&&(c.x=h.x,c.y=h.y,o&&(o.x=l.x,o.y=l.y)),_}}(cc),window.Uint16Array=window.Uint16Array||window.Array,window.Float32Array=window.Float32Array||window.Array,function(t){t.math.Matrix3=function(t){t&&t.mat?this.mat=new Float32Array(t.mat):this.mat=new Float32Array(9)},t.kmMat3=t.math.Matrix3;var e=t.math.Matrix3.prototype;e.fill=function(t){var e=this.mat,i=t.mat;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],this},e.adjugate=function(){var t=this.mat,e=t[0],i=t[1],n=t[2],r=t[3],c=t[4],o=t[5],s=t[6],a=t[7],h=t[8];return t[0]=c*h-o*a,t[1]=n*a-i*h,t[2]=i*o-n*c,t[3]=o*s-r*h,t[4]=e*h-n*s,t[5]=n*r-e*o,t[6]=r*a-c*s,t[8]=e*c-i*r,this},e.identity=function(){var t=this.mat;return t[1]=t[2]=t[3]=t[5]=t[6]=t[7]=0,t[0]=t[4]=t[8]=1,this};var i=new t.math.Matrix3;e.inverse=function(t){if(0===t)return this;i.assignFrom(this);var e=1/t;return this.adjugate(),this.multiplyScalar(e),this},e.isIdentity=function(){var t=this.mat;return 1===t[0]&&0===t[1]&&0===t[2]&&0===t[3]&&1===t[4]&&0===t[5]&&0===t[6]&&0===t[7]&&1===t[8]},e.transpose=function(){var t=this.mat,e=t[1],i=t[2],n=t[3],r=t[5],c=t[6],o=t[7];return t[1]=n,t[2]=c,t[3]=e,t[5]=o,t[6]=i,t[7]=r,this},e.determinant=function(){var t=this.mat,e=t[0]*t[4]*t[8]+t[1]*t[5]*t[6]+t[2]*t[3]*t[7];return e-=t[2]*t[4]*t[6]+t[0]*t[5]*t[7]+t[1]*t[3]*t[8]},e.multiply=function(t){var e=this.mat,i=t.mat,n=e[0],r=e[1],c=e[2],o=e[3],s=e[4],a=e[5],h=e[6],l=e[7],u=e[8],_=i[0],d=i[1],f=i[2],p=i[3],g=i[4],m=i[5],v=i[6],T=i[7],y=i[8];return e[0]=n*_+o*d+h*f,e[1]=r*_+s*d+l*f,e[2]=c*_+a*d+u*f,e[3]=c*_+a*d+u*f,e[4]=r*p+s*g+l*m,e[5]=c*p+a*g+u*m,e[6]=n*v+o*T+h*y,e[7]=r*v+s*T+l*y,e[8]=c*v+a*T+u*y,this},e.multiplyScalar=function(t){var e=this.mat;return e[0]*=t,e[1]*=t,e[2]*=t,e[3]*=t,e[4]*=t,e[5]*=t,e[6]*=t,e[7]*=t,e[8]*=t,this},t.math.Matrix3.rotationAxisAngle=function(e,i){var n=Math.cos(i),r=Math.sin(i),c=new t.math.Matrix3,o=c.mat;return o[0]=n+e.x*e.x*(1-n),o[1]=e.z*r+e.y*e.x*(1-n),o[2]=-e.y*r+e.z*e.x*(1-n),o[3]=-e.z*r+e.x*e.y*(1-n),o[4]=n+e.y*e.y*(1-n),o[5]=e.x*r+e.z*e.y*(1-n),o[6]=e.y*r+e.x*e.z*(1-n),o[7]=-e.x*r+e.y*e.z*(1-n),o[8]=n+e.z*e.z*(1-n),c},e.assignFrom=function(e){if(this===e)return t.log("cc.math.Matrix3.assign(): current matrix equals matIn"),this;var i=this.mat,n=e.mat;return i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=n[3],i[4]=n[4],i[5]=n[5],i[6]=n[6],i[7]=n[7],i[8]=n[8],this},e.equals=function(e){if(this===e)return!0;for(var i=t.math.EPSILON,n=this.mat,r=e.mat,c=0;c<9;++c)if(!(n[c]+i>r[c]&&n[c]-i<r[c]))return!1;return!0},t.math.Matrix3.createByRotationX=function(e){var i=new t.math.Matrix3,n=i.mat;return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=Math.cos(e),n[5]=Math.sin(e),n[6]=0,n[7]=-Math.sin(e),n[8]=Math.cos(e),i},t.math.Matrix3.createByRotationY=function(e){var i=new t.math.Matrix3,n=i.mat;return n[0]=Math.cos(e),n[1]=0,n[2]=-Math.sin(e),n[3]=0,n[4]=1,n[5]=0,n[6]=Math.sin(e),n[7]=0,n[8]=Math.cos(e),i},t.math.Matrix3.createByRotationZ=function(e){var i=new t.math.Matrix3,n=i.mat;return n[0]=Math.cos(e),n[1]=-Math.sin(e),n[2]=0,n[3]=Math.sin(e),n[4]=Math.cos(e),n[5]=0,n[6]=0,n[7]=0,n[8]=1,i},t.math.Matrix3.createByRotation=function(e){var i=new t.math.Matrix3,n=i.mat;return n[0]=Math.cos(e),n[1]=Math.sin(e),n[2]=0,n[3]=-Math.sin(e),n[4]=Math.cos(e),n[5]=0,n[6]=0,n[7]=0,n[8]=1,i},t.math.Matrix3.createByScale=function(e,i){var n=new t.math.Matrix3;return n.identity(),n.mat[0]=e,n.mat[4]=i,n},t.math.Matrix3.createByTranslation=function(e,i){var n=new t.math.Matrix3;return n.identity(),n.mat[6]=e,n.mat[7]=i,n},t.math.Matrix3.createByQuaternion=function(e){if(!e)return null;var i=new t.math.Matrix3,n=i.mat;return n[0]=1-2*(e.y*e.y+e.z*e.z),n[1]=2*(e.x*e.y-e.w*e.z),n[2]=2*(e.x*e.z+e.w*e.y),n[3]=2*(e.x*e.y+e.w*e.z),n[4]=1-2*(e.x*e.x+e.z*e.z),n[5]=2*(e.y*e.z-e.w*e.x),n[6]=2*(e.x*e.z-e.w*e.y),n[7]=2*(e.y*e.z+e.w*e.x),n[8]=1-2*(e.x*e.x+e.y*e.y),i},e.rotationToAxisAngle=function(){return t.math.Quaternion.rotationMatrix(this).toAxisAndAngle()}}(cc),function(t){t.math.Matrix4=function(t){t&&t.mat?this.mat=new Float32Array(t.mat):this.mat=new Float32Array(16)},t.kmMat4=t.math.Matrix4;var e=t.math.Matrix4.prototype;e.fill=function(t){for(var e=this.mat,i=0;i<16;i++)e[i]=t[i];return this},t.kmMat4Identity=function(t){var e=t.mat;return e[1]=e[2]=e[3]=e[4]=e[6]=e[7]=e[8]=e[9]=e[11]=e[12]=e[13]=e[14]=0,e[0]=e[5]=e[10]=e[15]=1,t},e.identity=function(){var t=this.mat;return t[1]=t[2]=t[3]=t[4]=t[6]=t[7]=t[8]=t[9]=t[11]=t[12]=t[13]=t[14]=0,t[0]=t[5]=t[10]=t[15]=1,this},e.get=function(t,e){return this.mat[t+4*e]},e.set=function(t,e,i){this.mat[t+4*e]=i},e.swap=function(t,e,i,n){var r=this.mat,c=r[t+4*e];r[t+4*e]=r[i+4*n],r[i+4*n]=c},t.math.Matrix4._gaussj=function(t,e){var i,n,r,c,o,s,a,h,l,u=0,_=0,d=4,f=4,p=[0,0,0,0],g=[0,0,0,0],m=[0,0,0,0];for(i=0;i<d;i++){for(a=0,n=0;n<d;n++)if(1!==m[n])for(r=0;r<d;r++)0===m[r]&&(s=Math.abs(t.get(n,r)),s>=a&&(a=s,_=n,u=r));if(++m[u],_!==u){for(c=0;c<d;c++)t.swap(_,c,u,c);for(c=0;c<f;c++)e.swap(_,c,u,c)}if(g[i]=_,p[i]=u,0===t.get(u,u))return!1;for(l=1/t.get(u,u),t.set(u,u,1),c=0;c<d;c++)t.set(u,c,t.get(u,c)*l);for(c=0;c<f;c++)e.set(u,c,e.get(u,c)*l);for(o=0;o<d;o++)if(o!==u){for(h=t.get(o,u),t.set(o,u,0),c=0;c<d;c++)t.set(o,c,t.get(o,c)-t.get(u,c)*h);for(c=0;c<f;c++)e.set(o,c,t.get(o,c)-e.get(u,c)*h)}}for(c=d-1;c>=0;c--)if(g[c]!==p[c])for(r=0;r<d;r++)t.swap(r,g[c],r,p[c]);return!0};var i=(new t.math.Matrix4).identity();t.kmMat4Inverse=function(e,n){var r=new t.math.Matrix4(n),c=new t.math.Matrix4(i);return t.math.Matrix4._gaussj(r,c)===!1?null:(e.assignFrom(r),e)},e.inverse=function(){var e=new t.math.Matrix4(this),n=new t.math.Matrix4(i);return t.math.Matrix4._gaussj(e,n)===!1?null:e},e.isIdentity=function(){var t=this.mat;return 1===t[0]&&0===t[1]&&0===t[2]&&0===t[3]&&0===t[4]&&1===t[5]&&0===t[6]&&0===t[7]&&0===t[8]&&0===t[9]&&1===t[10]&&0===t[11]&&0===t[12]&&0===t[13]&&0===t[14]&&1===t[15]},e.transpose=function(){var t=this.mat,e=t[1],i=t[2],n=t[3],r=t[4],c=t[6],o=t[7],s=t[8],a=t[9],h=t[11],l=t[12],u=t[13],_=t[14];return t[1]=r,t[2]=s,t[3]=l,t[4]=e,t[6]=a,t[7]=u,t[8]=i,t[9]=c,t[11]=_,t[12]=n,t[13]=o,t[14]=h,this},t.kmMat4Multiply=function(t,e,i){var n=t.mat,r=e.mat,c=i.mat,o=r[0],s=r[1],a=r[2],h=r[3],l=r[4],u=r[5],_=r[6],d=r[7],f=r[8],p=r[9],g=r[10],m=r[11],v=r[12],T=r[13],y=r[14],S=r[15],C=c[0],E=c[1],b=c[2],x=c[3],A=c[4],R=c[5],w=c[6],I=c[7],L=c[8],O=c[9],P=c[10],F=c[11],D=c[12],N=c[13],B=c[14],M=c[15];return n[0]=C*o+E*l+b*f+x*v,n[1]=C*s+E*u+b*p+x*T,n[2]=C*a+E*_+b*g+x*y,n[3]=C*h+E*d+b*m+x*S,n[4]=A*o+R*l+w*f+I*v,n[5]=A*s+R*u+w*p+I*T,n[6]=A*a+R*_+w*g+I*y,n[7]=A*h+R*d+w*m+I*S,n[8]=L*o+O*l+P*f+F*v,n[9]=L*s+O*u+P*p+F*T,n[10]=L*a+O*_+P*g+F*y,n[11]=L*h+O*d+P*m+F*S,n[12]=D*o+N*l+B*f+M*v,n[13]=D*s+N*u+B*p+M*T,n[14]=D*a+N*_+B*g+M*y,n[15]=D*h+N*d+B*m+M*S,t},e.multiply=function(t){var e=this.mat,i=t.mat,n=e[0],r=e[1],c=e[2],o=e[3],s=e[4],a=e[5],h=e[6],l=e[7],u=e[8],_=e[9],d=e[10],f=e[11],p=e[12],g=e[13],m=e[14],v=e[15],T=i[0],y=i[1],S=i[2],C=i[3],E=i[4],b=i[5],x=i[6],A=i[7],R=i[8],w=i[9],I=i[10],L=i[11],O=i[12],P=i[13],F=i[14],D=i[15];return e[0]=T*n+y*s+S*u+C*p,e[1]=T*r+y*a+S*_+C*g,e[2]=T*c+y*h+S*d+C*m,e[3]=T*o+y*l+S*f+C*v,e[4]=E*n+b*s+x*u+A*p,e[5]=E*r+b*a+x*_+A*g,e[6]=E*c+b*h+x*d+A*m,e[7]=E*o+b*l+x*f+A*v,e[8]=R*n+w*s+I*u+L*p,e[9]=R*r+w*a+I*_+L*g,e[10]=R*c+w*h+I*d+L*m,e[11]=R*o+w*l+I*f+L*v,e[12]=O*n+P*s+F*u+D*p,e[13]=O*r+P*a+F*_+D*g,e[14]=O*c+P*h+F*d+D*m,e[15]=O*o+P*l+F*f+D*v,this},t.getMat4MultiplyValue=function(t,e){var i=t.mat,n=e.mat,r=new Float32Array(16);return r[0]=i[0]*n[0]+i[4]*n[1]+i[8]*n[2]+i[12]*n[3],r[1]=i[1]*n[0]+i[5]*n[1]+i[9]*n[2]+i[13]*n[3],r[2]=i[2]*n[0]+i[6]*n[1]+i[10]*n[2]+i[14]*n[3],r[3]=i[3]*n[0]+i[7]*n[1]+i[11]*n[2]+i[15]*n[3],r[4]=i[0]*n[4]+i[4]*n[5]+i[8]*n[6]+i[12]*n[7],r[5]=i[1]*n[4]+i[5]*n[5]+i[9]*n[6]+i[13]*n[7],r[6]=i[2]*n[4]+i[6]*n[5]+i[10]*n[6]+i[14]*n[7],r[7]=i[3]*n[4]+i[7]*n[5]+i[11]*n[6]+i[15]*n[7],r[8]=i[0]*n[8]+i[4]*n[9]+i[8]*n[10]+i[12]*n[11],r[9]=i[1]*n[8]+i[5]*n[9]+i[9]*n[10]+i[13]*n[11],r[10]=i[2]*n[8]+i[6]*n[9]+i[10]*n[10]+i[14]*n[11],r[11]=i[3]*n[8]+i[7]*n[9]+i[11]*n[10]+i[15]*n[11],r[12]=i[0]*n[12]+i[4]*n[13]+i[8]*n[14]+i[12]*n[15],r[13]=i[1]*n[12]+i[5]*n[13]+i[9]*n[14]+i[13]*n[15],r[14]=i[2]*n[12]+i[6]*n[13]+i[10]*n[14]+i[14]*n[15],r[15]=i[3]*n[12]+i[7]*n[13]+i[11]*n[14]+i[15]*n[15],r},t.kmMat4Assign=function(e,i){if(e===i)return t.log("cc.kmMat4Assign(): pOut equals pIn"),e;var n=e.mat,r=i.mat;return n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=r[3],n[4]=r[4],n[5]=r[5],n[6]=r[6],n[7]=r[7],n[8]=r[8],n[9]=r[9],n[10]=r[10],n[11]=r[11],n[12]=r[12],n[13]=r[13],n[14]=r[14],n[15]=r[15],e},e.assignFrom=function(e){if(this===e)return t.log("cc.mat.Matrix4.assignFrom(): mat4 equals current matrix"),this;var i=this.mat,n=e.mat;return i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=n[3],i[4]=n[4],i[5]=n[5],i[6]=n[6],i[7]=n[7],i[8]=n[8],i[9]=n[9],i[10]=n[10],i[11]=n[11],i[12]=n[12],i[13]=n[13],i[14]=n[14],i[15]=n[15],this},e.equals=function(e){if(this===e)return t.log("cc.kmMat4AreEqual(): pMat1 and pMat2 are same object."),!0;for(var i=this.mat,n=e.mat,r=t.math.EPSILON,c=0;c<16;c++)if(!(i[c]+r>n[c]&&i[c]-r<n[c]))return!1;return!0},t.math.Matrix4.createByRotationX=function(e,i){i=i||new t.math.Matrix4;var n=i.mat;return n[0]=1,n[3]=n[2]=n[1]=0,n[4]=0,n[5]=Math.cos(e),n[6]=Math.sin(e),n[7]=0,n[8]=0,n[9]=-Math.sin(e),n[10]=Math.cos(e),n[11]=0,n[14]=n[13]=n[12]=0,n[15]=1,i},t.math.Matrix4.createByRotationY=function(e,i){i=i||new t.math.Matrix4;var n=i.mat;return n[0]=Math.cos(e),n[1]=0,n[2]=-Math.sin(e),n[3]=0,n[7]=n[6]=n[4]=0,n[5]=1,n[8]=Math.sin(e),n[9]=0,n[10]=Math.cos(e),n[11]=0,n[14]=n[13]=n[12]=0,n[15]=1,i},t.math.Matrix4.createByRotationZ=function(e,i){i=i||new t.math.Matrix4;var n=i.mat;return n[0]=Math.cos(e),n[1]=Math.sin(e),n[3]=n[2]=0,n[4]=-Math.sin(e),n[5]=Math.cos(e),n[7]=n[6]=0,n[11]=n[9]=n[8]=0,n[10]=1,n[14]=n[13]=n[12]=0,n[15]=1,i},t.math.Matrix4.createByPitchYawRoll=function(e,i,n,r){r=r||new t.math.Matrix4;var c=Math.cos(e),o=Math.sin(e),s=Math.cos(i),a=Math.sin(i),h=Math.cos(n),l=Math.sin(n),u=o*a,_=c*a,d=r.mat;return d[0]=s*h,d[4]=s*l,d[8]=-a,d[1]=u*h-c*l,d[5]=u*l+c*h,d[9]=o*s,d[2]=_*h+o*l,d[6]=_*l-o*h,d[10]=c*s,d[3]=d[7]=d[11]=0,d[15]=1,r},t.math.Matrix4.createByQuaternion=function(e,i){i=i||new t.math.Matrix4;var n=i.mat;return n[0]=1-2*(e.y*e.y+e.z*e.z),n[1]=2*(e.x*e.y+e.z*e.w),n[2]=2*(e.x*e.z-e.y*e.w),n[3]=0,n[4]=2*(e.x*e.y-e.z*e.w),n[5]=1-2*(e.x*e.x+e.z*e.z),n[6]=2*(e.z*e.y+e.x*e.w),n[7]=0,n[8]=2*(e.x*e.z+e.y*e.w),n[9]=2*(e.y*e.z-e.x*e.w),n[10]=1-2*(e.x*e.x+e.y*e.y),n[11]=0,n[14]=n[13]=n[12]=0,n[15]=1,i},t.math.Matrix4.createByRotationTranslation=function(e,i,n){n=n||new t.math.Matrix4;var r=n.mat,c=e.mat;return r[0]=c[0],r[1]=c[1],r[2]=c[2],r[3]=0,r[4]=c[3],r[5]=c[4],r[6]=c[5],r[7]=0,r[8]=c[6],r[9]=c[7],r[10]=c[8],r[11]=0,r[12]=i.x,r[13]=i.y,r[14]=i.z,r[15]=1,n},t.math.Matrix4.createByScale=function(e,i,n,r){r=r||new t.math.Matrix4;var c=r.mat;return c[0]=e,c[5]=i,c[10]=n,c[15]=1,c[1]=c[2]=c[3]=c[4]=c[6]=c[7]=c[8]=c[9]=c[11]=c[12]=c[13]=c[14]=0,r},t.kmMat4Translation=function(t,e,i,n){return t.mat[0]=t.mat[5]=t.mat[10]=t.mat[15]=1,t.mat[1]=t.mat[2]=t.mat[3]=t.mat[4]=t.mat[6]=t.mat[7]=t.mat[8]=t.mat[9]=t.mat[11]=0,t.mat[12]=e,t.mat[13]=i,t.mat[14]=n,t},t.math.Matrix4.createByTranslation=function(e,i,n,r){return r=r||new t.math.Matrix4,r.identity(),r.mat[12]=e,r.mat[13]=i,r.mat[14]=n,r},e.getUpVec3=function(){var e=this.mat,i=new t.math.Vec3(e[4],e[5],e[6]);return i.normalize()},e.getRightVec3=function(){var e=this.mat,i=new t.math.Vec3(e[0],e[1],e[2]);return i.normalize()},e.getForwardVec3=function(){var e=this.mat,i=new t.math.Vec3(e[8],e[9],e[10]);return i.normalize()},t.kmMat4PerspectiveProjection=function(e,i,n,r,c){var o=t.degreesToRadians(i/2),s=c-r,a=Math.sin(o);if(0===s||0===a||0===n)return null;var h=Math.cos(o)/a;return e.identity(),e.mat[0]=h/n,e.mat[5]=h,e.mat[10]=-(c+r)/s,e.mat[11]=-1,e.mat[14]=-2*r*c/s,e.mat[15]=0,e},t.math.Matrix4.createPerspectiveProjection=function(e,i,n,r){var c=t.degreesToRadians(e/2),o=r-n,s=Math.sin(c);if(0===o||0===s||0===i)return null;var a=Math.cos(c)/s,h=new t.math.Matrix4,l=h.mat;return h.identity(),l[0]=a/i,l[5]=a,l[10]=-(r+n)/o,l[11]=-1,l[14]=-2*n*r/o,l[15]=0,h},t.kmMat4OrthographicProjection=function(t,e,i,n,r,c,o){return t.identity(),t.mat[0]=2/(i-e),t.mat[5]=2/(r-n),t.mat[10]=-2/(o-c),t.mat[12]=-((i+e)/(i-e)),t.mat[13]=-((r+n)/(r-n)),t.mat[14]=-((o+c)/(o-c)),t},t.math.Matrix4.createOrthographicProjection=function(e,i,n,r,c,o){var s=new t.math.Matrix4,a=s.mat;return s.identity(),a[0]=2/(i-e),a[5]=2/(r-n),a[10]=-2/(o-c),a[12]=-((i+e)/(i-e)),a[13]=-((r+n)/(r-n)),a[14]=-((o+c)/(o-c)),s},t.kmMat4LookAt=function(e,i,n,r){var c=new t.math.Vec3(n),o=new t.math.Vec3(r);c.subtract(i),c.normalize(),o.normalize();var s=new t.math.Vec3(c);s.cross(o),s.normalize();var a=new t.math.Vec3(s);a.cross(c),s.normalize(),e.identity(),e.mat[0]=s.x,e.mat[4]=s.y,e.mat[8]=s.z,e.mat[1]=a.x,e.mat[5]=a.y,e.mat[9]=a.z,e.mat[2]=-c.x,e.mat[6]=-c.y,e.mat[10]=-c.z;var h=t.math.Matrix4.createByTranslation(-i.x,-i.y,-i.z);return e.multiply(h),e};var n=new t.math.Matrix4;e.lookAt=function(e,i,r){var c=new t.math.Vec3(i),o=new t.math.Vec3(r),s=this.mat;c.subtract(e),c.normalize(),o.normalize();var a=new t.math.Vec3(c);a.cross(o),a.normalize();var h=new t.math.Vec3(a);return h.cross(c),a.normalize(),this.identity(),s[0]=a.x,s[4]=a.y,s[8]=a.z,s[1]=h.x,s[5]=h.y,s[9]=h.z,s[2]=-c.x,s[6]=-c.y,s[10]=-c.z,n=t.math.Matrix4.createByTranslation(-e.x,-e.y,-e.z,n),this.multiply(n),this},t.kmMat4RotationAxisAngle=function(e,i,n){var r=Math.cos(n),c=Math.sin(n),o=new t.math.Vec3(i);return o.normalize(),e.mat[0]=r+o.x*o.x*(1-r),e.mat[1]=o.z*c+o.y*o.x*(1-r),e.mat[2]=-o.y*c+o.z*o.x*(1-r),e.mat[3]=0,e.mat[4]=-o.z*c+o.x*o.y*(1-r),e.mat[5]=r+o.y*o.y*(1-r),e.mat[6]=o.x*c+o.z*o.y*(1-r),e.mat[7]=0,e.mat[8]=o.y*c+o.x*o.z*(1-r),e.mat[9]=-o.x*c+o.y*o.z*(1-r),e.mat[10]=r+o.z*o.z*(1-r),e.mat[11]=0,e.mat[12]=0,e.mat[13]=0,e.mat[14]=0,e.mat[15]=1,e},t.math.Matrix4.createByAxisAndAngle=function(e,i,n){n=n||new t.math.Matrix4;var r=this.mat,c=Math.cos(i),o=Math.sin(i),s=new t.math.Vec3(e);return s.normalize(),r[0]=c+s.x*s.x*(1-c),r[1]=s.z*o+s.y*s.x*(1-c),r[2]=-s.y*o+s.z*s.x*(1-c),r[3]=0,r[4]=-s.z*o+s.x*s.y*(1-c),r[5]=c+s.y*s.y*(1-c),r[6]=s.x*o+s.z*s.y*(1-c),r[7]=0,r[8]=s.y*o+s.x*s.z*(1-c),r[9]=-s.x*o+s.y*s.z*(1-c),r[10]=c+s.z*s.z*(1-c),r[11]=0,r[12]=r[13]=r[14]=0,r[15]=1,n},e.extractRotation=function(){var e=new t.math.Matrix3,i=this.mat,n=e.mat;return n[0]=i[0],n[1]=i[1],n[2]=i[2],n[3]=i[4],n[4]=i[5],n[5]=i[6],n[6]=i[8],n[7]=i[9],n[8]=i[10],e},e.extractPlane=function(e){var i=new t.math.Plane,n=this.mat;switch(e){case t.math.Plane.RIGHT:i.a=n[3]-n[0],i.b=n[7]-n[4],i.c=n[11]-n[8],i.d=n[15]-n[12];break;case t.math.Plane.LEFT:i.a=n[3]+n[0],i.b=n[7]+n[4],i.c=n[11]+n[8],i.d=n[15]+n[12];break;case t.math.Plane.BOTTOM:i.a=n[3]+n[1],i.b=n[7]+n[5],i.c=n[11]+n[9],i.d=n[15]+n[13];break;case t.math.Plane.TOP:i.a=n[3]-n[1],i.b=n[7]-n[5],i.c=n[11]-n[9],i.d=n[15]-n[13];break;case t.math.Plane.FAR:i.a=n[3]-n[2],i.b=n[7]-n[6],i.c=n[11]-n[10],i.d=n[15]-n[14];break;case t.math.Plane.NEAR:i.a=n[3]+n[2],i.b=n[7]+n[6],i.c=n[11]+n[10],i.d=n[15]+n[14];break;default:t.log("cc.math.Matrix4.extractPlane: Invalid plane index")}var r=Math.sqrt(i.a*i.a+i.b*i.b+i.c*i.c);return i.a/=r,i.b/=r,i.c/=r,i.d/=r,i},e.toAxisAndAngle=function(){var e=this.extractRotation(),i=t.math.Quaternion.rotationMatrix(e);return i.toAxisAndAngle()}}(cc),function(t){t.math.Plane=function(t,e,i,n){t&&void 0===e?(this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d):(this.a=t||0,this.b=e||0,this.c=i||0,this.d=n||0)},t.kmPlane=t.math.Plane;var e=t.math.Plane.prototype;t.math.Plane.LEFT=0,t.math.Plane.RIGHT=1,t.math.Plane.BOTTOM=2,t.math.Plane.TOP=3,t.math.Plane.NEAR=4,t.math.Plane.FAR=5,t.math.Plane.POINT_INFRONT_OF_PLANE=0,t.math.Plane.POINT_BEHIND_PLANE=1,t.math.Plane.POINT_ON_PLANE=2,e.dot=function(t){return this.a*t.x+this.b*t.y+this.c*t.z+this.d*t.w},e.dotCoord=function(t){return this.a*t.x+this.b*t.y+this.c*t.z+this.d},e.dotNormal=function(t){return this.a*t.x+this.b*t.y+this.c*t.z},t.math.Plane.fromPointNormal=function(e,i){return new t.math.Plane(i.x,i.y,i.z,-i.dot(e));
},t.math.Plane.fromPoints=function(e,i,n){var r=new t.math.Vec3(i),c=new t.math.Vec3(n),o=new t.math.Plane;return r.subtract(e),c.subtract(e),r.cross(c),r.normalize(),o.a=r.x,o.b=r.y,o.c=r.z,o.d=r.scale(-1).dot(e),o},e.normalize=function(){var e=new t.math.Vec3(this.a,this.b,this.c),i=1/e.length();return e.normalize(),this.a=e.x,this.b=e.y,this.c=e.z,this.d=this.d*i,this},e.classifyPoint=function(e){var i=this.a*e.x+this.b*e.y+this.c*e.z+this.d;return i>.001?t.math.Plane.POINT_INFRONT_OF_PLANE:i<-.001?t.math.Plane.POINT_BEHIND_PLANE:t.math.Plane.POINT_ON_PLANE}}(cc),function(t){t.math.Quaternion=function(t,e,i,n){t&&void 0===e?(this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w):(this.x=t||0,this.y=e||0,this.z=i||0,this.w=n||0)},t.kmQuaternion=t.math.Quaternion;var e=t.math.Quaternion.prototype;e.conjugate=function(t){return this.x=-t.x,this.y=-t.y,this.z=-t.z,this.w=t.w,this},e.dot=function(t){return this.w*t.w+this.x*t.x+this.y*t.y+this.z*t.z},e.exponential=function(){return this},e.identity=function(){return this.x=0,this.y=0,this.z=0,this.w=1,this},e.inverse=function(){var e=this.length();return Math.abs(e)>t.math.EPSILON?(this.x=0,this.y=0,this.z=0,this.w=0,this):(this.conjugate(this).scale(1/e),this)},e.isIdentity=function(){return 0===this.x&&0===this.y&&0===this.z&&1===this.w},e.length=function(){return Math.sqrt(this.lengthSq())},e.lengthSq=function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},e.multiply=function(t){var e=this.x,i=this.y,n=this.z,r=this.w;return this.w=r*t.w-e*t.x-i*t.y-n*t.z,this.x=r*t.x+e*t.w+i*t.z-n*t.y,this.y=r*t.y+i*t.w+n*t.x-e*t.z,this.z=r*t.z+n*t.w+e*t.y-i*t.x,this},e.normalize=function(){var e=this.length();if(Math.abs(e)<=t.math.EPSILON)throw new Error("current quaternion is an invalid value");return this.scale(1/e),this},e.rotationAxis=function(t,e){var i=.5*e,n=Math.sin(i);return this.w=Math.cos(i),this.x=t.x*n,this.y=t.y*n,this.z=t.z*n,this},t.math.Quaternion.rotationMatrix=function(e){if(!e)return null;var i,n,r,c,o=[],s=e.mat,a=0;o[0]=s[0],o[1]=s[3],o[2]=s[6],o[4]=s[1],o[5]=s[4],o[6]=s[7],o[8]=s[2],o[9]=s[5],o[10]=s[8],o[15]=1;var h=o[0],l=h[0]+h[5]+h[10]+1;return l>t.math.EPSILON?(a=2*Math.sqrt(l),i=(h[9]-h[6])/a,n=(h[2]-h[8])/a,r=(h[4]-h[1])/a,c=.25*a):h[0]>h[5]&&h[0]>h[10]?(a=2*Math.sqrt(1+h[0]-h[5]-h[10]),i=.25*a,n=(h[4]+h[1])/a,r=(h[2]+h[8])/a,c=(h[9]-h[6])/a):h[5]>h[10]?(a=2*Math.sqrt(1+h[5]-h[0]-h[10]),i=(h[4]+h[1])/a,n=.25*a,r=(h[9]+h[6])/a,c=(h[2]-h[8])/a):(a=2*Math.sqrt(1+h[10]-h[0]-h[5]),i=(h[2]+h[8])/a,n=(h[9]+h[6])/a,r=.25*a,c=(h[4]-h[1])/a),new t.math.Quaternion(i,n,r,c)},t.math.Quaternion.rotationYawPitchRoll=function(e,i,n){var r,c,o,s,a,h,l,u,_,d,f;r=t.degreesToRadians(i)/2,c=t.degreesToRadians(e)/2,o=t.degreesToRadians(n)/2,s=Math.cos(r),a=Math.cos(c),h=Math.cos(o),l=Math.sin(r),u=Math.sin(c),_=Math.sin(o),d=a*h,f=u*_;var p=new t.math.Quaternion;return p.w=s*d+l*f,p.x=l*d-s*f,p.y=s*u*h+l*a*_,p.z=s*a*_-l*u*h,p.normalize(),p},e.slerp=function(e,i){if(this.x===e.x&&this.y===e.y&&this.z===e.z&&this.w===e.w)return this;var n=this.dot(e),r=Math.acos(n),c=Math.sqrt(1-t.math.square(n)),o=Math.sin(i*r)/c,s=Math.sin((1-i)*r)/c,a=new t.math.Quaternion(e);return this.scale(s),a.scale(o),this.add(a),this},e.toAxisAndAngle=function(){var e,i,n,r=new t.math.Vec3;return e=Math.acos(this.w),i=Math.sqrt(t.math.square(this.x)+t.math.square(this.y)+t.math.square(this.z)),i>-t.math.EPSILON&&i<t.math.EPSILON||i<2*Math.PI+t.math.EPSILON&&i>2*Math.PI-t.math.EPSILON?(n=0,r.x=0,r.y=0,r.z=1):(n=2*e,r.x=this.x/i,r.y=this.y/i,r.z=this.z/i,r.normalize()),{axis:r,angle:n}},e.scale=function(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},e.assignFrom=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},e.add=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this},t.math.Quaternion.rotationBetweenVec3=function(e,i,n){var r=new t.math.Vec3(e),c=new t.math.Vec3(i);r.normalize(),c.normalize();var o=r.dot(c),s=new t.math.Quaternion;if(o>=1)return s.identity(),s;if(o<1e-6-1)if(Math.abs(n.lengthSq())<t.math.EPSILON)s.rotationAxis(n,Math.PI);else{var a=new t.math.Vec3(1,0,0);a.cross(e),Math.abs(a.lengthSq())<t.math.EPSILON&&(a.fill(0,1,0),a.cross(e)),a.normalize(),s.rotationAxis(a,Math.PI)}else{var h=Math.sqrt(2*(1+o)),l=1/h;r.cross(c),s.x=r.x*l,s.y=r.y*l,s.z=r.z*l,s.w=.5*h,s.normalize()}return s},e.multiplyVec3=function(e){var i=this.x,n=this.y,r=this.z,c=new t.math.Vec3(e),o=new t.math.Vec3(i,n,r),s=new t.math.Vec3(i,n,r);return o.cross(e),s.cross(o),o.scale(2*q.w),s.scale(2),c.add(o),c.add(s),c}}(cc),cc.math.AABB=function(t,e){this.min=t||new cc.math.Vec3,this.max=e||new cc.math.Vec3},cc.math.AABB.prototype.containsPoint=function(t){return t.x>=this.min.x&&t.x<=this.max.x&&t.y>=this.min.y&&t.y<=this.max.y&&t.z>=this.min.z&&t.z<=this.max.z},cc.math.AABB.containsPoint=function(t,e){return t.x>=e.min.x&&t.x<=e.max.x&&t.y>=e.min.y&&t.y<=e.max.y&&t.z>=e.min.z&&t.z<=e.max.z},cc.math.AABB.prototype.assignFrom=function(t){this.min.assignFrom(t.min),this.max.assignFrom(t.max)},cc.math.AABB.assign=function(t,e){return t.min.assignFrom(e.min),t.max.assignFrom(e.max),t},function(t){t.math.Matrix4Stack=function(t,e){this.top=t,this.stack=e||[]},t.km_mat4_stack=t.math.Matrix4Stack;var e=t.math.Matrix4Stack.prototype;e.initialize=function(){this.stack.length=0,this.top=null},t.km_mat4_stack_push=function(e,i){e.stack.push(e.top),e.top=new t.math.Matrix4(i)},t.km_mat4_stack_pop=function(t,e){t.top=t.stack.pop()},t.km_mat4_stack_release=function(t){t.stack=null,t.top=null},e.push=function(e){e=e||this.top,this.stack.push(this.top),this.top=new t.math.Matrix4(e)},e.pop=function(){this.top=this.stack.pop()},e.release=function(){this.stack=null,this.top=null,this._matrixPool=null},e._getFromPool=function(e){var i=this._matrixPool;if(0===i.length)return new t.math.Matrix4(e);var n=i.pop();return n.assignFrom(e),n},e._putInPool=function(t){this._matrixPool.push(t)}}(cc),function(t){t.KM_GL_MODELVIEW=5888,t.KM_GL_PROJECTION=5889,t.KM_GL_TEXTURE=5890,t.modelview_matrix_stack=new t.math.Matrix4Stack,t.projection_matrix_stack=new t.math.Matrix4Stack,t.texture_matrix_stack=new t.math.Matrix4Stack,t.current_stack=null;var e=!1;t.lazyInitialize=function(){if(!e){var i=new t.math.Matrix4;t.modelview_matrix_stack.initialize(),t.projection_matrix_stack.initialize(),t.texture_matrix_stack.initialize(),t.current_stack=t.modelview_matrix_stack,t.initialized=!0,i.identity(),t.modelview_matrix_stack.push(i),t.projection_matrix_stack.push(i),t.texture_matrix_stack.push(i)}},t.lazyInitialize(),t.kmGLFreeAll=function(){t.modelview_matrix_stack.release(),t.modelview_matrix_stack=null,t.projection_matrix_stack.release(),t.projection_matrix_stack=null,t.texture_matrix_stack.release(),t.texture_matrix_stack=null,t.initialized=!1,t.current_stack=null},t.kmGLPushMatrix=function(){t.current_stack.push(t.current_stack.top)},t.kmGLPushMatrixWitMat4=function(e){t.current_stack.stack.push(t.current_stack.top),e.assignFrom(t.current_stack.top),t.current_stack.top=e},t.kmGLPopMatrix=function(){t.current_stack.top=t.current_stack.stack.pop()},t.kmGLMatrixMode=function(e){switch(e){case t.KM_GL_MODELVIEW:t.current_stack=t.modelview_matrix_stack;break;case t.KM_GL_PROJECTION:t.current_stack=t.projection_matrix_stack;break;case t.KM_GL_TEXTURE:t.current_stack=t.texture_matrix_stack;break;default:throw new Error("Invalid matrix mode specified")}},t.kmGLLoadIdentity=function(){t.current_stack.top.identity()},t.kmGLLoadMatrix=function(e){t.current_stack.top.assignFrom(e)},t.kmGLMultMatrix=function(e){t.current_stack.top.multiply(e)};var i=new t.math.Matrix4;t.kmGLTranslatef=function(e,n,r){var c=t.math.Matrix4.createByTranslation(e,n,r,i);t.current_stack.top.multiply(c)};var n=new t.math.Vec3;t.kmGLRotatef=function(e,r,c,o){n.fill(r,c,o);var s=t.math.Matrix4.createByAxisAndAngle(n,t.degreesToRadians(e),i);t.current_stack.top.multiply(s)},t.kmGLScalef=function(e,n,r){var c=t.math.Matrix4.createByScale(e,n,r,i);t.current_stack.top.multiply(c)},t.kmGLGetMatrix=function(e,i){switch(e){case t.KM_GL_MODELVIEW:i.assignFrom(t.modelview_matrix_stack.top);break;case t.KM_GL_PROJECTION:i.assignFrom(t.projection_matrix_stack.top);break;case t.KM_GL_TEXTURE:i.assignFrom(t.texture_matrix_stack.top);break;default:throw new Error("Invalid matrix mode specified")}}}(cc),cc.SHADER_POSITION_UCOLOR_FRAG="precision lowp float;\nvarying vec4 v_fragmentColor;\nvoid main()                              \n{ \n    gl_FragColor = v_fragmentColor;      \n}\n",cc.SHADER_POSITION_UCOLOR_VERT="attribute vec4 a_position;\nuniform    vec4 u_color;\nuniform float u_pointSize;\nvarying lowp vec4 v_fragmentColor; \nvoid main(void)   \n{\n    gl_Position = (CC_PMatrix * CC_MVMatrix) * a_position;  \n    gl_PointSize = u_pointSize;          \n    v_fragmentColor = u_color;           \n}",cc.SHADER_POSITION_COLOR_FRAG="precision lowp float; \nvarying vec4 v_fragmentColor; \nvoid main() \n{ \n     gl_FragColor = v_fragmentColor; \n} ",cc.SHADER_POSITION_COLOR_VERT="attribute vec4 a_position;\nattribute vec4 a_color;\nvarying lowp vec4 v_fragmentColor;\nvoid main()\n{\n    gl_Position = (CC_PMatrix * CC_MVMatrix) * a_position;  \n    v_fragmentColor = a_color;             \n}",cc.SHADER_SPRITE_POSITION_COLOR_VERT="attribute vec4 a_position;\nattribute vec4 a_color;\nvarying lowp vec4 v_fragmentColor;\nvoid main()\n{\n    gl_Position = CC_PMatrix * a_position;  \n    v_fragmentColor = a_color;             \n}",cc.SHADER_POSITION_COLOR_LENGTH_TEXTURE_FRAG="// #extension GL_OES_standard_derivatives : enable\nvarying mediump vec4 v_color;\nvarying mediump vec2 v_texcoord;\nvoid main()\t\n{ \n// #if defined GL_OES_standard_derivatives\t\n// gl_FragColor = v_color*smoothstep(0.0, length(fwidth(v_texcoord)), 1.0 - length(v_texcoord)); \n// #else\t\ngl_FragColor = v_color * step(0.0, 1.0 - length(v_texcoord)); \n// #endif \n}",cc.SHADER_POSITION_COLOR_LENGTH_TEXTURE_VERT="attribute mediump vec4 a_position; \nattribute mediump vec2 a_texcoord; \nattribute mediump vec4 a_color;\t\nvarying mediump vec4 v_color; \nvarying mediump vec2 v_texcoord;\t\nvoid main() \n{ \n     v_color = a_color;//vec4(a_color.rgb * a_color.a, a_color.a); \n     v_texcoord = a_texcoord; \n    gl_Position = (CC_PMatrix * CC_MVMatrix) * a_position;  \n}",cc.SHADER_POSITION_TEXTURE_FRAG="precision lowp float;   \nvarying vec2 v_texCoord;  \nvoid main() \n{  \n    gl_FragColor =  texture2D(CC_Texture0, v_texCoord);   \n}",cc.SHADER_POSITION_TEXTURE_VERT="attribute vec4 a_position; \nattribute vec2 a_texCoord; \nvarying mediump vec2 v_texCoord; \nvoid main() \n{ \n    gl_Position = (CC_PMatrix * CC_MVMatrix) * a_position;  \n    v_texCoord = a_texCoord;               \n}",cc.SHADER_POSITION_TEXTURE_UCOLOR_FRAG="precision lowp float;  \nuniform vec4 u_color; \nvarying vec2 v_texCoord; \nvoid main() \n{  \n    gl_FragColor =  texture2D(CC_Texture0, v_texCoord) * u_color;    \n}",cc.SHADER_POSITION_TEXTURE_UCOLOR_VERT="attribute vec4 a_position;\nattribute vec2 a_texCoord; \nvarying mediump vec2 v_texCoord; \nvoid main() \n{ \n    gl_Position = (CC_PMatrix * CC_MVMatrix) * a_position;  \n    v_texCoord = a_texCoord;                 \n}",cc.SHADER_POSITION_TEXTURE_A8COLOR_FRAG="precision lowp float;  \nvarying vec4 v_fragmentColor; \nvarying vec2 v_texCoord; \nvoid main() \n{ \n    gl_FragColor = vec4( v_fragmentColor.rgb,         \n        v_fragmentColor.a * texture2D(CC_Texture0, v_texCoord).a   \n    ); \n}",cc.SHADER_POSITION_TEXTURE_A8COLOR_VERT="attribute vec4 a_position; \nattribute vec2 a_texCoord; \nattribute vec4 a_color;  \nvarying lowp vec4 v_fragmentColor; \nvarying mediump vec2 v_texCoord; \nvoid main() \n{ \n    gl_Position = (CC_PMatrix * CC_MVMatrix) * a_position;  \n    v_fragmentColor = a_color; \n    v_texCoord = a_texCoord; \n}",cc.SHADER_POSITION_TEXTURE_COLOR_FRAG="precision lowp float;\nvarying vec4 v_fragmentColor; \nvarying vec2 v_texCoord; \nvoid main() \n{ \n    gl_FragColor = v_fragmentColor * texture2D(CC_Texture0, v_texCoord); \n}",cc.SHADER_POSITION_TEXTURE_COLOR_VERT="attribute vec4 a_position; \nattribute vec2 a_texCoord; \nattribute vec4 a_color;  \nvarying lowp vec4 v_fragmentColor; \nvarying mediump vec2 v_texCoord; \nvoid main() \n{ \n    gl_Position = (CC_PMatrix * CC_MVMatrix) * a_position;  \n    v_fragmentColor = a_color; \n    v_texCoord = a_texCoord; \n}",cc.SHADER_SPRITE_POSITION_TEXTURE_COLOR_VERT="attribute vec4 a_position; \nattribute vec2 a_texCoord; \nattribute vec4 a_color;  \nvarying lowp vec4 v_fragmentColor; \nvarying mediump vec2 v_texCoord; \nvoid main() \n{ \n    gl_Position = CC_PMatrix * a_position;  \n    v_fragmentColor = a_color; \n    v_texCoord = a_texCoord; \n}",cc.SHADER_POSITION_TEXTURE_COLOR_ALPHATEST_FRAG="precision lowp float;   \nvarying vec4 v_fragmentColor; \nvarying vec2 v_texCoord;   \nuniform float CC_alpha_value; \nvoid main() \n{  \n    vec4 texColor = texture2D(CC_Texture0, v_texCoord);  \n    if ( texColor.a <= CC_alpha_value )          \n        discard; \n    gl_FragColor = texColor * v_fragmentColor;  \n}",cc.SHADEREX_SWITCHMASK_FRAG="precision lowp float; \nvarying vec4 v_fragmentColor; \nvarying vec2 v_texCoord; \nuniform sampler2D u_texture;  \nuniform sampler2D   u_mask;   \nvoid main()  \n{  \n    vec4 texColor   = texture2D(u_texture, v_texCoord);  \n    vec4 maskColor  = texture2D(u_mask, v_texCoord); \n    vec4 finalColor = vec4(texColor.r, texColor.g, texColor.b, maskColor.a * texColor.a);        \n    gl_FragColor    = v_fragmentColor * finalColor; \n}",cc.shaderCache={TYPE_POSITION_TEXTURECOLOR:0,TYPE_POSITION_TEXTURECOLOR_ALPHATEST:1,TYPE_POSITION_COLOR:2,TYPE_POSITION_TEXTURE:3,TYPE_POSITION_TEXTURE_UCOLOR:4,TYPE_POSITION_TEXTURE_A8COLOR:5,TYPE_POSITION_UCOLOR:6,TYPE_POSITION_LENGTH_TEXTURECOLOR:7,TYPE_SPRITE_POSITION_TEXTURECOLOR:8,TYPE_SPRITE_POSITION_TEXTURECOLOR_ALPHATEST:9,TYPE_SPRITE_POSITION_COLOR:10,TYPE_MAX:10,_programs:{},_init:function(){return this.loadDefaultShaders(),!0},_loadDefaultShader:function(t,e){switch(e){case this.TYPE_POSITION_TEXTURECOLOR:t.initWithVertexShaderByteArray(cc.SHADER_POSITION_TEXTURE_COLOR_VERT,cc.SHADER_POSITION_TEXTURE_COLOR_FRAG),t.addAttribute(cc.ATTRIBUTE_NAME_POSITION,cc.VERTEX_ATTRIB_POSITION),t.addAttribute(cc.ATTRIBUTE_NAME_COLOR,cc.VERTEX_ATTRIB_COLOR),t.addAttribute(cc.ATTRIBUTE_NAME_TEX_COORD,cc.VERTEX_ATTRIB_TEX_COORDS);break;case this.TYPE_SPRITE_POSITION_TEXTURECOLOR:t.initWithVertexShaderByteArray(cc.SHADER_SPRITE_POSITION_TEXTURE_COLOR_VERT,cc.SHADER_POSITION_TEXTURE_COLOR_FRAG),t.addAttribute(cc.ATTRIBUTE_NAME_POSITION,cc.VERTEX_ATTRIB_POSITION),t.addAttribute(cc.ATTRIBUTE_NAME_COLOR,cc.VERTEX_ATTRIB_COLOR),t.addAttribute(cc.ATTRIBUTE_NAME_TEX_COORD,cc.VERTEX_ATTRIB_TEX_COORDS);break;case this.TYPE_POSITION_TEXTURECOLOR_ALPHATEST:t.initWithVertexShaderByteArray(cc.SHADER_POSITION_TEXTURE_COLOR_VERT,cc.SHADER_POSITION_TEXTURE_COLOR_ALPHATEST_FRAG),t.addAttribute(cc.ATTRIBUTE_NAME_POSITION,cc.VERTEX_ATTRIB_POSITION),t.addAttribute(cc.ATTRIBUTE_NAME_COLOR,cc.VERTEX_ATTRIB_COLOR),t.addAttribute(cc.ATTRIBUTE_NAME_TEX_COORD,cc.VERTEX_ATTRIB_TEX_COORDS);break;case this.TYPE_SPRITE_POSITION_TEXTURECOLOR_ALPHATEST:t.initWithVertexShaderByteArray(cc.SHADER_SPRITE_POSITION_TEXTURE_COLOR_VERT,cc.SHADER_POSITION_TEXTURE_COLOR_ALPHATEST_FRAG),t.addAttribute(cc.ATTRIBUTE_NAME_POSITION,cc.VERTEX_ATTRIB_POSITION),t.addAttribute(cc.ATTRIBUTE_NAME_COLOR,cc.VERTEX_ATTRIB_COLOR),t.addAttribute(cc.ATTRIBUTE_NAME_TEX_COORD,cc.VERTEX_ATTRIB_TEX_COORDS);break;case this.TYPE_POSITION_COLOR:t.initWithVertexShaderByteArray(cc.SHADER_POSITION_COLOR_VERT,cc.SHADER_POSITION_COLOR_FRAG),t.addAttribute(cc.ATTRIBUTE_NAME_POSITION,cc.VERTEX_ATTRIB_POSITION),t.addAttribute(cc.ATTRIBUTE_NAME_COLOR,cc.VERTEX_ATTRIB_COLOR);break;case this.TYPE_SPRITE_POSITION_COLOR:t.initWithVertexShaderByteArray(cc.SHADER_SPRITE_POSITION_COLOR_VERT,cc.SHADER_POSITION_COLOR_FRAG),t.addAttribute(cc.ATTRIBUTE_NAME_POSITION,cc.VERTEX_ATTRIB_POSITION),t.addAttribute(cc.ATTRIBUTE_NAME_COLOR,cc.VERTEX_ATTRIB_COLOR);break;case this.TYPE_POSITION_TEXTURE:t.initWithVertexShaderByteArray(cc.SHADER_POSITION_TEXTURE_VERT,cc.SHADER_POSITION_TEXTURE_FRAG),t.addAttribute(cc.ATTRIBUTE_NAME_POSITION,cc.VERTEX_ATTRIB_POSITION),t.addAttribute(cc.ATTRIBUTE_NAME_TEX_COORD,cc.VERTEX_ATTRIB_TEX_COORDS);break;case this.TYPE_POSITION_TEXTURE_UCOLOR:t.initWithVertexShaderByteArray(cc.SHADER_POSITION_TEXTURE_UCOLOR_VERT,cc.SHADER_POSITION_TEXTURE_UCOLOR_FRAG),t.addAttribute(cc.ATTRIBUTE_NAME_POSITION,cc.VERTEX_ATTRIB_POSITION),t.addAttribute(cc.ATTRIBUTE_NAME_TEX_COORD,cc.VERTEX_ATTRIB_TEX_COORDS);break;case this.TYPE_POSITION_TEXTURE_A8COLOR:t.initWithVertexShaderByteArray(cc.SHADER_POSITION_TEXTURE_A8COLOR_VERT,cc.SHADER_POSITION_TEXTURE_A8COLOR_FRAG),t.addAttribute(cc.ATTRIBUTE_NAME_POSITION,cc.VERTEX_ATTRIB_POSITION),t.addAttribute(cc.ATTRIBUTE_NAME_COLOR,cc.VERTEX_ATTRIB_COLOR),t.addAttribute(cc.ATTRIBUTE_NAME_TEX_COORD,cc.VERTEX_ATTRIB_TEX_COORDS);break;case this.TYPE_POSITION_UCOLOR:t.initWithVertexShaderByteArray(cc.SHADER_POSITION_UCOLOR_VERT,cc.SHADER_POSITION_UCOLOR_FRAG),t.addAttribute("aVertex",cc.VERTEX_ATTRIB_POSITION);break;case this.TYPE_POSITION_LENGTH_TEXTURECOLOR:t.initWithVertexShaderByteArray(cc.SHADER_POSITION_COLOR_LENGTH_TEXTURE_VERT,cc.SHADER_POSITION_COLOR_LENGTH_TEXTURE_FRAG),t.addAttribute(cc.ATTRIBUTE_NAME_POSITION,cc.VERTEX_ATTRIB_POSITION),t.addAttribute(cc.ATTRIBUTE_NAME_TEX_COORD,cc.VERTEX_ATTRIB_TEX_COORDS),t.addAttribute(cc.ATTRIBUTE_NAME_COLOR,cc.VERTEX_ATTRIB_COLOR);break;default:return void cc.log("cocos2d: cc.shaderCache._loadDefaultShader, error shader type")}t.link(),t.updateUniforms()},loadDefaultShaders:function(){var t=new cc.GLProgram;this._loadDefaultShader(t,this.TYPE_POSITION_TEXTURECOLOR),this._programs[cc.SHADER_POSITION_TEXTURECOLOR]=t,this._programs.ShaderPositionTextureColor=t,t=new cc.GLProgram,this._loadDefaultShader(t,this.TYPE_SPRITE_POSITION_TEXTURECOLOR),this._programs[cc.SHADER_SPRITE_POSITION_TEXTURECOLOR]=t,this._programs.ShaderSpritePositionTextureColor=t,t=new cc.GLProgram,this._loadDefaultShader(t,this.TYPE_POSITION_TEXTURECOLOR_ALPHATEST),this._programs[cc.SHADER_POSITION_TEXTURECOLORALPHATEST]=t,this._programs.ShaderPositionTextureColorAlphaTest=t,t=new cc.GLProgram,this._loadDefaultShader(t,this.TYPE_SPRITE_POSITION_TEXTURECOLOR_ALPHATEST),this._programs[cc.SHADER_SPRITE_POSITION_TEXTURECOLORALPHATEST]=t,this._programs.ShaderSpritePositionTextureColorAlphaTest=t,t=new cc.GLProgram,this._loadDefaultShader(t,this.TYPE_POSITION_COLOR),this._programs[cc.SHADER_POSITION_COLOR]=t,this._programs.ShaderPositionColor=t,t=new cc.GLProgram,this._loadDefaultShader(t,this.TYPE_SPRITE_POSITION_COLOR),this._programs[cc.SHADER_SPRITE_POSITION_COLOR]=t,this._programs.ShaderSpritePositionColor=t,t=new cc.GLProgram,this._loadDefaultShader(t,this.TYPE_POSITION_TEXTURE),this._programs[cc.SHADER_POSITION_TEXTURE]=t,this._programs.ShaderPositionTexture=t,t=new cc.GLProgram,this._loadDefaultShader(t,this.TYPE_POSITION_TEXTURE_UCOLOR),this._programs[cc.SHADER_POSITION_TEXTURE_UCOLOR]=t,this._programs.ShaderPositionTextureUColor=t,t=new cc.GLProgram,this._loadDefaultShader(t,this.TYPE_POSITION_TEXTURE_A8COLOR),this._programs[cc.SHADER_POSITION_TEXTUREA8COLOR]=t,this._programs.ShaderPositionTextureA8Color=t,t=new cc.GLProgram,this._loadDefaultShader(t,this.TYPE_POSITION_UCOLOR),this._programs[cc.SHADER_POSITION_UCOLOR]=t,this._programs.ShaderPositionUColor=t,t=new cc.GLProgram,this._loadDefaultShader(t,this.TYPE_POSITION_LENGTH_TEXTURECOLOR),this._programs[cc.SHADER_POSITION_LENGTHTEXTURECOLOR]=t,this._programs.ShaderPositionLengthTextureColor=t},reloadDefaultShaders:function(){var t=this.programForKey(cc.SHADER_POSITION_TEXTURECOLOR);t.reset(),this._loadDefaultShader(t,this.TYPE_POSITION_TEXTURECOLOR),t=this.programForKey(cc.SHADER_SPRITE_POSITION_TEXTURECOLOR),t.reset(),this._loadDefaultShader(t,this.TYPE_SPRITE_POSITION_TEXTURECOLOR),t=this.programForKey(cc.SHADER_POSITION_TEXTURECOLORALPHATEST),t.reset(),this._loadDefaultShader(t,this.TYPE_POSITION_TEXTURECOLOR_ALPHATEST),t=this.programForKey(cc.SHADER_SPRITE_POSITION_TEXTURECOLORALPHATEST),t.reset(),this._loadDefaultShader(t,this.TYPE_SPRITE_POSITION_TEXTURECOLOR_ALPHATEST),t=this.programForKey(cc.SHADER_POSITION_COLOR),t.reset(),this._loadDefaultShader(t,this.TYPE_POSITION_COLOR),t=this.programForKey(cc.SHADER_POSITION_TEXTURE),t.reset(),this._loadDefaultShader(t,this.TYPE_POSITION_TEXTURE),t=this.programForKey(cc.SHADER_POSITION_TEXTURE_UCOLOR),t.reset(),this._loadDefaultShader(t,this.TYPE_POSITION_TEXTURE_UCOLOR),t=this.programForKey(cc.SHADER_POSITION_TEXTUREA8COLOR),t.reset(),this._loadDefaultShader(t,this.TYPE_POSITION_TEXTURE_A8COLOR),t=this.programForKey(cc.SHADER_POSITION_UCOLOR),t.reset(),this._loadDefaultShader(t,this.TYPE_POSITION_UCOLOR)},programForKey:function(t){return this._programs[t]},getProgram:function(t){return this._programs[t]},addProgram:function(t,e){this._programs[e]=t}},cc.GLProgram=cc.Class.extend({_glContext:null,_programObj:null,_vertShader:null,_fragShader:null,_uniforms:null,_hashForUniforms:null,_usesTime:!1,_updateUniformLocation:function(t){if(!t)return!1;var e,i=this._hashForUniforms[t];if(i){e=!1;for(var n=arguments.length-1,r=0;r<n;++r)arguments[r+1]!==i[r]&&(i[r]=arguments[r+1],e=!0)}else i=[arguments[1],arguments[2],arguments[3],arguments[4]],this._hashForUniforms[t]=i,e=!0;return e},_description:function(){return"<CCGLProgram = "+this.toString()+" | Program = "+this._programObj.toString()+", VertexShader = "+this._vertShader.toString()+", FragmentShader = "+this._fragShader.toString()+">"},_compileShader:function(t,e,i){if(!i||!t)return!1;var n=cc.GLProgram._isHighpSupported()?"precision highp float;\n":"precision mediump float;\n";i=n+"uniform mat4 CC_PMatrix;         \nuniform mat4 CC_MVMatrix;        \nuniform mat4 CC_MVPMatrix;       \nuniform vec4 CC_Time;            \nuniform vec4 CC_SinTime;         \nuniform vec4 CC_CosTime;         \nuniform vec4 CC_Random01;        \nuniform sampler2D CC_Texture0;   \n//CC INCLUDES END                \n"+i,this._glContext.shaderSource(t,i),this._glContext.compileShader(t);var r=this._glContext.getShaderParameter(t,this._glContext.COMPILE_STATUS);return r||(cc.log("cocos2d: ERROR: Failed to compile shader:\n"+this._glContext.getShaderSource(t)),e===this._glContext.VERTEX_SHADER?cc.log("cocos2d: \n"+this.vertexShaderLog()):cc.log("cocos2d: \n"+this.fragmentShaderLog())),r===!0},ctor:function(t,e,i){this._uniforms={},this._hashForUniforms={},this._glContext=i||cc._renderContext,t&&e&&this.init(t,e)},destroyProgram:function(){this._vertShader=null,this._fragShader=null,this._uniforms=null,this._hashForUniforms=null,this._glContext.deleteProgram(this._programObj)},initWithVertexShaderByteArray:function(t,e){var i=this._glContext;this._programObj=i.createProgram(),this._vertShader=null,this._fragShader=null,t&&(this._vertShader=i.createShader(i.VERTEX_SHADER),this._compileShader(this._vertShader,i.VERTEX_SHADER,t)||cc.log("cocos2d: ERROR: Failed to compile vertex shader")),e&&(this._fragShader=i.createShader(i.FRAGMENT_SHADER),this._compileShader(this._fragShader,i.FRAGMENT_SHADER,e)||cc.log("cocos2d: ERROR: Failed to compile fragment shader")),this._vertShader&&i.attachShader(this._programObj,this._vertShader),cc.checkGLErrorDebug(),this._fragShader&&i.attachShader(this._programObj,this._fragShader);for(var n in this._hashForUniforms)delete this._hashForUniforms[n];return cc.checkGLErrorDebug(),!0},initWithString:function(t,e){return this.initWithVertexShaderByteArray(t,e)},initWithVertexShaderFilename:function(t,e){var i=cc.loader.getRes(t);if(!i)throw new Error("Please load the resource firset : "+t);var n=cc.loader.getRes(e);if(!n)throw new Error("Please load the resource firset : "+e);return this.initWithVertexShaderByteArray(i,n)},init:function(t,e){return this.initWithVertexShaderFilename(t,e)},addAttribute:function(t,e){this._glContext.bindAttribLocation(this._programObj,e,t)},link:function(){if(!this._programObj)return cc.log("cc.GLProgram.link(): Cannot link invalid program"),!1;if(this._glContext.linkProgram(this._programObj),this._vertShader&&this._glContext.deleteShader(this._vertShader),this._fragShader&&this._glContext.deleteShader(this._fragShader),this._vertShader=null,this._fragShader=null,cc.game.config[cc.game.CONFIG_KEY.debugMode]){var t=this._glContext.getProgramParameter(this._programObj,this._glContext.LINK_STATUS);if(!t)return cc.log("cocos2d: ERROR: Failed to link program: "+this._glContext.getProgramInfoLog(this._programObj)),cc.glDeleteProgram(this._programObj),this._programObj=null,!1}return!0},use:function(){cc.glUseProgram(this._programObj)},updateUniforms:function(){this._uniforms[cc.UNIFORM_PMATRIX_S]=this._glContext.getUniformLocation(this._programObj,cc.UNIFORM_PMATRIX_S),this._uniforms[cc.UNIFORM_MVMATRIX_S]=this._glContext.getUniformLocation(this._programObj,cc.UNIFORM_MVMATRIX_S),this._uniforms[cc.UNIFORM_MVPMATRIX_S]=this._glContext.getUniformLocation(this._programObj,cc.UNIFORM_MVPMATRIX_S),this._uniforms[cc.UNIFORM_TIME_S]=this._glContext.getUniformLocation(this._programObj,cc.UNIFORM_TIME_S),this._uniforms[cc.UNIFORM_SINTIME_S]=this._glContext.getUniformLocation(this._programObj,cc.UNIFORM_SINTIME_S),this._uniforms[cc.UNIFORM_COSTIME_S]=this._glContext.getUniformLocation(this._programObj,cc.UNIFORM_COSTIME_S),this._usesTime=null!=this._uniforms[cc.UNIFORM_TIME_S]||null!=this._uniforms[cc.UNIFORM_SINTIME_S]||null!=this._uniforms[cc.UNIFORM_COSTIME_S],this._uniforms[cc.UNIFORM_RANDOM01_S]=this._glContext.getUniformLocation(this._programObj,cc.UNIFORM_RANDOM01_S),this._uniforms[cc.UNIFORM_SAMPLER_S]=this._glContext.getUniformLocation(this._programObj,cc.UNIFORM_SAMPLER_S),this.use(),this.setUniformLocationWith1i(this._uniforms[cc.UNIFORM_SAMPLER_S],0)},_addUniformLocation:function(t){var e=this._glContext.getUniformLocation(this._programObj,t);this._uniforms[t]=e},getUniformLocationForName:function(t){if(!t)throw new Error("cc.GLProgram.getUniformLocationForName(): uniform name should be non-null");if(!this._programObj)throw new Error("cc.GLProgram.getUniformLocationForName(): Invalid operation. Cannot get uniform location when program is not initialized");var e=this._uniforms[t]||this._glContext.getUniformLocation(this._programObj,t);return e},getUniformMVPMatrix:function(){return this._uniforms[cc.UNIFORM_MVPMATRIX_S]},getUniformSampler:function(){return this._uniforms[cc.UNIFORM_SAMPLER_S]},setUniformLocationWith1i:function(t,e){var i=this._glContext;if("string"==typeof t){var n=this._updateUniformLocation(t,e);if(n){var r=this.getUniformLocationForName(t);i.uniform1i(r,e)}}else i.uniform1i(t,e)},setUniformLocationWith2i:function(t,e,i){var n=this._glContext;if("string"==typeof t){var r=this._updateUniformLocation(t,e,i);if(r){var c=this.getUniformLocationForName(t);n.uniform2i(c,e,i)}}else n.uniform2i(t,e,i)},setUniformLocationWith3i:function(t,e,i,n){var r=this._glContext;if("string"==typeof t){var c=this._updateUniformLocation(t,e,i,n);if(c){var o=this.getUniformLocationForName(t);r.uniform3i(o,e,i,n)}}else r.uniform3i(t,e,i,n)},setUniformLocationWith4i:function(t,e,i,n,r){var c=this._glContext;if("string"==typeof t){var o=this._updateUniformLocation(t,e,i,n,r);if(o){var s=this.getUniformLocationForName(t);c.uniform4i(s,e,i,n,r)}}else c.uniform4i(t,e,i,n,r)},setUniformLocationWith2iv:function(t,e){var i="string"==typeof t?this.getUniformLocationForName(t):t;this._glContext.uniform2iv(i,e)},setUniformLocationWith3iv:function(t,e){var i="string"==typeof t?this.getUniformLocationForName(t):t;this._glContext.uniform3iv(i,e)},setUniformLocationWith4iv:function(t,e){var i="string"==typeof t?this.getUniformLocationForName(t):t;this._glContext.uniform4iv(i,e)},setUniformLocationI32:function(t,e){this.setUniformLocationWith1i(t,e)},setUniformLocationWith1f:function(t,e){var i=this._glContext;if("string"==typeof t){var n=this._updateUniformLocation(t,e);if(n){var r=this.getUniformLocationForName(t);i.uniform1f(r,e)}}else i.uniform1f(t,e)},setUniformLocationWith2f:function(t,e,i){var n=this._glContext;if("string"==typeof t){var r=this._updateUniformLocation(t,e,i);if(r){var c=this.getUniformLocationForName(t);n.uniform2f(c,e,i)}}else n.uniform2f(t,e,i)},setUniformLocationWith3f:function(t,e,i,n){var r=this._glContext;if("string"==typeof t){var c=this._updateUniformLocation(t,e,i,n);if(c){var o=this.getUniformLocationForName(t);r.uniform3f(o,e,i,n)}}else r.uniform3f(t,e,i,n)},setUniformLocationWith4f:function(t,e,i,n,r){var c=this._glContext;if("string"==typeof t){var o=this._updateUniformLocation(t,e,i,n,r);if(o){var s=this.getUniformLocationForName(t);c.uniform4f(s,e,i,n,r)}}else c.uniform4f(t,e,i,n,r)},setUniformLocationWith2fv:function(t,e){var i="string"==typeof t?this.getUniformLocationForName(t):t;this._glContext.uniform2fv(i,e)},setUniformLocationWith3fv:function(t,e){var i="string"==typeof t?this.getUniformLocationForName(t):t;this._glContext.uniform3fv(i,e)},setUniformLocationWith4fv:function(t,e){var i="string"==typeof t?this.getUniformLocationForName(t):t;this._glContext.uniform4fv(i,e)},setUniformLocationWithMatrix4fv:function(t,e){var i="string"==typeof t?this.getUniformLocationForName(t):t;this._glContext.uniformMatrix4fv(i,!1,e)},setUniformLocationF32:function(){if(!(arguments.length<2))switch(arguments.length){case 2:this.setUniformLocationWith1f(arguments[0],arguments[1]);break;case 3:this.setUniformLocationWith2f(arguments[0],arguments[1],arguments[2]);break;case 4:this.setUniformLocationWith3f(arguments[0],arguments[1],arguments[2],arguments[3]);break;case 5:this.setUniformLocationWith4f(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4])}},setUniformsForBuiltins:function(){var t=new cc.math.Matrix4,e=new cc.math.Matrix4,i=new cc.math.Matrix4;if(cc.kmGLGetMatrix(cc.KM_GL_PROJECTION,t),cc.kmGLGetMatrix(cc.KM_GL_MODELVIEW,e),cc.kmMat4Multiply(i,t,e),this.setUniformLocationWithMatrix4fv(this._uniforms[cc.UNIFORM_PMATRIX_S],t.mat,1),this.setUniformLocationWithMatrix4fv(this._uniforms[cc.UNIFORM_MVMATRIX_S],e.mat,1),this.setUniformLocationWithMatrix4fv(this._uniforms[cc.UNIFORM_MVPMATRIX_S],i.mat,1),this._usesTime){var n=cc.director,r=n.getTotalFrames()*n.getAnimationInterval();this.setUniformLocationWith4f(this._uniforms[cc.UNIFORM_TIME_S],r/10,r,2*r,4*r),this.setUniformLocationWith4f(this._uniforms[cc.UNIFORM_SINTIME_S],r/8,r/4,r/2,Math.sin(r)),this.setUniformLocationWith4f(this._uniforms[cc.UNIFORM_COSTIME_S],r/8,r/4,r/2,Math.cos(r))}this._uniforms[cc.UNIFORM_RANDOM01_S]!==-1&&this.setUniformLocationWith4f(this._uniforms[cc.UNIFORM_RANDOM01_S],Math.random(),Math.random(),Math.random(),Math.random())},_setUniformsForBuiltinsForRenderer:function(t){if(t&&t._renderCmd){var e=new cc.math.Matrix4,i=new cc.math.Matrix4;if(cc.kmGLGetMatrix(cc.KM_GL_PROJECTION,e),cc.kmMat4Multiply(i,e,t._renderCmd._stackMatrix),this.setUniformLocationWithMatrix4fv(this._uniforms[cc.UNIFORM_PMATRIX_S],e.mat,1),this.setUniformLocationWithMatrix4fv(this._uniforms[cc.UNIFORM_MVMATRIX_S],t._renderCmd._stackMatrix.mat,1),this.setUniformLocationWithMatrix4fv(this._uniforms[cc.UNIFORM_MVPMATRIX_S],i.mat,1),this._usesTime){var n=cc.director,r=n.getTotalFrames()*n.getAnimationInterval();this.setUniformLocationWith4f(this._uniforms[cc.UNIFORM_TIME_S],r/10,r,2*r,4*r),this.setUniformLocationWith4f(this._uniforms[cc.UNIFORM_SINTIME_S],r/8,r/4,r/2,Math.sin(r)),this.setUniformLocationWith4f(this._uniforms[cc.UNIFORM_COSTIME_S],r/8,r/4,r/2,Math.cos(r))}this._uniforms[cc.UNIFORM_RANDOM01_S]!==-1&&this.setUniformLocationWith4f(this._uniforms[cc.UNIFORM_RANDOM01_S],Math.random(),Math.random(),Math.random(),Math.random())}},setUniformForModelViewProjectionMatrix:function(){this._glContext.uniformMatrix4fv(this._uniforms[cc.UNIFORM_MVPMATRIX_S],!1,cc.getMat4MultiplyValue(cc.projection_matrix_stack.top,cc.modelview_matrix_stack.top))},setUniformForModelViewProjectionMatrixWithMat4:function(t){
cc.kmMat4Multiply(t,cc.projection_matrix_stack.top,cc.modelview_matrix_stack.top),this._glContext.uniformMatrix4fv(this._uniforms[cc.UNIFORM_MVPMATRIX_S],!1,t.mat)},setUniformForModelViewAndProjectionMatrixWithMat4:function(){this._glContext.uniformMatrix4fv(this._uniforms[cc.UNIFORM_MVMATRIX_S],!1,cc.modelview_matrix_stack.top.mat),this._glContext.uniformMatrix4fv(this._uniforms[cc.UNIFORM_PMATRIX_S],!1,cc.projection_matrix_stack.top.mat)},_setUniformForMVPMatrixWithMat4:function(t){if(!t)throw new Error("modelView matrix is undefined.");this._glContext.uniformMatrix4fv(this._uniforms[cc.UNIFORM_MVMATRIX_S],!1,t.mat),this._glContext.uniformMatrix4fv(this._uniforms[cc.UNIFORM_PMATRIX_S],!1,cc.projection_matrix_stack.top.mat)},_updateProjectionUniform:function(){this._glContext.uniformMatrix4fv(this._uniforms[cc.UNIFORM_PMATRIX_S],!1,cc.projection_matrix_stack.top.mat)},vertexShaderLog:function(){return this._glContext.getShaderInfoLog(this._vertShader)},getVertexShaderLog:function(){return this._glContext.getShaderInfoLog(this._vertShader)},getFragmentShaderLog:function(){return this._glContext.getShaderInfoLog(this._vertShader)},fragmentShaderLog:function(){return this._glContext.getShaderInfoLog(this._fragShader)},programLog:function(){return this._glContext.getProgramInfoLog(this._programObj)},getProgramLog:function(){return this._glContext.getProgramInfoLog(this._programObj)},reset:function(){this._vertShader=null,this._fragShader=null,this._uniforms.length=0,this._glContext.deleteProgram(this._programObj),this._programObj=null;for(var t in this._hashForUniforms)this._hashForUniforms[t].length=0,delete this._hashForUniforms[t]},getProgram:function(){return this._programObj},retain:function(){},release:function(){}}),cc.GLProgram.create=function(t,e){return new cc.GLProgram(t,e)},cc.GLProgram._highpSupported=null,cc.GLProgram._isHighpSupported=function(){if(null==cc.GLProgram._highpSupported){var t=cc._renderContext,e=t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT);cc.GLProgram._highpSupported=0!==e.precision}return cc.GLProgram._highpSupported},cc.setProgram=function(t,e){t.shaderProgram=e;var i=t.children;if(i)for(var n=0;n<i.length;n++)cc.setProgram(i[n],e)},cc._currentProjectionMatrix=-1,cc.ENABLE_GL_STATE_CACHE){cc.MAX_ACTIVETEXTURE=16,cc._currentShaderProgram=-1,cc._currentBoundTexture=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],cc._blendingSource=-1,cc._blendingDest=-1,cc._GLServerState=0,cc.TEXTURE_ATLAS_USE_VAO&&(cc._uVAO=0);var _currBuffers={};WebGLRenderingContext.prototype.glBindBuffer=WebGLRenderingContext.prototype.bindBuffer,WebGLRenderingContext.prototype.bindBuffer=function(t,e){return _currBuffers[t]===e||(this.glBindBuffer(t,e),_currBuffers[t]=e,!1)},WebGLRenderingContext.prototype.glEnableVertexAttribArray=WebGLRenderingContext.prototype.enableVertexAttribArray,WebGLRenderingContext.prototype.enableVertexAttribArray=function(t){t===cc.VERTEX_ATTRIB_FLAG_POSITION?this._vertexAttribPosition||(this.glEnableVertexAttribArray(t),this._vertexAttribPosition=!0):t===cc.VERTEX_ATTRIB_FLAG_COLOR?this._vertexAttribColor||(this.glEnableVertexAttribArray(t),this._vertexAttribColor=!0):t===cc.VERTEX_ATTRIB_FLAG_TEX_COORDS?this._vertexAttribTexCoords||(this.glEnableVertexAttribArray(t),this._vertexAttribTexCoords=!0):this.glEnableVertexAttribArray(t)},WebGLRenderingContext.prototype.glDisableVertexAttribArray=WebGLRenderingContext.prototype.disableVertexAttribArray,WebGLRenderingContext.prototype.disableVertexAttribArray=function(t){t===cc.VERTEX_ATTRIB_FLAG_COLOR?this._vertexAttribColor&&(this.glDisableVertexAttribArray(t),this._vertexAttribColor=!1):t===cc.VERTEX_ATTRIB_FLAG_TEX_COORDS?this._vertexAttribTexCoords&&(this.glDisableVertexAttribArray(t),this._vertexAttribTexCoords=!1):0!==t&&this.glDisableVertexAttribArray(t)}}cc.glInvalidateStateCache=function(){if(cc.kmGLFreeAll(),cc._currentProjectionMatrix=-1,cc.ENABLE_GL_STATE_CACHE){cc._currentShaderProgram=-1;for(var t=0;t<cc.MAX_ACTIVETEXTURE;t++)cc._currentBoundTexture[t]=-1;cc._blendingSource=-1,cc._blendingDest=-1,cc._GLServerState=0}},cc.glUseProgram=cc.ENABLE_GL_STATE_CACHE?function(t){t!==cc._currentShaderProgram&&(cc._currentShaderProgram=t,cc._renderContext.useProgram(t))}:function(t){cc._renderContext.useProgram(t)},cc.glDeleteProgram=function(t){cc.ENABLE_GL_STATE_CACHE&&t===cc._currentShaderProgram&&(cc._currentShaderProgram=-1),gl.deleteProgram(t)},cc.setBlending=function(t,e){var i=cc._renderContext;t===i.ONE&&e===i.ZERO?i.disable(i.BLEND):(i.enable(i.BLEND),cc._renderContext.blendFunc(t,e))},cc.glBlendFunc=cc.ENABLE_GL_STATE_CACHE?function(t,e){t===cc._blendingSource&&e===cc._blendingDest||(cc._blendingSource=t,cc._blendingDest=e,cc.setBlending(t,e))}:cc.setBlending,cc.glBlendFuncForParticle=function(t,e){if(t!==cc._blendingSource||e!==cc._blendingDest){cc._blendingSource=t,cc._blendingDest=e;var i=cc._renderContext;t===i.ONE&&e===i.ZERO?i.disable(i.BLEND):(i.enable(i.BLEND),i.blendFuncSeparate(i.SRC_ALPHA,e,t,e))}},cc.glBlendResetToCache=function(){var t=cc._renderContext;t.blendEquation(t.FUNC_ADD),cc.ENABLE_GL_STATE_CACHE?cc.setBlending(cc._blendingSource,cc._blendingDest):cc.setBlending(t.BLEND_SRC,t.BLEND_DST)},cc.setProjectionMatrixDirty=function(){cc._currentProjectionMatrix=-1},cc.glBindTexture2D=function(t){cc.glBindTexture2DN(0,t)},cc.glBindTexture2DN=cc.ENABLE_GL_STATE_CACHE?function(t,e){if(cc._currentBoundTexture[t]!==e){cc._currentBoundTexture[t]=e;var i=cc._renderContext;i.activeTexture(i.TEXTURE0+t),e?i.bindTexture(i.TEXTURE_2D,e._webTextureObj):i.bindTexture(i.TEXTURE_2D,null)}}:function(t,e){var i=cc._renderContext;i.activeTexture(i.TEXTURE0+t),e?i.bindTexture(i.TEXTURE_2D,e._webTextureObj):i.bindTexture(i.TEXTURE_2D,null)},cc.glDeleteTexture=function(t){cc.glDeleteTextureN(0,t)},cc.glDeleteTextureN=function(t,e){cc.ENABLE_GL_STATE_CACHE&&e===cc._currentBoundTexture[t]&&(cc._currentBoundTexture[t]=-1),cc._renderContext.deleteTexture(e._webTextureObj)},cc.glBindVAO=function(t){cc.TEXTURE_ATLAS_USE_VAO&&cc.ENABLE_GL_STATE_CACHE&&cc._uVAO!==t&&(cc._uVAO=t)},cc.glEnable=function(t){cc.ENABLE_GL_STATE_CACHE},cc.IMAGE_FORMAT_JPEG=0,cc.IMAGE_FORMAT_PNG=1,cc.IMAGE_FORMAT_RAWDATA=9,cc.NextPOT=function(t){return t-=1,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,t|=t>>16,t+1},cc.RenderTexture=cc.Node.extend({sprite:null,clearFlags:0,clearDepthVal:0,autoDraw:!1,_texture:null,_pixelFormat:0,clearStencilVal:0,_clearColor:null,_className:"RenderTexture",ctor:function(t,e,i,n){cc.Node.prototype.ctor.call(this),this._cascadeColorEnabled=!0,this._cascadeOpacityEnabled=!0,this._pixelFormat=cc.Texture2D.PIXEL_FORMAT_RGBA8888,this._clearColor=new cc.Color(0,0,0,255),void 0!==t&&void 0!==e&&(i=i||cc.Texture2D.PIXEL_FORMAT_RGBA8888,n=n||0,this.initWithWidthAndHeight(t,e,i,n)),this.setAnchorPoint(0,0)},_createRenderCmd:function(){return cc._renderType===cc.game.RENDER_TYPE_CANVAS?new cc.RenderTexture.CanvasRenderCmd(this):new cc.RenderTexture.WebGLRenderCmd(this)},cleanup:function(){cc.Node.prototype.onExit.call(this),this._renderCmd.cleanup()},getSprite:function(){return this.sprite},setSprite:function(t){this.sprite=t},setVirtualViewport:function(t,e,i){this._renderCmd.setVirtualViewport(t,e,i)},initWithWidthAndHeight:function(t,e,i,n){return this._renderCmd.initWithWidthAndHeight(t,e,i,n)},begin:function(){cc.renderer._turnToCacheMode(this.__instanceId),this._renderCmd.begin()},beginWithClear:function(t,e,i,n,r,c){var o=cc._renderContext;r=r||o.COLOR_BUFFER_BIT,c=c||o.COLOR_BUFFER_BIT|o.DEPTH_BUFFER_BIT,this._beginWithClear(t,e,i,n,r,c,o.COLOR_BUFFER_BIT|o.DEPTH_BUFFER_BIT|o.STENCIL_BUFFER_BIT)},_beginWithClear:function(t,e,i,n,r,c,o){this.begin(),this._renderCmd._beginWithClear(t,e,i,n,r,c,o)},end:function(){this._renderCmd.end()},clear:function(t,e,i,n){this.beginWithClear(t,e,i,n),this.end()},clearRect:function(t,e,i,n){this._renderCmd.clearRect(t,e,i,n)},clearDepth:function(t){this._renderCmd.clearDepth(t)},clearStencil:function(t){this._renderCmd.clearStencil(t)},getClearFlags:function(){return this.clearFlags},setClearFlags:function(t){this.clearFlags=t},getClearColor:function(){return this._clearColor},setClearColor:function(t){var e=this._clearColor;e.r=t.r,e.g=t.g,e.b=t.b,e.a=t.a,this._renderCmd.updateClearColor(t)},getClearDepth:function(){return this.clearDepthVal},setClearDepth:function(t){this.clearDepthVal=t},getClearStencil:function(){return this.clearStencilVal},setClearStencil:function(t){this.clearStencilVal=t},isAutoDraw:function(){return this.autoDraw},setAutoDraw:function(t){this.autoDraw=t},saveToFile:function(t,e){cc.log("saveToFile isn't supported on Cocos2d-Html5")},newCCImage:function(t){return cc.log("saveToFile isn't supported on cocos2d-html5"),null},listenToBackground:function(t){},listenToForeground:function(t){}});var _p=cc.RenderTexture.prototype;_p.clearColorVal,cc.defineGetterSetter(_p,"clearColorVal",_p.getClearColor,_p.setClearColor),cc.RenderTexture.create=function(t,e,i,n){return new cc.RenderTexture(t,e,i,n)},function(){cc.RenderTexture.CanvasRenderCmd=function(t){cc.Node.CanvasRenderCmd.call(this,t),this._needDraw=!0,this._clearColorStr="rgba(255,255,255,1)",this._cacheCanvas=document.createElement("canvas"),this._cacheContext=new cc.CanvasContextWrapper(this._cacheCanvas.getContext("2d"))};var t=cc.RenderTexture.CanvasRenderCmd.prototype=Object.create(cc.Node.CanvasRenderCmd.prototype);t.constructor=cc.RenderTexture.CanvasRenderCmd,t.cleanup=function(){this._cacheContext=null,this._cacheCanvas=null},t.clearStencil=function(t){},t.setVirtualViewport=function(t,e,i){},t.updateClearColor=function(t){this._clearColorStr="rgba("+(0|t.r)+","+(0|t.g)+","+(0|t.b)+","+t.a/255+")"},t.initWithWidthAndHeight=function(t,e,i,n){var r=this._node,c=this._cacheCanvas,o=cc.contentScaleFactor();c.width=0|t*o,c.height=0|e*o;var s=new cc.Texture2D;s.initWithElement(c),s.handleLoadedTexture();var a=r.sprite=new cc.Sprite(s);return a.setBlendFunc(cc.ONE,cc.ONE_MINUS_SRC_ALPHA),r.autoDraw=!1,r.addChild(a),!0},t.begin=function(){},t._beginWithClear=function(t,e,i,n,r,c,o){t=t||0,e=e||0,i=i||0,n=isNaN(n)?255:n;var s=this._cacheContext.getContext(),a=this._cacheCanvas;s.setTransform(1,0,0,1,0,0),this._cacheContext.setFillStyle("rgba("+(0|t)+","+(0|e)+","+(0|i)+","+n/255+")"),s.clearRect(0,0,a.width,a.height),s.fillRect(0,0,a.width,a.height)},t.end=function(){var t=this._node,e=cc.contentScaleFactor();cc.renderer._renderingToCacheCanvas(this._cacheContext,t.__instanceId,e,e);var i=t.sprite._renderCmd;i._notifyRegionStatus&&i._notifyRegionStatus(cc.Node.CanvasRenderCmd.RegionStatus.Dirty)},t.clearRect=function(t,e,i,n){this._cacheContext.clearRect(t,e,i,-n)},t.clearDepth=function(t){cc.log("clearDepth isn't supported on Cocos2d-Html5")},t.visit=function(t){var e=this._node;this._syncStatus(t),e.sprite.visit(this),this._dirtyFlag=0}}(),function(){cc.RenderTexture.WebGLRenderCmd=function(t){cc.Node.WebGLRenderCmd.call(this,t),this._needDraw=!0,this._fBO=null,this._oldFBO=null,this._textureCopy=null,this._depthRenderBuffer=null,this._rtTextureRect=new cc.Rect,this._fullRect=new cc.Rect,this._fullViewport=new cc.Rect};var t=cc.RenderTexture.WebGLRenderCmd.prototype=Object.create(cc.Node.WebGLRenderCmd.prototype);t.constructor=cc.RenderTexture.WebGLRenderCmd,t.setVirtualViewport=function(t,e,i){this._rtTextureRect.x=t.x,this._rtTextureRect.y=t.y,this._fullRect=e,this._fullViewport=i},t.needDraw=function(){return this._needDraw&&this._node.autoDraw},t.rendering=function(t){var e=t||cc._renderContext,i=this._node;if(i.autoDraw){i.begin();var n=i.clearFlags;if(n){var r=[0,0,0,0],c=0,o=0;n&e.COLOR_BUFFER_BIT&&(r=e.getParameter(e.COLOR_CLEAR_VALUE),e.clearColor(i._clearColor.r/255,i._clearColor.g/255,i._clearColor.b/255,i._clearColor.a/255)),n&e.DEPTH_BUFFER_BIT&&(c=e.getParameter(e.DEPTH_CLEAR_VALUE),e.clearDepth(i.clearDepthVal)),n&e.STENCIL_BUFFER_BIT&&(o=e.getParameter(e.STENCIL_CLEAR_VALUE),e.clearStencil(i.clearStencilVal)),e.clear(n),n&e.COLOR_BUFFER_BIT&&e.clearColor(r[0],r[1],r[2],r[3]),n&e.DEPTH_BUFFER_BIT&&e.clearDepth(c),n&e.STENCIL_BUFFER_BIT&&e.clearStencil(o)}i.sortAllChildren();for(var s=i._children,a=0;a<s.length;a++){var h=s[a];h!==i.sprite&&h._renderCmd.visit(i.sprite._renderCmd)}i.end()}},t.clearStencil=function(t){var e=cc._renderContext,i=e.getParameter(e.STENCIL_CLEAR_VALUE);e.clearStencil(t),e.clear(e.STENCIL_BUFFER_BIT),e.clearStencil(i)},t.cleanup=function(){this._node;this._textureCopy=null;var t=cc._renderContext;t.deleteFramebuffer(this._fBO),this._depthRenderBuffer&&t.deleteRenderbuffer(this._depthRenderBuffer)},t.updateClearColor=function(t){},t.initWithWidthAndHeight=function(t,e,i,n){var r=this._node;i===cc.Texture2D.PIXEL_FORMAT_A8&&cc.log("cc.RenderTexture._initWithWidthAndHeightForWebGL() : only RGB and RGBA formats are valid for a render texture;");var c=cc._renderContext,o=cc.contentScaleFactor();this._fullRect=new cc.Rect(0,0,t,e),this._fullViewport=new cc.Rect(0,0,t,e),t=0|t*o,e=0|e*o,this._oldFBO=c.getParameter(c.FRAMEBUFFER_BINDING);var s,a;cc.configuration.supportsNPOT()?(s=t,a=e):(s=cc.NextPOT(t),a=cc.NextPOT(e));for(var h=s*a*4,l=new Uint8Array(h),u=0;u<s*a*4;u++)l[u]=0;this._pixelFormat=i;var _=r._texture=new cc.Texture2D;if(!r._texture)return!1;_.initWithData(l,r._pixelFormat,s,a,cc.size(t,e));var d=c.getParameter(c.RENDERBUFFER_BINDING);if(cc.configuration.checkForGLExtension("GL_QCOM")){if(this._textureCopy=new cc.Texture2D,!this._textureCopy)return!1;this._textureCopy.initWithData(l,r._pixelFormat,s,a,cc.size(t,e))}this._fBO=c.createFramebuffer(),c.bindFramebuffer(c.FRAMEBUFFER,this._fBO),c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,_._webTextureObj,0),0!==n&&(this._depthRenderBuffer=c.createRenderbuffer(),c.bindRenderbuffer(c.RENDERBUFFER,this._depthRenderBuffer),c.renderbufferStorage(c.RENDERBUFFER,n,s,a),n===c.DEPTH_STENCIL?c.framebufferRenderbuffer(c.FRAMEBUFFER,c.DEPTH_STENCIL_ATTACHMENT,c.RENDERBUFFER,this._depthRenderBuffer):n===c.STENCIL_INDEX||n===c.STENCIL_INDEX8?c.framebufferRenderbuffer(c.FRAMEBUFFER,c.STENCIL_ATTACHMENT,c.RENDERBUFFER,this._depthRenderBuffer):n===c.DEPTH_COMPONENT16&&c.framebufferRenderbuffer(c.FRAMEBUFFER,c.DEPTH_ATTACHMENT,c.RENDERBUFFER,this._depthRenderBuffer)),c.checkFramebufferStatus(c.FRAMEBUFFER)!==c.FRAMEBUFFER_COMPLETE&&cc.log("Could not attach texture to the framebuffer"),_.setAliasTexParameters();var f=r.sprite=new cc.Sprite(_);return f.scaleY=-1,f.setBlendFunc(c.ONE,c.ONE_MINUS_SRC_ALPHA),c.bindRenderbuffer(c.RENDERBUFFER,d),c.bindFramebuffer(c.FRAMEBUFFER,this._oldFBO),r.autoDraw=!1,r.addChild(f),!0},t.begin=function(){var t=this._node;cc.kmGLMatrixMode(cc.KM_GL_PROJECTION),cc.kmGLPushMatrix(),cc.kmGLMatrixMode(cc.KM_GL_MODELVIEW),cc.kmGLPushMatrix();var e=cc._renderContext,i=cc.director;i.setProjection(i.getProjection());var n=t._texture.getContentSizeInPixels(),r=cc.director.getWinSizeInPixels(),c=r.width/n.width,o=r.height/n.height,s=cc.math.Matrix4.createOrthographicProjection(-1/c,1/c,-1/o,1/o,-1,1);cc.kmGLMultMatrix(s);var a=new cc.Rect(0,0,0,0);a.width=this._fullViewport.width,a.height=this._fullViewport.height;var h=a.width/this._fullRect.width,l=a.height/this._fullRect.height;a.x=(this._fullRect.x-this._rtTextureRect.x)*h,a.y=(this._fullRect.y-this._rtTextureRect.y)*l,e.viewport(a.x,a.y,a.width,a.height),this._oldFBO=e.getParameter(e.FRAMEBUFFER_BINDING),e.bindFramebuffer(e.FRAMEBUFFER,this._fBO),cc.configuration.checkForGLExtension("GL_QCOM")&&(e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this._textureCopy._webTextureObj,0),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t._texture._webTextureObj,0))},t._beginWithClear=function(t,e,i,n,r,c,o){t/=255,e/=255,i/=255,n/=255;var s=cc._renderContext,a=[0,0,0,0],h=0,l=0;o&s.COLOR_BUFFER_BIT&&(a=s.getParameter(s.COLOR_CLEAR_VALUE),s.clearColor(t,e,i,n)),o&s.DEPTH_BUFFER_BIT&&(h=s.getParameter(s.DEPTH_CLEAR_VALUE),s.clearDepth(r)),o&s.STENCIL_BUFFER_BIT&&(l=s.getParameter(s.STENCIL_CLEAR_VALUE),s.clearStencil(c)),s.clear(o),o&s.COLOR_BUFFER_BIT&&s.clearColor(a[0],a[1],a[2],a[3]),o&s.DEPTH_BUFFER_BIT&&s.clearDepth(h),o&s.STENCIL_BUFFER_BIT&&s.clearStencil(l)},t.end=function(){var t=this._node;cc.renderer._renderingToBuffer(t.__instanceId);var e=cc._renderContext,i=cc.director;e.bindFramebuffer(e.FRAMEBUFFER,this._oldFBO),i.setViewport(),cc.kmGLMatrixMode(cc.KM_GL_PROJECTION),cc.kmGLPopMatrix(),cc.kmGLMatrixMode(cc.KM_GL_MODELVIEW),cc.kmGLPopMatrix()},t.clearRect=function(t,e,i,n){},t.clearDepth=function(t){var e=this._node;e.begin();var i=cc._renderContext,n=i.getParameter(i.DEPTH_CLEAR_VALUE);i.clearDepth(t),i.clear(i.DEPTH_BUFFER_BIT),i.clearDepth(n),e.end()},t.visit=function(t){var e=this._node;e._visible&&(cc.kmGLPushMatrix(),this._syncStatus(t),cc.renderer.pushRenderCommand(this),e.sprite.visit(this),this._dirtyFlag=0,cc.kmGLPopMatrix())}}(),cc.SpriteBatchNode=cc.Node.extend({_blendFunc:null,_texture:null,_className:"SpriteBatchNode",ctor:function(t){cc.Node.prototype.ctor.call(this),this._blendFunc=new cc.BlendFunc(cc.BLEND_SRC,cc.BLEND_DST);var e;cc.isString(t)?(e=cc.textureCache.getTextureForKey(t),e||(e=cc.textureCache.addImage(t))):t instanceof cc.Texture2D&&(e=t),e&&this.initWithTexture(e)},addSpriteWithoutQuad:function(t,e,i){return this.addChild(t,e,i),this},getTextureAtlas:function(){return null},setTextureAtlas:function(t){},getDescendants:function(){return this._children},initWithFile:function(t,e){var i=cc.textureCache.getTextureForKey(t);return i||(i=cc.textureCache.addImage(t)),this.initWithTexture(i,e)},init:function(t,e){var i=cc.textureCache.getTextureForKey(t);return i||(i=cc.textureCache.addImage(t)),this.initWithTexture(i,e)},increaseAtlasCapacity:function(){},removeChildAtIndex:function(t,e){this.removeChild(this._children[t],e)},rebuildIndexInOrder:function(t,e){return e},highestAtlasIndexInChild:function(t){var e=t.children;return e&&0!==e.length?this.highestAtlasIndexInChild(e[e.length-1]):t.zIndex},lowestAtlasIndexInChild:function(t){var e=t.children;return e&&0!==e.length?this.lowestAtlasIndexInChild(e[e.length-1]):t.zIndex},atlasIndexForChild:function(t){return t.zIndex},reorderBatch:function(t){this._reorderChildDirty=t},setBlendFunc:function(t,e){void 0===e?this._blendFunc=t:this._blendFunc={src:t,dst:e}},getBlendFunc:function(){return new cc.BlendFunc(this._blendFunc.src,this._blendFunc.dst)},updateQuadFromSprite:function(t,e){return cc.assert(t,cc._LogInfos.CCSpriteBatchNode_updateQuadFromSprite_2),t instanceof cc.Sprite?(t.dirty=!0,void t._renderCmd.transform(this._renderCmd,!0)):void cc.log(cc._LogInfos.CCSpriteBatchNode_updateQuadFromSprite)},insertQuadFromSprite:function(t,e){this.addChild(t,e)},insertChild:function(t,e){this.addChild(t,e)},appendChild:function(t){this.sortAllChildren();this._children[this._children.length-1]._localZOrder;this.addChild(t.lastLocalZOrder+1)},removeSpriteFromAtlas:function(t,e){this.removeChild(t,e)},initWithTexture:function(t){return this.setTexture(t),!0},getTexture:function(){return this._texture},setTexture:function(t){if(this._texture=t,t._textureLoaded){var e,i=this._children,n=i.length;for(e=0;e<n;++e)i[e].setTexture(t)}else t.addEventListener("load",function(){var e,i=this._children,n=i.length;for(e=0;e<n;++e)i[e].setTexture(t)},this)},setShaderProgram:function(t){this._renderCmd.setShaderProgram(t);var e,i=this._children,n=i.length;for(e=0;e<n;++e)i[e].setShaderProgram(t)},addChild:function(t,e,i){cc.assert(void 0!==t,cc._LogInfos.CCSpriteBatchNode_addChild_3),this._isValidChild(t)&&(e=void 0===e?t.zIndex:e,i=void 0===i?t.tag:i,cc.Node.prototype.addChild.call(this,t,e,i),this._renderCmd._shaderProgram&&(t.shaderProgram=this._renderCmd._shaderProgram))},_isValidChild:function(t){return t instanceof cc.Sprite?t.texture===this._texture||(cc.log(cc._LogInfos.Sprite_addChild_5),!1):(cc.log(cc._LogInfos.Sprite_addChild_4),!1)}});var _p=cc.SpriteBatchNode.prototype;cc.defineGetterSetter(_p,"texture",_p.getTexture,_p.setTexture),cc.defineGetterSetter(_p,"shaderProgram",_p.getShaderProgram,_p.setShaderProgram),cc.SpriteBatchNode.create=function(t){return new cc.SpriteBatchNode(t)},cc.SpriteBatchNode.createWithTexture=cc.SpriteBatchNode.create,cc.v2fzero=function(){return{x:0,y:0}},cc.v2f=function(t,e){return{x:t,y:e}},cc.v2fadd=function(t,e){return cc.v2f(t.x+e.x,t.y+e.y)},cc.v2fsub=function(t,e){return cc.v2f(t.x-e.x,t.y-e.y)},cc.v2fmult=function(t,e){return cc.v2f(t.x*e,t.y*e)},cc.v2fperp=function(t){return cc.v2f(-t.y,t.x)},cc.v2fneg=function(t){return cc.v2f(-t.x,-t.y)},cc.v2fdot=function(t,e){return t.x*e.x+t.y*e.y},cc.v2fforangle=function(t){return cc.v2f(Math.cos(t),Math.sin(t))},cc.v2fnormalize=function(t){var e=cc.pNormalize(cc.p(t.x,t.y));return cc.v2f(e.x,e.y)},cc.__v2f=function(t){return cc.v2f(t.x,t.y)},cc.__t=function(t){return{u:t.x,v:t.y}},cc.DrawNode=cc.Node.extend({_buffer:null,_blendFunc:null,_lineWidth:1,_drawColor:null,getBlendFunc:function(){return this._blendFunc},setBlendFunc:function(t,e){void 0===e?(this._blendFunc.src=t.src,this._blendFunc.dst=t.dst):(this._blendFunc.src=t,this._blendFunc.dst=e)},setLineWidth:function(t){this._lineWidth=t},getLineWidth:function(){return this._lineWidth},setDrawColor:function(t){var e=this._drawColor;e.r=t.r,e.g=t.g,e.b=t.b,e.a=null==t.a?255:t.a},getDrawColor:function(){return cc.color(this._drawColor.r,this._drawColor.g,this._drawColor.b,this._drawColor.a)}}),cc.DrawNode.create=function(){return new cc.DrawNode},cc.DrawNode.TYPE_DOT=0,cc.DrawNode.TYPE_SEGMENT=1,cc.DrawNode.TYPE_POLY=2,cc.game.addEventListener(cc.game.EVENT_RENDERER_INITED,function(){cc._renderType===cc.game.RENDER_TYPE_CANVAS?(cc._DrawNodeElement=function(t,e,i,n,r,c,o,s,a){var h=this;h.type=t,h.verts=e||null,h.fillColor=i||null,h.lineWidth=n||0,h.lineColor=r||null,h.lineCap=c||"butt",h.isClosePolygon=o||!1,h.isFill=s||!1,h.isStroke=a||!1},cc.extend(cc.DrawNode.prototype,{_className:"DrawNodeCanvas",ctor:function(){cc.Node.prototype.ctor.call(this);var t=this._renderCmd;t._buffer=this._buffer=[],t._drawColor=this._drawColor=cc.color(255,255,255,255),t._blendFunc=this._blendFunc=new cc.BlendFunc(cc.SRC_ALPHA,cc.ONE_MINUS_SRC_ALPHA),this.init(),this._localBB=new cc.Rect},setLocalBB:function(t,e,i,n){var r=this._localBB;void 0===e?(r.x=t.x,r.y=t.y,r.width=t.width,r.height=t.height):(r.x=t,r.y=e,r.width=i,r.height=n)},drawRect:function(t,e,i,n,r){n=null==n?this._lineWidth:n,r=r||this.getDrawColor(),null==r.a&&(r.a=255);var c=[t,cc.p(e.x,t.y),e,cc.p(t.x,e.y)],o=new cc._DrawNodeElement(cc.DrawNode.TYPE_POLY);o.verts=c,o.lineWidth=n,o.lineColor=r,o.isClosePolygon=!0,o.isStroke=!0,o.lineCap="butt",o.fillColor=i,i&&(null==i.a&&(i.a=255),o.isFill=!0),this._buffer.push(o)},drawCircle:function(t,e,i,n,r,c,o){c=c||this._lineWidth,o=o||this.getDrawColor(),null==o.a&&(o.a=255);for(var s=2*Math.PI/n,a=[],h=0;h<=n;h++){var l=h*s,u=e*Math.cos(l+i)+t.x,_=e*Math.sin(l+i)+t.y;a.push(cc.p(u,_))}r&&a.push(cc.p(t.x,t.y));var d=new cc._DrawNodeElement(cc.DrawNode.TYPE_POLY);d.verts=a,d.lineWidth=c,d.lineColor=o,d.isClosePolygon=!0,d.isStroke=!0,this._buffer.push(d)},drawQuadBezier:function(t,e,i,n,r,c){r=r||this._lineWidth,c=c||this.getDrawColor(),null==c.a&&(c.a=255);for(var o=[],s=0,a=0;a<n;a++){var h=Math.pow(1-s,2)*t.x+2*(1-s)*s*e.x+s*s*i.x,l=Math.pow(1-s,2)*t.y+2*(1-s)*s*e.y+s*s*i.y;o.push(cc.p(h,l)),s+=1/n}o.push(cc.p(i.x,i.y));var u=new cc._DrawNodeElement(cc.DrawNode.TYPE_POLY);u.verts=o,u.lineWidth=r,u.lineColor=c,u.isStroke=!0,u.lineCap="round",this._buffer.push(u)},drawCubicBezier:function(t,e,i,n,r,c,o){c=c||this._lineWidth,o=o||this.getDrawColor(),null==o.a&&(o.a=255);for(var s=[],a=0,h=0;h<r;h++){var l=Math.pow(1-a,3)*t.x+3*Math.pow(1-a,2)*a*e.x+3*(1-a)*a*a*i.x+a*a*a*n.x,u=Math.pow(1-a,3)*t.y+3*Math.pow(1-a,2)*a*e.y+3*(1-a)*a*a*i.y+a*a*a*n.y;s.push(cc.p(l,u)),a+=1/r}s.push(cc.p(n.x,n.y));var _=new cc._DrawNodeElement(cc.DrawNode.TYPE_POLY);_.verts=s,_.lineWidth=c,_.lineColor=o,_.isStroke=!0,_.lineCap="round",this._buffer.push(_)},drawCatmullRom:function(t,e,i,n){this.drawCardinalSpline(t,.5,e,i,n)},drawCardinalSpline:function(t,e,i,n,r){n=n||this._lineWidth,r=r||this.getDrawColor(),null==r.a&&(r.a=255);for(var c,o,s=[],a=1/t.length,h=0;h<i+1;h++){var l=h/i;1===l?(c=t.length-1,o=1):(c=0|l/a,o=(l-a*c)/a);var u=cc.cardinalSplineAt(cc.getControlPointAt(t,c-1),cc.getControlPointAt(t,c-0),cc.getControlPointAt(t,c+1),cc.getControlPointAt(t,c+2),e,o);s.push(u)}var _=new cc._DrawNodeElement(cc.DrawNode.TYPE_POLY);_.verts=s,_.lineWidth=n,_.lineColor=r,_.isStroke=!0,_.lineCap="round",this._buffer.push(_)},drawDot:function(t,e,i){i=i||this.getDrawColor(),null==i.a&&(i.a=255);var n=new cc._DrawNodeElement(cc.DrawNode.TYPE_DOT);n.verts=[t],n.lineWidth=e,n.fillColor=i,this._buffer.push(n)},drawDots:function(t,e,i){if(t&&0!=t.length){i=i||this.getDrawColor(),null==i.a&&(i.a=255);for(var n=0,r=t.length;n<r;n++)this.drawDot(t[n],e,i)}},drawSegment:function(t,e,i,n){i=i||this._lineWidth,n=n||this.getDrawColor(),null==n.a&&(n.a=255);var r=new cc._DrawNodeElement(cc.DrawNode.TYPE_POLY);r.verts=[t,e],r.lineWidth=2*i,r.lineColor=n,r.isStroke=!0,r.lineCap="round",this._buffer.push(r)},drawPoly_:function(t,e,i,n){i=null==i?this._lineWidth:i,n=n||this.getDrawColor(),null==n.a&&(n.a=255);var r=new cc._DrawNodeElement(cc.DrawNode.TYPE_POLY);r.verts=t,r.fillColor=e,r.lineWidth=i,r.lineColor=n,r.isClosePolygon=!0,r.isStroke=!0,r.lineCap="round",e&&(r.isFill=!0),this._buffer.push(r)},drawPoly:function(t,e,i,n){for(var r=[],c=0;c<t.length;c++)r.push(cc.p(t[c].x,t[c].y));return this.drawPoly_(r,e,i,n)},clear:function(){this._buffer.length=0},_createRenderCmd:function(){return new cc.DrawNode.CanvasRenderCmd(this)}})):cc._renderType===cc.game.RENDER_TYPE_WEBGL&&cc.extend(cc.DrawNode.prototype,{_bufferCapacity:0,_trianglesArrayBuffer:null,_trianglesWebBuffer:null,_trianglesReader:null,_dirty:!1,_className:"DrawNodeWebGL",ctor:function(){cc.Node.prototype.ctor.call(this),this._buffer=[],this._blendFunc=new cc.BlendFunc(cc.SRC_ALPHA,cc.ONE_MINUS_SRC_ALPHA),this._drawColor=cc.color(255,255,255,255),this.init()},init:function(){return!!cc.Node.prototype.init.call(this)&&(this.shaderProgram=cc.shaderCache.programForKey(cc.SHADER_POSITION_LENGTHTEXTURECOLOR),this._ensureCapacity(64),this._trianglesWebBuffer=cc._renderContext.createBuffer(),this._dirty=!0,!0)},drawRect:function(t,e,i,n,r){n=null==n?this._lineWidth:n,r=r||this.getDrawColor(),null==r.a&&(r.a=255);var c=[t,cc.p(e.x,t.y),e,cc.p(t.x,e.y)];null==i?this._drawSegments(c,n,r,!0):this.drawPoly(c,i,n,r)},drawCircle:function(t,e,i,n,r,c,o){c=c||this._lineWidth,o=o||this.getDrawColor(),null==o.a&&(o.a=255);var s,a,h=2*Math.PI/n,l=[];for(s=0;s<=n;s++){var u=s*h,_=e*Math.cos(u+i)+t.x,d=e*Math.sin(u+i)+t.y;l.push(cc.p(_,d))}for(r&&l.push(cc.p(t.x,t.y)),c*=.5,s=0,a=l.length;s<a-1;s++)this.drawSegment(l[s],l[s+1],c,o)},drawQuadBezier:function(t,e,i,n,r,c){r=r||this._lineWidth,c=c||this.getDrawColor(),null==c.a&&(c.a=255);for(var o=[],s=0,a=0;a<n;a++){var h=Math.pow(1-s,2)*t.x+2*(1-s)*s*e.x+s*s*i.x,l=Math.pow(1-s,2)*t.y+2*(1-s)*s*e.y+s*s*i.y;o.push(cc.p(h,l)),s+=1/n}o.push(cc.p(i.x,i.y)),this._drawSegments(o,r,c,!1)},drawCubicBezier:function(t,e,i,n,r,c,o){c=c||this._lineWidth,o=o||this.getDrawColor(),null==o.a&&(o.a=255);for(var s=[],a=0,h=0;h<r;h++){var l=Math.pow(1-a,3)*t.x+3*Math.pow(1-a,2)*a*e.x+3*(1-a)*a*a*i.x+a*a*a*n.x,u=Math.pow(1-a,3)*t.y+3*Math.pow(1-a,2)*a*e.y+3*(1-a)*a*a*i.y+a*a*a*n.y;s.push(cc.p(l,u)),a+=1/r}s.push(cc.p(n.x,n.y)),this._drawSegments(s,c,o,!1)},drawCatmullRom:function(t,e,i,n){this.drawCardinalSpline(t,.5,e,i,n)},drawCardinalSpline:function(t,e,i,n,r){n=n||this._lineWidth,r=r||this.getDrawColor(),null==r.a&&(r.a=255);for(var c,o,s=[],a=1/t.length,h=0;h<i+1;h++){var l=h/i;1===l?(c=t.length-1,o=1):(c=0|l/a,o=(l-a*c)/a);var u=cc.cardinalSplineAt(cc.getControlPointAt(t,c-1),cc.getControlPointAt(t,c-0),cc.getControlPointAt(t,c+1),cc.getControlPointAt(t,c+2),e,o);s.push(u)}n*=.5;for(var _=0,d=s.length;_<d-1;_++)this.drawSegment(s[_],s[_+1],n,r)},_render:function(){var t=cc._renderContext;t.bindBuffer(t.ARRAY_BUFFER,this._trianglesWebBuffer),this._dirty&&(t.bufferData(t.ARRAY_BUFFER,this._trianglesArrayBuffer,t.STREAM_DRAW),this._dirty=!1);var e=cc.V2F_C4B_T2F.BYTES_PER_ELEMENT;t.enableVertexAttribArray(cc.VERTEX_ATTRIB_POSITION),t.enableVertexAttribArray(cc.VERTEX_ATTRIB_COLOR),t.enableVertexAttribArray(cc.VERTEX_ATTRIB_TEX_COORDS),t.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,t.FLOAT,!1,e,0),t.vertexAttribPointer(cc.VERTEX_ATTRIB_COLOR,4,t.UNSIGNED_BYTE,!0,e,8),t.vertexAttribPointer(cc.VERTEX_ATTRIB_TEX_COORDS,2,t.FLOAT,!1,e,12),t.drawArrays(t.TRIANGLES,0,3*this._buffer.length),cc.incrementGLDraws(1)},_ensureCapacity:function(t){var e=this,i=e._buffer;if(i.length+t>e._bufferCapacity){var n=cc.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT;if(e._bufferCapacity+=Math.max(e._bufferCapacity,t),null==i||0===i.length)e._buffer=[],e._trianglesArrayBuffer=new ArrayBuffer(n*e._bufferCapacity),e._trianglesReader=new Uint8Array(e._trianglesArrayBuffer);else{for(var r=[],c=new ArrayBuffer(n*e._bufferCapacity),o=0;o<i.length;o++)r[o]=new cc.V2F_C4B_T2F_Triangle(i[o].a,i[o].b,i[o].c,c,o*n);e._trianglesReader=new Uint8Array(c),e._trianglesArrayBuffer=c,e._buffer=r}}},drawDot:function(t,e,i){i=i||this.getDrawColor(),null==i.a&&(i.a=255);var n={r:0|i.r,g:0|i.g,b:0|i.b,a:0|i.a},r={vertices:{x:t.x-e,y:t.y-e},colors:n,texCoords:{u:-1,v:-1}},c={vertices:{x:t.x-e,y:t.y+e},colors:n,texCoords:{u:-1,v:1}},o={vertices:{x:t.x+e,y:t.y+e},colors:n,texCoords:{u:1,v:1}},s={vertices:{x:t.x+e,y:t.y-e},colors:n,texCoords:{u:1,v:-1}};this._ensureCapacity(6),this._buffer.push(new cc.V2F_C4B_T2F_Triangle(r,c,o,this._trianglesArrayBuffer,this._buffer.length*cc.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT)),this._buffer.push(new cc.V2F_C4B_T2F_Triangle(r,o,s,this._trianglesArrayBuffer,this._buffer.length*cc.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT)),this._dirty=!0},drawDots:function(t,e,i){if(t&&0!==t.length){i=i||this.getDrawColor(),null==i.a&&(i.a=255);for(var n=0,r=t.length;n<r;n++)this.drawDot(t[n],e,i)}},drawSegment:function(t,e,i,n){n=n||this.getDrawColor(),null==n.a&&(n.a=255),i=i||.5*this._lineWidth;var r=18;this._ensureCapacity(r);var c={r:0|n.r,g:0|n.g,b:0|n.b,a:0|n.a},o=cc.__v2f(t),s=cc.__v2f(e),a=cc.v2fnormalize(cc.v2fperp(cc.v2fsub(s,o))),h=cc.v2fperp(a),l=cc.v2fmult(a,i),u=cc.v2fmult(h,i),_=cc.v2fsub(s,cc.v2fadd(l,u)),d=cc.v2fadd(s,cc.v2fsub(l,u)),f=cc.v2fsub(s,l),p=cc.v2fadd(s,l),g=cc.v2fsub(o,l),m=cc.v2fadd(o,l),v=cc.v2fsub(o,cc.v2fsub(l,u)),T=cc.v2fadd(o,cc.v2fadd(l,u)),y=cc.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT,S=this._trianglesArrayBuffer,C=this._buffer;C.push(new cc.V2F_C4B_T2F_Triangle({vertices:_,colors:c,texCoords:cc.__t(cc.v2fneg(cc.v2fadd(a,h)))},{vertices:d,colors:c,texCoords:cc.__t(cc.v2fsub(a,h))},{vertices:f,colors:c,texCoords:cc.__t(cc.v2fneg(a))},S,C.length*y)),C.push(new cc.V2F_C4B_T2F_Triangle({vertices:p,colors:c,texCoords:cc.__t(a)},{vertices:d,colors:c,texCoords:cc.__t(cc.v2fsub(a,h))},{vertices:f,colors:c,texCoords:cc.__t(cc.v2fneg(a))},S,C.length*y)),C.push(new cc.V2F_C4B_T2F_Triangle({vertices:p,colors:c,texCoords:cc.__t(a)},{vertices:g,colors:c,texCoords:cc.__t(cc.v2fneg(a))},{vertices:f,colors:c,texCoords:cc.__t(cc.v2fneg(a))},S,C.length*y)),C.push(new cc.V2F_C4B_T2F_Triangle({vertices:p,colors:c,texCoords:cc.__t(a)},{vertices:g,colors:c,texCoords:cc.__t(cc.v2fneg(a))},{vertices:m,colors:c,texCoords:cc.__t(a)},S,C.length*y)),C.push(new cc.V2F_C4B_T2F_Triangle({vertices:v,colors:c,texCoords:cc.__t(cc.v2fsub(h,a))},{vertices:g,colors:c,texCoords:cc.__t(cc.v2fneg(a))},{vertices:m,colors:c,texCoords:cc.__t(a)},S,C.length*y)),C.push(new cc.V2F_C4B_T2F_Triangle({vertices:v,colors:c,texCoords:cc.__t(cc.v2fsub(h,a))},{vertices:T,colors:c,texCoords:cc.__t(cc.v2fadd(a,h))},{vertices:m,colors:c,texCoords:cc.__t(a)},S,C.length*y)),this._dirty=!0},drawPoly:function(t,e,i,n){if(null==e)return void this._drawSegments(t,i,n,!0);null==e.a&&(e.a=255),
null==n.a&&(n.a=255),i=null==i?this._lineWidth:i,i*=.5;var r,c,o,s,a={r:0|e.r,g:0|e.g,b:0|e.b,a:0|e.a},h={r:0|n.r,g:0|n.g,b:0|n.b,a:0|n.a},l=[],u=t.length;for(r=0;r<u;r++){c=cc.__v2f(t[(r-1+u)%u]),o=cc.__v2f(t[r]),s=cc.__v2f(t[(r+1)%u]);var _=cc.v2fnormalize(cc.v2fperp(cc.v2fsub(o,c))),d=cc.v2fnormalize(cc.v2fperp(cc.v2fsub(s,o))),f=cc.v2fmult(cc.v2fadd(_,d),1/(cc.v2fdot(_,d)+1));l[r]={offset:f,n:d}}var p=i>0,g=3*u-2,m=3*g;this._ensureCapacity(m);var v=cc.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT,T=this._trianglesArrayBuffer,y=this._buffer,S=0==p?.5:0;for(r=0;r<u-2;r++)c=cc.v2fsub(cc.__v2f(t[0]),cc.v2fmult(l[0].offset,S)),o=cc.v2fsub(cc.__v2f(t[r+1]),cc.v2fmult(l[r+1].offset,S)),s=cc.v2fsub(cc.__v2f(t[r+2]),cc.v2fmult(l[r+2].offset,S)),y.push(new cc.V2F_C4B_T2F_Triangle({vertices:c,colors:a,texCoords:cc.__t(cc.v2fzero())},{vertices:o,colors:a,texCoords:cc.__t(cc.v2fzero())},{vertices:s,colors:a,texCoords:cc.__t(cc.v2fzero())},T,y.length*v));for(r=0;r<u;r++){var C=(r+1)%u;c=cc.__v2f(t[r]),o=cc.__v2f(t[C]);var E=l[r].n,b=l[r].offset,x=l[C].offset,A=p?cc.v2fsub(c,cc.v2fmult(b,i)):cc.v2fsub(c,cc.v2fmult(b,.5)),R=p?cc.v2fsub(o,cc.v2fmult(x,i)):cc.v2fsub(o,cc.v2fmult(x,.5)),w=p?cc.v2fadd(c,cc.v2fmult(b,i)):cc.v2fadd(c,cc.v2fmult(b,.5)),I=p?cc.v2fadd(o,cc.v2fmult(x,i)):cc.v2fadd(o,cc.v2fmult(x,.5));p?(y.push(new cc.V2F_C4B_T2F_Triangle({vertices:A,colors:h,texCoords:cc.__t(cc.v2fneg(E))},{vertices:R,colors:h,texCoords:cc.__t(cc.v2fneg(E))},{vertices:I,colors:h,texCoords:cc.__t(E)},T,y.length*v)),y.push(new cc.V2F_C4B_T2F_Triangle({vertices:A,colors:h,texCoords:cc.__t(cc.v2fneg(E))},{vertices:w,colors:h,texCoords:cc.__t(E)},{vertices:I,colors:h,texCoords:cc.__t(E)},T,y.length*v))):(y.push(new cc.V2F_C4B_T2F_Triangle({vertices:A,colors:a,texCoords:cc.__t(cc.v2fzero())},{vertices:R,colors:a,texCoords:cc.__t(cc.v2fzero())},{vertices:I,colors:a,texCoords:cc.__t(E)},T,y.length*v)),y.push(new cc.V2F_C4B_T2F_Triangle({vertices:A,colors:a,texCoords:cc.__t(cc.v2fzero())},{vertices:w,colors:a,texCoords:cc.__t(E)},{vertices:I,colors:a,texCoords:cc.__t(E)},T,y.length*v)))}l=null,this._dirty=!0},_drawSegments:function(t,e,i,n){if(e=null==e?this._lineWidth:e,i=i||this._drawColor,null==i.a&&(i.a=255),e*=.5,!(e<=0)){var r,c,o,s,a={r:0|i.r,g:0|i.g,b:0|i.b,a:0|i.a},h=[],l=t.length;for(r=0;r<l;r++){c=cc.__v2f(t[(r-1+l)%l]),o=cc.__v2f(t[r]),s=cc.__v2f(t[(r+1)%l]);var u=cc.v2fnormalize(cc.v2fperp(cc.v2fsub(o,c))),_=cc.v2fnormalize(cc.v2fperp(cc.v2fsub(s,o))),d=cc.v2fmult(cc.v2fadd(u,_),1/(cc.v2fdot(u,_)+1));h[r]={offset:d,n:_}}var f=3*l-2,p=3*f;this._ensureCapacity(p);var g=cc.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT,m=this._trianglesArrayBuffer,v=this._buffer,T=n?l:l-1;for(r=0;r<T;r++){var y=(r+1)%l;c=cc.__v2f(t[r]),o=cc.__v2f(t[y]);var S=h[r].n,C=h[r].offset,E=h[y].offset,b=cc.v2fsub(c,cc.v2fmult(C,e)),x=cc.v2fsub(o,cc.v2fmult(E,e)),A=cc.v2fadd(c,cc.v2fmult(C,e)),R=cc.v2fadd(o,cc.v2fmult(E,e));v.push(new cc.V2F_C4B_T2F_Triangle({vertices:b,colors:a,texCoords:cc.__t(cc.v2fneg(S))},{vertices:x,colors:a,texCoords:cc.__t(cc.v2fneg(S))},{vertices:R,colors:a,texCoords:cc.__t(S)},m,v.length*g)),v.push(new cc.V2F_C4B_T2F_Triangle({vertices:b,colors:a,texCoords:cc.__t(cc.v2fneg(S))},{vertices:A,colors:a,texCoords:cc.__t(S)},{vertices:R,colors:a,texCoords:cc.__t(S)},m,v.length*g))}h=null,this._dirty=!0}},clear:function(){this._buffer.length=0,this._dirty=!0},_createRenderCmd:function(){return new cc.DrawNode.WebGLRenderCmd(this)}})}),function(){cc.DrawNode.CanvasRenderCmd=function(t){cc.Node.CanvasRenderCmd.call(this,t),this._needDraw=!0,this._buffer=null,this._drawColor=null,this._blendFunc=null},cc.DrawNode.CanvasRenderCmd.prototype=Object.create(cc.Node.CanvasRenderCmd.prototype),cc.DrawNode.CanvasRenderCmd.prototype.constructor=cc.DrawNode.CanvasRenderCmd,cc.DrawNode.CanvasRenderCmd.prototype.getLocalBB=function(){var t=this._node;return t._localBB},cc.extend(cc.DrawNode.CanvasRenderCmd.prototype,{rendering:function(t,e,i){var n=t||cc._renderContext,r=(n.getContext(),this._node),c=r._displayedOpacity/255;if(0!==c){n.setTransform(this._worldTransform,e,i),n.setGlobalAlpha(c),this._blendFunc&&this._blendFunc.src===cc.SRC_ALPHA&&this._blendFunc.dst===cc.ONE&&n.setCompositeOperation("lighter");for(var o=this._buffer,s=0,a=o.length;s<a;s++){var h=o[s];switch(h.type){case cc.DrawNode.TYPE_DOT:this._drawDot(n,h,e,i);break;case cc.DrawNode.TYPE_SEGMENT:this._drawSegment(n,h,e,i);break;case cc.DrawNode.TYPE_POLY:this._drawPoly(n,h,e,i)}}}},_drawDot:function(t,e){var i=e.fillColor,n=e.verts[0],r=e.lineWidth,c=t.getContext();t.setFillStyle("rgba("+(0|i.r)+","+(0|i.g)+","+(0|i.b)+","+i.a/255+")"),c.beginPath(),c.arc(n.x,-n.y,r,0,2*Math.PI,!1),c.closePath(),c.fill()},_drawSegment:function(t,e,i){var n=e.lineColor,r=e.verts[0],c=e.verts[1],o=e.lineWidth,s=e.lineCap,a=t.getContext();t.setStrokeStyle("rgba("+(0|n.r)+","+(0|n.g)+","+(0|n.b)+","+n.a/255+")"),a.lineWidth=o*i,a.beginPath(),a.lineCap=s,a.moveTo(r.x,-r.y),a.lineTo(c.x,-c.y),a.stroke()},_drawPoly:function(t,e,i){var n=e.verts,r=e.lineCap;if(null!=n){var c=e.fillColor,o=e.lineWidth,s=e.lineColor,a=e.isClosePolygon,h=e.isFill,l=e.isStroke,u=t.getContext(),_=n[0];u.lineCap=r,c&&t.setFillStyle("rgba("+(0|c.r)+","+(0|c.g)+","+(0|c.b)+","+c.a/255+")"),o&&(u.lineWidth=o*i),s&&t.setStrokeStyle("rgba("+(0|s.r)+","+(0|s.g)+","+(0|s.b)+","+s.a/255+")"),u.beginPath(),u.moveTo(_.x,-_.y);for(var d=1,f=n.length;d<f;d++)u.lineTo(n[d].x,-n[d].y);a&&u.closePath(),h&&u.fill(),l&&u.stroke()}}})}(),function(){cc.DrawNode.WebGLRenderCmd=function(t){cc.Node.WebGLRenderCmd.call(this,t),this._needDraw=!0,this._matrix=new cc.math.Matrix4,this._matrix.identity()},cc.DrawNode.WebGLRenderCmd.prototype=Object.create(cc.Node.WebGLRenderCmd.prototype),cc.DrawNode.WebGLRenderCmd.prototype.constructor=cc.DrawNode.WebGLRenderCmd,cc.DrawNode.WebGLRenderCmd.prototype.rendering=function(t){var e=this._node;if(e._buffer.length>0){var i=this._worldTransform;this._matrix.mat[0]=i.a,this._matrix.mat[4]=i.c,this._matrix.mat[12]=i.tx,this._matrix.mat[1]=i.b,this._matrix.mat[5]=i.d,this._matrix.mat[13]=i.ty,cc.glBlendFunc(e._blendFunc.src,e._blendFunc.dst),this._shaderProgram.use(),this._shaderProgram._setUniformForMVPMatrixWithMat4(this._matrix),e._render()}}}(),cc.stencilBits=-1,cc.ClippingNode=cc.Node.extend({alphaThreshold:0,inverted:!1,_stencil:null,_className:"ClippingNode",ctor:function(t){t=t||null,cc.Node.prototype.ctor.call(this),this._stencil=t,this.alphaThreshold=1,this.inverted=!1,this._renderCmd.initStencilBits()},init:function(t){return this._stencil=t,this.alphaThreshold=1,this.inverted=!1,this._renderCmd.initStencilBits(),!0},onEnter:function(){cc.Node.prototype.onEnter.call(this),this._stencil.onEnter()},onEnterTransitionDidFinish:function(){cc.Node.prototype.onEnterTransitionDidFinish.call(this),this._stencil.onEnterTransitionDidFinish()},onExitTransitionDidStart:function(){this._stencil.onExitTransitionDidStart(),cc.Node.prototype.onExitTransitionDidStart.call(this)},onExit:function(){this._stencil.onExit(),cc.Node.prototype.onExit.call(this)},getAlphaThreshold:function(){return this.alphaThreshold},setAlphaThreshold:function(t){this.alphaThreshold=t},isInverted:function(){return this.inverted},setInverted:function(t){this.inverted=t},getStencil:function(){return this._stencil},setStencil:function(t){this._stencil!==t&&this._renderCmd.setStencil(t)},_createRenderCmd:function(){return cc._renderType===cc.game.RENDER_TYPE_CANVAS?new cc.ClippingNode.CanvasRenderCmd(this):new cc.ClippingNode.WebGLRenderCmd(this)}});var _p=cc.ClippingNode.prototype;cc.defineGetterSetter(_p,"stencil",_p.getStencil,_p.setStencil),_p.stencil,cc.ClippingNode.create=function(t){return new cc.ClippingNode(t)},function(){cc.ClippingNode.CanvasRenderCmd=function(t){cc.Node.CanvasRenderCmd.call(this,t),this._needDraw=!1,this._godhelpme=!1,this._clipElemType=!1,this._rendererSaveCmd=new cc.CustomRenderCmd(this,this._saveCmdCallback),this._rendererClipCmd=new cc.CustomRenderCmd(this,this._clipCmdCallback),this._rendererRestoreCmd=new cc.CustomRenderCmd(this,this._restoreCmdCallback)};var t=cc.ClippingNode.CanvasRenderCmd.prototype=Object.create(cc.Node.CanvasRenderCmd.prototype);t.constructor=cc.ClippingNode.CanvasRenderCmd,t.initStencilBits=function(){},t.setStencil=function(t){if(null!=t)if(this._node._stencil=t,t instanceof cc.DrawNode){if(t._buffer)for(var e=0;e<t._buffer.length;e++)t._buffer[e].isFill=!1,t._buffer[e].isStroke=!1;t._renderCmd.rendering=function(t,e,i){},t._renderCmd._canUseDirtyRegion=!0,this._rendererSaveCmd._canUseDirtyRegion=!0,this._rendererClipCmd._canUseDirtyRegion=!0,this._rendererRestoreCmd._canUseDirtyRegion=!0}else t._parent=this._node},t._saveCmdCallback=function(t,e,i){var n=t||cc._renderContext,r=n.getContext();if(this._clipElemType){var c=cc.ClippingNode.CanvasRenderCmd._getSharedCache(),o=r.canvas;c.width=o.width,c.height=o.height;var s=c.getContext("2d");s.drawImage(o,0,0)}else n.save(),n.setTransform(this._worldTransform,e,i),this._node.inverted&&(r.beginPath(),r.rect(0,0,r.canvas.width,-r.canvas.height),r.clip())},t._setStencilCompositionOperation=function(t){if(t){var e=this._node;if(t._renderCmd&&t._renderCmd._blendFuncStr&&(t._renderCmd._blendFuncStr=e.inverted?"destination-out":"destination-in"),t._children)for(var i=t._children,n=0,r=i.length;n<r;n++)this._setStencilCompositionOperation(i[n])}},t._clipCmdCallback=function(t){var e=this._node,i=t||cc._renderContext,n=i.getContext();if(this._clipElemType)this._setStencilCompositionOperation(e._stencil);else{var r=this._node._stencil;if(r instanceof cc.DrawNode){n.beginPath();var c=r._renderCmd._transform;n.transform(c.a,c.b,c.c,c.d,c.tx,-c.ty);for(var o=0;o<r._buffer.length;o++){var s=r._buffer[o].verts,a=s[0];n.moveTo(a.x,-a.y);for(var h=s.length-1;h>0;h--)n.lineTo(s[h].x,-s[h].y)}}n.clip()}},t._restoreCmdCallback=function(t){var e=cc.ClippingNode.CanvasRenderCmd._getSharedCache(),i=t||cc._renderContext,n=i.getContext();this._clipElemType?(n.save(),n.setTransform(1,0,0,1,0,0),n.globalCompositeOperation="destination-over",n.drawImage(e,0,0),n.restore(),this._dirtyFlag=0):i.restore()},t.transform=function(t,e){cc.Node.CanvasRenderCmd.prototype.transform.call(this,t,e);var i=this._node;i._stencil&&i._stencil._renderCmd&&i._stencil._renderCmd.transform(this,e)},t._cangodhelpme=function(t){return t!==!0&&t!==!1||(cc.ClippingNode.CanvasRenderCmd.prototype._godhelpme=t),cc.ClippingNode.CanvasRenderCmd.prototype._godhelpme},t.visit=function(t){var e=this._node;if(e._visible){t=t||this.getParentRenderCmd(),t&&(this._curLevel=t._curLevel+1);var i=this;if(this._clipElemType=!(!this._cangodhelpme()&&e._stencil instanceof cc.DrawNode),!e._stencil||!e._stencil.visible)return void(this.inverted&&this.originVisit(t));if(this._syncStatus(t),cc.renderer.pushRenderCommand(this._rendererSaveCmd),this._clipElemType?this.originVisit(t):e._stencil.visit(this),cc.renderer.pushRenderCommand(this._rendererClipCmd),this._clipElemType)e._stencil.visit(i);else{var n,r=e._children;this._cangodhelpme(!0);var c=r.length;if(c>0)for(e.sortAllChildren(),n=0;n<c;n++)r[n]._renderCmd.visit(this);this._cangodhelpme(!1)}cc.renderer.pushRenderCommand(this._rendererRestoreCmd),this._dirtyFlag=0}},cc.ClippingNode.CanvasRenderCmd._sharedCache=null,cc.ClippingNode.CanvasRenderCmd._getSharedCache=function(){return cc.ClippingNode.CanvasRenderCmd._sharedCache||(cc.ClippingNode.CanvasRenderCmd._sharedCache=document.createElement("canvas"))}}(),function(){cc.ClippingNode.WebGLRenderCmd=function(t){cc.Node.WebGLRenderCmd.call(this,t),this._needDraw=!1,this._beforeVisitCmd=new cc.CustomRenderCmd(this,this._onBeforeVisit),this._afterDrawStencilCmd=new cc.CustomRenderCmd(this,this._onAfterDrawStencil),this._afterVisitCmd=new cc.CustomRenderCmd(this,this._onAfterVisit),this._currentStencilEnabled=null,this._mask_layer_le=null};var t=cc.ClippingNode.WebGLRenderCmd.prototype=Object.create(cc.Node.WebGLRenderCmd.prototype);t.constructor=cc.ClippingNode.WebGLRenderCmd,cc.ClippingNode.WebGLRenderCmd._init_once=null,cc.ClippingNode.WebGLRenderCmd._visit_once=null,cc.ClippingNode.WebGLRenderCmd._layer=-1,t.initStencilBits=function(){cc.ClippingNode.WebGLRenderCmd._init_once=!0,cc.ClippingNode.WebGLRenderCmd._init_once&&(cc.stencilBits=cc._renderContext.getParameter(cc._renderContext.STENCIL_BITS),cc.stencilBits<=0&&cc.log("Stencil buffer is not enabled."),cc.ClippingNode.WebGLRenderCmd._init_once=!1)},t.transform=function(t,e){var i=this._node;this.originTransform(t,e),i._stencil&&i._stencil._renderCmd.transform(this,e)},t.visit=function(t){var e=this._node;if(e._visible){if(e._parent&&e._parent._renderCmd&&(this._curLevel=e._parent._renderCmd._curLevel+1),cc.stencilBits<1)return void this.originVisit(t);if(!e._stencil||!e._stencil.visible)return void(e.inverted&&this.originVisit(t));if(cc.ClippingNode.WebGLRenderCmd._layer+1===cc.stencilBits)return cc.ClippingNode.WebGLRenderCmd._visit_once=!0,cc.ClippingNode.WebGLRenderCmd._visit_once&&(cc.log("Nesting more than "+cc.stencilBits+"stencils is not supported. Everything will be drawn without stencil for this node and its children."),cc.ClippingNode.WebGLRenderCmd._visit_once=!1),void this.originVisit(t);cc.renderer.pushRenderCommand(this._beforeVisitCmd);var i=cc.current_stack;i.stack.push(i.top),this._syncStatus(t),i.top=this._stackMatrix,e._stencil._renderCmd.visit(this),cc.renderer.pushRenderCommand(this._afterDrawStencilCmd);var n=e._children;if(n&&n.length>0){var r=n.length;e.sortAllChildren();for(var c=0;c<r;c++)n[c]._renderCmd.visit(this)}cc.renderer.pushRenderCommand(this._afterVisitCmd),this._dirtyFlag=0,i.top=i.stack.pop()}},t.setStencil=function(t){var e=this._node;e._stencil&&(e._stencil._parent=null),e._stencil=t,e._stencil&&(e._stencil._parent=e)},t._onBeforeVisit=function(t){var e=t||cc._renderContext,i=this._node;cc.ClippingNode.WebGLRenderCmd._layer++;var n=1<<cc.ClippingNode.WebGLRenderCmd._layer,r=n-1;if(this._mask_layer_le=n|r,this._currentStencilEnabled=e.isEnabled(e.STENCIL_TEST),e.clear(e.DEPTH_BUFFER_BIT),e.enable(e.STENCIL_TEST),e.depthMask(!1),e.stencilFunc(e.NEVER,n,n),e.stencilOp(e.REPLACE,e.KEEP,e.KEEP),e.stencilMask(n),e.clear(e.STENCIL_BUFFER_BIT),i.alphaThreshold<1){var c=cc.shaderCache.programForKey(cc.SHADER_POSITION_TEXTURECOLORALPHATEST);cc.glUseProgram(c.getProgram()),c.setUniformLocationWith1f(cc.UNIFORM_ALPHA_TEST_VALUE_S,i.alphaThreshold),c.setUniformLocationWithMatrix4fv(cc.UNIFORM_MVMATRIX_S,cc.renderer.mat4Identity.mat),cc.setProgram(i._stencil,c)}},t._onAfterDrawStencil=function(t){var e=t||cc._renderContext;e.depthMask(!0),e.stencilFunc(this._node.inverted?e.NOTEQUAL:e.EQUAL,this._mask_layer_le,this._mask_layer_le),e.stencilOp(e.KEEP,e.KEEP,e.KEEP)},t._onAfterVisit=function(t){var e=t||cc._renderContext;if(cc.ClippingNode.WebGLRenderCmd._layer--,this._currentStencilEnabled){var i=1<<cc.ClippingNode.WebGLRenderCmd._layer,n=i-1,r=i|n;e.stencilMask(i),e.stencilFunc(e.EQUAL,r,r)}else e.disable(e.STENCIL_TEST)}}(),cc.ProgressTimer=cc.Node.extend({_type:null,_percentage:0,_sprite:null,_midPoint:null,_barChangeRate:null,_reverseDirection:!1,_className:"ProgressTimer",ctor:function(t){cc.Node.prototype.ctor.call(this),this._type=cc.ProgressTimer.TYPE_RADIAL,this._percentage=0,this._midPoint=cc.p(0,0),this._barChangeRate=cc.p(0,0),this._reverseDirection=!1,this._sprite=null,t&&this.initWithSprite(t)},onEnter:function(){this._super(),cc._renderType===cc.game.RENDER_TYPE_WEBGL&&(this._renderCmd.initCmd(),this._renderCmd._updateProgress())},cleanup:function(){cc._renderType===cc.game.RENDER_TYPE_WEBGL&&this._renderCmd.releaseData(),this._super()},getMidpoint:function(){return cc.p(this._midPoint.x,this._midPoint.y)},setMidpoint:function(t){this._midPoint=cc.pClamp(t,cc.p(0,0),cc.p(1,1))},getBarChangeRate:function(){return cc.p(this._barChangeRate.x,this._barChangeRate.y)},setBarChangeRate:function(t){this._barChangeRate=cc.pClamp(t,cc.p(0,0),cc.p(1,1))},getType:function(){return this._type},getPercentage:function(){return this._percentage},getSprite:function(){return this._sprite},setPercentage:function(t){this._percentage!==t&&(this._percentage=cc.clampf(t,0,100),this._renderCmd._updateProgress())},setOpacityModifyRGB:function(t){},isOpacityModifyRGB:function(){return!1},isReverseDirection:function(){return this._reverseDirection},setColor:function(t){this._sprite.color=t,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.colorDirty)},setOpacity:function(t){this._sprite.opacity=t,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.opacityDirty)},getColor:function(){return this._sprite.color},getOpacity:function(){return this._sprite.opacity},setReverseProgress:function(t){this._reverseDirection!==t&&(this._reverseDirection=t,this._renderCmd.resetVertexData())},setSprite:function(t){this._sprite!==t&&(this._sprite=t,t?(this.setContentSize(t.width,t.height),t.ignoreAnchorPointForPosition(!0)):this.setContentSize(0,0),this._renderCmd.resetVertexData())},setType:function(t){t!==this._type&&(this._type=t,this._renderCmd.resetVertexData())},setReverseDirection:function(t){this._reverseDirection!==t&&(this._reverseDirection=t,this._renderCmd.resetVertexData())},initWithSprite:function(t){return this.percentage=0,this.setAnchorPoint(.5,.5),this._type=cc.ProgressTimer.TYPE_RADIAL,this._reverseDirection=!1,this.midPoint=cc.p(.5,.5),this.barChangeRate=cc.p(1,1),this.setSprite(t),this._renderCmd.resetVertexData(),!0},_createRenderCmd:function(){return cc._renderType===cc.game.RENDER_TYPE_CANVAS?new cc.ProgressTimer.CanvasRenderCmd(this):new cc.ProgressTimer.WebGLRenderCmd(this)}});var _p=cc.ProgressTimer.prototype;_p.midPoint,cc.defineGetterSetter(_p,"midPoint",_p.getMidpoint,_p.setMidpoint),_p.barChangeRate,cc.defineGetterSetter(_p,"barChangeRate",_p.getBarChangeRate,_p.setBarChangeRate),_p.type,cc.defineGetterSetter(_p,"type",_p.getType,_p.setType),_p.percentage,cc.defineGetterSetter(_p,"percentage",_p.getPercentage,_p.setPercentage),_p.sprite,cc.defineGetterSetter(_p,"sprite",_p.getSprite,_p.setSprite),_p.reverseDir,cc.defineGetterSetter(_p,"reverseDir",_p.isReverseDirection,_p.setReverseDirection),cc.ProgressTimer.create=function(t){return new cc.ProgressTimer(t)},cc.ProgressTimer.TEXTURE_COORDS_COUNT=4,cc.ProgressTimer.TEXTURE_COORDS=75,cc.ProgressTimer.TYPE_RADIAL=0,cc.ProgressTimer.TYPE_BAR=1,function(){cc.ProgressTimer.CanvasRenderCmd=function(t){cc.Node.CanvasRenderCmd.call(this,t),this._needDraw=!0,this._PI180=Math.PI/180,this._barRect=cc.rect(0,0,0,0),this._origin=cc.p(0,0),this._radius=0,this._startAngle=270,this._endAngle=270,this._counterClockWise=!1,this._canUseDirtyRegion=!0};var t=cc.ProgressTimer.CanvasRenderCmd.prototype=Object.create(cc.Node.CanvasRenderCmd.prototype);t.constructor=cc.ProgressTimer.CanvasRenderCmd,t.rendering=function(t,e,i){var n=t||cc._renderContext,r=n.getContext(),c=this._node,o=c._sprite,s=o._renderCmd._textureCoord,a=o._renderCmd._displayedOpacity/255;if(0!==s.width&&0!==s.height&&o._texture&&s.validRect&&0!==a){n.setTransform(this._worldTransform,e,i),n.setCompositeOperation(o._blendFuncStr),n.setGlobalAlpha(a);var h=o._rect,l=o._offsetPosition,u=l.x,_=-l.y-h.height,d=h.width,f=h.height;if(n.save(),o._flippedX&&(u=-u-d,r.scale(-1,1)),o._flippedY&&(_=l.y,r.scale(1,-1)),c._type===cc.ProgressTimer.TYPE_BAR){var p=this._barRect;r.beginPath(),r.rect(p.x,p.y,p.width,p.height),r.clip(),r.closePath()}else if(c._type===cc.ProgressTimer.TYPE_RADIAL){var g=this._origin.x,m=this._origin.y;r.beginPath(),r.arc(g,m,this._radius,this._PI180*this._startAngle,this._PI180*this._endAngle,this._counterClockWise),r.lineTo(g,m),r.clip(),r.closePath()}var v=o._renderCmd._textureToRender||o._texture,T=v.getHtmlElementObj();o._renderCmd._colorized?r.drawImage(T,0,0,s.width,s.height,u,_,d,f):r.drawImage(T,s.renderX,s.renderY,s.width,s.height,u,_,d,f),n.restore(),cc.g_NumberOfDraws++}},t.releaseData=function(){},t.resetVertexData=function(){},t._updateProgress=function(){this.setDirtyFlag(cc.Node._dirtyFlags.contentDirty);var t=this._node,e=t._sprite,i=e.width,n=e.height,r=t._midPoint;if(t._type===cc.ProgressTimer.TYPE_RADIAL){this._radius=Math.round(Math.sqrt(i*i+n*n));var c,o,s=!1,a=this._origin;a.x=i*r.x,a.y=-n*r.y,t._reverseDirection?(o=270,c=270-3.6*t._percentage):(c=-90,o=-90+3.6*t._percentage),e._flippedX&&(a.x-=i*(2*t._midPoint.x),c=-c,o=-o,c-=180,o-=180,s=!s),e._flippedY&&(a.y+=n*(2*t._midPoint.y),s=!s,c=-c,o=-o),this._startAngle=c,this._endAngle=o,this._counterClockWise=s}else{var h=t._barChangeRate,l=t._percentage/100,u=this._barRect,_=cc.size(i*(1-h.x),n*(1-h.y)),d=cc.size((i-_.width)*l,(n-_.height)*l),f=cc.size(_.width+d.width,_.height+d.height),p=cc.p(i*r.x,n*r.y),g=p.x-f.width/2;r.x>.5&&f.width/2>=i-p.x&&(g=i-f.width);var m=p.y-f.height/2;r.y>.5&&f.height/2>=n-p.y&&(m=n-f.height),u.x=0;var v=1;e._flippedX&&(u.x-=f.width,v=-1),g>0&&(u.x+=g*v),u.y=0;var T=1;e._flippedY&&(u.y+=f.height,T=-1),m>0&&(u.y-=m*T),u.width=f.width,u.height=-f.height}},t._syncStatus=function(t){var e=this._node;if(e._sprite){var i=cc.Node._dirtyFlags,n=this._dirtyFlag,r=t?t._node:null;r&&r._cascadeColorEnabled&&t._dirtyFlag&i.colorDirty&&(n|=i.colorDirty),r&&r._cascadeOpacityEnabled&&t._dirtyFlag&i.opacityDirty&&(n|=i.opacityDirty),t&&t._dirtyFlag&i.transformDirty&&(n|=i.transformDirty),this._dirtyFlag=n;var c=e._sprite._renderCmd,o=c._dirtyFlag,s=o&i.colorDirty,a=o&i.opacityDirty;s&&(c._syncDisplayColor(),c._dirtyFlag=c._dirtyFlag&i.colorDirty^c._dirtyFlag,this._dirtyFlag=this._dirtyFlag&i.colorDirty^this._dirtyFlag),a&&(c._syncDisplayOpacity(),c._dirtyFlag=c._dirtyFlag&i.opacityDirty^c._dirtyFlag,this._dirtyFlag=this._dirtyFlag&i.opacityDirty^this._dirtyFlag),(s||a)&&c._updateColor(),n&i.transformDirty&&this.transform(t),n&i.orderDirty&&(this._dirtyFlag=this._dirtyFlag&i.orderDirty^this._dirtyFlag)}},t.updateStatus=function(){var t=this._node;if(t._sprite){var e=cc.Node._dirtyFlags,i=this._dirtyFlag,n=t._sprite._renderCmd,r=n._dirtyFlag,c=r&e.colorDirty,o=r&e.opacityDirty;c&&(n._updateDisplayColor(),n._dirtyFlag=n._dirtyFlag&e.colorDirty^n._dirtyFlag,this._dirtyFlag=this._dirtyFlag&e.colorDirty^this._dirtyFlag),o&&(n._updateDisplayOpacity(),n._dirtyFlag=n._dirtyFlag&e.opacityDirty^n._dirtyFlag,this._dirtyFlag=this._dirtyFlag&e.opacityDirty^this._dirtyFlag),(c||o)&&n._updateColor(),i&e.transformDirty&&this.transform(this.getParentRenderCmd(),!0),i&e.contentDirty&&this._notifyRegionStatus&&this._notifyRegionStatus(cc.Node.CanvasRenderCmd.RegionStatus.Dirty),this._dirtyFlag=0}}}(),cc.ProgressTo=cc.ActionInterval.extend({_to:0,_from:0,ctor:function(t,e){cc.ActionInterval.prototype.ctor.call(this),this._to=0,this._from=0,void 0!==e&&this.initWithDuration(t,e)},initWithDuration:function(t,e){return!!cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(this._to=e,!0)},clone:function(){var t=new cc.ProgressTo;return t.initWithDuration(this._duration,this._to),t},reverse:function(){return cc.log("cc.ProgressTo.reverse(): reverse hasn't been supported."),null},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._from=t.percentage},update:function(t){this.target instanceof cc.ProgressTimer&&(this.target.percentage=this._from+(this._to-this._from)*t)}}),cc.progressTo=function(t,e){return new cc.ProgressTo(t,e)},cc.ProgressTo.create=cc.progressTo,cc.ProgressFromTo=cc.ActionInterval.extend({_to:0,_from:0,ctor:function(t,e,i){cc.ActionInterval.prototype.ctor.call(this),this._to=0,this._from=0,void 0!==i&&this.initWithDuration(t,e,i)},initWithDuration:function(t,e,i){return!!cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(this._to=i,this._from=e,!0)},clone:function(){var t=new cc.ProgressFromTo;return t.initWithDuration(this._duration,this._from,this._to),t},reverse:function(){return cc.progressFromTo(this._duration,this._to,this._from)},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t)},update:function(t){this.target instanceof cc.ProgressTimer&&(this.target.percentage=this._from+(this._to-this._from)*t)}}),cc.progressFromTo=function(t,e,i){return new cc.ProgressFromTo(t,e,i)},cc.ProgressFromTo.create=cc.progressFromTo,function(){var t=8;cc.ProgressTimer.WebGLRenderCmd=function(t){cc.Node.WebGLRenderCmd.call(this,t),this._needDraw=!0,this._progressDirty=!0,this._bl=cc.p(),this._tr=cc.p(),this.initCmd()};var e=cc.ProgressTimer.WebGLRenderCmd.prototype=Object.create(cc.Node.WebGLRenderCmd.prototype);e.constructor=cc.ProgressTimer.WebGLRenderCmd,e.transform=function(t,e){this.originTransform(t,e);var i=this._node._sprite;i._renderCmd.transform(this,e);var n=i._offsetPosition.x,r=n+i._rect.width,c=i._offsetPosition.y,o=c+i._rect.height,s=this._worldTransform;this._bl.x=n*s.a+c*s.c+s.tx,this._bl.y=n*s.b+c*s.d+s.ty,this._tr.x=r*s.a+o*s.c+s.tx,this._tr.y=r*s.b+o*s.d+s.ty,this._updateProgressData()},e.rendering=function(t){var e=this._node,i=t||cc._renderContext;if(0!==this._vertexDataCount&&e._sprite){this._shaderProgram.use(),this._shaderProgram._updateProjectionUniform();var n=e._sprite._blendFunc;cc.glBlendFunc(n.src,n.dst),cc.glBindTexture2D(e._sprite.texture),i.bindBuffer(i.ARRAY_BUFFER,this._vertexWebGLBuffer),i.enableVertexAttribArray(cc.VERTEX_ATTRIB_POSITION),i.enableVertexAttribArray(cc.VERTEX_ATTRIB_COLOR),i.enableVertexAttribArray(cc.VERTEX_ATTRIB_TEX_COORDS),this._vertexDataDirty&&(i.bufferSubData(i.ARRAY_BUFFER,0,this._float32View),this._vertexDataDirty=!1);var r=cc.V3F_C4B_T2F.BYTES_PER_ELEMENT;i.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,3,i.FLOAT,!1,r,0),i.vertexAttribPointer(cc.VERTEX_ATTRIB_COLOR,4,i.UNSIGNED_BYTE,!0,r,12),i.vertexAttribPointer(cc.VERTEX_ATTRIB_TEX_COORDS,2,i.FLOAT,!1,r,16),e._type===cc.ProgressTimer.TYPE_RADIAL?i.drawArrays(i.TRIANGLE_FAN,0,this._vertexDataCount):e._type===cc.ProgressTimer.TYPE_BAR&&(e._reverseDirection?(i.drawArrays(i.TRIANGLE_STRIP,0,this._vertexDataCount/2),i.drawArrays(i.TRIANGLE_STRIP,4,this._vertexDataCount/2),cc.g_NumberOfDraws++):i.drawArrays(i.TRIANGLE_STRIP,0,this._vertexDataCount)),cc.g_NumberOfDraws++}},e._syncStatus=function(t){var e=this._node;if(e._sprite){var i=cc.Node._dirtyFlags,n=this._dirtyFlag,r=t?t._node:null;r&&r._cascadeColorEnabled&&t._dirtyFlag&i.colorDirty&&(n|=i.colorDirty),r&&r._cascadeOpacityEnabled&&t._dirtyFlag&i.opacityDirty&&(n|=i.opacityDirty),t&&t._dirtyFlag&i.transformDirty&&(n|=i.transformDirty),this._dirtyFlag=n;var c=e._sprite._renderCmd,o=c._dirtyFlag,s=(n|o)&i.colorDirty,a=(n|o)&i.opacityDirty;s&&(c._syncDisplayColor(),c._dirtyFlag=c._dirtyFlag&i.colorDirty^c._dirtyFlag,this._dirtyFlag=this._dirtyFlag&i.colorDirty^this._dirtyFlag),a&&(c._syncDisplayOpacity(),c._dirtyFlag=c._dirtyFlag&i.opacityDirty^c._dirtyFlag,this._dirtyFlag=this._dirtyFlag&i.opacityDirty^this._dirtyFlag),(s||a)&&this._updateColor(),n&i.transformDirty&&this.transform(t),n&i.textureDirty&&(this._updateProgressData(),this._dirtyFlag=this._dirtyFlag&i.textureDirty^this._dirtyFlag),c._dirtyFlag=0}},e.updateStatus=function(){var t=this._node;if(t._sprite){var e=cc.Node._dirtyFlags,i=this._dirtyFlag,n=t._sprite._renderCmd,r=n._dirtyFlag,c=(i|r)&e.colorDirty,o=(i|r)&e.opacityDirty;c&&(n._updateDisplayColor(),n._dirtyFlag=n._dirtyFlag&e.colorDirty^n._dirtyFlag,this._dirtyFlag=this._dirtyFlag&e.colorDirty^this._dirtyFlag),o&&(n._updateDisplayOpacity(),n._dirtyFlag=n._dirtyFlag&e.opacityDirty^n._dirtyFlag,this._dirtyFlag=this._dirtyFlag&e.opacityDirty^this._dirtyFlag),(c||o)&&this._updateColor(),i&e.transformDirty&&this.transform(this.getParentRenderCmd(),!0),i&e.orderDirty&&(this._dirtyFlag=this._dirtyFlag&e.orderDirty^this._dirtyFlag),i&e.textureDirty&&(this._updateProgressData(),this._dirtyFlag=this._dirtyFlag&e.textureDirty^this._dirtyFlag)}},e.releaseData=function(){if(this._vertexData){var t=this._vertexWebGLBuffer;setTimeout(function(){cc._renderContext.deleteBuffer(t)},.1),this._vertexWebGLBuffer=null,this._vertexData=null,this._float32View=null,this._vertexArrayBuffer=null,this._vertexDataCount=0}},e.initCmd=function(){if(!this._vertexData){this._vertexWebGLBuffer=cc._renderContext.createBuffer();var e=cc.V3F_C4B_T2F.BYTES_PER_ELEMENT;this._vertexArrayBuffer=new ArrayBuffer(t*e),this._float32View=new Float32Array(this._vertexArrayBuffer),this._vertexData=[];for(var i=0;i<t;i++)this._vertexData[i]=new cc.V3F_C4B_T2F(null,null,null,this._vertexArrayBuffer,i*e);gl.bindBuffer(gl.ARRAY_BUFFER,this._vertexWebGLBuffer),gl.bufferData(gl.ARRAY_BUFFER,this._float32View,gl.DYNAMIC_DRAW),this._vertexDataCount=0,this._vertexDataDirty=!0,this._shaderProgram=cc.shaderCache.programForKey(cc.SHADER_SPRITE_POSITION_TEXTURECOLOR)}},e.resetVertexData=function(){this._vertexDataCount=0},e._updateProgressData=function(){var t=this._node,e=t._type;e===cc.ProgressTimer.TYPE_RADIAL?this._updateRadial():e===cc.ProgressTimer.TYPE_BAR&&this._updateBar(),this._vertexDataDirty=!0},e._updateProgress=function(){this.setDirtyFlag(cc.Node._dirtyFlags.textureDirty)},e._updateBar=function(){var t=this._node;if(t._sprite){var e=t._percentage/100,i=t._barChangeRate,n=cc.pMult(cc.p(1-i.x+e*i.x,1-i.y+e*i.y),.5),r=cc.pSub(t._midPoint,n),c=cc.pAdd(t._midPoint,n);r.x<0&&(c.x+=-r.x,r.x=0),c.x>1&&(r.x-=c.x-1,c.x=1),r.y<0&&(c.y+=-r.y,r.y=0),c.y>1&&(r.y-=c.y-1,c.y=1);var o;this._reverseDirection?(o=this._vertexData,this._vertexDataCount||(this._vertexDataCount=8,this._textureCoordFromAlphaPoint(o[0].texCoords,0,1),this._vertexFromAlphaPoint(o[0].vertices,0,1),this._textureCoordFromAlphaPoint(o[1].texCoords,0,0),this._vertexFromAlphaPoint(o[1].vertices,0,0),this._textureCoordFromAlphaPoint(o[6].texCoords,1,1),this._vertexFromAlphaPoint(o[6].vertices,1,1),this._textureCoordFromAlphaPoint(o[7].texCoords,1,0),this._vertexFromAlphaPoint(o[7].vertices,1,0)),this._textureCoordFromAlphaPoint(o[2].texCoords,r.x,c.y),this._vertexFromAlphaPoint(o[2].vertices,r.x,c.y),this._textureCoordFromAlphaPoint(o[3].texCoords,r.x,r.y),this._vertexFromAlphaPoint(o[3].vertices,r.x,r.y),this._textureCoordFromAlphaPoint(o[4].texCoords,c.x,c.y),this._vertexFromAlphaPoint(o[4].vertices,c.x,c.y),this._textureCoordFromAlphaPoint(o[5].texCoords,c.x,r.y),this._vertexFromAlphaPoint(o[5].vertices,c.x,r.y)):(this._vertexDataCount||(this._vertexDataCount=4),o=this._vertexData,this._textureCoordFromAlphaPoint(o[0].texCoords,r.x,c.y),this._vertexFromAlphaPoint(o[0].vertices,r.x,c.y),this._textureCoordFromAlphaPoint(o[1].texCoords,r.x,r.y),this._vertexFromAlphaPoint(o[1].vertices,r.x,r.y),this._textureCoordFromAlphaPoint(o[2].texCoords,c.x,c.y),this._vertexFromAlphaPoint(o[2].vertices,c.x,c.y),this._textureCoordFromAlphaPoint(o[3].texCoords,c.x,r.y),this._vertexFromAlphaPoint(o[3].vertices,c.x,r.y)),this._updateColor()}},e._updateRadial=function(){var t=this._node;if(t._sprite){var e,i,n=t._midPoint,r=t._percentage/100,c=2*cc.PI*(t._reverseDirection?r:1-r),o=cc.p(n.x,1),s=cc.pRotateByAngle(o,n,c),a=0;if(0===r)i=o,a=0;else if(1===r)i=o,a=4;else{var h=cc.FLT_MAX,l=cc.ProgressTimer.TEXTURE_COORDS_COUNT;for(e=0;e<=l;++e){var u=(e+(l-1))%l,_=this._boundaryTexCoord(e%l),d=this._boundaryTexCoord(u);0===e?d=cc.pLerp(_,d,1-n.x):4===e&&(_=cc.pLerp(_,d,1-n.x));var f=cc.p(0,0);if(cc.pLineIntersect(_,d,n,s,f)){if(!(0!==e&&4!==e||0<=f.x&&f.x<=1))continue;f.y>=0&&f.y<h&&(h=f.y,a=e)}}i=cc.pAdd(n,cc.pMult(cc.pSub(s,n),h))}var p=!0;this._vertexDataCount!==a+3&&(p=!1,this._vertexDataCount=a+3),this._updateColor();var g=this._vertexData;if(!p)for(this._textureCoordFromAlphaPoint(g[0].texCoords,n.x,n.y),this._vertexFromAlphaPoint(g[0].vertices,n.x,n.y),this._textureCoordFromAlphaPoint(g[1].texCoords,o.x,o.y),this._vertexFromAlphaPoint(g[1].vertices,o.x,o.y),e=0;e<a;e++){var m=this._boundaryTexCoord(e);this._textureCoordFromAlphaPoint(g[e+2].texCoords,m.x,m.y),this._vertexFromAlphaPoint(g[e+2].vertices,m.x,m.y)}this._textureCoordFromAlphaPoint(g[this._vertexDataCount-1].texCoords,i.x,i.y),this._vertexFromAlphaPoint(g[this._vertexDataCount-1].vertices,i.x,i.y)}},e._boundaryTexCoord=function(t){if(t<cc.ProgressTimer.TEXTURE_COORDS_COUNT){var e=cc.ProgressTimer.TEXTURE_COORDS;return this._node._reverseDirection?cc.p(e>>7-(t<<1)&1,e>>7-((t<<1)+1)&1):cc.p(e>>(t<<1)+1&1,e>>(t<<1)&1);
}return cc.p(0,0)},e._textureCoordFromAlphaPoint=function(t,e,i){var n=this._node._sprite;if(!n)return t.u=0,void(t.v=0);var r=n._renderCmd._vertices,c=r[1],o=r[2],s=cc.p(c.u,c.v),a=cc.p(o.u,o.v);if(n.textureRectRotated){var h=e;e=i,i=h}t.u=s.x*(1-e)+a.x*e,t.v=s.y*(1-i)+a.y*i},e._vertexFromAlphaPoint=function(t,e,i){t.x=this._bl.x*(1-e)+this._tr.x*e,t.y=this._bl.y*(1-i)+this._tr.y*i,t.z=this._node._vertexZ},e._updateColor=function(){var t=this._node._sprite;if(this._vertexDataCount&&t){var e=this._displayedColor,i=t._renderCmd._displayedColor,n=i.r,r=i.g,c=i.b,o=t._renderCmd._displayedOpacity/255;t._opacityModifyRGB&&(n*=o,r*=o,c*=o),e.r=n,e.g=r,e.b=c,e.a=t._renderCmd._displayedOpacity;for(var s=this._vertexData,a=0,h=this._vertexDataCount;a<h;++a)s[a].colors=e;this._vertexDataDirty=!0}}}(),cc.SCENE_FADE=4208917214,cc.TRANSITION_ORIENTATION_LEFT_OVER=0,cc.TRANSITION_ORIENTATION_RIGHT_OVER=1,cc.TRANSITION_ORIENTATION_UP_OVER=0,cc.TRANSITION_ORIENTATION_DOWN_OVER=1,cc.TransitionScene=cc.Scene.extend({_inScene:null,_outScene:null,_duration:null,_isInSceneOnTop:!1,_isSendCleanupToScene:!1,_className:"TransitionScene",ctor:function(t,e){cc.Scene.prototype.ctor.call(this),void 0!==t&&void 0!==e&&this.initWithDuration(t,e)},_setNewScene:function(t){this.unschedule(this._setNewScene);var e=cc.director;this._isSendCleanupToScene=e.isSendCleanupToScene(),e.runScene(this._inScene),cc.eventManager.setEnabled(!0),this._outScene.visible=!0},_sceneOrder:function(){this._isInSceneOnTop=!0},visit:function(){this._isInSceneOnTop?(this._outScene.visit(),this._inScene.visit()):(this._inScene.visit(),this._outScene.visit()),cc.Node.prototype.visit.call(this)},onEnter:function(){cc.Node.prototype.onEnter.call(this),cc.eventManager.setEnabled(!1),this._outScene.onExitTransitionDidStart(),this._inScene.onEnter()},onExit:function(){cc.Node.prototype.onExit.call(this),cc.eventManager.setEnabled(!0),this._outScene.onExit(),this._inScene.onEnterTransitionDidFinish()},cleanup:function(){cc.Node.prototype.cleanup.call(this),this._isSendCleanupToScene&&this._outScene.cleanup()},initWithDuration:function(t,e){if(!e)throw new Error("cc.TransitionScene.initWithDuration(): Argument scene must be non-nil");if(this.init()){if(this._duration=t,this.attr({x:0,y:0,anchorX:0,anchorY:0}),this._inScene=e,this._outScene=cc.director.getRunningScene(),this._outScene||(this._outScene=new cc.Scene,this._outScene.init()),this._inScene===this._outScene)throw new Error("cc.TransitionScene.initWithDuration(): Incoming scene must be different from the outgoing scene");return this._sceneOrder(),!0}return!1},finish:function(){this._inScene.attr({visible:!0,x:0,y:0,scale:1,rotation:0}),this._outScene.attr({visible:!1,x:0,y:0,scale:1,rotation:0}),this.schedule(this._setNewScene,0)},hideOutShowIn:function(){this._inScene.visible=!0,this._outScene.visible=!1}}),cc.TransitionScene.create=function(t,e){return new cc.TransitionScene(t,e)},cc.TransitionSceneOriented=cc.TransitionScene.extend({_orientation:0,ctor:function(t,e,i){cc.TransitionScene.prototype.ctor.call(this),void 0!=i&&this.initWithDuration(t,e,i)},initWithDuration:function(t,e,i){return cc.TransitionScene.prototype.initWithDuration.call(this,t,e)&&(this._orientation=i),!0}}),cc.TransitionSceneOriented.create=function(t,e,i){return new cc.TransitionSceneOriented(t,e,i)},cc.TransitionRotoZoom=cc.TransitionScene.extend({ctor:function(t,e){cc.TransitionScene.prototype.ctor.call(this),e&&this.initWithDuration(t,e)},onEnter:function(){cc.TransitionScene.prototype.onEnter.call(this),this._inScene.attr({scale:.001,anchorX:.5,anchorY:.5}),this._outScene.attr({scale:1,anchorX:.5,anchorY:.5});var t=cc.sequence(cc.spawn(cc.scaleBy(this._duration/2,.001),cc.rotateBy(this._duration/2,720)),cc.delayTime(this._duration/2));this._outScene.runAction(t),this._inScene.runAction(cc.sequence(t.reverse(),cc.callFunc(this.finish,this)))}}),cc.TransitionRotoZoom.create=function(t,e){return new cc.TransitionRotoZoom(t,e)},cc.TransitionJumpZoom=cc.TransitionScene.extend({ctor:function(t,e){cc.TransitionScene.prototype.ctor.call(this),e&&this.initWithDuration(t,e)},onEnter:function(){cc.TransitionScene.prototype.onEnter.call(this);var t=cc.director.getWinSize();this._inScene.attr({scale:.5,x:t.width,y:0,anchorX:.5,anchorY:.5}),this._outScene.anchorX=.5,this._outScene.anchorY=.5;var e=cc.jumpBy(this._duration/4,cc.p(-t.width,0),t.width/4,2),i=cc.scaleTo(this._duration/4,1),n=cc.scaleTo(this._duration/4,.5),r=cc.sequence(n,e),c=cc.sequence(e,i),o=cc.delayTime(this._duration/2);this._outScene.runAction(r),this._inScene.runAction(cc.sequence(o,c,cc.callFunc(this.finish,this)))}}),cc.TransitionJumpZoom.create=function(t,e){return new cc.TransitionJumpZoom(t,e)},cc.TransitionMoveInL=cc.TransitionScene.extend({ctor:function(t,e){cc.TransitionScene.prototype.ctor.call(this),e&&this.initWithDuration(t,e)},onEnter:function(){cc.TransitionScene.prototype.onEnter.call(this),this.initScenes();var t=this.action();this._inScene.runAction(cc.sequence(this.easeActionWithAction(t),cc.callFunc(this.finish,this)))},initScenes:function(){this._inScene.setPosition(-cc.director.getWinSize().width,0)},action:function(){return cc.moveTo(this._duration,cc.p(0,0))},easeActionWithAction:function(t){return new cc.EaseOut(t,2)}}),cc.TransitionMoveInL.create=function(t,e){return new cc.TransitionMoveInL(t,e)},cc.TransitionMoveInR=cc.TransitionMoveInL.extend({ctor:function(t,e){cc.TransitionMoveInL.prototype.ctor.call(this),e&&this.initWithDuration(t,e)},initScenes:function(){this._inScene.setPosition(cc.director.getWinSize().width,0)}}),cc.TransitionMoveInR.create=function(t,e){return new cc.TransitionMoveInR(t,e)},cc.TransitionMoveInT=cc.TransitionMoveInL.extend({ctor:function(t,e){cc.TransitionMoveInL.prototype.ctor.call(this),e&&this.initWithDuration(t,e)},initScenes:function(){this._inScene.setPosition(0,cc.director.getWinSize().height)}}),cc.TransitionMoveInT.create=function(t,e){return new cc.TransitionMoveInT(t,e)},cc.TransitionMoveInB=cc.TransitionMoveInL.extend({ctor:function(t,e){cc.TransitionMoveInL.prototype.ctor.call(this),e&&this.initWithDuration(t,e)},initScenes:function(){this._inScene.setPosition(0,-cc.director.getWinSize().height)}}),cc.TransitionMoveInB.create=function(t,e){return new cc.TransitionMoveInB(t,e)},cc.ADJUST_FACTOR=.5,cc.TransitionSlideInL=cc.TransitionScene.extend({ctor:function(t,e){cc.TransitionScene.prototype.ctor.call(this),e&&this.initWithDuration(t,e)},_sceneOrder:function(){this._isInSceneOnTop=!1},onEnter:function(){cc.TransitionScene.prototype.onEnter.call(this),this.initScenes();var t=this.action(),e=this.action(),i=cc.sequence(this.easeActionWithAction(t),cc.callFunc(this.finish,this)),n=this.easeActionWithAction(e);this._inScene.runAction(i),this._outScene.runAction(n)},initScenes:function(){this._inScene.setPosition(-cc.director.getWinSize().width+cc.ADJUST_FACTOR,0)},action:function(){return cc.moveBy(this._duration,cc.p(cc.director.getWinSize().width-cc.ADJUST_FACTOR,0))},easeActionWithAction:function(t){return new cc.EaseInOut(t,2)}}),cc.TransitionSlideInL.create=function(t,e){return new cc.TransitionSlideInL(t,e)},cc.TransitionSlideInR=cc.TransitionSlideInL.extend({ctor:function(t,e){cc.TransitionSlideInL.prototype.ctor.call(this),e&&this.initWithDuration(t,e)},_sceneOrder:function(){this._isInSceneOnTop=!0},initScenes:function(){this._inScene.setPosition(cc.director.getWinSize().width-cc.ADJUST_FACTOR,0)},action:function(){return cc.moveBy(this._duration,cc.p(-(cc.director.getWinSize().width-cc.ADJUST_FACTOR),0))}}),cc.TransitionSlideInR.create=function(t,e){return new cc.TransitionSlideInR(t,e)},cc.TransitionSlideInB=cc.TransitionSlideInL.extend({ctor:function(t,e){cc.TransitionSlideInL.prototype.ctor.call(this),e&&this.initWithDuration(t,e)},_sceneOrder:function(){this._isInSceneOnTop=!1},initScenes:function(){this._inScene.setPosition(0,-(cc.director.getWinSize().height-cc.ADJUST_FACTOR))},action:function(){return cc.moveBy(this._duration,cc.p(0,cc.director.getWinSize().height-cc.ADJUST_FACTOR))}}),cc.TransitionSlideInB.create=function(t,e){return new cc.TransitionSlideInB(t,e)},cc.TransitionSlideInT=cc.TransitionSlideInL.extend({ctor:function(t,e){cc.TransitionSlideInL.prototype.ctor.call(this),e&&this.initWithDuration(t,e)},_sceneOrder:function(){this._isInSceneOnTop=!0},initScenes:function(){this._inScene.setPosition(0,cc.director.getWinSize().height-cc.ADJUST_FACTOR)},action:function(){return cc.moveBy(this._duration,cc.p(0,-(cc.director.getWinSize().height-cc.ADJUST_FACTOR)))}}),cc.TransitionSlideInT.create=function(t,e){return new cc.TransitionSlideInT(t,e)},cc.TransitionShrinkGrow=cc.TransitionScene.extend({ctor:function(t,e){cc.TransitionScene.prototype.ctor.call(this),e&&this.initWithDuration(t,e)},onEnter:function(){cc.TransitionScene.prototype.onEnter.call(this),this._inScene.attr({scale:.001,anchorX:2/3,anchorY:.5}),this._outScene.attr({scale:1,anchorX:1/3,anchorY:.5});var t=cc.scaleTo(this._duration,.01),e=cc.scaleTo(this._duration,1);this._inScene.runAction(cc.sequence(this.easeActionWithAction(e),cc.callFunc(this.finish,this))),this._outScene.runAction(this.easeActionWithAction(t))},easeActionWithAction:function(t){return new cc.EaseOut(t,2)}}),cc.TransitionShrinkGrow.create=function(t,e){return new cc.TransitionShrinkGrow(t,e)},cc.TransitionFade=cc.TransitionScene.extend({_color:null,ctor:function(t,e,i){cc.TransitionScene.prototype.ctor.call(this),this._color=cc.color(),e&&this.initWithDuration(t,e,i)},onEnter:function(){cc.TransitionScene.prototype.onEnter.call(this);var t=new cc.LayerColor(this._color);this._inScene.visible=!1,this.addChild(t,2,cc.SCENE_FADE);var e=this.getChildByTag(cc.SCENE_FADE),i=cc.sequence(cc.fadeIn(this._duration/2),cc.callFunc(this.hideOutShowIn,this),cc.fadeOut(this._duration/2),cc.callFunc(this.finish,this));e.runAction(i)},onExit:function(){cc.TransitionScene.prototype.onExit.call(this),this.removeChildByTag(cc.SCENE_FADE,!1)},initWithDuration:function(t,e,i){return i=i||cc.color.BLACK,cc.TransitionScene.prototype.initWithDuration.call(this,t,e)&&(this._color.r=i.r,this._color.g=i.g,this._color.b=i.b,this._color.a=0),!0}}),cc.TransitionFade.create=function(t,e,i){return new cc.TransitionFade(t,e,i)},cc.TransitionCrossFade=cc.TransitionScene.extend({ctor:function(t,e){cc.TransitionScene.prototype.ctor.call(this),e&&this.initWithDuration(t,e)},onEnter:function(){cc.TransitionScene.prototype.onEnter.call(this);var t=cc.color(0,0,0,0),e=cc.director.getWinSize(),i=new cc.LayerColor(t),n=new cc.RenderTexture(e.width,e.height);n.sprite.anchorX=.5,n.sprite.anchorY=.5,n.attr({x:e.width/2,y:e.height/2,anchorX:.5,anchorY:.5}),n.begin(),this._inScene.visit(),n.end();var r=new cc.RenderTexture(e.width,e.height);r.setPosition(e.width/2,e.height/2),r.sprite.anchorX=r.anchorX=.5,r.sprite.anchorY=r.anchorY=.5,r.begin(),this._outScene.visit(),r.end(),n.sprite.setBlendFunc(cc.ONE,cc.ONE),r.sprite.setBlendFunc(cc.SRC_ALPHA,cc.ONE_MINUS_SRC_ALPHA),i.addChild(n),i.addChild(r),n.sprite.opacity=255,r.sprite.opacity=255;var c=cc.sequence(cc.fadeTo(this._duration,0),cc.callFunc(this.hideOutShowIn,this),cc.callFunc(this.finish,this));r.sprite.runAction(c),this.addChild(i,2,cc.SCENE_FADE)},onExit:function(){this.removeChildByTag(cc.SCENE_FADE,!1),cc.TransitionScene.prototype.onExit.call(this)},visit:function(){cc.Node.prototype.visit.call(this)},draw:function(){}}),cc.TransitionCrossFade.create=function(t,e){return new cc.TransitionCrossFade(t,e)},cc.TransitionTurnOffTiles=cc.TransitionScene.extend({_gridProxy:null,ctor:function(t,e){cc.TransitionScene.prototype.ctor.call(this),this._gridProxy=new cc.NodeGrid,e&&this.initWithDuration(t,e)},_sceneOrder:function(){this._isInSceneOnTop=!1},onEnter:function(){cc.TransitionScene.prototype.onEnter.call(this),this._gridProxy.setTarget(this._outScene),this._gridProxy.onEnter();var t=cc.director.getWinSize(),e=t.width/t.height,i=0|12*e,n=12,r=cc.turnOffTiles(this._duration,cc.size(i,n)),c=this.easeActionWithAction(r);this._gridProxy.runAction(cc.sequence(c,cc.callFunc(this.finish,this),cc.stopGrid()))},visit:function(){this._inScene.visit(),this._gridProxy.visit()},easeActionWithAction:function(t){return t}}),cc.TransitionTurnOffTiles.create=function(t,e){return new cc.TransitionTurnOffTiles(t,e)},cc.TransitionSplitCols=cc.TransitionScene.extend({_gridProxy:null,_switchTargetToInscene:function(){this._gridProxy.setTarget(this._inScene)},ctor:function(t,e){cc.TransitionScene.prototype.ctor.call(this),this._gridProxy=new cc.NodeGrid,e&&this.initWithDuration(t,e)},onEnter:function(){cc.TransitionScene.prototype.onEnter.call(this),this._gridProxy.setTarget(this._outScene),this._gridProxy.onEnter();var t=this.action(),e=cc.sequence(t,cc.callFunc(this._switchTargetToInscene,this),t.reverse());this._gridProxy.runAction(cc.sequence(this.easeActionWithAction(e),cc.callFunc(this.finish,this),cc.stopGrid()))},onExit:function(){this._gridProxy.setTarget(null),this._gridProxy.onExit(),cc.TransitionScene.prototype.onExit.call(this)},visit:function(){this._gridProxy.visit()},easeActionWithAction:function(t){return new cc.EaseInOut(t,3)},action:function(){return cc.splitCols(this._duration/2,3)}}),cc.TransitionSplitCols.create=function(t,e){return new cc.TransitionSplitCols(t,e)},cc.TransitionSplitRows=cc.TransitionSplitCols.extend({ctor:function(t,e){cc.TransitionSplitCols.prototype.ctor.call(this),e&&this.initWithDuration(t,e)},action:function(){return cc.splitRows(this._duration/2,3)}}),cc.TransitionSplitRows.create=function(t,e){return new cc.TransitionSplitRows(t,e)},cc.TransitionFadeTR=cc.TransitionScene.extend({_gridProxy:null,ctor:function(t,e){cc.TransitionScene.prototype.ctor.call(this),this._gridProxy=new cc.NodeGrid,e&&this.initWithDuration(t,e)},_sceneOrder:function(){this._isInSceneOnTop=!1},onEnter:function(){cc.TransitionScene.prototype.onEnter.call(this),this._gridProxy.setTarget(this._outScene),this._gridProxy.onEnter();var t=cc.director.getWinSize(),e=t.width/t.height,i=0|12*e,n=12,r=this.actionWithSize(cc.size(i,n));this._gridProxy.runAction(cc.sequence(this.easeActionWithAction(r),cc.callFunc(this.finish,this),cc.stopGrid()))},visit:function(){this._inScene.visit(),this._gridProxy.visit()},easeActionWithAction:function(t){return t},actionWithSize:function(t){return cc.fadeOutTRTiles(this._duration,t)}}),cc.TransitionFadeTR.create=function(t,e){return new cc.TransitionFadeTR(t,e)},cc.TransitionFadeBL=cc.TransitionFadeTR.extend({ctor:function(t,e){cc.TransitionFadeTR.prototype.ctor.call(this),e&&this.initWithDuration(t,e)},actionWithSize:function(t){return cc.fadeOutBLTiles(this._duration,t)}}),cc.TransitionFadeBL.create=function(t,e){return new cc.TransitionFadeBL(t,e)},cc.TransitionFadeUp=cc.TransitionFadeTR.extend({ctor:function(t,e){cc.TransitionFadeTR.prototype.ctor.call(this),e&&this.initWithDuration(t,e)},actionWithSize:function(t){return new cc.FadeOutUpTiles(this._duration,t)}}),cc.TransitionFadeUp.create=function(t,e){return new cc.TransitionFadeUp(t,e)},cc.TransitionFadeDown=cc.TransitionFadeTR.extend({ctor:function(t,e){cc.TransitionFadeTR.prototype.ctor.call(this),e&&this.initWithDuration(t,e)},actionWithSize:function(t){return cc.fadeOutDownTiles(this._duration,t)}}),cc.TransitionFadeDown.create=function(t,e){return new cc.TransitionFadeDown(t,e)},cc.SCENE_RADIAL=49153,cc.TransitionProgress=cc.TransitionScene.extend({_to:0,_from:0,_sceneToBeModified:null,_className:"TransitionProgress",ctor:function(t,e){cc.TransitionScene.prototype.ctor.call(this),e&&this.initWithDuration(t,e)},_setAttrs:function(t,e,i){t.attr({x:e,y:i,anchorX:.5,anchorY:.5})},onEnter:function(){cc.TransitionScene.prototype.onEnter.call(this),this._setupTransition();var t=cc.director.getWinSize(),e=new cc.RenderTexture(t.width,t.height);e.sprite.anchorX=.5,e.sprite.anchorY=.5,this._setAttrs(e,t.width/2,t.height/2),e.clear(0,0,0,1),e.begin(),this._sceneToBeModified.visit(),e.end(),this._sceneToBeModified===this._outScene&&this.hideOutShowIn();var i=this._progressTimerNodeWithRenderTexture(e),n=cc.sequence(cc.progressFromTo(this._duration,this._from,this._to),cc.callFunc(this.finish,this));i.runAction(n),this.addChild(i,2,cc.SCENE_RADIAL)},onExit:function(){this.removeChildByTag(cc.SCENE_RADIAL,!0),cc.TransitionScene.prototype.onExit.call(this)},_setupTransition:function(){this._sceneToBeModified=this._outScene,this._from=100,this._to=0},_progressTimerNodeWithRenderTexture:function(t){return cc.log("cc.TransitionProgress._progressTimerNodeWithRenderTexture(): should be overridden in subclass"),null},_sceneOrder:function(){this._isInSceneOnTop=!1}}),cc.TransitionProgress.create=function(t,e){return new cc.TransitionProgress(t,e)},cc.TransitionProgressRadialCCW=cc.TransitionProgress.extend({ctor:function(t,e){cc.TransitionProgress.prototype.ctor.call(this),e&&this.initWithDuration(t,e)},_progressTimerNodeWithRenderTexture:function(t){var e=cc.director.getWinSize(),i=new cc.ProgressTimer(t.sprite);return cc._renderType===cc.game.RENDER_TYPE_WEBGL&&(i.sprite.flippedY=!0),i.type=cc.ProgressTimer.TYPE_RADIAL,i.reverseDir=!1,i.percentage=100,this._setAttrs(i,e.width/2,e.height/2),i}}),cc.TransitionProgressRadialCCW.create=function(t,e){return new cc.TransitionProgressRadialCCW(t,e)},cc.TransitionProgressRadialCW=cc.TransitionProgress.extend({ctor:function(t,e){cc.TransitionProgress.prototype.ctor.call(this),e&&this.initWithDuration(t,e)},_progressTimerNodeWithRenderTexture:function(t){var e=cc.director.getWinSize(),i=new cc.ProgressTimer(t.sprite);return cc._renderType===cc.game.RENDER_TYPE_WEBGL&&(i.sprite.flippedY=!0),i.type=cc.ProgressTimer.TYPE_RADIAL,i.reverseDir=!0,i.percentage=100,this._setAttrs(i,e.width/2,e.height/2),i}}),cc.TransitionProgressRadialCW.create=function(t,e){var i=new cc.TransitionProgressRadialCW;return null!==i&&i.initWithDuration(t,e)?i:new cc.TransitionProgressRadialCW(t,e)},cc.TransitionProgressHorizontal=cc.TransitionProgress.extend({ctor:function(t,e){cc.TransitionProgress.prototype.ctor.call(this),e&&this.initWithDuration(t,e)},_progressTimerNodeWithRenderTexture:function(t){var e=cc.director.getWinSize(),i=new cc.ProgressTimer(t.sprite);return cc._renderType===cc.game.RENDER_TYPE_WEBGL&&(i.sprite.flippedY=!0),i.type=cc.ProgressTimer.TYPE_BAR,i.midPoint=cc.p(1,0),i.barChangeRate=cc.p(1,0),i.percentage=100,this._setAttrs(i,e.width/2,e.height/2),i}}),cc.TransitionProgressHorizontal.create=function(t,e){return new cc.TransitionProgressHorizontal(t,e)},cc.TransitionProgressVertical=cc.TransitionProgress.extend({ctor:function(t,e){cc.TransitionProgress.prototype.ctor.call(this),e&&this.initWithDuration(t,e)},_progressTimerNodeWithRenderTexture:function(t){var e=cc.director.getWinSize(),i=new cc.ProgressTimer(t.sprite);return cc._renderType===cc.game.RENDER_TYPE_WEBGL&&(i.sprite.flippedY=!0),i.type=cc.ProgressTimer.TYPE_BAR,i.midPoint=cc.p(0,0),i.barChangeRate=cc.p(0,1),i.percentage=100,this._setAttrs(i,e.width/2,e.height/2),i}}),cc.TransitionProgressVertical.create=function(t,e){return new cc.TransitionProgressVertical(t,e)},cc.TransitionProgressInOut=cc.TransitionProgress.extend({ctor:function(t,e){cc.TransitionProgress.prototype.ctor.call(this),e&&this.initWithDuration(t,e)},_progressTimerNodeWithRenderTexture:function(t){var e=cc.director.getWinSize(),i=new cc.ProgressTimer(t.sprite);return cc._renderType===cc.game.RENDER_TYPE_WEBGL&&(i.sprite.flippedY=!0),i.type=cc.ProgressTimer.TYPE_BAR,i.midPoint=cc.p(.5,.5),i.barChangeRate=cc.p(1,1),i.percentage=0,this._setAttrs(i,e.width/2,e.height/2),i},_sceneOrder:function(){this._isInSceneOnTop=!1},_setupTransition:function(){this._sceneToBeModified=this._inScene,this._from=0,this._to=100}}),cc.TransitionProgressInOut.create=function(t,e){return new cc.TransitionProgressInOut(t,e)},cc.TransitionProgressOutIn=cc.TransitionProgress.extend({ctor:function(t,e){cc.TransitionProgress.prototype.ctor.call(this),e&&this.initWithDuration(t,e)},_progressTimerNodeWithRenderTexture:function(t){var e=cc.director.getWinSize(),i=new cc.ProgressTimer(t.sprite);return cc._renderType===cc.game.RENDER_TYPE_WEBGL&&(i.sprite.flippedY=!0),i.type=cc.ProgressTimer.TYPE_BAR,i.midPoint=cc.p(.5,.5),i.barChangeRate=cc.p(1,1),i.percentage=100,this._setAttrs(i,e.width/2,e.height/2),i}}),cc.TransitionProgressOutIn.create=function(t,e){return new cc.TransitionProgressOutIn(t,e)},cc.TransitionPageTurn=cc.TransitionScene.extend({ctor:function(t,e,i){cc.TransitionScene.prototype.ctor.call(this),this._gridProxy=new cc.NodeGrid,this.initWithDuration(t,e,i)},_back:!0,_gridProxy:null,_className:"TransitionPageTurn",initWithDuration:function(t,e,i){return this._back=i,cc.TransitionScene.prototype.initWithDuration.call(this,t,e),!0},actionWithSize:function(t){return this._back?cc.reverseTime(cc.pageTurn3D(this._duration,t)):cc.pageTurn3D(this._duration,t)},onEnter:function(){cc.TransitionScene.prototype.onEnter.call(this);var t,e,i=cc.director.getWinSize();i.width>i.height?(t=16,e=12):(t=12,e=16);var n=this.actionWithSize(cc.size(t,e)),r=this._gridProxy;this._back?(r.setTarget(this._inScene),r.onEnter(),this._inScene.visible=!1,r.runAction(cc.sequence(n,cc.callFunc(this.finish,this),cc.stopGrid())),this._inScene.runAction(cc.show())):(r.setTarget(this._outScene),r.onEnter(),r.runAction(cc.sequence(n,cc.callFunc(this.finish,this),cc.stopGrid())))},visit:function(){this._back?this._outScene.visit():this._inScene.visit(),this._gridProxy.visit()},_sceneOrder:function(){this._isInSceneOnTop=this._back}}),cc.TransitionPageTurn.create=function(t,e,i){return new cc.TransitionPageTurn(t,e,i)},cc.CONTROL_EVENT_TOTAL_NUMBER=9,cc.CONTROL_EVENT_TOUCH_DOWN=1,cc.CONTROL_EVENT_TOUCH_DRAG_INSIDE=2,cc.CONTROL_EVENT_TOUCH_DRAG_OUTSIDE=4,cc.CONTROL_EVENT_TOUCH_DRAG_ENTER=8,cc.CONTROL_EVENT_TOUCH_DRAG_EXIT=16,cc.CONTROL_EVENT_TOUCH_UP_INSIDE=32,cc.CONTROL_EVENT_TOUCH_UP_OUTSIDE=64,cc.CONTROL_EVENT_TOUCH_CANCEL=128,cc.CONTROL_EVENT_VALUECHANGED=256,cc.CONTROL_STATE_NORMAL=1,cc.CONTROL_STATE_HIGHLIGHTED=2,cc.CONTROL_STATE_DISABLED=4,cc.CONTROL_STATE_SELECTED=8,cc.CONTROL_STATE_INITIAL=8,cc.Control=cc.Layer.extend({_isOpacityModifyRGB:!1,_hasVisibleParents:!1,_touchListener:null,_className:"Control",isOpacityModifyRGB:function(){return this._isOpacityModifyRGB},setOpacityModifyRGB:function(t){this._isOpacityModifyRGB=t;for(var e=this.getChildren(),i=0,n=e.length;i<n;i++){var r=e[i];r&&r.setOpacityModifyRGB(t)}},_state:cc.CONTROL_STATE_NORMAL,getState:function(){return this._state},_enabled:!1,_selected:!1,_highlighted:!1,_dispatchTable:null,setEnabled:function(t){this._enabled=t,this._state=t?cc.CONTROL_STATE_NORMAL:cc.CONTROL_STATE_DISABLED,this.needsLayout()},isEnabled:function(){return this._enabled},setSelected:function(t){this._selected=t,this.needsLayout()},isSelected:function(){return this._selected},setHighlighted:function(t){this._highlighted=t,this.needsLayout()},isHighlighted:function(){return this._highlighted},hasVisibleParents:function(){for(var t=this.getParent(),e=t;null!=e;e=e.getParent())if(!e.isVisible())return!1;return!0},ctor:function(){cc.Layer.prototype.ctor.call(this),this._dispatchTable={},this._color=cc.color.WHITE},init:function(){if(cc.Layer.prototype.init.call(this)){this._state=cc.CONTROL_STATE_NORMAL,this._enabled=!0,this._selected=!1,this._highlighted=!1;var t=cc.EventListener.create({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:!0});return this.onTouchBegan&&(t.onTouchBegan=this.onTouchBegan.bind(this)),this.onTouchMoved&&(t.onTouchMoved=this.onTouchMoved.bind(this)),this.onTouchEnded&&(t.onTouchEnded=this.onTouchEnded.bind(this)),this.onTouchCancelled&&(t.onTouchCancelled=this.onTouchCancelled.bind(this)),this._touchListener=t,!0}return!1},onEnter:function(){var t=this._touchListener;t._isRegistered()||cc.eventManager.addListener(t,this),cc.Node.prototype.onEnter.call(this)},sendActionsForControlEvents:function(t){for(var e=0,i=cc.CONTROL_EVENT_TOTAL_NUMBER;e<i;e++)if(t&1<<e)for(var n=this._dispatchListforControlEvent(1<<e),r=0,c=n.length;r<c;r++)n[r].invoke(this)},addTargetWithActionForControlEvents:function(t,e,i){for(var n=0,r=cc.CONTROL_EVENT_TOTAL_NUMBER;n<r;n++)i&1<<n&&this._addTargetWithActionForControlEvent(t,e,1<<n)},removeTargetWithActionForControlEvents:function(t,e,i){for(var n=0,r=cc.CONTROL_EVENT_TOTAL_NUMBER;n<r;n++)i&1<<n&&this._removeTargetWithActionForControlEvent(t,e,1<<n)},getTouchLocation:function(t){var e=t.getLocation();return this.convertToNodeSpace(e)},isTouchInside:function(t){var e=t.getLocation();return e=this.getParent().convertToNodeSpace(e),cc.rectContainsPoint(this.getBoundingBox(),e)},_invocationWithTargetAndActionForControlEvent:function(t,e,i){return null},_dispatchListforControlEvent:function(t){return t=t.toString(),this._dispatchTable[t]||(this._dispatchTable[t]=[]),this._dispatchTable[t]},_addTargetWithActionForControlEvent:function(t,e,i){var n=new cc.Invocation(t,e,i),r=this._dispatchListforControlEvent(i);r.push(n)},_removeTargetWithActionForControlEvent:function(t,e,i){var n=this._dispatchListforControlEvent(i);if(t||e)for(var r=0;r<n.length;){var c=n[r],o=!0;t&&(o=t===c.getTarget()),e&&(o=o&&e===c.getAction()),o?cc.arrayRemoveObject(n,c):r++}else n.length=0},needsLayout:function(){}});var _p=cc.Control.prototype;_p.state,cc.defineGetterSetter(_p,"state",_p.getState),_p.enabled,cc.defineGetterSetter(_p,"enabled",_p.isEnabled,_p.setEnabled),_p.selected,cc.defineGetterSetter(_p,"selected",_p.isSelected,_p.setSelected),_p.highlighted,cc.defineGetterSetter(_p,"highlighted",_p.isHighlighted,_p.setHighlighted),_p=null,cc.Control.create=function(){var t=new cc.Control;return t&&t.init()?t:null},cc.CONTROL_ZOOM_ACTION_TAG=3435855873,cc.ControlButton=cc.Control.extend({_doesAdjustBackgroundImage:!1,zoomOnTouchDown:!1,_preferredSize:null,_labelAnchorPoint:null,_currentTitle:null,_currentTitleColor:null,_titleLabel:null,_backgroundSprite:null,_opacity:0,_isPushed:!1,_titleDispatchTable:null,_titleColorDispatchTable:null,_titleLabelDispatchTable:null,_backgroundSpriteDispatchTable:null,_parentInited:!1,_marginV:0,_marginH:0,_className:"ControlButton",ctor:function(t,e,i){cc.Control.prototype.ctor.call(this),this._preferredSize=cc.size(0,0),this._labelAnchorPoint=cc.p(0,0),this._currentTitle="",this._currentTitleColor=cc.color.WHITE,this._titleDispatchTable={},this._titleColorDispatchTable={},this._titleLabelDispatchTable={},this._backgroundSpriteDispatchTable={},void 0!=i?this.initWithTitleAndFontNameAndFontSize(t,e,i):void 0!=e?this.initWithLabelAndBackgroundSprite(t,e):void 0!=t?this.initWithBackgroundSprite(t):this.init()},init:function(){return this.initWithLabelAndBackgroundSprite(new cc.LabelTTF("","Arial",12),new cc.Scale9Sprite)},needsLayout:function(){if(this._parentInited){this._titleLabel&&this._titleLabel.setVisible(!1),this._backgroundSprite&&this._backgroundSprite.setVisible(!1),this.setLabelAnchorPoint(this._labelAnchorPoint);var t=this._state;this._currentTitle=this.getTitleForState(t),this._currentTitleColor=this.getTitleColorForState(t),this._titleLabel=this.getTitleLabelForState(t);var e=this._titleLabel;e&&e.setString&&e.setString(this._currentTitle),e&&e.setColor(this._currentTitleColor);var i=this.getContentSize();e&&e.setPosition(i.width/2,i.height/2),this._backgroundSprite=this.getBackgroundSpriteForState(t);var n=this._backgroundSprite;n&&n.setPosition(i.width/2,i.height/2);var r=cc.size(0,0);if(e){var c=e.getBoundingBox();r.width=c.width,r.height=c.height}if(this._doesAdjustBackgroundImage)n&&n.setContentSize(r.width+2*this._marginH,r.height+2*this._marginV);else if(n){var o=n.getPreferredSize();o=cc.size(o.width,o.height),o.width<=0&&(o.width=r.width),o.height<=0&&(o.height=r.height),n.setContentSize(o)}var s=e?e.getBoundingBox():cc.rect(0,0,0,0),a=n?n.getBoundingBox():cc.rect(0,0,0,0),h=cc.rectUnion(s,a);this.setContentSize(h.width,h.height),i=this.getContentSize(),e&&(e.setPosition(i.width/2,i.height/2),e.setVisible(!0)),n&&(n.setPosition(i.width/2,i.height/2),n.setVisible(!0))}},initWithLabelAndBackgroundSprite:function(t,e){if(!t)throw new Error("cc.ControlButton.initWithLabelAndBackgroundSprite(): label should be non-null");if(!e)throw new Error("cc.ControlButton.initWithLabelAndBackgroundSprite(): backgroundSprite should be non-null");if(cc.Control.prototype.init.call(this,!0)){this._parentInited=!0,this._titleDispatchTable={},this._titleColorDispatchTable={},this._titleLabelDispatchTable={},this._backgroundSpriteDispatchTable={},this._isPushed=!1,this.zoomOnTouchDown=!0,this._currentTitle=null,this.setAdjustBackgroundImage(!0),this.setPreferredSize(cc.size(0,0)),this.zoomOnTouchDown=!0,this.ignoreAnchorPointForPosition(!1),this.setAnchorPoint(.5,.5),this._titleLabel=t,this._backgroundSprite=e,this.setOpacity(255),this.setOpacityModifyRGB(!0);var i=t.getString();return this.setTitleForState(i,cc.CONTROL_STATE_NORMAL),this.setTitleColorForState(t.getColor(),cc.CONTROL_STATE_NORMAL),this.setTitleLabelForState(t,cc.CONTROL_STATE_NORMAL),this.setBackgroundSpriteForState(e,cc.CONTROL_STATE_NORMAL),this._state=cc.CONTROL_STATE_NORMAL,this._marginH=24,this._marginV=12,this._labelAnchorPoint=cc.p(.5,.5),this.setPreferredSize(cc.size(0,0)),this.needsLayout(),!0}return!1},initWithTitleAndFontNameAndFontSize:function(t,e,i){var n=new cc.LabelTTF(t,e,i);return this.initWithLabelAndBackgroundSprite(n,new cc.Scale9Sprite)},initWithBackgroundSprite:function(t){var e=new cc.LabelTTF("","Arial",30);return this.initWithLabelAndBackgroundSprite(e,t)},doesAdjustBackgroundImage:function(){return this._doesAdjustBackgroundImage},setAdjustBackgroundImage:function(t){this._doesAdjustBackgroundImage=t,this.needsLayout()},getZoomOnTouchDown:function(){return this.zoomOnTouchDown},setZoomOnTouchDown:function(t){return this.zoomOnTouchDown=t},getPreferredSize:function(){return this._preferredSize},setPreferredSize:function(t){if(0===t.width&&0===t.height)this._doesAdjustBackgroundImage=!0;else{this._doesAdjustBackgroundImage=!1;var e=this._backgroundSpriteDispatchTable;for(var i in e)e[i].setPreferredSize(t)}this._preferredSize=t,this.needsLayout()},getLabelAnchorPoint:function(){return this._labelAnchorPoint},setLabelAnchorPoint:function(t){this._labelAnchorPoint=t,this._titleLabel&&this._titleLabel.setAnchorPoint(t)},_getCurrentTitle:function(){return this._currentTitle},_getCurrentTitleColor:function(){return this._currentTitleColor},getOpacity:function(){return this._opacity},setOpacity:function(t){cc.Control.prototype.setOpacity.call(this,t);var e=this._backgroundSpriteDispatchTable;for(var i in e)e[i].setOpacity(t)},setColor:function(t){cc.Control.prototype.setColor.call(this,t);var e=this._backgroundSpriteDispatchTable;for(var i in e)e[i].setColor(t)},getColor:function(){var t=this._realColor;return cc.color(t.r,t.g,t.b,t.a)},isPushed:function(){return this._isPushed},_getVerticalMargin:function(){return this._marginV},_getHorizontalOrigin:function(){return this._marginH},setMargins:function(t,e){this._marginV=e,this._marginH=t,this.needsLayout()},setEnabled:function(t){cc.Control.prototype.setEnabled.call(this,t),this.needsLayout()},setSelected:function(t){cc.Control.prototype.setSelected.call(this,t),this.needsLayout()},setHighlighted:function(t){this._state=t?cc.CONTROL_STATE_HIGHLIGHTED:cc.CONTROL_STATE_NORMAL,cc.Control.prototype.setHighlighted.call(this,t);var e=this.getActionByTag(cc.CONTROL_ZOOM_ACTION_TAG);if(e&&this.stopAction(e),this.zoomOnTouchDown){var i=this.isHighlighted()&&this.isEnabled()&&!this.isSelected()?1.1:1,n=cc.scaleTo(.05,i);n.setTag(cc.CONTROL_ZOOM_ACTION_TAG),this.runAction(n)}},onTouchBegan:function(t,e){return!!(this.isTouchInside(t)&&this.isEnabled()&&this.isVisible()&&this.hasVisibleParents())&&(this._isPushed=!0,this.setHighlighted(!0),this.sendActionsForControlEvents(cc.CONTROL_EVENT_TOUCH_DOWN),!0)},onTouchMoved:function(t,e){if(!this._enabled||!this._isPushed||this._selected)return void(this._highlighted&&this.setHighlighted(!1));var i=this.isTouchInside(t);i&&!this._highlighted?(this.setHighlighted(!0),this.sendActionsForControlEvents(cc.CONTROL_EVENT_TOUCH_DRAG_ENTER)):i&&this._highlighted?this.sendActionsForControlEvents(cc.CONTROL_EVENT_TOUCH_DRAG_INSIDE):!i&&this._highlighted?(this.setHighlighted(!1),
this.sendActionsForControlEvents(cc.CONTROL_EVENT_TOUCH_DRAG_EXIT)):i||this._highlighted||this.sendActionsForControlEvents(cc.CONTROL_EVENT_TOUCH_DRAG_OUTSIDE)},onTouchEnded:function(t,e){this._isPushed=!1,this.setHighlighted(!1),this.isTouchInside(t)?this.sendActionsForControlEvents(cc.CONTROL_EVENT_TOUCH_UP_INSIDE):this.sendActionsForControlEvents(cc.CONTROL_EVENT_TOUCH_UP_OUTSIDE)},onTouchCancelled:function(t,e){this._isPushed=!1,this.setHighlighted(!1),this.sendActionsForControlEvents(cc.CONTROL_EVENT_TOUCH_CANCEL)},getTitleForState:function(t){var e=this._titleDispatchTable;return e?e[t]?e[t]:e[cc.CONTROL_STATE_NORMAL]:""},setTitleForState:function(t,e){this._titleDispatchTable[e]=t||"",this.getState()===e&&this.needsLayout()},getTitleColorForState:function(t){var e=this._titleColorDispatchTable[t];return e?e:(e=this._titleColorDispatchTable[cc.CONTROL_STATE_NORMAL],e?e:cc.color.WHITE)},setTitleColorForState:function(t,e){this._titleColorDispatchTable[e]=t,this.getState()===e&&this.needsLayout()},getTitleLabelForState:function(t){var e=this._titleLabelDispatchTable;return e[t]?e[t]:e[cc.CONTROL_STATE_NORMAL]},setTitleLabelForState:function(t,e){var i=this._titleLabelDispatchTable;if(i[e]){var n=i[e];n&&this.removeChild(n,!0)}i[e]=t,t.setVisible(!1),t.setAnchorPoint(.5,.5),this.addChild(t,1),this.getState()===e&&this.needsLayout()},setTitleTTFForState:function(t,e){var i=this.getTitleForState(e);i||(i=""),this.setTitleLabelForState(new cc.LabelTTF(i,t,12),e)},getTitleTTFForState:function(t){var e=this.getTitleLabelForState(t);return null!=e&&e instanceof cc.LabelTTF?e.getFontName():""},setTitleTTFSizeForState:function(t,e){var i=this.getTitleLabelForState(e);null!=i&&i instanceof cc.LabelTTF&&i.setFontSize(t)},getTitleTTFSizeForState:function(t){var e=this.getTitleLabelForState(t);return null!=e&&e instanceof cc.LabelTTF?e.getFontSize():0},setTitleBMFontForState:function(t,e){var i=this.getTitleForState(e);i||(i=""),this.setTitleLabelForState(new cc.LabelBMFont(i,t),e)},getTitleBMFontForState:function(t){var e=this.getTitleLabelForState(t);return null!=e&&e instanceof cc.LabelBMFont?e.getFntFile():""},getBackgroundSpriteForState:function(t){var e=this._backgroundSpriteDispatchTable;return e[t]?e[t]:e[cc.CONTROL_STATE_NORMAL]},setBackgroundSpriteForState:function(t,e){var i=this._backgroundSpriteDispatchTable;if(i[e]){var n=i[e];n&&this.removeChild(n,!0)}i[e]=t,t.setVisible(!1),t.setAnchorPoint(.5,.5),this.addChild(t);var r=this._preferredSize;0===r.width&&0===r.height||t.setPreferredSize(r),this._state===e&&this.needsLayout()},setBackgroundSpriteFrameForState:function(t,e){var i=cc.Scale9Sprite.createWithSpriteFrame(t);this.setBackgroundSpriteForState(i,e)}});var _p=cc.ControlButton.prototype;_p.adjustBackground,cc.defineGetterSetter(_p,"adjustBackground",_p.getAdjustBackgroundImage,_p.setAdjustBackgroundImage),_p.preferredSize,cc.defineGetterSetter(_p,"preferredSize",_p.getPreferredSize,_p.setPreferredSize),_p.labelAnchor,cc.defineGetterSetter(_p,"labelAnchor",_p.getLabelAnchorPoint,_p.setLabelAnchorPoint),_p=null,cc.ControlButton.create=function(t,e,i){return new cc.ControlButton(t,e,i)},cc.RGBA=function(t,e,i,n){this.r=t,this.g=e,this.b=i,this.a=n},cc.HSV=function(t,e,i){this.h=t,this.s=e,this.v=i},cc.ControlUtils={},cc.ControlUtils.addSpriteToTargetWithPosAndAnchor=function(t,e,i,n){var r=new cc.Sprite("#"+t);return r?(r.setPosition(i),r.setAnchorPoint(n),e.addChild(r),r):null},cc.ControlUtils.HSVfromRGB=function(t){var e,i,n,r=new cc.HSV;return e=t.r<t.g?t.r:t.g,e=e<t.b?e:t.b,i=t.r>t.g?t.r:t.g,i=i>t.b?i:t.b,r.v=i,n=i-e,i>0?(r.s=n/i,t.r>=i?r.h=(t.g-t.b)/n:t.g>=i?r.h=2+(t.b-t.r)/n:r.h=4+(t.r-t.g)/n,r.h*=60,r.h<0&&(r.h+=360),r):(r.s=0,r.h=-1,r)},cc.ControlUtils.RGBfromHSV=function(t){var e,i,n,r,c,o,s=new cc.RGBA;if(s.a=1,t.s<=0)return t.h?(s.r=0,s.g=0,s.b=0,s):(s.r=t.v,s.g=t.v,s.b=t.v,s);switch(e=t.h,e>=360&&(e=0),e/=60,o=0|e,c=e-o,i=t.v*(1-t.s),n=t.v*(1-t.s*c),r=t.v*(1-t.s*(1-c)),o){case 0:s.r=t.v,s.g=r,s.b=i;break;case 1:s.r=n,s.g=t.v,s.b=i;break;case 2:s.r=i,s.g=t.v,s.b=r;break;case 3:s.r=i,s.g=n,s.b=t.v;break;case 4:s.r=r,s.g=i,s.b=t.v;break;default:s.r=t.v,s.g=i,s.b=n}return s},cc.ControlUtils.CCRectUnion=function(t,e){return cc.rectUnion(t,e)},cc.Invocation=cc.Class.extend({_action:null,_target:null,_controlEvent:null,ctor:function(t,e,i){this._target=t,this._action=e,this._controlEvent=i},getAction:function(){return this._action},getTarget:function(){return this._target},getControlEvent:function(){return this._controlEvent},invoke:function(t){this._target&&this._action&&(cc.isString(this._action)?this._target[this._action](t,this._controlEvent):this._action.call(this._target,t,this._controlEvent))}}),cc.Spacer=cc.Layer.extend({}),cc.Spacer.verticalSpacer=function(t){var e=new cc.Spacer;return e.init(),e.setContentSize(0,t),e},cc.Spacer.horizontalSpacer=function(t){var e=new cc.Spacer;return e.init(),e.setContentSize(t,0),e},cc.MenuPassive=cc.Layer.extend({_color:null,_opacity:0,_className:"MenuPassive",ctor:function(){},getColor:function(){var t=this._color;return cc.color(t.r,t.g,t.b,t.a)},setColor:function(t){var e=this._color;if(e.r=t.r,e.g=t.g,e.b=t.b,this._children&&this._children.length>0)for(var i=0;i<this._children.length;i++)this._children[i]&&this._children[i].setColor(t);void 0===t.a||t.a_undefined||this.setOpacity(t.a)},getOpacity:function(){return this._opacity},setOpacity:function(t){if(this._opacity=t,this._children&&this._children.length>0)for(var e=0;e<this._children.length;e++)this._children[e]&&this._children[e].setOpacity(t);this._color.a=t},initWithItems:function(t,e){if(this.init()){var i=cc.director.getWinSize();this.ignoreAnchorPointForPosition(!0),this.setAnchorPoint(.5,.5),this.setContentSize(i),this.setPosition(i.width/2,i.height/2);var n=0;if(t){this.addChild(t,n);for(var r=0;r<e.length;r++)e[r]&&(n++,this.addChild(e[r],n))}return!0}return!1},alignItemsVertically:function(){this.alignItemsVerticallyWithPadding(cc.DEFAULT_PADDING)},alignItemsVerticallyWithPadding:function(t){var e,i=-t;if(this._children&&this._children.length>0)for(e=0;e<this._children.length;e++)this._children[e]&&(i+=this._children[e].getContentSize().height*this._children[e].getScaleY()+t);var n=0,r=i/2;if(this._children&&this._children.length>0)for(e=0;e<this._children.length;e++)this._children[e]&&(n=Math.max(n,this._children[e].getContentSize().width),this._children[e].setPosition(0,r-this._children[e].getContentSize().height*this._children[e].getScaleY()/2),r-=this._children[e].getContentSize().height*this._children[e].getScaleY()+t);this.setContentSize(n,i)},alignItemsHorizontally:function(){this.alignItemsHorizontallyWithPadding(cc.DEFAULT_PADDING)},alignItemsHorizontallyWithPadding:function(t){var e,i=-t;if(this._children&&this._children.length>0)for(e=0;e<this._children.length;e++)this._children[e]&&(i+=this._children[e].getContentSize().width*this._children[e].getScaleX()+t);var n=0,r=-i/2;if(this._children&&this._children.length>0)for(e=0;e<this._children.length;e++)this._children[e]&&(n=Math.max(n,this._children[e].getContentSize().height),this._children[e].setPosition(r+this._children[e].getContentSize().width*this._children[e].getScaleX()/2,0),r+=this._children[e].getContentSize().width*this._children[e].getScaleX()+t);this.setContentSize(i,n)},alignItemsInColumns:function(t){var e,i=[];for(e=1;e<arguments.length;e++)i.push(arguments[e]);var n,r,c=-5,o=0,s=0,a=0;if(this._children&&this._children.length>0)for(e=0;e<this._children.length;e++)if(this._children[e]){if(o>=i.length){cc.log("cc.MenuPassive.alignItemsInColumns(): invalid row index");continue}if(n=i[o],!n){cc.log("cc.MenuPassive.alignItemsInColumns(): can not have zero columns on a row");continue}r=this._children[e].getContentSize().height,s=0|(s>=r||null==r?s:r),++a,a>=n&&(c+=s+5,a=0,s=0,++o)}var h=cc.director.getWinSize();o=0,s=0,n=0;var l=0,u=0,_=c/2;if(this._children&&this._children.length>0)for(e=0;e<this._children.length;e++)this._children[e]&&(0===n&&(n=i[o],l=h.width/(1+n),u=l),r=this._children[e].getContentSize().height,s=0|(s>=r||null==r?s:r),this._children[e].setPosition(u-h.width/2,_-this._children[e].getContentSize().height/2),u+=l,++a,a>=n&&(_-=s+5,a=0,n=0,s=0,++o))},alignItemsInRows:function(t){var e,i=[];for(e=1;e<arguments.length;e++)i.push(arguments[e]);var n,r,c=[],o=[],s=-10,a=-5,h=0,l=0,u=0;if(this._children&&this._children.length>0)for(e=0;e<this._children.length;e++)if(this._children[e]){if(h>=i.length){cc.log("cc.MenuPassive.alignItemsInRows(): invalid row index");continue}if(n=i[h],!n){cc.log("cc.MenuPassive.alignItemsInColumns(): can't have zero rows on a column");continue}r=this._children[e].getContentSize().width,l=0|(l>=r||null==r?l:r),a+=0|this._children[e].getContentSize().height+5,++u,u>=n&&(c.push(l),o.push(a),s+=l+10,u=0,l=0,a=-5,++h)}var _=cc.director.getWinSize();h=0,l=0,n=null;var d=-s/2,f=0;if(this._children&&this._children.length>0)for(e=0;e<this._children.length;e++)this._children[e]&&(null==n&&(n=i[h],f=o[h]),r=this._children[e].getContentSize().width,l=0|(l>=r||null==r?l:r),this._children[e].setPosition(d+c[h]/2,f-_.height/2),f-=this._children[e].getContentSize().height+10,++u,u>=n&&(d+=l+5,u=0,n=0,l=0,++h))},setOpacityModifyRGB:function(t){},isOpacityModifyRGB:function(){return!1}}),cc.MenuPassive.create=function(t){t||(t=null);for(var e=[],i=1;i<arguments.length;i++)e.push(arguments[i]);var n=new cc.MenuPassive;return n&&n.initWithItems(t,e)?n:null},cc.MenuPassive.createWithItem=function(t){return cc.MenuPassive.create(t,null)},cc.ControlSaturationBrightnessPicker=cc.Control.extend({_saturation:0,_brightness:0,_background:null,_overlay:null,_shadow:null,_slider:null,_startPos:null,_boxPos:0,_boxSize:0,_className:"ControlSaturationBrightnessPicker",ctor:function(t,e){cc.Control.prototype.ctor.call(this),e&&this.initWithTargetAndPos(t,e)},getSaturation:function(){return this._saturation},getBrightness:function(){return this._brightness},getBackground:function(){return this._background},getOverlay:function(){return this._brightness},getShadow:function(){return this._shadow},getSlider:function(){return this._slider},getStartPos:function(){return this._startPos},initWithTargetAndPos:function(t,e){return!!cc.Control.prototype.init.call(this)&&(this._background=cc.ControlUtils.addSpriteToTargetWithPosAndAnchor("colourPickerBackground.png",t,e,cc.p(0,0)),this._overlay=cc.ControlUtils.addSpriteToTargetWithPosAndAnchor("colourPickerOverlay.png",t,e,cc.p(0,0)),this._shadow=cc.ControlUtils.addSpriteToTargetWithPosAndAnchor("colourPickerShadow.png",t,e,cc.p(0,0)),this._slider=cc.ControlUtils.addSpriteToTargetWithPosAndAnchor("colourPicker.png",t,e,cc.p(.5,.5)),this._startPos=e,this._boxPos=35,this._boxSize=this._background.getContentSize().width/2,!0)},setEnabled:function(t){cc.Control.prototype.setEnabled.call(this,t),this._slider&&this._slider.setOpacity(t?255:128)},updateWithHSV:function(t){var e=new cc.HSV;e.s=1,e.h=t.h,e.v=1;var i=cc.ControlUtils.RGBfromHSV(e);this._background.setColor(cc.color(0|255*i.r,0|255*i.g,0|255*i.b))},updateDraggerWithHSV:function(t){var e=cc.p(this._startPos.x+this._boxPos+this._boxSize*(1-t.s),this._startPos.y+this._boxPos+this._boxSize*t.v);this._updateSliderPosition(e)},_updateSliderPosition:function(t){var e=this._startPos.x+.5*this._background.getBoundingBox().width,i=this._startPos.y+.5*this._background.getBoundingBox().height,n=t.x-e,r=t.y-i,c=Math.sqrt(n*n+r*r),o=Math.atan2(r,n),s=.5*this._background.getBoundingBox().width;c>s&&(t.x=e+s*Math.cos(o),t.y=i+s*Math.sin(o)),this._slider.setPosition(t),t.x<this._startPos.x+this._boxPos?t.x=this._startPos.x+this._boxPos:t.x>this._startPos.x+this._boxPos+this._boxSize-1&&(t.x=this._startPos.x+this._boxPos+this._boxSize-1),t.y<this._startPos.y+this._boxPos?t.y=this._startPos.y+this._boxPos:t.y>this._startPos.y+this._boxPos+this._boxSize&&(t.y=this._startPos.y+this._boxPos+this._boxSize),this._saturation=1-Math.abs((this._startPos.x+this._boxPos-t.x)/this._boxSize),this._brightness=Math.abs((this._startPos.y+this._boxPos-t.y)/this._boxSize)},_checkSliderPosition:function(t){var e=this._startPos.x+.5*this._background.getBoundingBox().width,i=this._startPos.y+.5*this._background.getBoundingBox().height,n=t.x-e,r=t.y-i,c=Math.sqrt(n*n+r*r);return c<=.5*this._background.getBoundingBox().width&&(this._updateSliderPosition(t),this.sendActionsForControlEvents(cc.CONTROL_EVENT_VALUECHANGED),!0)},onTouchBegan:function(t,e){if(!this.isEnabled()||!this.isVisible())return!1;var i=this.getTouchLocation(t);return this._checkSliderPosition(i)},onTouchMoved:function(t,e){var i=this.getTouchLocation(t);this._checkSliderPosition(i)}});var _p=cc.ControlSaturationBrightnessPicker.prototype;_p.saturation,cc.defineGetterSetter(_p,"saturation",_p.getSaturation),_p.brightness,cc.defineGetterSetter(_p,"brightness",_p.getBrightness),_p.background,cc.defineGetterSetter(_p,"background",_p.getBackground),_p.overlay,cc.defineGetterSetter(_p,"overlay",_p.getOverlay),_p.shadow,cc.defineGetterSetter(_p,"shadow",_p.getShadow),_p.slider,cc.defineGetterSetter(_p,"slider",_p.getSlider),_p.startPos,cc.defineGetterSetter(_p,"startPos",_p.getStartPos),_p=null,cc.ControlSaturationBrightnessPicker.create=function(t,e){return new cc.ControlSaturationBrightnessPicker(t,e)},cc.ControlHuePicker=cc.Control.extend({_hue:0,_huePercentage:0,_background:null,_slider:null,_startPos:null,_className:"ControlHuePicker",ctor:function(t,e){cc.Control.prototype.ctor.call(this),e&&this.initWithTargetAndPos(t,e)},getHue:function(){return this._hue},setHue:function(t){this._hue=t,this.setHuePercentage(this._hue/360)},getHuePercentage:function(){return this._huePercentage},setHuePercentage:function(t){this._huePercentage=t,this._hue=360*this._huePercentage;var e=this._background.getBoundingBox(),i=this._startPos.x+.5*e.width,n=this._startPos.y+.5*e.height,r=.5*e.width-15,c=360*this._huePercentage-180,o=cc.degreesToRadians(c),s=i+r*Math.cos(o),a=n+r*Math.sin(o);this._slider.setPosition(s,a)},setEnabled:function(t){cc.Control.prototype.setEnabled.call(this,t),this._slider&&this._slider.setOpacity(t?255:128)},getBackground:function(){return this._background},getSlider:function(){return this._slider},getStartPos:function(){return this._startPos},initWithTargetAndPos:function(t,e){return!!cc.Control.prototype.init.call(this)&&(this._background=cc.ControlUtils.addSpriteToTargetWithPosAndAnchor("huePickerBackground.png",t,e,cc.p(0,0)),this._slider=cc.ControlUtils.addSpriteToTargetWithPosAndAnchor("colourPicker.png",t,e,cc.p(.5,.5)),this._slider.setPosition(e.x,e.y+.5*this._background.getBoundingBox().height),this._startPos=e,this._hue=0,this._huePercentage=0,!0)},_updateSliderPosition:function(t){var e=this._background.getBoundingBox(),i=this._startPos.x+.5*e.width,n=this._startPos.y+.5*e.height,r=t.x-i,c=t.y-n,o=Math.atan2(c,r),s=cc.radiansToDegrees(o)+180;this.setHue(s),this.sendActionsForControlEvents(cc.CONTROL_EVENT_VALUECHANGED)},_checkSliderPosition:function(t){var e=Math.sqrt(Math.pow(t.x+10,2)+Math.pow(t.y,2));return 80>e&&e>59&&(this._updateSliderPosition(t),!0)},onTouchBegan:function(t,e){if(!this.isEnabled()||!this.isVisible())return!1;var i=this.getTouchLocation(t);return this._checkSliderPosition(i)},onTouchMoved:function(t,e){var i=this.getTouchLocation(t);this._checkSliderPosition(i)}});var _p=cc.ControlHuePicker.prototype;_p.hue,cc.defineGetterSetter(_p,"hue",_p.getHue,_p.setHue),_p.huePercent,cc.defineGetterSetter(_p,"huePercent",_p.getHuePercentage,_p.setHuePercentage),_p.background,cc.defineGetterSetter(_p,"background",_p.getBackground),_p.slider,cc.defineGetterSetter(_p,"slider",_p.getSlider),_p.startPos,cc.defineGetterSetter(_p,"startPos",_p.getStartPos),_p=null,cc.ControlHuePicker.create=function(t,e){return new cc.ControlHuePicker(t,e)},cc.ControlColourPicker=cc.Control.extend({_hsv:null,_colourPicker:null,_huePicker:null,_background:null,_className:"ControlColourPicker",ctor:function(){cc.Control.prototype.ctor.call(this),this.init()},hueSliderValueChanged:function(t,e){this._hsv.h=t.getHue();var i=cc.ControlUtils.RGBfromHSV(this._hsv);cc.Control.prototype.setColor.call(this,cc.color(0|255*i.r,0|255*i.g,0|255*i.b)),this.sendActionsForControlEvents(cc.CONTROL_EVENT_VALUECHANGED),this._updateControlPicker()},colourSliderValueChanged:function(t,e){this._hsv.s=t.getSaturation(),this._hsv.v=t.getBrightness();var i=cc.ControlUtils.RGBfromHSV(this._hsv);cc.Control.prototype.setColor.call(this,cc.color(0|255*i.r,0|255*i.g,0|255*i.b)),this.sendActionsForControlEvents(cc.CONTROL_EVENT_VALUECHANGED)},setColor:function(t){cc.Control.prototype.setColor.call(this,t);var e=new cc.RGBA;e.r=t.r/255,e.g=t.g/255,e.b=t.b/255,e.a=1,this._hsv=cc.ControlUtils.HSVfromRGB(e),this._updateHueAndControlPicker()},getBackground:function(){return this._background},init:function(){if(cc.Control.prototype.init.call(this)){cc.spriteFrameCache.addSpriteFrames(res.CCControlColourPickerSpriteSheet_plist);var t=new cc.SpriteBatchNode(res.CCControlColourPickerSpriteSheet_png);this.addChild(t),this._hsv=new cc.HSV(0,0,0),this._background=cc.ControlUtils.addSpriteToTargetWithPosAndAnchor("menuColourPanelBackground.png",t,cc.p(0,0),cc.p(.5,.5));var e=cc.pSub(this._background.getPosition(),cc.p(this._background.getContentSize().width/2,this._background.getContentSize().height/2)),i=8,n=28;return this._huePicker=new cc.ControlHuePicker(t,cc.p(e.x+i,e.y+i)),this._colourPicker=new cc.ControlSaturationBrightnessPicker(t,cc.p(e.x+n,e.y+n)),this._huePicker.addTargetWithActionForControlEvents(this,this.hueSliderValueChanged,cc.CONTROL_EVENT_VALUECHANGED),this._colourPicker.addTargetWithActionForControlEvents(this,this.colourSliderValueChanged,cc.CONTROL_EVENT_VALUECHANGED),this._updateHueAndControlPicker(),this.addChild(this._huePicker),this.addChild(this._colourPicker),this.setContentSize(this._background.getContentSize()),!0}return!1},_updateControlPicker:function(){this._huePicker.setHue(this._hsv.h),this._colourPicker.updateWithHSV(this._hsv)},_updateHueAndControlPicker:function(){this._huePicker.setHue(this._hsv.h),this._colourPicker.updateWithHSV(this._hsv),this._colourPicker.updateDraggerWithHSV(this._hsv)},setEnabled:function(t){cc.Control.prototype.setEnabled.call(this,t),null!==this._huePicker&&this._huePicker.setEnabled(t),this._colourPicker&&this._colourPicker.setEnabled(t)},onTouchBegan:function(){return!1}});var _p=cc.ControlColourPicker.prototype;_p.background,cc.defineGetterSetter(_p,"background",_p.getBackground),_p=null,cc.ControlColourPicker.create=function(){return new cc.ControlColourPicker};var res=res||{};res.CCControlColourPickerSpriteSheet_plist=res.CCControlColourPickerSpriteSheet_plist||"res/extensions/CCControlColourPickerSpriteSheet.plist",res.CCControlColourPickerSpriteSheet_png=res.CCControlColourPickerSpriteSheet_png||"res/extensions/CCControlColourPickerSpriteSheet.png",cc.SLIDER_MARGIN_H=24,cc.SLIDER_MARGIN_V=8,cc.ControlSlider=cc.Control.extend({_value:0,_minimumValue:0,_maximumValue:0,_minimumAllowedValue:0,_maximumAllowedValue:0,_thumbSprite:null,_progressSprite:null,_backgroundSprite:null,_className:"ControlSlider",ctor:function(t,e,i){if(cc.Control.prototype.ctor.call(this),void 0!=i){var n=new cc.Sprite(t),r=new cc.Sprite(e),c=new cc.Sprite(i);this.initWithSprites(n,r,c)}},getValue:function(){return this._value},setValue:function(t){t=Math.max(t,this._minimumValue),t=Math.min(t,this._maximumValue),this._value=t,this.needsLayout(),this.sendActionsForControlEvents(cc.CONTROL_EVENT_VALUECHANGED)},getMinimumValue:function(){return this._minimumValue},setMinimumValue:function(t){this._minimumValue=t,this._minimumAllowedValue=t,this._minimumValue>=this._maximumValue&&(this._maximumValue=this._minimumValue+1),this.setValue(this._value)},getMaximumValue:function(){return this._maximumValue},setMaximumValue:function(t){this._maximumValue=t,this._maximumAllowedValue=t,this._maximumValue<=this._minimumValue&&(this._minimumValue=this._maximumValue-1),this.setValue(this._value)},isTouchInside:function(t){var e=t.getLocation();e=this.getParent().convertToNodeSpace(e);var i=this.getBoundingBox();return i.width+=this._thumbSprite.getContentSize().width,i.x-=this._thumbSprite.getContentSize().width/2,cc.rectContainsPoint(i,e)},locationFromTouch:function(t){var e=t.getLocation();return e=this.convertToNodeSpace(e),e.x<0?e.x=0:e.x>this._backgroundSprite.getContentSize().width&&(e.x=this._backgroundSprite.getContentSize().width),e},getMinimumAllowedValue:function(){return this._minimumAllowedValue},setMinimumAllowedValue:function(t){this._minimumAllowedValue=t},getMaximumAllowedValue:function(){return this._maximumAllowedValue},setMaximumAllowedValue:function(t){this._maximumAllowedValue=t},getThumbSprite:function(){return this._thumbSprite},getProgressSprite:function(){return this._progressSprite},getBackgroundSprite:function(){return this._backgroundSprite},initWithSprites:function(t,e,i){if(cc.Control.prototype.init.call(this)){this.ignoreAnchorPointForPosition(!1),this._backgroundSprite=t,this._progressSprite=e,this._thumbSprite=i;var n=cc.ControlUtils.CCRectUnion(t.getBoundingBox(),i.getBoundingBox());return this.setContentSize(n.width,n.height),this._backgroundSprite.setAnchorPoint(.5,.5),this._backgroundSprite.setPosition(n.width/2,n.height/2),this.addChild(this._backgroundSprite),this._progressSprite.setAnchorPoint(0,.5),this._progressSprite.setPosition(0,n.height/2),this.addChild(this._progressSprite),this._thumbSprite.setPosition(0,n.height/2),this.addChild(this._thumbSprite),this._minimumValue=0,this._maximumValue=1,this.setValue(this._minimumValue),!0}return!1},setEnabled:function(t){cc.Control.prototype.setEnabled.call(this,t),this._thumbSprite&&this._thumbSprite.setOpacity(t?255:128)},sliderBegan:function(t){this.setSelected(!0),this._thumbSprite.setColor(cc.color.GRAY),this.setValue(this.valueForLocation(t))},sliderMoved:function(t){this.setValue(this.valueForLocation(t))},sliderEnded:function(t){this.isSelected()&&this.setValue(this.valueForLocation(this._thumbSprite.getPosition())),this._thumbSprite.setColor(cc.color.WHITE),this.setSelected(!1)},getTouchLocationInControl:function(t){var e=t.getLocation();return e=this.convertToNodeSpace(e),e.x<0?e.x=0:e.x>this._backgroundSprite.getContentSize().width+cc.SLIDER_MARGIN_H&&(e.x=this._backgroundSprite.getContentSize().width+cc.SLIDER_MARGIN_H),e},onTouchBegan:function(t,e){if(!this.isTouchInside(t)||!this.isEnabled()||!this.isVisible())return!1;var i=this.locationFromTouch(t);return this.sliderBegan(i),!0},onTouchMoved:function(t,e){var i=this.locationFromTouch(t);this.sliderMoved(i)},onTouchEnded:function(t,e){this.sliderEnded(cc.p(0,0))},needsLayout:function(){var t=(this._value-this._minimumValue)/(this._maximumValue-this._minimumValue);this._thumbSprite.setPositionX(t*this._backgroundSprite.getContentSize().width);var e=this._progressSprite.getTextureRect();e=cc.rect(e.x,e.y,this._thumbSprite.getPositionX(),e.height),this._progressSprite.setTextureRect(e,this._progressSprite.isTextureRectRotated()),this._thumbSprite._renderCmd.transform(this._renderCmd)},valueForLocation:function(t){var e=t.x/this._backgroundSprite.getContentSize().width;return Math.max(Math.min(this._minimumValue+e*(this._maximumValue-this._minimumValue),this._maximumAllowedValue),this._minimumAllowedValue)}});var _p=cc.ControlSlider.prototype;_p.value,cc.defineGetterSetter(_p,"value",_p.getValue,_p.setValue),_p.minValue,cc.defineGetterSetter(_p,"minValue",_p.getMinimumValue,_p.setMinimumValue),_p.maxValue,cc.defineGetterSetter(_p,"maxValue",_p.getMaximumValue,_p.setMaximumValue),_p.minAllowedValue,cc.defineGetterSetter(_p,"minAllowedValue",_p.getMinimumAllowedValue,_p.setMinimumAllowedValue),_p.maxAllowedValue,cc.defineGetterSetter(_p,"maxAllowedValue",_p.getMaximumAllowedValue,_p.setMaximumAllowedValue),_p.thumbSprite,cc.defineGetterSetter(_p,"thumbSprite",_p.getThumbSprite),_p.progressSprite,cc.defineGetterSetter(_p,"progressSprite",_p.getProgressSprite),_p.backgroundSprite,cc.defineGetterSetter(_p,"backgroundSprite",_p.getBackgroundSprite),_p=null,cc.ControlSlider.create=function(t,e,i){return new cc.ControlSlider(t,e,i)},cc.ControlSwitch=cc.Control.extend({_switchSprite:null,_initialTouchXPosition:0,_moved:!1,_on:!1,_className:"ControlSwitch",ctor:function(t,e,i,n,r,c){cc.Control.prototype.ctor.call(this),c&&this.initWithMaskSprite(t,e,i,n,r,c)},initWithMaskSprite:function(t,e,i,n,r,c){if(!t)throw new Error("cc.ControlSwitch.initWithMaskSprite(): maskSprite should be non-null.");if(!e)throw new Error("cc.ControlSwitch.initWithMaskSprite(): onSprite should be non-null.");if(!i)throw new Error("cc.ControlSwitch.initWithMaskSprite(): offSprite should be non-null.");if(!n)throw new Error("cc.ControlSwitch.initWithMaskSprite(): thumbSprite should be non-null.");return!!this.init()&&(this._on=!0,this._switchSprite=new cc.ControlSwitchSprite,this._switchSprite.initWithMaskSprite(t,e,i,n,r,c),this._switchSprite.setPosition(this._switchSprite.getContentSize().width/2,this._switchSprite.getContentSize().height/2),this.addChild(this._switchSprite),this.ignoreAnchorPointForPosition(!1),this.setAnchorPoint(.5,.5),this.setContentSize(this._switchSprite.getContentSize()),!0)},setOn:function(t,e){e=e||!1,this._on=t;var i=this._on?this._switchSprite.getOnPosition():this._switchSprite.getOffPosition();e?this._switchSprite.runAction(new cc.ActionTween(.2,"sliderXPosition",this._switchSprite.getSliderXPosition(),i)):this._switchSprite.setSliderXPosition(i),this.sendActionsForControlEvents(cc.CONTROL_EVENT_VALUECHANGED)},isOn:function(){return this._on},hasMoved:function(){return this._moved},setEnabled:function(t){this._enabled=t,this._switchSprite.setOpacity(t?255:128)},locationFromTouch:function(t){var e=t.getLocation();return e=this.convertToNodeSpace(e)},onTouchBegan:function(t,e){if(!this.isTouchInside(t)||!this.isEnabled()||!this.isVisible())return!1;this._moved=!1;var i=this.locationFromTouch(t);return this._initialTouchXPosition=i.x-this._switchSprite.getSliderXPosition(),this._switchSprite.getThumbSprite().setColor(cc.color.GRAY),this._switchSprite.needsLayout(),!0},onTouchMoved:function(t,e){var i=this.locationFromTouch(t);i=cc.p(i.x-this._initialTouchXPosition,0),this._moved=!0,this._switchSprite.setSliderXPosition(i.x)},onTouchEnded:function(t,e){var i=this.locationFromTouch(t);this._switchSprite.getThumbSprite().setColor(cc.color.WHITE),this.hasMoved()?this.setOn(!(i.x<this._switchSprite.getContentSize().width/2),!0):this.setOn(!this._on,!0)},onTouchCancelled:function(t,e){var i=this.locationFromTouch(t);this._switchSprite.getThumbSprite().setColor(cc.color.WHITE),this.hasMoved()?this.setOn(!(i.x<this._switchSprite.getContentSize().width/2),!0):this.setOn(!this._on,!0)}}),cc.ControlSwitch.create=function(t,e,i,n,r,c){return new cc.ControlSwitch(t,e,i,n,r,c)},cc.ControlSwitchSprite=cc.Sprite.extend({_sliderXPosition:0,_onPosition:0,_offPosition:0,_textureLocation:0,_maskLocation:0,_maskSize:null,_onSprite:null,_offSprite:null,_thumbSprite:null,_onLabel:null,_offLabel:null,_clipper:null,_stencil:null,_backRT:null,ctor:function(){cc.Sprite.prototype.ctor.call(this),this._sliderXPosition=0,this._onPosition=0,this._offPosition=0,this._maskLocation=0,this._maskSize=cc.size(0,0),this._onSprite=null,this._offSprite=null,this._thumbSprite=null,this._onLabel=null,this._offLabel=null},initWithMaskSprite:function(t,e,i,n,r,c){if(cc.Sprite.prototype.init.call(this)){this.setSpriteFrame(t.displayFrame()),this._onPosition=0,this._offPosition=-e.getContentSize().width+n.getContentSize().width/2,this._sliderXPosition=this._onPosition,this.setOnSprite(e),this.setOffSprite(i),this.setThumbSprite(n),this.setOnLabel(r),this.setOffLabel(c),this._stencil=t;var o=this._maskSize=this._stencil.getContentSize();return this._stencil.setPosition(0,0),this._clipper=new cc.ClippingNode,this._clipper.setAnchorPoint(.5,.5),this._clipper.setPosition(o.width/2,o.height/2),this._clipper.setStencil(this._stencil),this.addChild(this._clipper),this._clipper.addChild(e),this._clipper.addChild(i),this._clipper.addChild(r),this._clipper.addChild(c),this.addChild(this._thumbSprite),this.needsLayout(),!0}return!1},needsLayout:function(){var t=this._maskSize;this._onSprite.setPosition(this._onSprite.getContentSize().width/2+this._sliderXPosition-t.width/2,this._onSprite.getContentSize().height/2-t.height/2),this._offSprite.setPosition(this._onSprite.getContentSize().width+this._offSprite.getContentSize().width/2+this._sliderXPosition-t.width/2,this._offSprite.getContentSize().height/2-t.height/2),this._onLabel&&this._onLabel.setPosition(this._onSprite.getPositionX()-this._thumbSprite.getContentSize().width/6,this._onSprite.getContentSize().height/2-t.height/2),this._offLabel&&this._offLabel.setPosition(this._offSprite.getPositionX()+this._thumbSprite.getContentSize().width/6,this._offSprite.getContentSize().height/2-t.height/2),this._thumbSprite.setPosition(this._onSprite.getContentSize().width+this._sliderXPosition,this._maskSize.height/2)},setSliderXPosition:function(t){t<=this._offPosition?t=this._offPosition:t>=this._onPosition&&(t=this._onPosition),this._sliderXPosition=t,this.needsLayout()},getSliderXPosition:function(){return this._sliderXPosition},_getOnSideWidth:function(){return this._onSprite.getContentSize().width},_getOffSideWidth:function(){return this._offSprite.getContentSize().height},updateTweenAction:function(t,e){"sliderXPosition"===e&&this.setSliderXPosition(t)},setOnPosition:function(t){this._onPosition=t},getOnPosition:function(){return this._onPosition},setOffPosition:function(t){this._offPosition=t},getOffPosition:function(){return this._offPosition},setMaskTexture:function(t){this._stencil.setTexture(t)},getMaskTexture:function(){return this._stencil.getTexture()},setTextureLocation:function(t){this._textureLocation=t},getTextureLocation:function(){return this._textureLocation},setMaskLocation:function(t){this._maskLocation=t},getMaskLocation:function(){return this._maskLocation},setOnSprite:function(t){this._onSprite=t},getOnSprite:function(){return this._onSprite},setOffSprite:function(t){this._offSprite=t},getOffSprite:function(){return this._offSprite},setThumbSprite:function(t){this._thumbSprite=t},getThumbSprite:function(){return this._thumbSprite},setOnLabel:function(t){this._onLabel=t},getOnLabel:function(){return this._onLabel},setOffLabel:function(t){this._offLabel=t},getOffLabel:function(){return this._offLabel}});var _p=cc.ControlSwitchSprite.prototype;_p.sliderX,cc.defineGetterSetter(_p,"sliderX",_p.getSliderXPosition,_p.setSliderXPosition),_p.onPos,cc.defineGetterSetter(_p,"onPos",_p.getOnPosition,_p.setOnPosition),_p.offPos,cc.defineGetterSetter(_p,"offPos",_p.getOffPosition,_p.setOffPosition),_p.maskTexture,cc.defineGetterSetter(_p,"maskTexture",_p.getMaskTexture,_p.setMaskTexture),_p.maskPos,cc.defineGetterSetter(_p,"maskPos",_p.getMaskLocation,_p.setMaskLocation),_p.onSprite,cc.defineGetterSetter(_p,"onSprite",_p.getOnSprite,_p.setOnSprite),_p.offSprite,cc.defineGetterSetter(_p,"offSprite",_p.getOffSprite,_p.setOffSprite),_p.thumbSprite,cc.defineGetterSetter(_p,"thumbSprite",_p.getThumbSprite,_p.setThumbSprite),_p.onLabel,cc.defineGetterSetter(_p,"onLabel",_p.getOnLabel,_p.setOnLabel),_p.offLabel,cc.defineGetterSetter(_p,"offLabel",_p.getOffLabel,_p.setOffLabel),_p.onSideWidth,cc.defineGetterSetter(_p,"onSideWidth",_p._getOnSideWidth),_p.offSideWidth,cc.defineGetterSetter(_p,"offSideWidth",_p._getOffSideWidth),_p=null,cc.CONTROL_STEPPER_PARTMINUS=0,cc.CONTROL_STEPPER_PARTPLUS=1,cc.CONTROL_STEPPER_PARTNONE=2,cc.CONTROL_STEPPER_LABELCOLOR_ENABLED=cc.color(55,55,55),cc.CONTROL_STEPPER_LABELCOLOR_DISABLED=cc.color(147,147,147),cc.CONTROL_STEPPER_LABELFONT="CourierNewPSMT",cc.AUTOREPEAT_DELTATIME=.15,cc.AUTOREPEAT_INCREASETIME_INCREMENT=12,cc.ControlStepper=cc.Control.extend({_minusSprite:null,_plusSprite:null,_minusLabel:null,_plusLabel:null,_value:0,_continuous:!1,_autorepeat:!1,_wraps:!1,_minimumValue:0,_maximumValue:0,_stepValue:0,
_touchInsideFlag:!1,_touchedPart:cc.CONTROL_STEPPER_PARTNONE,_autorepeatCount:0,_className:"ControlStepper",ctor:function(t,e){cc.Control.prototype.ctor.call(this),this._minusSprite=null,this._plusSprite=null,this._minusLabel=null,this._plusLabel=null,this._value=0,this._continuous=!1,this._autorepeat=!1,this._wraps=!1,this._minimumValue=0,this._maximumValue=0,this._stepValue=0,this._touchInsideFlag=!1,this._touchedPart=cc.CONTROL_STEPPER_PARTNONE,this._autorepeatCount=0,e&&this.initWithMinusSpriteAndPlusSprite(t,e)},initWithMinusSpriteAndPlusSprite:function(t,e){if(!t)throw new Error("cc.ControlStepper.initWithMinusSpriteAndPlusSprite(): Minus sprite should be non-null.");if(!e)throw new Error("cc.ControlStepper.initWithMinusSpriteAndPlusSprite(): Plus sprite should be non-null.");if(this.init()){this._autorepeat=!0,this._continuous=!0,this._minimumValue=0,this._maximumValue=100,this._value=0,this._stepValue=1,this._wraps=!1,this.ignoreAnchorPointForPosition(!1),this.setMinusSprite(t),this._minusSprite.setPosition(t.getContentSize().width/2,t.getContentSize().height/2),this.addChild(this._minusSprite),this.setMinusLabel(new cc.LabelTTF("-",cc.CONTROL_STEPPER_LABELFONT,40,cc.size(40,40),cc.TEXT_ALIGNMENT_CENTER,cc.VERTICAL_TEXT_ALIGNMENT_CENTER)),this._minusLabel.setColor(cc.CONTROL_STEPPER_LABELCOLOR_DISABLED),this._minusLabel.setPosition(this._minusSprite.getContentSize().width/2,this._minusSprite.getContentSize().height/2),this._minusSprite.addChild(this._minusLabel),this.setPlusSprite(e),this._plusSprite.setPosition(t.getContentSize().width+e.getContentSize().width/2,t.getContentSize().height/2),this.addChild(this._plusSprite),this.setPlusLabel(new cc.LabelTTF("+",cc.CONTROL_STEPPER_LABELFONT,40,cc.size(40,40),cc.TEXT_ALIGNMENT_CENTER,cc.VERTICAL_TEXT_ALIGNMENT_CENTER)),this._plusLabel.setColor(cc.CONTROL_STEPPER_LABELCOLOR_ENABLED),this._plusLabel.setPosition(this._plusSprite.getContentSize().width/2,this._plusSprite.getContentSize().height/2),this._plusSprite.addChild(this._plusLabel);var i=cc.ControlUtils.CCRectUnion(this._minusSprite.getBoundingBox(),this._plusSprite.getBoundingBox());return this.setContentSize(this._minusSprite.getContentSize().width+this._plusSprite.getContentSize().height,i.height),!0}return!1},setWraps:function(t){this._wraps=t,this._wraps&&(this._minusLabel.setColor(cc.CONTROL_STEPPER_LABELCOLOR_ENABLED),this._plusLabel.setColor(cc.CONTROL_STEPPER_LABELCOLOR_ENABLED)),this.setValue(this._value)},getWraps:function(){return this._wraps},setMinimumValue:function(t){if(t>=this._maximumValue)throw new Error("cc.ControlStepper.setMinimumValue(): minimumValue should be numerically less than maximumValue.");this._minimumValue=t,this.setValue(this._value)},getMinimumValue:function(){return this._minimumValue},setMaximumValue:function(t){if(t<=this._minimumValue)throw new Error("cc.ControlStepper.setMaximumValue(): maximumValue should be numerically less than maximumValue.");this._maximumValue=t,this.setValue(this._value)},getMaximumValue:function(){return this._maximumValue},setValue:function(t){this.setValueWithSendingEvent(t,!0)},getValue:function(){return this._value},setStepValue:function(t){if(t<=0)throw new Error("cc.ControlStepper.setMaximumValue(): stepValue should be numerically greater than 0.");this._stepValue=t},getStepValue:function(){return this._stepValue},isContinuous:function(){return this._continuous},setValueWithSendingEvent:function(t,e){t<this._minimumValue?t=this._wraps?this._maximumValue:this._minimumValue:t>this._maximumValue&&(t=this._wraps?this._minimumValue:this._maximumValue),this._value=t,this._wraps||(this._minusLabel.setColor(t===this._minimumValue?cc.CONTROL_STEPPER_LABELCOLOR_DISABLED:cc.CONTROL_STEPPER_LABELCOLOR_ENABLED),this._plusLabel.setColor(t===this._maximumValue?cc.CONTROL_STEPPER_LABELCOLOR_DISABLED:cc.CONTROL_STEPPER_LABELCOLOR_ENABLED)),e&&this.sendActionsForControlEvents(cc.CONTROL_EVENT_VALUECHANGED)},startAutorepeat:function(){this._autorepeatCount=-1,this.schedule(this.update,cc.AUTOREPEAT_DELTATIME,cc.REPEAT_FOREVER,3*cc.AUTOREPEAT_DELTATIME)},stopAutorepeat:function(){this.unschedule(this.update)},update:function(t){this._autorepeatCount++,this._autorepeatCount<cc.AUTOREPEAT_INCREASETIME_INCREMENT&&this._autorepeatCount%3!==0||(this._touchedPart===cc.CONTROL_STEPPER_PARTMINUS?this.setValueWithSendingEvent(this._value-this._stepValue,this._continuous):this._touchedPart===cc.CONTROL_STEPPER_PARTPLUS&&this.setValueWithSendingEvent(this._value+this._stepValue,this._continuous))},updateLayoutUsingTouchLocation:function(t){t.x<this._minusSprite.getContentSize().width&&this._value>this._minimumValue?(this._touchedPart=cc.CONTROL_STEPPER_PARTMINUS,this._minusSprite.setColor(cc.color.GRAY),this._plusSprite.setColor(cc.color.WHITE)):t.x>=this._minusSprite.getContentSize().width&&this._value<this._maximumValue?(this._touchedPart=cc.CONTROL_STEPPER_PARTPLUS,this._minusSprite.setColor(cc.color.WHITE),this._plusSprite.setColor(cc.color.GRAY)):(this._touchedPart=cc.CONTROL_STEPPER_PARTNONE,this._minusSprite.setColor(cc.color.WHITE),this._plusSprite.setColor(cc.color.WHITE))},onTouchBegan:function(t,e){if(!this.isTouchInside(t)||!this.isEnabled()||!this.isVisible())return!1;var i=this.getTouchLocation(t);return this.updateLayoutUsingTouchLocation(i),this._touchInsideFlag=!0,this._autorepeat&&this.startAutorepeat(),!0},onTouchMoved:function(t,e){if(this.isTouchInside(t)){var i=this.getTouchLocation(t);this.updateLayoutUsingTouchLocation(i),this._touchInsideFlag||(this._touchInsideFlag=!0,this._autorepeat&&this.startAutorepeat())}else this._touchInsideFlag=!1,this._touchedPart=cc.CONTROL_STEPPER_PARTNONE,this._minusSprite.setColor(cc.color.WHITE),this._plusSprite.setColor(cc.color.WHITE),this._autorepeat&&this.stopAutorepeat()},onTouchEnded:function(t,e){if(this._minusSprite.setColor(cc.color.WHITE),this._plusSprite.setColor(cc.color.WHITE),this._autorepeat&&this.stopAutorepeat(),this.isTouchInside(t)){var i=this.getTouchLocation(t);this.setValue(this._value+(i.x<this._minusSprite.getContentSize().width?0-this._stepValue:this._stepValue))}},setMinusSprite:function(t){this._minusSprite=t},getMinusSprite:function(){return this._minusSprite},setPlusSprite:function(t){this._plusSprite=t},getPlusSprite:function(){return this._plusSprite},setMinusLabel:function(t){this._minusLabel=t},getMinusLabel:function(){return this._minusLabel},setPlusLabel:function(t){this._plusLabel=t},getPlusLabel:function(){return this._plusLabel}});var _p=cc.ControlStepper.prototype;_p.wraps,cc.defineGetterSetter(_p,"wraps",_p.getWraps,_p.setWraps),_p.value,cc.defineGetterSetter(_p,"value",_p.getValue,_p.setValue),_p.minValue,cc.defineGetterSetter(_p,"minValue",_p.getMinimumValue,_p.setMinimumValue),_p.maxValue,cc.defineGetterSetter(_p,"maxValue",_p.getMaximumValue,_p.setMaximumValue),_p.stepValue,cc.defineGetterSetter(_p,"stepValue",_p.getStepValue,_p.setStepValue),_p.continuous,cc.defineGetterSetter(_p,"continuous",_p.isContinuous),_p.minusSprite,cc.defineGetterSetter(_p,"minusSprite",_p.getMinusSprite,_p.setMinusSprite),_p.plusSprite,cc.defineGetterSetter(_p,"plusSprite",_p.getPlusSprite,_p.setPlusSprite),_p.minusLabel,cc.defineGetterSetter(_p,"minusLabel",_p.getMinusLabel,_p.setMinusLabel),_p.plusLabel,cc.defineGetterSetter(_p,"plusLabel",_p.getPlusLabel,_p.setPlusLabel),_p=null,cc.ControlStepper.create=function(t,e){return new cc.ControlStepper(t,e)},cc.ControlPotentiometer=cc.Control.extend({_thumbSprite:null,_progressTimer:null,_previousLocation:null,_value:0,_minimumValue:0,_maximumValue:1,_className:"ControlPotentiometer",ctor:function(t,e,i){if(cc.Control.prototype.ctor.call(this),void 0!=i){var n=new cc.Sprite(t),r=new cc.Sprite(i),c=new cc.ProgressTimer(new cc.Sprite(e));this.initWithTrackSprite_ProgressTimer_ThumbSprite(n,c,r)}},initWithTrackSprite_ProgressTimer_ThumbSprite:function(t,e,i){return!!this.init()&&(this.setProgressTimer(e),this.setThumbSprite(i),this._thumbSprite.setPosition(e.getPosition()),this.addChild(i,2),this.addChild(e,1),this.addChild(t),this.setContentSize(t.getContentSize()),this._minimumValue=0,this._maximumValue=1,this.setValue(this._minimumValue),!0)},setEnabled:function(t){this.setEnabled(t),null!==this._thumbSprite&&this._thumbSprite.setOpacity(t?255:128)},setValue:function(t){t<this._minimumValue&&(t=this._minimumValue),t>this._maximumValue&&(t=this._maximumValue),this._value=t;var e=(t-this._minimumValue)/(this._maximumValue-this._minimumValue);this._progressTimer.setPercentage(100*e),this._thumbSprite.setRotation(360*e),this.sendActionsForControlEvents(cc.CONTROL_EVENT_VALUECHANGED)},getValue:function(){return this._value},setMinimumValue:function(t){this._minimumValue=t,this._minimumValue>=this._maximumValue&&(this._maximumValue=this._minimumValue+1),this.setValue(this._maximumValue)},getMinimumValue:function(){return this._minimumValue},setMaximumValue:function(t){this._maximumValue=t,this._maximumValue<=this._minimumValue&&(this._minimumValue=this._maximumValue-1),this.setValue(this._minimumValue)},getMaximumValue:function(){return this._maximumValue},isTouchInside:function(t){var e=this.getTouchLocation(t),i=this.distanceBetweenPointAndPoint(this._progressTimer.getPosition(),e);return i<Math.min(this.getContentSize().width/2,this.getContentSize().height/2)},onTouchBegan:function(t,e){return!!(this.isTouchInside(t)&&this.isEnabled()&&this.isVisible())&&(this._previousLocation=this.getTouchLocation(t),this.potentiometerBegan(this._previousLocation),!0)},onTouchMoved:function(t,e){var i=this.getTouchLocation(t);this.potentiometerMoved(i)},onTouchEnded:function(t,e){this.potentiometerEnded(cc.p(0,0))},distanceBetweenPointAndPoint:function(t,e){var i=t.x-e.x,n=t.y-e.y;return Math.sqrt(i*i+n*n)},angleInDegreesBetweenLineFromPoint_toPoint_toLineFromPoint_toPoint:function(t,e,i,n){var r=e.x-t.x,c=e.y-t.y,o=n.x-i.x,s=n.y-i.y,a=Math.atan2(r,c),h=Math.atan2(o,s);return 180*(a-h)/Math.PI},potentiometerBegan:function(t){this.setSelected(!0),this.getThumbSprite().setColor(cc.color.GRAY)},potentiometerMoved:function(t){var e=this.angleInDegreesBetweenLineFromPoint_toPoint_toLineFromPoint_toPoint(this._progressTimer.getPosition(),t,this._progressTimer.getPosition(),this._previousLocation);e>180?e-=360:e<-180&&(e+=360),this.setValue(this._value+e/360*(this._maximumValue-this._minimumValue)),this._previousLocation=t},potentiometerEnded:function(t){this.getThumbSprite().setColor(cc.color.WHITE),this.setSelected(!1)},setThumbSprite:function(t){this._thumbSprite=t},getThumbSprite:function(){return this._thumbSprite},setProgressTimer:function(t){this._progressTimer=t},getProgressTimer:function(){return this._progressTimer},setPreviousLocation:function(t){this._previousLocation=t},getPreviousLocation:function(){return this._previousLocation}});var _p=cc.ControlPotentiometer.prototype;_p.value,cc.defineGetterSetter(_p,"value",_p.getValue,_p.setValue),_p.minValue,cc.defineGetterSetter(_p,"minValue",_p.getMinimumValue,_p.setMinimumValue),_p.maxValue,cc.defineGetterSetter(_p,"maxValue",_p.getMaximumValue,_p.setMaximumValue),_p.progressTimer,cc.defineGetterSetter(_p,"progressTimer",_p.getProgressTimer,_p.setProgressTimer),_p.thumbSprite,cc.defineGetterSetter(_p,"thumbSprite",_p.getThumbSprite,_p.setThumbSprite),_p.prevLocation,cc.defineGetterSetter(_p,"prevLocation",_p.getPreviousLocation,_p.setPreviousLocation),_p=null,cc.ControlPotentiometer.create=function(t,e,i){return new cc.ControlPotentiometer(t,e,i)},cc.SCROLLVIEW_DIRECTION_NONE=-1,cc.SCROLLVIEW_DIRECTION_HORIZONTAL=0,cc.SCROLLVIEW_DIRECTION_VERTICAL=1,cc.SCROLLVIEW_DIRECTION_BOTH=2;var SCROLL_DEACCEL_RATE=.95,SCROLL_DEACCEL_DIST=1,BOUNCE_DURATION=.15,INSET_RATIO=.2,MOVE_INCH=7/160,BOUNCE_BACK_FACTOR=.35;cc.convertDistanceFromPointToInch=function(t){var e=cc.view,i=(e.getScaleX()+e.getScaleY())/2;return t*i/160},cc.ScrollViewDelegate=cc.Class.extend({scrollViewDidScroll:function(t){},scrollViewDidZoom:function(t){}}),cc.ScrollView=cc.Layer.extend({_zoomScale:0,_minZoomScale:0,_maxZoomScale:0,_delegate:null,_direction:cc.SCROLLVIEW_DIRECTION_BOTH,_dragging:!1,_contentOffset:null,_container:null,_touchMoved:!1,_maxInset:null,_minInset:null,_bounceable:!1,_clippingToBounds:!1,_scrollDistance:null,_touchPoint:null,_touchLength:0,_touches:null,_viewSize:null,_minScale:0,_maxScale:0,_parentScissorRect:null,_scissorRestored:!1,_tmpViewRect:null,_touchListener:null,_className:"ScrollView",ctor:function(t,e){cc.Layer.prototype.ctor.call(this),this._contentOffset=cc.p(0,0),this._maxInset=cc.p(0,0),this._minInset=cc.p(0,0),this._scrollDistance=cc.p(0,0),this._touchPoint=cc.p(0,0),this._touches=[],this._viewSize=cc.size(0,0),this._parentScissorRect=new cc.Rect(0,0,0,0),this._tmpViewRect=new cc.Rect(0,0,0,0),void 0!=e?this.initWithViewSize(t,e):this.initWithViewSize(cc.size(200,200),null)},init:function(){return this.initWithViewSize(cc.size(200,200),null)},initWithViewSize:function(t,e){var i=cc.p(0,0);return!!cc.Layer.prototype.init.call(this)&&(e||this._container||(e=new cc.Layer),e&&this.setContainer(e),this.setViewSize(t),this.setTouchEnabled(!0),this._touches.length=0,this._delegate=null,this._bounceable=!0,this._clippingToBounds=!0,this._direction=cc.SCROLLVIEW_DIRECTION_BOTH,this._container.setPosition(i),this._touchLength=0,this._minScale=this._maxScale=1,!0)},setContentOffset:function(t,e){if(e)return void this.setContentOffsetInDuration(t,BOUNCE_DURATION);if(!this._bounceable){var i=this.minContainerOffset(),n=this.maxContainerOffset();t.x=Math.max(i.x,Math.min(n.x,t.x)),t.y=Math.max(i.y,Math.min(n.y,t.y))}this._container.setPosition(t);var r=this._delegate;null!=r&&r.scrollViewDidScroll&&r.scrollViewDidScroll(this)},getContentOffset:function(){var t=this._container.getPosition();return cc.p(t.x,t.y)},setContentOffsetInDuration:function(t,e){var i=cc.moveTo(e,t),n=cc.callFunc(this._stoppedAnimatedScroll,this);this._container.runAction(cc.sequence(i,n)),this.schedule(this._performedAnimatedScroll)},setZoomScale:function(t,e){if(e)return void this.setZoomScaleInDuration(t,BOUNCE_DURATION);var i=this._container;if(i.getScale()!==t){var n,r,c;if(0===this._touchLength){var o=this._viewSize;c=cc.p(.5*o.width,.5*o.height),c=this.convertToWorldSpace(c)}else c=this._touchPoint;n=i.convertToNodeSpace(c),i.setScale(Math.max(this._minScale,Math.min(this._maxScale,t))),r=i.convertToWorldSpace(n);var s=cc.pSub(c,r);this._delegate&&this._delegate.scrollViewDidZoom&&this._delegate.scrollViewDidZoom(this),this.setContentOffset(cc.pAdd(i.getPosition(),s))}},getZoomScale:function(){return this._container.getScale()},setZoomScaleInDuration:function(t,e){if(e>0){var i=this._container.getScale();if(i!==t){var n=cc.actionTween(e,"zoomScale",i,t);this.runAction(n)}}else this.setZoomScale(t)},minContainerOffset:function(){var t=this._container,e=t.getContentSize(),i=this._viewSize;return cc.p(i.width-e.width*t.getScaleX(),i.height-e.height*t.getScaleY())},maxContainerOffset:function(){return cc.p(0,0)},isNodeVisible:function(t){var e=this.getContentOffset(),i=this.getViewSize(),n=this.getZoomScale(),r=cc.rect(-e.x/n,-e.y/n,i.width/n,i.height/n);return cc.rectIntersectsRect(r,t.getBoundingBox())},pause:function(t){this._container.pause();for(var e=this._container.getChildren(),i=0;i<e.length;i++)e[i].pause();this._super()},resume:function(t){for(var e=this._container.getChildren(),i=0,n=e.length;i<n;i++)e[i].resume();this._container.resume(),this._super()},isDragging:function(){return this._dragging},isTouchMoved:function(){return this._touchMoved},isBounceable:function(){return this._bounceable},setBounceable:function(t){this._bounceable=t},getViewSize:function(){return this._viewSize},setViewSize:function(t){this._viewSize=t,cc.Node.prototype.setContentSize.call(this,t)},getContainer:function(){return this._container},setContainer:function(t){t&&(this.removeAllChildren(!0),this._container=t,t.ignoreAnchorPointForPosition(!1),t.setAnchorPoint(0,0),this.addChild(t),this.setViewSize(this._viewSize))},getDirection:function(){return this._direction},setDirection:function(t){this._direction=t},getDelegate:function(){return this._delegate},setDelegate:function(t){this._delegate=t},onTouchBegan:function(t,e){for(var i=this;null!=i;i=i.parent)if(!i.isVisible())return!1;var n=this._getViewRect(),r=this._container,c=r.convertToWorldSpace(r.convertTouchToNodeSpace(t)),o=this._touches;return!(o.length>2||this._touchMoved||!cc.rectContainsPoint(n,c))&&(o.push(t),1===o.length?(this._touchPoint=this.convertTouchToNodeSpace(t),this._touchMoved=!1,this._dragging=!0,this._scrollDistance.x=0,this._scrollDistance.y=0,this._touchLength=0):2===o.length&&(this._touchPoint=cc.pMidpoint(this.convertTouchToNodeSpace(o[0]),this.convertTouchToNodeSpace(o[1])),this._touchLength=cc.pDistance(r.convertTouchToNodeSpace(o[0]),r.convertTouchToNodeSpace(o[1])),this._dragging=!1),!0)},onTouchMoved:function(t,e){if(this.isVisible())if(this.setNodeDirty(),1===this._touches.length&&this._dragging){this._touchMoved=!0;var i,n=(this._getViewRect(),this.convertTouchToNodeSpace(t)),r=cc.pSub(n,this._touchPoint),c=0,o=this._direction;if(o===cc.SCROLLVIEW_DIRECTION_VERTICAL)c=r.y,i=this._container.getPositionY(),this.minContainerOffset().y<=i&&i<=this.maxContainerOffset().y||(r.y*=BOUNCE_BACK_FACTOR);else if(o===cc.SCROLLVIEW_DIRECTION_HORIZONTAL)c=r.x,i=this._container.getPositionX(),this.minContainerOffset().x<=i&&i<=this.maxContainerOffset().x||(r.x*=BOUNCE_BACK_FACTOR);else{c=Math.sqrt(r.x*r.x+r.y*r.y),i=this._container.getPositionY();var s=this.minContainerOffset(),a=this.maxContainerOffset();s.y<=i&&i<=a.y||(r.y*=BOUNCE_BACK_FACTOR),i=this._container.getPositionX(),s.x<=i&&i<=a.x||(r.x*=BOUNCE_BACK_FACTOR)}if(!this._touchMoved&&Math.abs(cc.convertDistanceFromPointToInch(c))<MOVE_INCH)return;if(this._touchMoved||(r.x=0,r.y=0),this._touchPoint=n,this._touchMoved=!0,this._dragging){switch(o){case cc.SCROLLVIEW_DIRECTION_VERTICAL:r.x=0;break;case cc.SCROLLVIEW_DIRECTION_HORIZONTAL:r.y=0}var h=this._container.getPosition(),l=h.x+r.x,u=h.y+r.y;this._scrollDistance=r,this.setContentOffset(cc.p(l,u))}}else if(2===this._touches.length&&!this._dragging){var _=cc.pDistance(this._container.convertTouchToNodeSpace(this._touches[0]),this._container.convertTouchToNodeSpace(this._touches[1]));this.setZoomScale(this.getZoomScale()*_/this._touchLength)}},onTouchEnded:function(t,e){this.isVisible()&&(1===this._touches.length&&this._touchMoved&&this.schedule(this._deaccelerateScrolling),this._touches.length=0,this._dragging=!1,this._touchMoved=!1)},onTouchCancelled:function(t,e){this.isVisible()&&(this._touches.length=0,this._dragging=!1,this._touchMoved=!1)},setContentSize:function(t,e){null!==this.getContainer()&&(void 0===e?this.getContainer().setContentSize(t):this.getContainer().setContentSize(t,e),this.updateInset())},_setWidth:function(t){var e=this.getContainer();null!==e&&(e._setWidth(t),this.updateInset())},_setHeight:function(t){var e=this.getContainer();null!==e&&(e._setHeight(t),this.updateInset())},getContentSize:function(){return this._container.getContentSize()},updateInset:function(){if(null!==this.getContainer()){var t=this._viewSize,e=this.maxContainerOffset();this._maxInset.x=e.x+t.width*INSET_RATIO,this._maxInset.y=e.y+t.height*INSET_RATIO,e=this.minContainerOffset(),this._minInset.x=e.x-t.width*INSET_RATIO,this._minInset.y=e.y-t.height*INSET_RATIO}},isClippingToBounds:function(){return this._clippingToBounds},setClippingToBounds:function(t){this._clippingToBounds=t},addChild:function(t,e,i){if(!t)throw new Error("child must not nil!");e=e||t.getLocalZOrder(),i=i||t.getTag(),this._container!==t?this._container.addChild(t,e,i):cc.Layer.prototype.addChild.call(this,t,e,i)},isTouchEnabled:function(){return null!==this._touchListener},setTouchEnabled:function(t){if(this._touchListener&&cc.eventManager.removeListener(this._touchListener),this._touchListener=null,t){var e=cc.EventListener.create({event:cc.EventListener.TOUCH_ONE_BY_ONE});this.onTouchBegan&&(e.onTouchBegan=this.onTouchBegan.bind(this)),this.onTouchMoved&&(e.onTouchMoved=this.onTouchMoved.bind(this)),this.onTouchEnded&&(e.onTouchEnded=this.onTouchEnded.bind(this)),this.onTouchCancelled&&(e.onTouchCancelled=this.onTouchCancelled.bind(this)),this._touchListener=e,cc.eventManager.addListener(e,this)}else this._dragging=!1,this._touchMoved=!1,this._touches.length=0},_initWithViewSize:function(t){return null},_relocateContainer:function(t){var e=this.minContainerOffset(),i=this.maxContainerOffset(),n=this._direction,r=this._container.getPosition(),c=r.x,o=r.y;n!==cc.SCROLLVIEW_DIRECTION_BOTH&&n!==cc.SCROLLVIEW_DIRECTION_HORIZONTAL||(c=Math.max(c,e.x),c=Math.min(c,i.x)),n!==cc.SCROLLVIEW_DIRECTION_BOTH&&n!==cc.SCROLLVIEW_DIRECTION_VERTICAL||(o=Math.min(o,i.y),o=Math.max(o,e.y)),o===r.y&&c===r.x||this.setContentOffset(cc.p(c,o),t)},_deaccelerateScrolling:function(t){if(this._dragging)return void this.unschedule(this._deaccelerateScrolling);var e,i,n=this._container.getPosition(),r=this._scrollDistance;this._container.setPosition(n.x+r.x,n.y+r.y),this._bounceable?(e=this._maxInset,i=this._minInset):(e=this.maxContainerOffset(),i=this.minContainerOffset());var c=this._container.getPositionX(),o=this._container.getPositionY();r.x=r.x*SCROLL_DEACCEL_RATE,r.y=r.y*SCROLL_DEACCEL_RATE,this.setContentOffset(cc.p(c,o)),(Math.abs(r.x)<=SCROLL_DEACCEL_DIST&&Math.abs(r.y)<=SCROLL_DEACCEL_DIST||o>e.y||o<i.y||c>e.x||c<i.x||c===e.x||c===i.x||o===e.y||o===i.y)&&(this.unschedule(this._deaccelerateScrolling),this._relocateContainer(!0))},_performedAnimatedScroll:function(t){return this._dragging?void this.unschedule(this._performedAnimatedScroll):void(this._delegate&&this._delegate.scrollViewDidScroll&&this._delegate.scrollViewDidScroll(this))},_stoppedAnimatedScroll:function(t){this.unschedule(this._performedAnimatedScroll),this._delegate&&this._delegate.scrollViewDidScroll&&this._delegate.scrollViewDidScroll(this)},_handleZoom:function(){},_getViewRect:function(){for(var t=this.convertToWorldSpace(cc.p(0,0)),e=this._viewSize,i=this.getScaleX(),n=this.getScaleY(),r=this._parent;null!=r;r=r.getParent())i*=r.getScaleX(),n*=r.getScaleY();i<0&&(t.x+=e.width*i,i=-i),n<0&&(t.y+=e.height*n,n=-n);var c=this._tmpViewRect;return c.x=t.x,c.y=t.y,c.width=e.width*i,c.height=e.height*n,c},_createRenderCmd:function(){return cc._renderType===cc.game.RENDER_TYPE_CANVAS?new cc.ScrollView.CanvasRenderCmd(this):new cc.ScrollView.WebGLRenderCmd(this)}});var _p=cc.ScrollView.prototype;_p.minOffset,cc.defineGetterSetter(_p,"minOffset",_p.minContainerOffset),_p.maxOffset,cc.defineGetterSetter(_p,"maxOffset",_p.maxContainerOffset),_p.bounceable,cc.defineGetterSetter(_p,"bounceable",_p.isBounceable,_p.setBounceable),_p.viewSize,cc.defineGetterSetter(_p,"viewSize",_p.getViewSize,_p.setViewSize),_p.container,cc.defineGetterSetter(_p,"container",_p.getContainer,_p.setContainer),_p.direction,cc.defineGetterSetter(_p,"direction",_p.getDirection,_p.setDirection),_p.delegate,cc.defineGetterSetter(_p,"delegate",_p.getDelegate,_p.setDelegate),_p.clippingToBounds,cc.defineGetterSetter(_p,"clippingToBounds",_p.isClippingToBounds,_p.setClippingToBounds),_p=null,cc.ScrollView.create=function(t,e){return new cc.ScrollView(t,e)},function(){cc.ScrollView.CanvasRenderCmd=function(t){cc.Layer.CanvasRenderCmd.call(this,t),this._needDraw=!1,this.startCmd=new cc.CustomRenderCmd(this,this._startCmd),this.startCmd._canUseDirtyRegion=!0,this.endCmd=new cc.CustomRenderCmd(this,this._endCmd),this.endCmd._canUseDirtyRegion=!0};var t=cc.ScrollView.CanvasRenderCmd.prototype=Object.create(cc.Layer.CanvasRenderCmd.prototype);t.constructor=cc.ScrollView.CanvasRenderCmd,t._startCmd=function(t,e,i){var n=this._node,r=t||cc._renderContext,c=r.getContext();if(r.save(),n._clippingToBounds){this._scissorRestored=!1,r.setTransform(this._worldTransform,e,i);var o=n.getScaleX(),s=n.getScaleY(),a=n._viewSize.width*o,h=n._viewSize.height*s;c.beginPath(),c.rect(0,0,a,-h),c.closePath(),c.clip()}},t._endCmd=function(t){t=t||cc._renderContext,t.restore()},t.visit=function(t){var e=this._node;if(e._visible){var i,n,r=e._children;if(this._syncStatus(t),cc.renderer.pushRenderCommand(this.startCmd),r&&r.length>0)for(n=r.length,e.sortAllChildren(),i=0;i<n;i++)r[i]._renderCmd.visit(this);cc.renderer.pushRenderCommand(this.endCmd),this._dirtyFlag=0}}}(),cc.SortableObject=cc.Class.extend({setObjectID:function(t){},getObjectID:function(){return 0}}),cc.SortedObject=cc.SortableObject.extend({_objectID:0,ctor:function(){this._objectID=0},setObjectID:function(t){this._objectID=t},getObjectID:function(){return this._objectID}});var _compareObject=function(t,e){return t.getObjectID()-e.getObjectID()};cc.ArrayForObjectSorting=cc.Class.extend({_saveObjectArr:null,ctor:function(){this._saveObjectArr=[]},insertSortedObject:function(t){if(!t)throw new Error("cc.ArrayForObjectSorting.insertSortedObject(): addObject should be non-null.");var e=this.indexOfSortedObject(t);this.insertObject(t,e)},removeSortedObject:function(t){if(0!==this.count()){var e=this.indexOfSortedObject(t);if(e<this.count()&&e!==cc.INVALID_INDEX){var i=this.objectAtIndex(e);i.getObjectID()===t.getObjectID()&&this.removeObjectAtIndex(e)}}},setObjectID_ofSortedObject:function(t,e){var i=this.indexOfSortedObject(e);if(i<this.count()&&i!==cc.INVALID_INDEX){var n=this.objectAtIndex(i);n.getObjectID()===e.getObjectID()&&(this.removeObjectAtIndex(i),n.setObjectID(t),this.insertSortedObject(n))}},objectWithObjectID:function(t){if(0===this.count())return null;var e=new cc.SortedObject;e.setObjectID(t);var i=this.indexOfSortedObject(e);return i<this.count()&&i!==cc.INVALID_INDEX&&(e=this.objectAtIndex(i),e.getObjectID()!==t&&(e=null)),e},getObjectWithObjectID:function(t){return null},indexOfSortedObject:function(t){var e=0;if(t)for(var i=0,n=t.getObjectID(),r=this._saveObjectArr,c=0;c<r.length;c++){var o=r[c],s=o.getObjectID();if(n===s||n>=i&&n<s)break;i=s,e++}else e=cc.INVALID_INDEX;return e},count:function(){return this._saveObjectArr.length},lastObject:function(){var t=this._saveObjectArr;return 0===t.length?null:t[t.length-1]},objectAtIndex:function(t){return this._saveObjectArr[t]},addObject:function(t){this._saveObjectArr.push(t),this._saveObjectArr.sort(_compareObject)},removeObjectAtIndex:function(t){this._saveObjectArr.splice(t,1),this._saveObjectArr.sort(_compareObject)},insertObject:function(t,e){this._saveObjectArr.splice(e,0,t),this._saveObjectArr.sort(_compareObject)}}),cc.TABLEVIEW_FILL_TOPDOWN=0,cc.TABLEVIEW_FILL_BOTTOMUP=1,cc.TableViewCell=cc.Node.extend({_idx:0,_className:"TableViewCell",getIdx:function(){return this._idx},setIdx:function(t){this._idx=t},reset:function(){this._idx=cc.INVALID_INDEX},setObjectID:function(t){this._idx=t},getObjectID:function(){return this._idx}});var _p=cc.TableViewCell.prototype;_p.objectId,cc.defineGetterSetter(_p,"objectId",_p.getObjectID,_p.setObjectID),_p=null,cc.TableViewDelegate=cc.ScrollViewDelegate.extend({tableCellTouched:function(t,e){},tableCellHighlight:function(t,e){},tableCellUnhighlight:function(t,e){},tableCellWillRecycle:function(t,e){}}),cc.TableViewDataSource=cc.Class.extend({tableCellSizeForIndex:function(t,e){return this.cellSizeForTable(t)},cellSizeForTable:function(t){return cc.size(0,0)},tableCellAtIndex:function(t,e){return null},numberOfCellsInTableView:function(t){return 0}}),cc.TableView=cc.ScrollView.extend({_vOrdering:null,_indices:null,_cellsFreed:null,_dataSource:null,_tableViewDelegate:null,_oldDirection:null,_cellsPositions:null,_touchedCell:null,ctor:function(t,e,i){cc.ScrollView.prototype.ctor.call(this),this._oldDirection=cc.SCROLLVIEW_DIRECTION_NONE,this._cellsPositions=[],this.initWithViewSize(e,i),this.setDataSource(t),this._updateCellPositions(),this._updateContentSize()},__indexFromOffset:function(t){var e,i=0,n=this._dataSource.numberOfCellsInTableView(this)-1;switch(this.getDirection()){case cc.SCROLLVIEW_DIRECTION_HORIZONTAL:e=t.x;break;default:e=t.y}for(var r=this._cellsPositions;n>=i;){var c=0|i+(n-i)/2,o=r[c],s=r[c+1];if(e>=o&&e<=s)return c;e<o?n=c-1:i=c+1}return i<=0?0:-1},_indexFromOffset:function(t){var e={x:t.x,y:t.y},i=this._dataSource,n=i.numberOfCellsInTableView(this)-1;this._vOrdering===cc.TABLEVIEW_FILL_TOPDOWN&&(e.y=this.getContainer().getContentSize().height-e.y);var r=this.__indexFromOffset(e);return r!==-1&&(r=Math.max(0,r),r>n&&(r=cc.INVALID_INDEX)),r},__offsetFromIndex:function(t){var e;switch(this.getDirection()){case cc.SCROLLVIEW_DIRECTION_HORIZONTAL:e=cc.p(this._cellsPositions[t],0);break;default:e=cc.p(0,this._cellsPositions[t])}return e},_offsetFromIndex:function(t){var e=this.__offsetFromIndex(t),i=this._dataSource.tableCellSizeForIndex(this,t);return this._vOrdering===cc.TABLEVIEW_FILL_TOPDOWN&&(e.y=this.getContainer().getContentSize().height-e.y-i.height),e},_updateCellPositions:function(){var t=this._dataSource.numberOfCellsInTableView(this),e=this._cellsPositions;if(t>0){for(var i,n=0,r=this._dataSource,c=0;c<t;c++)switch(e[c]=n,i=r.tableCellSizeForIndex(this,c),this.getDirection()){case cc.SCROLLVIEW_DIRECTION_HORIZONTAL:n+=i.width;break;default:n+=i.height}this._cellsPositions[t]=n}},_updateContentSize:function(){var t=cc.size(0,0),e=this._dataSource.numberOfCellsInTableView(this);if(e>0){var i=this._cellsPositions[e];switch(this.getDirection()){case cc.SCROLLVIEW_DIRECTION_HORIZONTAL:t=cc.size(i,this._viewSize.height);break;default:t=cc.size(this._viewSize.width,i)}}this.setContentSize(t),this._oldDirection!==this._direction&&(this._direction===cc.SCROLLVIEW_DIRECTION_HORIZONTAL?this.setContentOffset(cc.p(0,0)):this.setContentOffset(cc.p(0,this.minContainerOffset().y)),this._oldDirection=this._direction)},_moveCellOutOfSight:function(t){this._tableViewDelegate&&this._tableViewDelegate.tableCellWillRecycle&&this._tableViewDelegate.tableCellWillRecycle(this,t),this._cellsFreed.addObject(t),this._cellsUsed.removeSortedObject(t),cc.arrayRemoveObject(this._indices,t.getIdx()),t.reset(),t.getParent()===this.getContainer()&&this.getContainer().removeChild(t,!0)},_setIndexForCell:function(t,e){e.setAnchorPoint(0,0),e.setPosition(this._offsetFromIndex(t)),e.setIdx(t)},_addCellIfNecessary:function(t){t.getParent()!==this.getContainer()&&this.getContainer().addChild(t),this._cellsUsed.insertSortedObject(t);var e=this._indices,i=t.getIdx();e.indexOf(i)===-1&&(e.push(i),e.sort(function(t,e){return t-e}))},getDataSource:function(){return this._dataSource},setDataSource:function(t){this._dataSource=t},getDelegate:function(){return this._tableViewDelegate},setDelegate:function(t){this._tableViewDelegate=t},setVerticalFillOrder:function(t){this._vOrdering!==t&&(this._vOrdering=t,this._cellsUsed.count()>0&&this.reloadData())},getVerticalFillOrder:function(){return this._vOrdering},initWithViewSize:function(t,e){return!!cc.ScrollView.prototype.initWithViewSize.call(this,t,e)&&(this._cellsUsed=new cc.ArrayForObjectSorting,this._cellsFreed=new cc.ArrayForObjectSorting,this._indices=[],this._tableViewDelegate=null,this._vOrdering=cc.TABLEVIEW_FILL_BOTTOMUP,this.setDirection(cc.SCROLLVIEW_DIRECTION_VERTICAL),cc.ScrollView.prototype.setDelegate.call(this,this),!0)},updateCellAtIndex:function(t){if(!(t===cc.INVALID_INDEX||t>this._dataSource.numberOfCellsInTableView(this)-1)){var e=this.cellAtIndex(t);e&&this._moveCellOutOfSight(e),e=this._dataSource.tableCellAtIndex(this,t),this._setIndexForCell(t,e),this._addCellIfNecessary(e)}},insertCellAtIndex:function(t){if(!(t===cc.INVALID_INDEX||t>this._dataSource.numberOfCellsInTableView(this)-1)){var e,i=this._cellsUsed,n=i.objectWithObjectID(t);if(n){e=i.indexOfSortedObject(n);for(var r=e;r<i.count();r++)n=i.objectAtIndex(r),this._setIndexForCell(n.getIdx()+1,n)}n=this._dataSource.tableCellAtIndex(this,t),this._setIndexForCell(t,n),this._addCellIfNecessary(n),this._updateCellPositions(),this._updateContentSize()}},removeCellAtIndex:function(t){if(!(t===cc.INVALID_INDEX||t>this._dataSource.numberOfCellsInTableView(this)-1)){var e=this.cellAtIndex(t);if(e){var i=this._cellsUsed,n=i.indexOfSortedObject(e);
this._moveCellOutOfSight(e),cc.arrayRemoveObject(this._indices,t),this._updateCellPositions();for(var r=i.count()-1;r>n;r--)e=i.objectAtIndex(r),this._setIndexForCell(e.getIdx()-1,e)}}},reloadData:function(){this._oldDirection=cc.SCROLLVIEW_DIRECTION_NONE;for(var t=this._cellsUsed,e=this._cellsFreed,i=this.getContainer(),n=0,r=t.count();n<r;n++){var c=t.objectAtIndex(n);this._tableViewDelegate&&this._tableViewDelegate.tableCellWillRecycle&&this._tableViewDelegate.tableCellWillRecycle(this,c),e.addObject(c),c.reset(),c.getParent()===i&&i.removeChild(c,!0)}this._indices=[],this._cellsUsed=new cc.ArrayForObjectSorting,this._updateCellPositions(),this._updateContentSize(),this._dataSource.numberOfCellsInTableView(this)>0&&this.scrollViewDidScroll(this),this.setNodeDirty()},dequeueCell:function(){if(0===this._cellsFreed.count())return null;var t=this._cellsFreed.objectAtIndex(0);return this._cellsFreed.removeObjectAtIndex(0),t},cellAtIndex:function(t){var e=this._indices.indexOf(t);return e===-1?null:this._cellsUsed.objectWithObjectID(t)},scrollViewDidScroll:function(t){var e=this._dataSource,i=e.numberOfCellsInTableView(this);if(0!==i){null!==this._tableViewDelegate&&this._tableViewDelegate.scrollViewDidScroll&&this._tableViewDelegate.scrollViewDidScroll(this);var n=0,r=this._viewSize,c=this.getContainer(),o=this.getContentOffset();o.x*=-1,o.y*=-1;var s=Math.max(i-1,0);this._vOrdering===cc.TABLEVIEW_FILL_TOPDOWN&&(o.y=o.y+r.height/c.getScaleY());var a=this._indexFromOffset(o);a===cc.INVALID_INDEX&&(a=i-1),this._vOrdering===cc.TABLEVIEW_FILL_TOPDOWN?o.y-=r.height/c.getScaleY():o.y+=r.height/c.getScaleY(),o.x+=r.width/c.getScaleX();var h=this._indexFromOffset(o);h===cc.INVALID_INDEX&&(h=i-1);var l,u=this._cellsUsed;if(u.count()>0)for(l=u.objectAtIndex(0),n=l.getIdx();n<a&&(this._moveCellOutOfSight(l),u.count()>0);)l=u.objectAtIndex(0),n=l.getIdx();if(u.count()>0)for(l=u.lastObject(),n=l.getIdx();n<=s&&n>h&&(this._moveCellOutOfSight(l),u.count()>0);)l=u.lastObject(),n=l.getIdx();for(var _=this._indices,d=a;d<=h;d++)_.indexOf(d)===-1&&this.updateCellAtIndex(d)}},scrollViewDidZoom:function(t){},onTouchEnded:function(t,e){if(this.isVisible()){if(this._touchedCell){var i=this.getBoundingBox(),n=cc.p(i.x,i.y);n=this._parent.convertToWorldSpace(n),i.x=n.x,i.y=n.y;var r=this._tableViewDelegate;cc.rectContainsPoint(i,t.getLocation())&&null!==r&&(r.tableCellUnhighlight&&r.tableCellUnhighlight(this,this._touchedCell),r.tableCellTouched&&r.tableCellTouched(this,this._touchedCell)),this._touchedCell=null}cc.ScrollView.prototype.onTouchEnded.call(this,t,e)}},onTouchBegan:function(t,e){for(var i=this;null!=i;i=i.parent)if(!i.isVisible())return!1;var n=cc.ScrollView.prototype.onTouchBegan.call(this,t,e);if(1===this._touches.length){var r,c;c=this.getContainer().convertTouchToNodeSpace(t),r=this._indexFromOffset(c),r===cc.INVALID_INDEX?this._touchedCell=null:this._touchedCell=this.cellAtIndex(r),this._touchedCell&&null!==this._tableViewDelegate&&this._tableViewDelegate.tableCellHighlight&&this._tableViewDelegate.tableCellHighlight(this,this._touchedCell)}else this._touchedCell&&(null!==this._tableViewDelegate&&this._tableViewDelegate.tableCellUnhighlight&&this._tableViewDelegate.tableCellUnhighlight(this,this._touchedCell),this._touchedCell=null);return n},onTouchMoved:function(t,e){cc.ScrollView.prototype.onTouchMoved.call(this,t,e),this._touchedCell&&this.isTouchMoved()&&(null!==this._tableViewDelegate&&this._tableViewDelegate.tableCellUnhighlight&&this._tableViewDelegate.tableCellUnhighlight(this,this._touchedCell),this._touchedCell=null)},onTouchCancelled:function(t,e){cc.ScrollView.prototype.onTouchCancelled.call(this,t,e),this._touchedCell&&(null!==this._tableViewDelegate&&this._tableViewDelegate.tableCellUnhighlight&&this._tableViewDelegate.tableCellUnhighlight(this,this._touchedCell),this._touchedCell=null)}});var _p=cc.TableView.prototype;_p.dataSource,cc.defineGetterSetter(_p,"dataSource",_p.getDataSource,_p.setDataSource),_p.delegate,cc.defineGetterSetter(_p,"delegate",_p.getDelegate,_p.setDelegate),_p.verticalFillOrder,cc.defineGetterSetter(_p,"verticalFillOrder",_p.getVerticalFillOrder,_p.setVerticalFillOrder),_p=null,cc.TableView.create=function(t,e,i){return new cc.TableView(t,e,i)},function(){cc.ScrollView.WebGLRenderCmd=function(t){cc.Layer.WebGLRenderCmd.call(this,t),this._needDraw=!1,this.startCmd=new cc.CustomRenderCmd(this,this._startCmd),this.endCmd=new cc.CustomRenderCmd(this,this._endCmd)};var t=cc.ScrollView.WebGLRenderCmd.prototype=Object.create(cc.Layer.WebGLRenderCmd.prototype);t.constructor=cc.ScrollView.WebGLRenderCmd,t._startCmd=function(){var t=this._node,e=cc.view,i=t._getViewRect();if(e.isScissorEnabled()){if(t._scissorRestored=!0,t._parentScissorRect=e.getScissorRect(),cc.rectIntersection(i,t._parentScissorRect)){var n=t._parentScissorRect,r=Math.max(i.x,n.x),c=Math.max(i.y,n.y),o=Math.min(i.x+i.width,n.x+n.width),s=Math.min(i.y+i.height,n.y+n.height);e.setScissorInPoints(r,c,o-r,s-c)}}else{var a=cc._renderContext;a.enable(a.SCISSOR_TEST),e.setScissorInPoints(i.x,i.y,i.width,i.height)}},t._endCmd=function(){var t=this._node;if(t._scissorRestored){var e=t._parentScissorRect;cc.view.setScissorInPoints(e.x,e.y,e.width,e.height)}else{var i=cc._renderContext;i.disable(i.SCISSOR_TEST)}},t.visit=function(t){var e=this._node;if(e._visible){var i,n,r,c=e._children;if(this._syncStatus(t),e._clippingToBounds&&cc.renderer.pushRenderCommand(this.startCmd),c&&c.length>0){for(r=c.length,i=0;i<r&&(n=c[i],n&&n._localZOrder<0);i++)n._renderCmd.visit();for(;i<r;i++)c[i]._renderCmd.visit()}e._clippingToBounds&&cc.renderer.pushRenderCommand(this.endCmd),this._dirtyFlag=0}}}(),function(){var t={_ignoreBodyRotation:!1,_body:null,_rotation:1,ctor:function(t,e){if(cc.Sprite.prototype.ctor.call(this),void 0===t)cc.PhysicsSprite.prototype.init.call(this);else if(cc.isString(t))if("#"===t[0]){var i=t.substr(1,t.length-1),n=cc.spriteFrameCache.getSpriteFrame(i);this.initWithSpriteFrame(n)}else this.init(t,e);else cc.isObject(t)&&(t instanceof cc.Texture2D?this.initWithTexture(t,e):t instanceof cc.SpriteFrame&&this.initWithSpriteFrame(t));cc.renderer.pushRenderCommand(this._renderCmd)},visit:function(){cc.renderer.pushRenderCommand(this._renderCmd),cc.Sprite.prototype.visit.call(this)},setBody:function(t){this._body=t},getBody:function(){return this._body},getPosition:function(){var t=this._body;return{x:t.p.x,y:t.p.y}},getPositionX:function(){return this._body.p.x},getPositionY:function(){return this._body.p.y},setPosition:function(t,e){void 0===e?(this._body.p.x=t.x,this._body.p.y=t.y):(this._body.p.x=t,this._body.p.y=e)},setPositionX:function(t){this._body.p.x=t},setPositionY:function(t){this._body.p.y=t},_syncPosition:function(){var t=this._position,e=this._body;t.x===e.p.x&&t.y===e.p.y||cc.Sprite.prototype.setPosition.call(this,e.p.x,e.p.y)},getRotation:function(){return this._ignoreBodyRotation?this._rotationX:-cc.radiansToDegrees(this._body.a)},setRotation:function(t){this._ignoreBodyRotation?cc.Sprite.prototype.setRotation.call(this,t):this._body.a=-cc.degreesToRadians(t)},_syncRotation:function(){var t=-cc.radiansToDegrees(this._body.a);this._rotationX!==t&&cc.Sprite.prototype.setRotation.call(this,t)},getNodeToParentTransform:function(){return this._renderCmd.getNodeToParentTransform()},isDirty:function(){return!this._body.isSleeping()},setDirty:function(){},setIgnoreBodyRotation:function(t){this._ignoreBodyRotation=t},_createRenderCmd:function(){return cc._renderType===cc.game.RENDER_TYPE_CANVAS?new cc.PhysicsSprite.CanvasRenderCmd(this):new cc.PhysicsSprite.WebGLRenderCmd(this)}};cc.PhysicsSprite=cc.Sprite.extend(t),cc.PhysicsSprite._className="PhysicsSprite";var e=cc.PhysicsSprite.prototype;e.body,cc.defineGetterSetter(e,"body",e.getBody,e.setBody),e.dirty,cc.defineGetterSetter(e,"dirty",e.isDirty,e.setDirty),cc.PhysicsSprite.create=function(t,e){return new cc.PhysicsSprite(t,e)},cc.PhysicsSprite.createWithSpriteFrameName=cc.PhysicsSprite.create,cc.PhysicsSprite.createWithSpriteFrame=cc.PhysicsSprite.create}(),function(){cc.PhysicsSprite.CanvasRenderCmd=function(t){cc.Sprite.CanvasRenderCmd.call(this,t),this._needDraw=!0};var t=cc.PhysicsSprite.CanvasRenderCmd.prototype=Object.create(cc.Sprite.CanvasRenderCmd.prototype);t.constructor=cc.PhysicsSprite.CanvasRenderCmd,t.rendering=function(t,e,i){var n=this._node;n._syncPosition(),n._ignoreBodyRotation||n._syncRotation(),this.transform(this.getParentRenderCmd()),cc.Sprite.CanvasRenderCmd.prototype.rendering.call(this,t,e,i)}}(),cc.__convertVerts=function(t){for(var e=[],i=0;i<t.length/2;i++)e[i]={x:t[2*i],y:t[2*i+1]};return e},cc.ColorForBody=function(t){return t.isRogue()||t.isSleeping()?cc.color(128,128,128,128):t.nodeIdleTime>t.space.sleepTimeThreshold?cc.color(84,84,84,128):cc.color(255,0,0,128)},cc.DrawShape=function(t,e){var i=t.body,n=cc.ColorForBody(i);switch(t.collisionCode){case cp.CircleShape.prototype.collisionCode:this.drawDot(t.tc,Math.max(t.r,1),n),this.drawSegment(t.tc,cp.v.add(t.tc,cp.v.mult(i.rot,t.r)),1,n);break;case cp.SegmentShape.prototype.collisionCode:this.drawSegment(t.ta,t.tb,Math.max(t.r,2),n);break;case cp.PolyShape.prototype.collisionCode:var r=cc.color(n.r,n.g,n.b,cc.lerp(n.a,255,.5));this.drawPoly(cc.__convertVerts(t.tVerts),n,1,r);break;default:cc.log("cc.DrawShape(): Bad assertion in DrawShape()")}},cc.DrawConstraint=function(t,e){var i,n,r=t.a,c=t.b;if(t instanceof cp.PinJoint)i=r.local2World(t.anchr1),n=c.local2World(t.anchr2),this.drawDot(i,3,cc.CONSTRAINT_COLOR),this.drawDot(n,3,cc.CONSTRAINT_COLOR),this.drawSegment(i,n,1,cc.CONSTRAINT_COLOR);else if(t instanceof cp.SlideJoint)i=r.local2World(t.anchr1),n=c.local2World(t.anchr2),this.drawDot(i,3,cc.CONSTRAINT_COLOR),this.drawDot(n,3,cc.CONSTRAINT_COLOR),this.drawSegment(i,n,1,cc.CONSTRAINT_COLOR);else if(t instanceof cp.PivotJoint)i=r.local2World(t.anchr1),n=c.local2World(t.anchr2),this.drawDot(i,3,cc.CONSTRAINT_COLOR),this.drawDot(n,3,cc.CONSTRAINT_COLOR);else if(t instanceof cp.GrooveJoint){i=r.local2World(t.grv_a),n=r.local2World(t.grv_b);var o=c.local2World(t.anchr2);this.drawDot(o,3,cc.CONSTRAINT_COLOR),this.drawSegment(i,n,1,cc.CONSTRAINT_COLOR)}else t instanceof cp.DampedSpring},cc.CONSTRAINT_COLOR=cc.color(0,255,0,128),cc.PhysicsDebugNode=cc.DrawNode.extend({_space:null,_className:"PhysicsDebugNode",ctor:function(t){cc.DrawNode.prototype.ctor.call(this),this._space=t},getSpace:function(){return this._space},setSpace:function(t){this._space=t},draw:function(t){this._space&&(this._space.eachShape(cc.DrawShape.bind(this)),this._space.eachConstraint(cc.DrawConstraint.bind(this)),cc.DrawNode.prototype.draw.call(this),this.clear())},_createRenderCmd:function(){return cc._renderType===cc.game.RENDER_TYPE_CANVAS?new cc.PhysicsDebugNode.CanvasRenderCmd(this):new cc.PhysicsDebugNode.WebGLRenderCmd(this)}}),cc.PhysicsDebugNode.create=function(t){return new cc.PhysicsDebugNode(t)},function(){cc.PhysicsDebugNode.CanvasRenderCmd=function(t){cc.Node.CanvasRenderCmd.call(this,t),this._buffer=t._buffer,this._needDraw=!0};var t=cc.PhysicsDebugNode.CanvasRenderCmd.prototype=Object.create(cc.Node.CanvasRenderCmd.prototype);t.constructor=cc.PhysicsDebugNode.CanvasRenderCmd,t.rendering=function(t,e,i){var n=this._node;n._space&&(n._space.eachShape(cc.DrawShape.bind(n)),n._space.eachConstraint(cc.DrawConstraint.bind(n)),cc.DrawNode.CanvasRenderCmd.prototype.rendering.call(this,t,e,i),n.clear())},t._drawDot=cc.DrawNode.CanvasRenderCmd.prototype._drawDot,t._drawSegment=cc.DrawNode.CanvasRenderCmd.prototype._drawSegment,t._drawPoly=cc.DrawNode.CanvasRenderCmd.prototype._drawPoly}(),function(){cc.PhysicsDebugNode.WebGLRenderCmd=function(t){cc.Node.WebGLRenderCmd.call(this,t),this._needDraw=!0,this._matrix=new cc.math.Matrix4,this._matrix.identity()},cc.PhysicsDebugNode.WebGLRenderCmd.prototype=Object.create(cc.Node.WebGLRenderCmd.prototype),cc.PhysicsDebugNode.WebGLRenderCmd.prototype.constructor=cc.PhysicsDebugNode.WebGLRenderCmd,cc.PhysicsDebugNode.WebGLRenderCmd.prototype.rendering=function(t){var e=this._node;if(e._space){e._space.eachShape(cc.DrawShape.bind(e)),e._space.eachConstraint(cc.DrawConstraint.bind(e));var i=this._worldTransform;this._matrix.mat[0]=i.a,this._matrix.mat[4]=i.c,this._matrix.mat[12]=i.tx,this._matrix.mat[1]=i.b,this._matrix.mat[5]=i.d,this._matrix.mat[13]=i.ty,cc.glBlendFunc(e._blendFunc.src,e._blendFunc.dst),this._shaderProgram.use(),this._shaderProgram._setUniformForMVPMatrixWithMat4(this._matrix),e._render(),e.clear()}}}(),function(){cc.PhysicsSprite.WebGLRenderCmd=function(t){cc.Sprite.WebGLRenderCmd.call(this,t),this._needDraw=!0};var t=cc.PhysicsSprite.WebGLRenderCmd.prototype=Object.create(cc.Sprite.WebGLRenderCmd.prototype);t.constructor=cc.PhysicsSprite.WebGLRenderCmd,t.spUploadData=cc.Sprite.WebGLRenderCmd.prototype.uploadData,t.uploadData=function(t,e,i){var n=this._node;return n._syncPosition(),n._ignoreBodyRotation||n._syncRotation(),this.transform(this.getParentRenderCmd(),!0),this.spUploadData(t,e,i)}}(),define("cocos",function(t){return function(){var e;return e||t.cc}}(this)),function(){Object.create=Object.create||function(t){function e(){}return e.prototype=t,new e};var t;"undefined"==typeof exports?(t={},"object"==typeof window&&(window.cp=t)):t=exports;var e,i,n=function(t,e){if(!t)throw new Error("Assertion failed: "+e)},r=function(t,e){!t&&console&&console.warn&&(console.warn("ASSERTION FAILED: "+e),console.trace&&console.trace())},c=function(t,e){return t<e?t:e},o=function(t,e){return t>e?t:e};"object"==typeof window&&window.navigator.userAgent.indexOf("Firefox")>-1?(e=Math.min,i=Math.max):(e=c,i=o);var s=function(t,e){return t<e?t+" "+e:e+" "+t},a=function(t,e){for(var i=0;i<t.length;i++)if(t[i]===e)return t[i]=t[t.length-1],void t.length--},h=function(t,e,i){var n=b(e,i),r=g(T(n,b(t,i))/F(n));return E(i,A(n,r))},l=function(t,e,i,n,r,c){var o=i-r,s=n-c,a=g(y(o,s,t-r,e-c)/D(o,s));return new m(r+o*a,c+s*a)};t.momentForCircle=function(t,e,i,n){return t*(.5*(e*e+i*i)+F(n))},t.areaForCircle=function(t,e){return Math.PI*Math.abs(t*t-e*e)},t.momentForSegment=function(t,e,i){var n=A(E(e,i),.5);return t*(G(i,e)/12+F(n))},t.areaForSegment=function(t,e,i){return i*(Math.PI*i+2*V(t,e))},t.momentForPoly=function(t,e,i){for(var n=0,r=0,c=e.length,o=0;o<c;o+=2){var s=e[o]+i.x,a=e[o+1]+i.y,h=e[(o+2)%c]+i.x,l=e[(o+3)%c]+i.y,u=w(h,l,s,a),_=y(s,a,s,a)+y(s,a,h,l)+y(h,l,h,l);n+=u*_,r+=u}return t*n/(6*r)},t.areaForPoly=function(t){for(var e=0,i=0,n=t.length;i<n;i+=2)e+=R(new m(t[i],t[i+1]),new m(t[(i+2)%n],t[(i+3)%n]));return-e/2},t.centroidForPoly=function(t){for(var e=0,i=new m(0,0),n=0,r=t.length;n<r;n+=2){var c=new m(t[n],t[n+1]),o=new m(t[(n+2)%r],t[(n+3)%r]),s=R(c,o);e+=s,i=E(i,A(E(c,o),s))}return A(i,1/(3*e))},t.recenterPoly=function(e){for(var i=t.centroidForPoly(e),n=0;n<e.length;n+=2)e[n]-=i.x,e[n+1]-=i.y},t.momentForBox=function(t,e,i){return t*(e*e+i*i)/12},t.momentForBox2=function(e,i){var n=i.r-i.l,r=i.t-i.b,c=A([i.l+i.r,i.b+i.t],.5);return t.momentForBox(e,n,r)+e*F(c)};var u=t.loopIndexes=function(t){var e,i,n,r,c=0,o=0;e=n=t[0],i=r=t[1];for(var s=t.length>>1,a=1;a<s;a++){var h=t[2*a],l=t[2*a+1];h<e||h==e&&l<i?(e=h,i=l,c=a):(h>n||h==n&&l>r)&&(n=h,r=l,o=a)}return[c,o]},_=function(t,e,i){var n=t[2*e];t[2*e]=t[2*i],t[2*i]=n,n=t[2*e+1],t[2*e+1]=t[2*i+1],t[2*i+1]=n},d=function(t,e,i,n,r,c){if(0===i)return 0;for(var o=0,s=e,a=b(r,n),h=c*S(a),l=e,u=e+i-1;l<=u;){var d=new m(t[2*l],t[2*l+1]),f=R(a,b(d,n));f>h?(f>o&&(o=f,s=l),l++):(_(t,l,u),u--)}return s!=e&&_(t,e,s),l-e},f=function(t,e,i,n,r,c,o,s){if(n<0)return 0;if(0==n)return e[2*s]=c.x,e[2*s+1]=c.y,1;var a=d(e,i,n,r,c,t),h=new m(e[2*i],e[2*i+1]),l=f(t,e,i+1,a-1,r,h,c,s),u=s+l++;e[2*u]=c.x,e[2*u+1]=c.y;var _=d(e,i+a,n-a,c,o,t),p=new m(e[2*(i+a)],e[2*(i+a)+1]);return l+f(t,e,i+a+1,_-1,c,p,o,s+l)};t.convexHull=function(t,e,i){if(e)for(var n=0;n<t.length;n++)e[n]=t[n];else e=t;var c=u(t),o=c[0],s=c[1];if(o==s)return e.length=2,e;_(e,0,o),_(e,1,0==s?o:s);var a=new m(e[0],e[1]),h=new m(e[2],e[3]),l=t.length>>1,d=f(i,e,2,l-2,a,h,a,1)+1;return e.length=2*d,r(tt(e),"Internal error: cpConvexHull() and cpPolyValidate() did not agree.Please report this error with as much info as you can."),e};var p=function(t,n,r){return e(i(t,n),r)},g=function(t){return i(0,e(t,1))},m=t.Vect=function(t,e){this.x=t,this.y=e};t.v=function(t,e){return new m(t,e)};var v=t.vzero=new m(0,0),T=t.v.dot=function(t,e){return t.x*e.x+t.y*e.y},y=function(t,e,i,n){return t*i+e*n},S=t.v.len=function(t){return Math.sqrt(T(t,t))},C=t.v.len2=function(t,e){return Math.sqrt(t*t+e*e)},E=(t.v.eql=function(t,e){return t.x===e.x&&t.y===e.y},t.v.add=function(t,e){return new m(t.x+e.x,t.y+e.y)});m.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this};var b=t.v.sub=function(t,e){return new m(t.x-e.x,t.y-e.y)};m.prototype.sub=function(t){return this.x-=t.x,this.y-=t.y,this};var x=t.v.neg=function(t){return new m(-t.x,-t.y)};m.prototype.neg=function(){return this.x=-this.x,this.y=-this.y,this};var A=t.v.mult=function(t,e){return new m(t.x*e,t.y*e)};m.prototype.mult=function(t){return this.x*=t,this.y*=t,this};var R=t.v.cross=function(t,e){return t.x*e.y-t.y*e.x},w=function(t,e,i,n){return t*n-e*i},I=t.v.perp=function(t){return new m(-t.y,t.x)},L=(t.v.pvrperp=function(t){return new m(t.y,-t.x)},t.v.project=function(t,e){return A(e,T(t,e)/F(e))});m.prototype.project=function(t){return this.mult(T(this,t)/F(t)),this};var O=t.v.rotate=function(t,e){return new m(t.x*e.x-t.y*e.y,t.x*e.y+t.y*e.x)};m.prototype.rotate=function(t){return this.x=this.x*t.x-this.y*t.y,this.y=this.x*t.y+this.y*t.x,this};var P=t.v.unrotate=function(t,e){return new m(t.x*e.x+t.y*e.y,t.y*e.x-t.x*e.y)},F=t.v.lengthsq=function(t){return T(t,t)},D=t.v.lengthsq2=function(t,e){return t*t+e*e},N=t.v.lerp=function(t,e,i){return E(A(t,1-i),A(e,i))},B=t.v.normalize=function(t){return A(t,1/S(t))},M=t.v.normalize_safe=function(t){return 0===t.x&&0===t.y?v:B(t)},W=t.v.clamp=function(t,e){return T(t,t)>e*e?A(B(t),e):t},V=(t.v.lerpconst=function(t,e,i){return E(t,W(b(e,t),i))},t.v.dist=function(t,e){return S(b(t,e))}),G=t.v.distsq=function(t,e){return F(b(t,e))},U=(t.v.near=function(t,e,i){return G(t,e)<i*i},t.v.slerp=function(t,e,i){var n=Math.acos(T(t,e));if(n){var r=1/Math.sin(n);return E(A(t,Math.sin((1-i)*n)*r),A(e,Math.sin(i*n)*r))}return t}),k=(t.v.slerpconst=function(t,i,n){var r=Math.acos(T(t,i));return U(t,i,e(n,r)/r)},t.v.forangle=function(t){return new m(Math.cos(t),Math.sin(t))},t.v.toangle=function(t){return Math.atan2(t.y,t.x)},t.v.str=function(t){return"("+t.x.toFixed(3)+", "+t.y.toFixed(3)+")"},0),z=t.BB=function(t,e,i,n){this.l=t,this.b=e,this.r=i,this.t=n,k++};t.bb=function(t,e,i,n){return new z(t,e,i,n)};var X=function(t,e){return new z(t.x-e,t.y-e,t.x+e,t.y+e)},Y=function(t,e,i,n,r){return t.l<=n&&e<=t.r&&t.b<=r&&i<=t.t},H=0,j=(t.NO_GROUP=0,t.ALL_LAYERS=-1);t.ALL_CATEGORIES=-1;t.resetShapeIdCounter=function(){H=0};var Q=t.Shape=function(t){this.body=t,this.bb_l=this.bb_b=this.bb_r=this.bb_t=0,this.hashid=H++,this.sensor=!1,this.e=0,this.u=0,this.surface_v=v,this.collision_type=0,this.group=0,this.layers=j,this.space=null,this.collisionCode=this.collisionCode};Q.prototype.setElasticity=function(t){this.e=t},Q.prototype.setFriction=function(t){this.body.activate(),this.u=t},Q.prototype.setLayers=function(t){this.body.activate(),this.layers=t},Q.prototype.setSensor=function(t){this.body.activate(),this.sensor=t},Q.prototype.setCollisionType=function(t){this.body.activate(),this.collision_type=t},Q.prototype.getBody=function(){return this.body},Q.prototype.active=function(){return this.body&&this.body.shapeList.indexOf(this)!==-1},Q.prototype.setBody=function(t){n(!this.active(),"You cannot change the body on an active shape. You must remove the shape from the space before changing the body."),this.body=t},Q.prototype.cacheBB=function(){return this.update(this.body.p,this.body.rot)},Q.prototype.update=function(t,e){n(!isNaN(e.x),"Rotation is NaN"),n(!isNaN(t.x),"Position is NaN"),this.cacheData(t,e)},Q.prototype.pointQuery=function(t){var e=this.nearestPointQuery(t);if(e.d<0)return e},Q.prototype.getBB=function(){return new z(this.bb_l,this.bb_b,this.bb_r,this.bb_t)};var q=function(t,e,i){this.shape=t,this.p=e,this.d=i},K=function(t,e,i){this.shape=t,this.t=e,this.n=i};K.prototype.hitPoint=function(t,e){return N(t,e,this.t)},K.prototype.hitDist=function(t,e){return V(t,e)*this.t};var Z=t.CircleShape=function(t,e,i){this.c=this.tc=i,this.r=e,this.type="circle",Q.call(this,t)};Z.prototype=Object.create(Q.prototype),Z.prototype.cacheData=function(t,e){var i=this.tc=O(this.c,e).add(t),n=this.r;this.bb_l=i.x-n,this.bb_b=i.y-n,this.bb_r=i.x+n,this.bb_t=i.y+n},Z.prototype.nearestPointQuery=function(t){var e=t.x-this.tc.x,i=t.y-this.tc.y,n=C(e,i),r=this.r,c=new m(this.tc.x+e*r/n,this.tc.y+i*r/n);return new q(this,c,n-r)};var J=function(t,e,i,n,r,c){n=b(n,e),r=b(r,e);var o=T(n,n)-2*T(n,r)+T(r,r),s=-2*T(n,n)+2*T(n,r),a=T(n,n)-i*i,h=s*s-4*o*a;if(h>=0){var l=(-s-Math.sqrt(h))/(2*o);if(0<=l&&l<=1)return new K(t,l,B(N(n,r,l)))}};Z.prototype.segmentQuery=function(t,e){return J(this,this.tc,this.r,t,e)};var $=t.SegmentShape=function(t,e,i,n){this.a=e,this.b=i,this.n=I(B(b(i,e))),this.ta=this.tb=this.tn=null,this.r=n,this.a_tangent=v,this.b_tangent=v,this.type="segment",Q.call(this,t)};$.prototype=Object.create(Q.prototype),$.prototype.cacheData=function(t,e){this.ta=E(t,O(this.a,e)),this.tb=E(t,O(this.b,e)),this.tn=O(this.n,e);var i,n,r,c;this.ta.x<this.tb.x?(i=this.ta.x,n=this.tb.x):(i=this.tb.x,n=this.ta.x),this.ta.y<this.tb.y?(r=this.ta.y,c=this.tb.y):(r=this.tb.y,c=this.ta.y);var o=this.r;this.bb_l=i-o,this.bb_b=r-o,this.bb_r=n+o,this.bb_t=c+o},$.prototype.nearestPointQuery=function(t){var e=h(t,this.ta,this.tb),i=t.x-e.x,n=t.y-e.y,r=C(i,n),c=this.r,o=r?E(e,A(new m(i,n),c/r)):e;return new q(this,o,r-c)},$.prototype.segmentQuery=function(t,e){var i=this.tn,n=T(b(this.ta,t),i),r=this.r,c=n>0?x(i):i,o=b(A(c,r),t),s=E(this.ta,o),a=E(this.tb,o),h=b(e,t);if(R(h,s)*R(h,a)<=0){var l=n+(n>0?-r:r),u=-l,_=T(h,i)-l;if(u*_<0)return new K(this,u/(u-_),c)}else if(0!==r){var d=J(this,this.ta,this.r,t,e),f=J(this,this.tb,this.r,t,e);return d?f&&f.t<d.t?f:d:f}},$.prototype.setNeighbors=function(t,e){this.a_tangent=b(t,this.a),this.b_tangent=b(e,this.b)},$.prototype.setEndpoints=function(t,e){this.a=t,this.b=e,this.n=I(B(b(e,t)))};var tt=function(t){for(var e=t.length,i=0;i<e;i+=2){var n=t[i],r=t[i+1],c=t[(i+2)%e],o=t[(i+3)%e],s=t[(i+4)%e],a=t[(i+5)%e];if(w(c-n,o-r,s-c,a-o)>0)return!1}return!0},et=t.PolyShape=function(t,e,i){this.setVerts(e,i),this.type="poly",Q.call(this,t)};et.prototype=Object.create(Q.prototype);var it=function(t,e){this.n=t,this.d=e};it.prototype.compare=function(t){return T(this.n,t)-this.d},et.prototype.setVerts=function(t,e){n(t.length>=4,"Polygons require some verts"),n("number"==typeof t[0],"Polygon verticies should be specified in a flattened list (eg [x1,y1,x2,y2,x3,y3,...])"),n(tt(t),"Polygon is concave or has a reversed winding. Consider using cpConvexHull()");var i=t.length,r=i>>1;this.verts=new Array(i),this.tVerts=new Array(i),this.planes=new Array(r),this.tPlanes=new Array(r);for(var c=0;c<i;c+=2){var o=t[c]+e.x,s=t[c+1]+e.y,a=t[(c+2)%i]+e.x,h=t[(c+3)%i]+e.y,l=B(I(new m(a-o,h-s)));this.verts[c]=o,this.verts[c+1]=s,this.planes[c>>1]=new it(l,y(l.x,l.y,o,s)),this.tPlanes[c>>1]=new it(new m(0,0),0)}};var nt=(t.BoxShape=function(t,e,i){var n=e/2,r=i/2;return nt(t,new z(-n,-r,n,r))},t.BoxShape2=function(t,e){var i=[e.l,e.b,e.l,e.t,e.r,e.t,e.r,e.b];return new et(t,i,v)});et.prototype.transformVerts=function(t,n){for(var r=this.verts,c=this.tVerts,o=1/0,s=-(1/0),a=1/0,h=-(1/0),l=0;l<r.length;l+=2){var u=r[l],_=r[l+1],d=t.x+u*n.x-_*n.y,f=t.y+u*n.y+_*n.x;c[l]=d,c[l+1]=f,o=e(o,d),s=i(s,d),a=e(a,f),h=i(h,f)}this.bb_l=o,this.bb_b=a,this.bb_r=s,this.bb_t=h},et.prototype.transformAxes=function(t,e){for(var i=this.planes,n=this.tPlanes,r=0;r<i.length;r++){var c=O(i[r].n,e);n[r].n=c,n[r].d=T(t,c)+i[r].d}},et.prototype.cacheData=function(t,e){this.transformAxes(t,e),this.transformVerts(t,e)},et.prototype.nearestPointQuery=function(t){for(var e=this.tPlanes,i=this.tVerts,n=i[i.length-2],r=i[i.length-1],c=1/0,o=v,s=!1,a=0;a<e.length;a++){e[a].compare(t)>0&&(s=!0);var h=i[2*a],u=i[2*a+1],_=l(t.x,t.y,n,r,h,u),d=V(t,_);d<c&&(c=d,o=_),n=h,r=u}return new q(this,o,s?c:-c)},et.prototype.segmentQuery=function(t,e){for(var i=this.tPlanes,n=this.tVerts,r=i.length,c=2*r,o=0;o<r;o++){var s=i[o].n,a=T(t,s);if(!(i[o].d>a)){var h=T(e,s),l=(i[o].d-a)/(h-a);if(!(l<0||1<l)){var u=N(t,e,l),_=-R(s,u),d=-w(s.x,s.y,n[2*o],n[2*o+1]),f=-w(s.x,s.y,n[(2*o+2)%c],n[(2*o+3)%c]);if(d<=_&&_<=f)return new K(this,l,s)}}}},et.prototype.valueOnAxis=function(t,i){for(var n=this.tVerts,r=y(t.x,t.y,n[0],n[1]),c=2;c<n.length;c+=2)r=e(r,y(t.x,t.y,n[c],n[c+1]));return r-i},et.prototype.containsVert=function(t,e){for(var i=this.tPlanes,n=0;n<i.length;n++){var r=i[n].n,c=y(r.x,r.y,t,e)-i[n].d;if(c>0)return!1}return!0},et.prototype.containsVertPartial=function(t,e,i){for(var n=this.tPlanes,r=0;r<n.length;r++){var c=n[r].n;if(!(T(c,i)<0)){var o=y(c.x,c.y,t,e)-n[r].d;if(o>0)return!1}}return!0},et.prototype.getNumVerts=function(){return this.verts.length/2},et.prototype.getCount=et.prototype.getNumVerts,et.prototype.getVert=function(t){return new m(this.verts[2*t],this.verts[2*t+1])};var rt=t.Body=function(t,e){this.p=new m(0,0),this.vx=this.vy=0,this.f=new m(0,0),this.w=0,this.t=0,this.v_limit=1/0,this.w_limit=1/0,this.v_biasx=this.v_biasy=0,this.w_bias=0,this.space=null,this.shapeList=[],this.arbiterList=null,this.constraintList=null,this.nodeRoot=null,this.nodeNext=null,this.nodeIdleTime=0,this.setMass(t),this.setMoment(e),this.rot=new m(0,0),this.setAngle(0)},ct=function(){var t=new rt(1/0,1/0);return t.nodeIdleTime=1/0,t};if(t.StaticBody=ct,"undefined"!=typeof DEBUG&&DEBUG){var ot=function(t,e){n(t.x==t.x&&t.y==t.y,e)},st=function(t,e){n(Math.abs(t.x)!==1/0&&Math.abs(t.y)!==1/0,e)},at=function(t,e){ot(t,e),st(t,e)};rt.prototype.sanityCheck=function(){n(this.m===this.m&&this.m_inv===this.m_inv,"Body's mass is invalid."),n(this.i===this.i&&this.i_inv===this.i_inv,"Body's moment is invalid."),at(this.p,"Body's position is invalid."),at(this.f,"Body's force is invalid."),n(this.vx===this.vx&&Math.abs(this.vx)!==1/0,"Body's velocity is invalid."),n(this.vy===this.vy&&Math.abs(this.vy)!==1/0,"Body's velocity is invalid."),n(this.a===this.a&&Math.abs(this.a)!==1/0,"Body's angle is invalid."),n(this.w===this.w&&Math.abs(this.w)!==1/0,"Body's angular velocity is invalid."),n(this.t===this.t&&Math.abs(this.t)!==1/0,"Body's torque is invalid."),at(this.rot,"Body's rotation vector is invalid."),n(this.v_limit===this.v_limit,"Body's velocity limit is invalid."),n(this.w_limit===this.w_limit,"Body's angular velocity limit is invalid.")}}else rt.prototype.sanityCheck=function(){};rt.prototype.getPos=function(){return this.p},rt.prototype.getVel=function(){return new m(this.vx,this.vy)},rt.prototype.getAngVel=function(){return this.w},rt.prototype.getPosition=rt.prototype.getPos,rt.prototype.getVelocity=rt.prototype.getVel,rt.prototype.getAngularVelocity=rt.prototype.getAngVel,rt.prototype.getCenterOfGravity=function(){return this.p},rt.prototype.isSleeping=function(){return null!==this.nodeRoot},rt.prototype.isStatic=function(){return this.nodeIdleTime===1/0},rt.prototype.isRogue=function(){return null===this.space},rt.prototype.setMass=function(t){n(t>0,"Mass must be positive and non-zero."),this.activate(),this.m=t,this.m_inv=1/t},rt.prototype.setMoment=function(t){n(t>0,"Moment of Inertia must be positive and non-zero."),this.activate(),this.i=t,this.i_inv=1/t},rt.prototype.addShape=function(t){this.shapeList.push(t)},rt.prototype.removeShape=function(t){a(this.shapeList,t)};var ht=function(t,e,i){return t===i?t.next(e):(t.a===e?t.next_a=ht(t.next_a,e,i):t.next_b=ht(t.next_b,e,i),t)};rt.prototype.removeConstraint=function(t){this.constraintList=ht(this.constraintList,this,t)},rt.prototype.setPos=function(e){this.activate(),this.sanityCheck(),e===v&&(e=t.v(0,0)),this.p=e},rt.prototype.setVel=function(t){this.activate(),this.vx=t.x,this.vy=t.y},rt.prototype.setAngVel=function(t){this.activate(),this.w=t},rt.prototype.setAngleInternal=function(t){n(!isNaN(t),"Internal Error: Attempting to set body's angle to NaN"),this.a=t,this.rot.x=Math.cos(t),this.rot.y=Math.sin(t)},rt.prototype.setAngle=function(t){this.activate(),this.sanityCheck(),this.setAngleInternal(t)},rt.prototype.velocity_func=function(t,e,i){var n=this.vx*e+(t.x+this.f.x*this.m_inv)*i,r=this.vy*e+(t.y+this.f.y*this.m_inv)*i,c=this.v_limit,o=n*n+r*r,s=o>c*c?c/Math.sqrt(o):1;this.vx=n*s,this.vy=r*s;var a=this.w_limit;this.w=p(this.w*e+this.t*this.i_inv*i,-a,a),this.sanityCheck()},rt.prototype.position_func=function(t){this.p.x+=(this.vx+this.v_biasx)*t,this.p.y+=(this.vy+this.v_biasy)*t,this.setAngleInternal(this.a+(this.w+this.w_bias)*t),this.v_biasx=this.v_biasy=0,this.w_bias=0,this.sanityCheck()},rt.prototype.resetForces=function(){this.activate(),this.f=new m(0,0),this.t=0},rt.prototype.applyForce=function(t,e){this.activate(),this.f=E(this.f,t),this.t+=R(e,t)},rt.prototype.applyImpulse=function(t,e){this.activate(),ue(this,t.x,t.y,e)},rt.prototype.getVelAtPoint=function(t){return E(new m(this.vx,this.vy),A(I(t),this.w))},rt.prototype.getVelAtWorldPoint=function(t){return this.getVelAtPoint(b(t,this.p))},rt.prototype.getVelAtLocalPoint=function(t){return this.getVelAtPoint(O(t,this.rot))},rt.prototype.eachShape=function(t){for(var e=0,i=this.shapeList.length;e<i;e++)t(this.shapeList[e])},rt.prototype.eachConstraint=function(t){for(var e=this.constraintList;e;){var i=e.next(this);t(e),e=i}},rt.prototype.eachArbiter=function(t){for(var e=this.arbiterList;e;){var i=e.next(this);e.swappedColl=this===e.body_b,t(e),e=i}},rt.prototype.local2World=function(t){return E(this.p,O(t,this.rot))},rt.prototype.world2Local=function(t){return P(b(t,this.p),this.rot)},rt.prototype.localToWorld=rt.prototype.local2World,rt.prototype.worldToLocal=rt.prototype.world2Local,rt.prototype.kineticEnergy=function(){var t=this.vx*this.vx+this.vy*this.vy,e=this.w*this.w;return(t?t*this.m:0)+(e?e*this.i:0)};var lt=t.SpatialIndex=function(t){if(this.staticIndex=t,t){if(t.dynamicIndex)throw new Error("This static index is already associated with a dynamic index.");t.dynamicIndex=this}};lt.prototype.collideStatic=function(t,e){if(t.count>0){var i=t.query;this.each(function(t){i(t,new z(t.bb_l,t.bb_b,t.bb_r,t.bb_t),e)})}};var ut=t.BBTree=function(t){lt.call(this,t),this.velocityFunc=null,this.leaves={},this.count=0,this.root=null,this.pooledNodes=null,this.pooledPairs=null,this.stamp=0};ut.prototype=Object.create(lt.prototype);var _t=0,dt=function(t,n,r){this.obj=null,this.bb_l=e(n.bb_l,r.bb_l),this.bb_b=e(n.bb_b,r.bb_b),this.bb_r=i(n.bb_r,r.bb_r),this.bb_t=i(n.bb_t,r.bb_t),this.parent=null,this.setA(n),this.setB(r)};ut.prototype.makeNode=function(t,e){var i=this.pooledNodes;return i?(this.pooledNodes=i.parent,i.constructor(this,t,e),i):(_t++,new dt(this,t,e))};var ft=0,pt=function(t,e){this.obj=e,t.getBB(e,this),this.parent=null,this.stamp=1,this.pairs=null,ft++};ut.prototype.getBB=function(t,n){var r=this.velocityFunc;if(r){var c=.1,o=(t.bb_r-t.bb_l)*c,s=(t.bb_t-t.bb_b)*c,a=A(r(t),.1);n.bb_l=t.bb_l+e(-o,a.x),n.bb_b=t.bb_b+e(-s,a.y),n.bb_r=t.bb_r+i(o,a.x),n.bb_t=t.bb_t+i(s,a.y)}else n.bb_l=t.bb_l,n.bb_b=t.bb_b,n.bb_r=t.bb_r,n.bb_t=t.bb_t},ut.prototype.getStamp=function(){var t=this.dynamicIndex;return t&&t.stamp?t.stamp:this.stamp},ut.prototype.incrementStamp=function(){this.dynamicIndex&&this.dynamicIndex.stamp?this.dynamicIndex.stamp++:this.stamp++};var gt=0,mt=function(t,e,i,n){this.prevA=null,this.leafA=t,this.nextA=e,this.prevB=null,this.leafB=i,this.nextB=n};ut.prototype.makePair=function(t,e,i,n){var r=this.pooledPairs;return r?(this.pooledPairs=r.prevA,r.prevA=null,r.leafA=t,r.nextA=e,r.prevB=null,r.leafB=i,r.nextB=n,r):(gt++,new mt(t,e,i,n))},mt.prototype.recycle=function(t){this.prevA=t.pooledPairs,
t.pooledPairs=this};var vt=function(t,e,i){i&&(i.leafA===e?i.prevA=t:i.prevB=t),t?t.leafA===e?t.nextA=i:t.nextB=i:e.pairs=i};pt.prototype.clearPairs=function(t){var e,i=this.pairs;for(this.pairs=null;i;)i.leafA===this?(e=i.nextA,vt(i.prevB,i.leafB,i.nextB)):(e=i.nextB,vt(i.prevA,i.leafA,i.nextA)),i.recycle(t),i=e};var Tt=function(t,e,i){var n=t.pairs,r=e.pairs,c=i.makePair(t,n,e,r);t.pairs=e.pairs=c,n&&(n.leafA===t?n.prevA=c:n.prevB=c),r&&(r.leafA===e?r.prevA=c:r.prevB=c)};dt.prototype.recycle=function(t){this.parent=t.pooledNodes,t.pooledNodes=this},pt.prototype.recycle=function(t){},dt.prototype.setA=function(t){this.A=t,t.parent=this},dt.prototype.setB=function(t){this.B=t,t.parent=this},pt.prototype.isLeaf=!0,dt.prototype.isLeaf=!1,dt.prototype.otherChild=function(t){return this.A==t?this.B:this.A},dt.prototype.replaceChild=function(t,n,c){r(t==this.A||t==this.B,"Node is not a child of parent."),this.A==t?(this.A.recycle(c),this.setA(n)):(this.B.recycle(c),this.setB(n));for(var o=this;o;o=o.parent){var s=o.A,a=o.B;o.bb_l=e(s.bb_l,a.bb_l),o.bb_b=e(s.bb_b,a.bb_b),o.bb_r=i(s.bb_r,a.bb_r),o.bb_t=i(s.bb_t,a.bb_t)}},dt.prototype.bbArea=pt.prototype.bbArea=function(){return(this.bb_r-this.bb_l)*(this.bb_t-this.bb_b)};var yt=function(t,n){return(i(t.bb_r,n.bb_r)-e(t.bb_l,n.bb_l))*(i(t.bb_t,n.bb_t)-e(t.bb_b,n.bb_b))},St=function(t,e){return Math.abs(t.bb_l+t.bb_r-e.bb_l-e.bb_r)+Math.abs(t.bb_b+t.bb_t-e.bb_b-e.bb_t)},Ct=function(t,n,r){if(null==t)return n;if(t.isLeaf)return r.makeNode(n,t);var c=t.B.bbArea()+yt(t.A,n),o=t.A.bbArea()+yt(t.B,n);return c===o&&(c=St(t.A,n),o=St(t.B,n)),o<c?t.setB(Ct(t.B,n,r)):t.setA(Ct(t.A,n,r)),t.bb_l=e(t.bb_l,n.bb_l),t.bb_b=e(t.bb_b,n.bb_b),t.bb_r=i(t.bb_r,n.bb_r),t.bb_t=i(t.bb_t,n.bb_t),t};dt.prototype.intersectsBB=pt.prototype.intersectsBB=function(t){return this.bb_l<=t.r&&t.l<=this.bb_r&&this.bb_b<=t.t&&t.b<=this.bb_t};var Et=function(t,e,i){t.intersectsBB(e)&&(t.isLeaf?i(t.obj):(Et(t.A,e,i),Et(t.B,e,i)))},bt=function(t,n,r){var c=1/(r.x-n.x),o=t.bb_l==n.x?-(1/0):(t.bb_l-n.x)*c,s=t.bb_r==n.x?1/0:(t.bb_r-n.x)*c,a=e(o,s),h=i(o,s),l=1/(r.y-n.y),u=t.bb_b==n.y?-(1/0):(t.bb_b-n.y)*l,_=t.bb_t==n.y?1/0:(t.bb_t-n.y)*l,d=e(u,_),f=i(u,_);if(d<=h&&a<=f){var p=i(a,d),g=e(h,f);if(0<=g&&p<=1)return i(p,0)}return 1/0},xt=function(t,i,n,r,c){if(t.isLeaf)return c(t.obj);var o=bt(t.A,i,n),s=bt(t.B,i,n);return o<s?(o<r&&(r=e(r,xt(t.A,i,n,r,c))),s<r&&(r=e(r,xt(t.B,i,n,r,c)))):(s<r&&(r=e(r,xt(t.B,i,n,r,c))),o<r&&(r=e(r,xt(t.A,i,n,r,c)))),r};ut.prototype.subtreeRecycle=function(t){t.isLeaf&&(this.subtreeRecycle(t.A),this.subtreeRecycle(t.B),t.recycle(this))};var At=function(t,e,i){if(e==t)return null;var n=e.parent;if(n==t){var r=t.otherChild(e);return r.parent=t.parent,t.recycle(i),r}return n.parent.replaceChild(n,n.otherChild(e),i),t},Rt=function(t,e){return t.bb_l<=e.bb_r&&e.bb_l<=t.bb_r&&t.bb_b<=e.bb_t&&e.bb_b<=t.bb_t};pt.prototype.markLeafQuery=function(t,e,i,n){Rt(t,this)&&(e?Tt(t,this,i):(this.stamp<t.stamp&&Tt(this,t,i),n&&n(t.obj,this.obj)))},dt.prototype.markLeafQuery=function(t,e,i,n){Rt(t,this)&&(this.A.markLeafQuery(t,e,i,n),this.B.markLeafQuery(t,e,i,n))},pt.prototype.markSubtree=function(t,e,i){if(this.stamp==t.getStamp()){e&&e.markLeafQuery(this,!1,t,i);for(var n=this;n.parent;n=n.parent)n==n.parent.A?n.parent.B.markLeafQuery(this,!0,t,i):n.parent.A.markLeafQuery(this,!1,t,i)}else for(var r=this.pairs;r;)this===r.leafB?(i&&i(r.leafA.obj,this.obj),r=r.nextB):r=r.nextA},dt.prototype.markSubtree=function(t,e,i){this.A.markSubtree(t,e,i),this.B.markSubtree(t,e,i)},pt.prototype.containsObj=function(t){return this.bb_l<=t.bb_l&&this.bb_r>=t.bb_r&&this.bb_b<=t.bb_b&&this.bb_t>=t.bb_t},pt.prototype.update=function(t){var e=t.root,i=this.obj;return!this.containsObj(i)&&(t.getBB(this.obj,this),e=At(e,this,t),t.root=Ct(e,this,t),this.clearPairs(t),this.stamp=t.getStamp(),!0)},pt.prototype.addPairs=function(t){var e=t.dynamicIndex;if(e){var i=e.root;i&&i.markLeafQuery(this,!0,e,null)}else{var n=t.staticIndex.root;this.markSubtree(t,n,null)}},ut.prototype.insert=function(t,e){var i=new pt(this,t);this.leaves[e]=i,this.root=Ct(this.root,i,this),this.count++,i.stamp=this.getStamp(),i.addPairs(this),this.incrementStamp()},ut.prototype.remove=function(t,e){var i=this.leaves[e];delete this.leaves[e],this.root=At(this.root,i,this),this.count--,i.clearPairs(this),i.recycle(this)},ut.prototype.contains=function(t,e){return null!=this.leaves[e]};var wt=function(t,e){};ut.prototype.reindexQuery=function(t){if(this.root){var e,i=this.leaves;for(e in i)i[e].update(this);var n=this.staticIndex,r=n&&n.root;this.root.markSubtree(this,r,t),n&&!r&&this.collideStatic(this,n,t),this.incrementStamp()}},ut.prototype.reindex=function(){this.reindexQuery(wt)},ut.prototype.reindexObject=function(t,e){var i=this.leaves[e];i&&(i.update(this)&&i.addPairs(this),this.incrementStamp())},ut.prototype.pointQuery=function(t,e){this.query(new z(t.x,t.y,t.x,t.y),e)},ut.prototype.segmentQuery=function(t,e,i,n){this.root&&xt(this.root,t,e,i,n)},ut.prototype.query=function(t,e){this.root&&Et(this.root,t,e)},ut.prototype.count=function(){return this.count},ut.prototype.each=function(t){var e;for(e in this.leaves)t(this.leaves[e].obj)};var It=function(t,n,r,c,o){return(i(t.bb_r,c)-e(t.bb_l,n))*(i(t.bb_t,o)-e(t.bb_b,r))},Lt=function(t,n,r,c){if(1==c)return n[r];if(2==c)return t.makeNode(n[r],n[r+1]);for(var o=n[r],s=o.bb_l,a=o.bb_b,h=o.bb_r,l=o.bb_t,u=r+c,_=r+1;_<u;_++)o=n[_],s=e(s,o.bb_l),a=e(a,o.bb_b),h=i(h,o.bb_r),l=i(l,o.bb_t);var d=h-s>l-a,f=new Array(2*c);if(d)for(var _=r;_<u;_++)f[2*_+0]=n[_].bb_l,f[2*_+1]=n[_].bb_r;else for(var _=r;_<u;_++)f[2*_+0]=n[_].bb_b,f[2*_+1]=n[_].bb_t;f.sort(function(t,e){return t-e});var p=.5*(f[c-1]+f[c]),g=s,m=a,v=h,T=l,y=s,S=a,C=h,E=l;d?v=y=p:T=S=p;for(var b=u,x=r;x<b;){var o=n[x];It(o,y,S,C,E)<It(o,g,m,v,T)?(b--,n[x]=n[b],n[b]=o):x++}if(b==c){for(var o=null,_=r;_<u;_++)o=Ct(o,n[_],t);return o}return NodeNew(t,Lt(t,n,r,b-r),Lt(t,n,b,u-b))};ut.prototype.optimize=function(){var t=new Array(this.count),e=0;for(var i in this.leaves)t[e++]=this.nodes[i];tree.subtreeRecycle(root),this.root=Lt(tree,t,t.length)};var Ot=function(t,e){!t.isLeaf&&e<=10&&(Ot(t.A,e+1),Ot(t.B,e+1));for(var i="",n=0;n<e;n++)i+=" ";console.log(i+t.bb_b+" "+t.bb_t)};ut.prototype.log=function(){this.root&&Ot(this.root,0)};var Pt=t.CollisionHandler=function(){this.a=this.b=0};Pt.prototype.begin=function(t,e){return!0},Pt.prototype.preSolve=function(t,e){return!0},Pt.prototype.postSolve=function(t,e){},Pt.prototype.separate=function(t,e){};var Ft=function(t,e){this.e=0,this.u=0,this.surface_vr=v,this.a=t,this.body_a=t.body,this.b=e,this.body_b=e.body,this.thread_a_next=this.thread_a_prev=null,this.thread_b_next=this.thread_b_prev=null,this.contacts=null,this.stamp=0,this.handler=null,this.swappedColl=!1,this.state="first coll"};Ft.prototype.getShapes=function(){return this.swappedColl?[this.b,this.a]:[this.a,this.b]},Ft.prototype.totalImpulse=function(){for(var t=this.contacts,e=new m(0,0),i=0,n=t.length;i<n;i++){var r=t[i];e.add(A(r.n,r.jnAcc))}return this.swappedColl?e:e.neg()},Ft.prototype.totalImpulseWithFriction=function(){for(var t=this.contacts,e=new m(0,0),i=0,n=t.length;i<n;i++){var r=t[i];e.add(new m(r.jnAcc,r.jtAcc).rotate(r.n))}return this.swappedColl?e:e.neg()},Ft.prototype.totalKE=function(){for(var t=(1-this.e)/(1+this.e),e=0,i=this.contacts,n=0,r=i.length;n<r;n++){var c=i[n],o=c.jnAcc,s=c.jtAcc;e+=t*o*o/c.nMass+s*s/c.tMass}return e},Ft.prototype.ignore=function(){this.state="ignore"},Ft.prototype.getA=function(){return this.swappedColl?this.b:this.a},Ft.prototype.getB=function(){return this.swappedColl?this.a:this.b},Ft.prototype.isFirstContact=function(){return"first coll"===this.state};var Dt=function(t,e,i){this.point=t,this.normal=e,this.dist=i};Ft.prototype.getContactPointSet=function(){var t,e=new Array(this.contacts.length);for(t=0;t<e.length;t++)e[t]=new Dt(this.contacts[t].p,this.contacts[t].n,this.contacts[t].dist);return e},Ft.prototype.getNormal=function(t){var e=this.contacts[t].n;return this.swappedColl?x(e):e},Ft.prototype.getPoint=function(t){return this.contacts[t].p},Ft.prototype.getDepth=function(t){return this.contacts[t].dist};var Nt=function(t,e,i,n){i?i.body_a===e?i.thread_a_next=n:i.thread_b_next=n:e.arbiterList=n,n&&(n.body_a===e?n.thread_a_prev=i:n.thread_b_prev=i)};Ft.prototype.unthread=function(){Nt(this,this.body_a,this.thread_a_prev,this.thread_a_next),Nt(this,this.body_b,this.thread_b_prev,this.thread_b_next),this.thread_a_prev=this.thread_a_next=null,this.thread_b_prev=this.thread_b_next=null},Ft.prototype.update=function(t,e,i,n){if(this.contacts)for(var r=0;r<this.contacts.length;r++)for(var c=this.contacts[r],o=0;o<t.length;o++){var s=t[o];s.hash===c.hash&&(s.jnAcc=c.jnAcc,s.jtAcc=c.jtAcc)}this.contacts=t,this.handler=e,this.swappedColl=i.collision_type!==e.a,this.e=i.e*n.e,this.u=i.u*n.u,this.surface_vr=b(i.surface_v,n.surface_v),this.a=i,this.body_a=i.body,this.b=n,this.body_b=n.body,"cached"==this.state&&(this.state="first coll")},Ft.prototype.preStep=function(t,i,n){for(var r=this.body_a,c=this.body_b,o=0;o<this.contacts.length;o++){var s=this.contacts[o];s.r1=b(s.p,r.p),s.r2=b(s.p,c.p),s.nMass=1/pe(r,c,s.r1,s.r2,s.n),s.tMass=1/pe(r,c,s.r1,s.r2,I(s.n)),s.bias=-n*e(0,s.dist+i)/t,s.jBias=0,s.bounce=le(r,c,s.r1,s.r2,s.n)*this.e}},Ft.prototype.applyCachedImpulse=function(t){if(!this.isFirstContact())for(var e=this.body_a,i=this.body_b,n=0;n<this.contacts.length;n++){var r=this.contacts[n],c=r.n.x,o=r.n.y,s=c*r.jnAcc-o*r.jtAcc,a=c*r.jtAcc+o*r.jnAcc;_e(e,i,r.r1,r.r2,s*t,a*t)}};var Bt=0,Mt=0;Ft.prototype.applyImpulse=function(){Bt++;for(var t=this.body_a,e=this.body_b,n=this.surface_vr,r=this.u,c=0;c<this.contacts.length;c++){Mt++;var o=this.contacts[c],s=o.nMass,a=o.n,h=o.r1,l=o.r2,u=e.vx-l.y*e.w-(t.vx-h.y*t.w),_=e.vy+l.x*e.w-(t.vy+h.x*t.w),d=a.x*(e.v_biasx-l.y*e.w_bias-t.v_biasx+h.y*t.w_bias)+a.y*(l.x*e.w_bias+e.v_biasy-h.x*t.w_bias-t.v_biasy),f=y(u,_,a.x,a.y),g=y(u+n.x,_+n.y,-a.y,a.x),m=(o.bias-d)*s,v=o.jBias;o.jBias=i(v+m,0);var T=-(o.bounce+f)*s,S=o.jnAcc;o.jnAcc=i(S+T,0);var C=r*o.jnAcc,E=-g*o.tMass,b=o.jtAcc;o.jtAcc=p(b+E,-C,C);var x=a.x*(o.jBias-v),A=a.y*(o.jBias-v);de(t,-x,-A,h),de(e,x,A,l);var R=o.jnAcc-S,w=o.jtAcc-b;_e(t,e,h,l,a.x*R-a.y*w,a.x*w+a.y*R)}},Ft.prototype.callSeparate=function(t){var e=t.lookupHandler(this.a.collision_type,this.b.collision_type);e.separate(this,t)},Ft.prototype.next=function(t){return this.body_a==t?this.thread_a_next:this.thread_b_next};var Wt=0,Vt=function(t,e,i,n){this.p=t,this.n=e,this.dist=i,this.r1=this.r2=v,this.nMass=this.tMass=this.bounce=this.bias=0,this.jnAcc=this.jtAcc=this.jBias=0,this.hash=n,Wt++},Gt=[],Ut=function(t,e,i,n){var r=i+n,c=b(e,t),o=F(c);if(!(o>=r*r)){var s=Math.sqrt(o);return new Vt(E(t,A(c,.5+(i-.5*r)/(s?s:1/0))),s?A(c,1/s):new m(1,0),s-r,0)}},kt=function(t,e){var i=Ut(t.tc,e.tc,t.r,e.r);return i?[i]:Gt},zt=function(t,e){var i=e.ta,n=e.tb,r=t.tc,c=b(n,i),o=g(T(c,b(r,i))/F(c)),s=E(i,A(c,o)),a=Ut(r,s,t.r,e.r);if(a){var h=a.n;return 0===o&&T(h,e.a_tangent)<0||1===o&&T(h,e.b_tangent)<0?Gt:[a]}return Gt},Xt=0,Yt=function(t,e){var i=0,n=t.valueOnAxis(e[0].n,e[0].d);if(n>0)return-1;for(var r=1;r<e.length;r++){var c=t.valueOnAxis(e[r].n,e[r].d);if(c>0)return-1;c>n&&(n=c,i=r)}return Xt=n,i},Ht=function(t,e,i,n){for(var r=[],c=t.tVerts,o=0;o<c.length;o+=2){var a=c[o],h=c[o+1];e.containsVertPartial(a,h,x(i))&&r.push(new Vt(new m(a,h),i,n,s(t.hashid,o)))}for(var l=e.tVerts,o=0;o<l.length;o+=2){var a=l[o],h=l[o+1];t.containsVertPartial(a,h,i)&&r.push(new Vt(new m(a,h),i,n,s(e.hashid,o)))}return r},jt=function(t,e,i,n){for(var r=[],c=t.tVerts,o=0;o<c.length;o+=2){var a=c[o],h=c[o+1];e.containsVert(a,h)&&r.push(new Vt(new m(a,h),i,n,s(t.hashid,o>>1)))}for(var l=e.tVerts,o=0;o<l.length;o+=2){var a=l[o],h=l[o+1];t.containsVert(a,h)&&r.push(new Vt(new m(a,h),i,n,s(e.hashid,o>>1)))}return r.length?r:Ht(t,e,i,n)},Qt=function(t,e){var i=Yt(e,t.tPlanes);if(i==-1)return Gt;var n=Xt,r=Yt(t,e.tPlanes);if(r==-1)return Gt;var c=Xt;return n>c?jt(t,e,t.tPlanes[i].n,n):jt(t,e,x(e.tPlanes[r].n),c)},qt=function(t,i,n){var r=T(i,t.ta)-t.r,c=T(i,t.tb)-t.r;return e(r,c)-n},Kt=function(t,e,i,n,r){for(var c=R(e.tn,e.ta),o=R(e.tn,e.tb),a=A(e.tn,r),h=i.tVerts,l=0;l<h.length;l+=2){var u=h[l],_=h[l+1];if(y(u,_,a.x,a.y)<T(e.tn,e.ta)*r+e.r){var d=w(e.tn.x,e.tn.y,u,_);c>=d&&d>=o&&t.push(new Vt(new m(u,_),a,n,s(i.hashid,l)))}}},Zt=function(t,e){var i=[],n=e.tPlanes,r=n.length,c=T(t.tn,t.ta),o=e.valueOnAxis(t.tn,c)-t.r,a=e.valueOnAxis(x(t.tn),-c)-t.r;if(a>0||o>0)return Gt;var h=0,l=qt(t,n[0].n,n[0].d);if(l>0)return Gt;for(var u=0;u<r;u++){var _=qt(t,n[u].n,n[u].d);if(_>0)return Gt;_>l&&(l=_,h=u)}var d=x(n[h].n),f=E(t.ta,A(d,t.r)),p=E(t.tb,A(d,t.r));if(e.containsVert(f.x,f.y)&&i.push(new Vt(f,d,l,s(t.hashid,0))),e.containsVert(p.x,p.y)&&i.push(new Vt(p,d,l,s(t.hashid,1))),(o>=l||a>=l)&&(o>a?Kt(i,t,e,o,1):Kt(i,t,e,a,-1)),0===i.length){var g,v=2*h,y=e.tVerts,S=new m(y[v],y[v+1]);if(g=Ut(t.ta,S,t.r,0,i))return[g];if(g=Ut(t.tb,S,t.r,0,i))return[g];var C=2*r,b=new m(y[(v+2)%C],y[(v+3)%C]);if(g=Ut(t.ta,b,t.r,0,i))return[g];if(g=Ut(t.tb,b,t.r,0,i))return[g]}return i},Jt=function(t,e){for(var i=e.tPlanes,n=0,r=T(i[0].n,t.tc)-i[0].d-t.r,c=0;c<i.length;c++){var o=T(i[c].n,t.tc)-i[c].d-t.r;if(o>0)return Gt;o>r&&(r=o,n=c)}var s=i[n].n,a=e.tVerts,h=a.length,l=n<<1,u=a[l],_=a[l+1],d=a[(l+2)%h],f=a[(l+3)%h],p=w(s.x,s.y,u,_),g=w(s.x,s.y,d,f),v=R(s,t.tc);if(v<g){var y=Ut(t.tc,new m(d,f),t.r,0,y);return y?[y]:Gt}if(v<p)return[new Vt(b(t.tc,A(s,t.r+r/2)),x(s),r,0)];var y=Ut(t.tc,new m(u,_),t.r,0,y);return y?[y]:Gt};Z.prototype.collisionCode=0,$.prototype.collisionCode=1,et.prototype.collisionCode=2,Z.prototype.collisionTable=[kt,zt,Jt],$.prototype.collisionTable=[null,function(t,e){return Gt},Zt],et.prototype.collisionTable=[null,null,Qt];var $t=t.collideShapes=function(t,e){return n(t.collisionCode<=e.collisionCode,"Collided shapes must be sorted by type"),t.collisionTable[e.collisionCode](t,e)},te=new Pt,ee=t.Space=function(){this.stamp=0,this.curr_dt=0,this.bodies=[],this.rousedBodies=[],this.sleepingComponents=[],this.staticShapes=new ut(null),this.activeShapes=new ut(this.staticShapes),this.arbiters=[],this.contactBuffersHead=null,this.cachedArbiters={},this.constraints=[],this.locked=0,this.collisionHandlers={},this.defaultHandler=te,this.postStepCallbacks=[],this.iterations=10,this.gravity=v,this.damping=1,this.idleSpeedThreshold=0,this.sleepTimeThreshold=1/0,this.collisionSlop=.1,this.collisionBias=Math.pow(.9,60),this.collisionPersistence=3,this.enableContactGraph=!1,this.staticBody=new rt(1/0,1/0),this.staticBody.nodeIdleTime=1/0,this.collideShapes=this.makeCollideShapes()};ee.prototype.getCurrentTimeStep=function(){return this.curr_dt},ee.prototype.setIterations=function(t){this.iterations=t},ee.prototype.isLocked=function(){return this.locked};var ie=function(t){n(!t.locked,"This addition/removal cannot be done safely during a call to cpSpaceStep()  or during a query. Put these calls into a post-step callback.")};ee.prototype.addCollisionHandler=function(t,e,i,n,r,c){ie(this),this.removeCollisionHandler(t,e);var o=new Pt;o.a=t,o.b=e,i&&(o.begin=i),n&&(o.preSolve=n),r&&(o.postSolve=r),c&&(o.separate=c),this.collisionHandlers[s(t,e)]=o},ee.prototype.removeCollisionHandler=function(t,e){ie(this),delete this.collisionHandlers[s(t,e)]},ee.prototype.setDefaultCollisionHandler=function(t,e,i,n){ie(this);var r=new Pt;t&&(r.begin=t),e&&(r.preSolve=e),i&&(r.postSolve=i),n&&(r.separate=n),this.defaultHandler=r},ee.prototype.lookupHandler=function(t,e){return this.collisionHandlers[s(t,e)]||this.defaultHandler},ee.prototype.addShape=function(t){var e=t.body;return e.isStatic()?this.addStaticShape(t):(n(!t.space,"This shape is already added to a space and cannot be added to another."),ie(this),e.activate(),e.addShape(t),t.update(e.p,e.rot),this.activeShapes.insert(t,t.hashid),t.space=this,t)},ee.prototype.addStaticShape=function(t){n(!t.space,"This shape is already added to a space and cannot be added to another."),ie(this);var e=t.body;return e.addShape(t),t.update(e.p,e.rot),this.staticShapes.insert(t,t.hashid),t.space=this,t},ee.prototype.addBody=function(t){return n(!t.isStatic(),"Static bodies cannot be added to a space as they are not meant to be simulated."),n(!t.space,"This body is already added to a space and cannot be added to another."),ie(this),this.bodies.push(t),t.space=this,t},ee.prototype.addConstraint=function(t){n(!t.space,"This shape is already added to a space and cannot be added to another."),ie(this);var e=t.a,i=t.b;return e.activate(),i.activate(),this.constraints.push(t),t.next_a=e.constraintList,e.constraintList=t,t.next_b=i.constraintList,i.constraintList=t,t.space=this,t},ee.prototype.filterArbiters=function(t,e){for(var i in this.cachedArbiters){var n=this.cachedArbiters[i];(t!==n.body_a||e!==n.a&&null!==e)&&(t!==n.body_b||e!==n.b&&null!==e)||(e&&"cached"!==n.state&&n.callSeparate(this),n.unthread(),a(this.arbiters,n),delete this.cachedArbiters[i])}},ee.prototype.removeShape=function(t){var e=t.body;e.isStatic()?this.removeStaticShape(t):(n(this.containsShape(t),"Cannot remove a shape that was not added to the space. (Removed twice maybe?)"),ie(this),e.activate(),e.removeShape(t),this.filterArbiters(e,t),this.activeShapes.remove(t,t.hashid),t.space=null)},ee.prototype.removeStaticShape=function(t){n(this.containsShape(t),"Cannot remove a static or sleeping shape that was not added to the space. (Removed twice maybe?)"),ie(this);var e=t.body;e.isStatic()&&e.activateStatic(t),e.removeShape(t),this.filterArbiters(e,t),this.staticShapes.remove(t,t.hashid),t.space=null},ee.prototype.removeBody=function(t){n(this.containsBody(t),"Cannot remove a body that was not added to the space. (Removed twice maybe?)"),ie(this),t.activate(),a(this.bodies,t),t.space=null},ee.prototype.removeConstraint=function(t){n(this.containsConstraint(t),"Cannot remove a constraint that was not added to the space. (Removed twice maybe?)"),ie(this),t.a.activate(),t.b.activate(),a(this.constraints,t),t.a.removeConstraint(t),t.b.removeConstraint(t),t.space=null},ee.prototype.containsShape=function(t){return t.space===this},ee.prototype.containsBody=function(t){return t.space==this},ee.prototype.containsConstraint=function(t){return t.space==this},ee.prototype.uncacheArbiter=function(t){delete this.cachedArbiters[s(t.a.hashid,t.b.hashid)],a(this.arbiters,t)},ee.prototype.eachBody=function(t){this.lock();for(var e=this.bodies,i=0;i<e.length;i++)t(e[i]);for(var n=this.sleepingComponents,i=0;i<n.length;i++)for(var r=n[i],c=r;c;){var o=c.nodeNext;t(c),c=o}this.unlock(!0)},ee.prototype.eachShape=function(t){this.lock(),this.activeShapes.each(t),this.staticShapes.each(t),this.unlock(!0)},ee.prototype.eachConstraint=function(t){this.lock();for(var e=this.constraints,i=0;i<e.length;i++)t(e[i]);this.unlock(!0)},ee.prototype.reindexStatic=function(){n(!this.locked,"You cannot manually reindex objects while the space is locked. Wait until the current query or step is complete."),this.staticShapes.each(function(t){var e=t.body;t.update(e.p,e.rot)}),this.staticShapes.reindex()},ee.prototype.reindexShape=function(t){n(!this.locked,"You cannot manually reindex objects while the space is locked. Wait until the current query or step is complete.");var e=t.body;t.update(e.p,e.rot),this.activeShapes.reindexObject(t,t.hashid),this.staticShapes.reindexObject(t,t.hashid)},ee.prototype.reindexShapesForBody=function(t){for(var e=t.shapeList;e;e=e.next)this.reindexShape(e)},ee.prototype.useSpatialHash=function(t,e){throw new Error("Spatial Hash not implemented.")},ee.prototype.activateBody=function(t){if(n(!t.isRogue(),"Internal error: Attempting to activate a rogue body."),this.locked)this.rousedBodies.indexOf(t)===-1&&this.rousedBodies.push(t);else{this.bodies.push(t);for(var e=0;e<t.shapeList.length;e++){var i=t.shapeList[e];this.staticShapes.remove(i,i.hashid),this.activeShapes.insert(i,i.hashid)}for(var r=t.arbiterList;r;r=r.next(t)){var c=r.body_a;if(t===c||c.isStatic()){var o=r.a,a=r.b;this.cachedArbiters[s(o.hashid,a.hashid)]=r,r.stamp=this.stamp,r.handler=this.lookupHandler(o.collision_type,a.collision_type),this.arbiters.push(r)}}for(var h=t.constraintList;h;h=h.nodeNext){var c=h.a;(t===c||c.isStatic())&&this.constraints.push(h)}}},ee.prototype.deactivateBody=function(t){n(!t.isRogue(),"Internal error: Attempting to deactivate a rogue body."),a(this.bodies,t);for(var e=0;e<t.shapeList.length;e++){var i=t.shapeList[e];this.activeShapes.remove(i,i.hashid),this.staticShapes.insert(i,i.hashid)}for(var r=t.arbiterList;r;r=r.next(t)){var c=r.body_a;(t===c||c.isStatic())&&this.uncacheArbiter(r)}for(var o=t.constraintList;o;o=o.nodeNext){var c=o.a;(t===c||c.isStatic())&&a(this.constraints,o)}};var ne=function(t){return t?t.nodeRoot:null},re=function(t){if(t&&t.isSleeping(t)){n(!t.isRogue(),"Internal Error: componentActivate() called on a rogue body.");for(var e=t.space,i=t;i;){var r=i.nodeNext;i.nodeIdleTime=0,i.nodeRoot=null,i.nodeNext=null,e.activateBody(i),i=r}a(e.sleepingComponents,t)}};rt.prototype.activate=function(){this.isRogue()||(this.nodeIdleTime=0,re(ne(this)))},rt.prototype.activateStatic=function(t){n(this.isStatic(),"Body.activateStatic() called on a non-static body.");for(var e=this.arbiterList;e;e=e.next(this))t&&t!=e.a&&t!=e.b||(e.body_a==this?e.body_b:e.body_a).activate()},rt.prototype.pushArbiter=function(t){r(null===(t.body_a===this?t.thread_a_next:t.thread_b_next),"Internal Error: Dangling contact graph pointers detected. (A)"),r(null===(t.body_a===this?t.thread_a_prev:t.thread_b_prev),"Internal Error: Dangling contact graph pointers detected. (B)");var e=this.arbiterList;r(null===e||null===(e.body_a===this?e.thread_a_prev:e.thread_b_prev),"Internal Error: Dangling contact graph pointers detected. (C)"),t.body_a===this?t.thread_a_next=e:t.thread_b_next=e,e&&(e.body_a===this?e.thread_a_prev=t:e.thread_b_prev=t),this.arbiterList=t};var ce=function(t,e){e.nodeRoot=t,e!==t&&(e.nodeNext=t.nodeNext,t.nodeNext=e)},oe=function(t,e){if(!e.isRogue()){var i=ne(e);if(null==i){ce(t,e);for(var n=e.arbiterList;n;n=n.next(e))oe(t,e==n.body_a?n.body_b:n.body_a);for(var c=e.constraintList;c;c=c.next(e))oe(t,e==c.a?c.b:c.a)}else r(i===t,"Internal Error: Inconsistency detected in the contact graph.")}},se=function(t,e){for(var i=t;i;i=i.nodeNext)if(i.nodeIdleTime<e)return!0;return!1};ee.prototype.processComponents=function(t){for(var e=this.sleepTimeThreshold!==1/0,i=this.bodies,n=0;n<i.length;n++){var c=i[n];r(null===c.nodeNext,"Internal Error: Dangling next pointer detected in contact graph."),r(null===c.nodeRoot,"Internal Error: Dangling root pointer detected in contact graph.")}if(e)for(var o=this.idleSpeedThreshold,s=o?o*o:F(this.gravity)*t*t,n=0;n<i.length;n++){var c=i[n],a=s?c.m*s:0;c.nodeIdleTime=c.kineticEnergy()>a?0:c.nodeIdleTime+t}for(var h=this.arbiters,n=0,l=h.length;n<l;n++){var u=h[n],_=u.body_a,d=u.body_b;e&&((d.isRogue()&&!d.isStatic()||_.isSleeping())&&_.activate(),(_.isRogue()&&!_.isStatic()||d.isSleeping())&&d.activate()),_.pushArbiter(u),d.pushArbiter(u)}if(e){for(var f=this.constraints,n=0;n<f.length;n++){var p=f[n],_=p.a,d=p.b;d.isRogue()&&!d.isStatic()&&_.activate(),_.isRogue()&&!_.isStatic()&&d.activate()}for(var n=0;n<i.length;){var c=i[n];if(null!==ne(c)||(oe(c,c),se(c,this.sleepTimeThreshold)))n++,c.nodeRoot=null,c.nodeNext=null;else{this.sleepingComponents.push(c);for(var g=c;g;g=g.nodeNext)this.deactivateBody(g)}}}},rt.prototype.sleep=function(){this.sleepWithGroup(null)},rt.prototype.sleepWithGroup=function(t){n(!this.isStatic()&&!this.isRogue(),"Rogue and static bodies cannot be put to sleep.");var e=this.space;if(n(e,"Cannot put a rogue body to sleep."),n(!e.locked,"Bodies cannot be put to sleep during a query or a call to cpSpaceStep(). Put these calls into a post-step callback."),n(null===t||t.isSleeping(),"Cannot use a non-sleeping body as a group identifier."),this.isSleeping())return void n(ne(this)===ne(t),"The body is already sleeping and it's group cannot be reassigned.");for(var i=0;i<this.shapeList.length;i++)this.shapeList[i].update(this.p,this.rot);if(e.deactivateBody(this),t){var r=ne(t);this.nodeRoot=r,this.nodeNext=r.nodeNext,this.nodeIdleTime=0,r.nodeNext=this}else this.nodeRoot=this,this.nodeNext=null,this.nodeIdleTime=0,e.sleepingComponents.push(this);a(e.bodies,this)},ee.prototype.activateShapesTouchingShape=function(t){this.sleepTimeThreshold!==1/0&&this.shapeQuery(t,function(t,e){t.body.activate()})},ee.prototype.pointQuery=function(t,e,i,n){var r=function(r){(!r.group||i!==r.group)&&e&r.layers&&r.pointQuery(t)&&n(r)},c=new z(t.x,t.y,t.x,t.y);this.lock(),this.activeShapes.query(c,r),this.staticShapes.query(c,r),this.unlock(!0)},ee.prototype.pointQueryFirst=function(t,e,i){var n=null;return this.pointQuery(t,e,i,function(t){t.sensor||(n=t)}),n},ee.prototype.nearestPointQuery=function(t,e,i,n,r){var c=function(c){if((!c.group||n!==c.group)&&i&c.layers){var o=c.nearestPointQuery(t);o.d<e&&r(c,o.d,o.p)}},o=X(t,e);this.lock(),this.activeShapes.query(o,c),this.staticShapes.query(o,c),this.unlock(!0)},ee.prototype.nearestPointQueryNearest=function(t,e,i,n){var r,c=function(c){if((!c.group||n!==c.group)&&i&c.layers&&!c.sensor){var o=c.nearestPointQuery(t);o.d<e&&(!r||o.d<r.d)&&(r=o)}},o=X(t,e);return this.activeShapes.query(o,c),this.staticShapes.query(o,c),r},t.SHAPE_FILTER_ALL={group:t.NO_GROUP,categories:t.ALL_CATEGORIES,mask:t.ALL_CATEGORIES},ee.prototype.pointQueryNearest=function(t,e,i){var n=this.nearestPointQueryNearest(t,e,i.mask,i.group);return"undefined"!=typeof n&&(n.distance=n.d,n.point=n.p),n},ee.prototype.segmentQuery=function(t,e,i,n,r){var c=function(c){var o;return(!c.group||n!==c.group)&&i&c.layers&&(o=c.segmentQuery(t,e))&&r(c,o.t,o.n),1};this.lock(),this.staticShapes.segmentQuery(t,e,1,c),this.activeShapes.segmentQuery(t,e,1,c),this.unlock(!0)},ee.prototype.segmentQueryFirst=function(e,i,n,r){var c=null,o=function(t){var o;return(!t.group||r!==t.group)&&n&t.layers&&!t.sensor&&(o=t.segmentQuery(e,i))&&(null===c||o.t<c.t)&&(c=o),c?c.t:1};return this.staticShapes.segmentQuery(e,i,1,o),this.activeShapes.segmentQuery(e,i,c?c.t:1,o),c&&"null"!==c&&"undefined"!==c&&(c.normal=c.n,c.alpha=c.t,c.p=c.point=t.v.lerp(e,i,c.t)),c},ee.prototype.bbQuery=function(t,e,i,n){var r=function(r){(!r.group||i!==r.group)&&e&r.layers&&Y(t,r.bb_l,r.bb_b,r.bb_r,r.bb_t)&&n(r)};this.lock(),this.activeShapes.query(t,r),this.staticShapes.query(t,r),this.unlock(!0)},ee.prototype.shapeQuery=function(t,e){var i=t.body;i&&t.update(i.p,i.rot);var n=new z(t.bb_l,t.bb_b,t.bb_r,t.bb_t),r=!1,c=function(i){var n=t;if((!n.group||n.group!==i.group)&&n.layers&i.layers&&n!==i){var c;if(n.collisionCode<=i.collisionCode)c=$t(n,i);else{c=$t(i,n);for(var o=0;o<c.length;o++)c[o].n=x(c[o].n)}if(c.length&&(r=!(n.sensor||i.sensor),e)){for(var s=new Array(c.length),o=0;o<c.length;o++)s[o]=new Dt(c[o].p,c[o].n,c[o].dist);e(i,s)}}};return this.lock(),this.activeShapes.query(n,c),this.staticShapes.query(n,c),this.unlock(!0),r},ee.prototype.addPostStepCallback=function(t){r(this.locked,"Adding a post-step callback when the space is not locked is unnecessary. Post-step callbacks will not called until the end of the next call to cpSpaceStep() or the next query."),this.postStepCallbacks.push(t)},ee.prototype.runPostStepCallbacks=function(){for(var t=0;t<this.postStepCallbacks.length;t++)this.postStepCallbacks[t]();this.postStepCallbacks=[]},ee.prototype.lock=function(){this.locked++},ee.prototype.unlock=function(t){if(this.locked--,n(this.locked>=0,"Internal Error: Space lock underflow."),0===this.locked&&t){for(var e=this.rousedBodies,i=0;i<e.length;i++)this.activateBody(e[i]);e.length=0,this.runPostStepCallbacks()}},ee.prototype.makeCollideShapes=function(){var t=this;return function(e,i){var n=t;if(e.bb_l<=i.bb_r&&i.bb_l<=e.bb_r&&e.bb_b<=i.bb_t&&i.bb_b<=e.bb_t&&e.body!==i.body&&(!e.group||e.group!==i.group)&&e.layers&i.layers){var r=n.lookupHandler(e.collision_type,i.collision_type),c=e.sensor||i.sensor;if(!c||r!==te){if(e.collisionCode>i.collisionCode){var o=e;e=i,i=o}var a=$t(e,i);if(0!==a.length){var h=s(e.hashid,i.hashid),l=n.cachedArbiters[h];l||(l=n.cachedArbiters[h]=new Ft(e,i)),l.update(a,r,e,i),"first coll"!=l.state||r.begin(l,n)||l.ignore(),"ignore"!==l.state&&r.preSolve(l,n)&&!c?n.arbiters.push(l):(l.contacts=null,"ignore"!==l.state&&(l.state="normal")),l.stamp=n.stamp}}}}},ee.prototype.arbiterSetFilter=function(t){var e=this.stamp-t.stamp,i=t.body_a,n=t.body_b;return!(!i.isStatic()&&!i.isSleeping()||!n.isStatic()&&!n.isSleeping())||(e>=1&&"cached"!=t.state&&(t.callSeparate(this),t.state="cached"),!(e>=this.collisionPersistence)||(t.contacts=null,!1))};var ae=function(t){var e=t.body;t.update(e.p,e.rot)};ee.prototype.step=function(t){if(0!==t){n(0===v.x&&0===v.y,"vzero is invalid"),this.stamp++;var e=this.curr_dt;this.curr_dt=t;var i,r,c,o=this.bodies,s=this.constraints,a=this.arbiters;for(i=0;i<a.length;i++){var h=a[i];h.state="normal",h.body_a.isSleeping()||h.body_b.isSleeping()||h.unthread()}for(a.length=0,this.lock(),i=0;i<o.length;i++)o[i].position_func(t);this.activeShapes.each(ae),this.activeShapes.reindexQuery(this.collideShapes),this.unlock(!1),this.processComponents(t),this.lock();for(c in this.cachedArbiters)this.arbiterSetFilter(this.cachedArbiters[c])||delete this.cachedArbiters[c];var l=this.collisionSlop,u=1-Math.pow(this.collisionBias,t);for(i=0;i<a.length;i++)a[i].preStep(t,l,u);for(i=0;i<s.length;i++){var _=s[i];_.preSolve(this),_.preStep(t)}var d=Math.pow(this.damping,t),f=this.gravity;for(i=0;i<o.length;i++)o[i].velocity_func(f,d,t);var p=0===e?0:t/e;for(i=0;i<a.length;i++)a[i].applyCachedImpulse(p);for(i=0;i<s.length;i++)s[i].applyCachedImpulse(p);for(i=0;i<this.iterations;i++){for(r=0;r<a.length;r++)a[r].applyImpulse();for(r=0;r<s.length;r++)s[r].applyImpulse()}for(i=0;i<s.length;i++)s[i].postSolve(this);for(i=0;i<a.length;i++)a[i].handler.postSolve(a[i],this);this.unlock(!0)}};var he=function(t,e,i,n){var r=t.vx+-i.y*t.w,c=t.vy+i.x*t.w,o=e.vx+-n.y*e.w,s=e.vy+n.x*e.w;return new m(o-r,s-c)},le=function(t,e,i,n,r){var c=t.vx+-i.y*t.w,o=t.vy+i.x*t.w,s=e.vx+-n.y*e.w,a=e.vy+n.x*e.w;return y(s-c,a-o,r.x,r.y)},ue=function(t,e,i,n){t.vx+=e*t.m_inv,t.vy+=i*t.m_inv,t.w+=t.i_inv*(n.x*i-n.y*e)},_e=function(t,e,i,n,r,c){ue(t,-r,-c,i),ue(e,r,c,n)},de=function(t,e,i,n){t.v_biasx+=e*t.m_inv,t.v_biasy+=i*t.m_inv,t.w_bias+=t.i_inv*w(n.x,n.y,e,i)},fe=function(t,e,i){var n=R(e,i);return t.m_inv+t.i_inv*n*n},pe=function(t,e,i,n,c){var o=fe(t,i,c)+fe(e,n,c);return r(0!==o,"Unsolvable collision or constraint."),o},ge=function(t,e,i,n,c,o){var s,a,h,l,u=t.m_inv+e.m_inv;s=u,a=0,h=0,l=u;var _=t.i_inv,d=i.x*i.x*_,f=i.y*i.y*_,p=-i.x*i.y*_;s+=f,a+=p,h+=p,l+=d;var g=e.i_inv,m=n.x*n.x*g,v=n.y*n.y*g,T=-n.x*n.y*g;s+=v,a+=T,h+=T,l+=m;var y=s*l-a*h;r(0!==y,"Unsolvable constraint.");var S=1/y;c.x=l*S,c.y=-a*S,o.x=-h*S,o.y=s*S},me=function(t,e,i){return new m(T(t,e),T(t,i))},ve=function(t,e){return 1-Math.pow(t,e)},Te=t.Constraint=function(t,e){this.a=t,this.b=e,this.space=null,this.next_a=null,this.next_b=null,this.maxForce=1/0,this.errorBias=Math.pow(.9,60),this.maxBias=1/0};Te.prototype.activateBodies=function(){this.a&&this.a.activate(),this.b&&this.b.activate()},Te.prototype.preStep=function(t){},Te.prototype.applyCachedImpulse=function(t){},Te.prototype.applyImpulse=function(){},Te.prototype.getImpulse=function(){return 0},Te.prototype.preSolve=function(t){},Te.prototype.postSolve=function(t){},Te.prototype.next=function(t){return this.a===t?this.next_a:this.next_b};var ye=t.PinJoint=function(t,e,i,n){Te.call(this,t,e),this.anchr1=i,this.anchr2=n;var c=t?E(t.p,O(i,t.rot)):i,o=e?E(e.p,O(n,e.rot)):n;this.dist=S(b(o,c)),r(this.dist>0,"You created a 0 length pin joint. A pivot joint will be much more stable."),this.r1=this.r2=null,this.n=null,this.nMass=0,this.jnAcc=this.jnMax=0,this.bias=0};ye.prototype=Object.create(Te.prototype),ye.prototype.preStep=function(t){var e=this.a,i=this.b;
this.r1=O(this.anchr1,e.rot),this.r2=O(this.anchr2,i.rot);var n=b(E(i.p,this.r2),E(e.p,this.r1)),r=S(n);this.n=A(n,1/(r?r:1/0)),this.nMass=1/pe(e,i,this.r1,this.r2,this.n);var c=this.maxBias;this.bias=p(-ve(this.errorBias,t)*(r-this.dist)/t,-c,c),this.jnMax=this.maxForce*t},ye.prototype.applyCachedImpulse=function(t){var e=A(this.n,this.jnAcc*t);_e(this.a,this.b,this.r1,this.r2,e.x,e.y)},ye.prototype.applyImpulse=function(){var t=this.a,e=this.b,i=this.n,n=le(t,e,this.r1,this.r2,i),r=(this.bias-n)*this.nMass,c=this.jnAcc;this.jnAcc=p(c+r,-this.jnMax,this.jnMax),r=this.jnAcc-c,_e(t,e,this.r1,this.r2,i.x*r,i.y*r)},ye.prototype.getImpulse=function(){return Math.abs(this.jnAcc)};var Se=t.SlideJoint=function(t,e,i,n,r,c){Te.call(this,t,e),this.anchr1=i,this.anchr2=n,this.min=r,this.max=c,this.r1=this.r2=this.n=null,this.nMass=0,this.jnAcc=this.jnMax=0,this.bias=0};Se.prototype=Object.create(Te.prototype),Se.prototype.preStep=function(t){var e=this.a,i=this.b;this.r1=O(this.anchr1,e.rot),this.r2=O(this.anchr2,i.rot);var n=b(E(i.p,this.r2),E(e.p,this.r1)),r=S(n),c=0;r>this.max?(c=r-this.max,this.n=M(n)):r<this.min?(c=this.min-r,this.n=x(M(n))):(this.n=v,this.jnAcc=0),this.nMass=1/pe(e,i,this.r1,this.r2,this.n);var o=this.maxBias;this.bias=p(-ve(this.errorBias,t)*c/t,-o,o),this.jnMax=this.maxForce*t},Se.prototype.applyCachedImpulse=function(t){var e=this.jnAcc*t;_e(this.a,this.b,this.r1,this.r2,this.n.x*e,this.n.y*e)},Se.prototype.applyImpulse=function(){if(0!==this.n.x||0!==this.n.y){var t=this.a,e=this.b,i=this.n,n=this.r1,r=this.r2,c=he(t,e,n,r),o=T(c,i),s=(this.bias-o)*this.nMass,a=this.jnAcc;this.jnAcc=p(a+s,-this.jnMax,0),s=this.jnAcc-a,_e(t,e,this.r1,this.r2,i.x*s,i.y*s)}},Se.prototype.getImpulse=function(){return Math.abs(this.jnAcc)};var Ce=t.PivotJoint=function(t,e,i,n){if(Te.call(this,t,e),"undefined"==typeof n){var r=i;i=t?t.world2Local(r):r,n=e?e.world2Local(r):r}this.anchr1=i,this.anchr2=n,this.r1=this.r2=v,this.k1=new m(0,0),this.k2=new m(0,0),this.jAcc=v,this.jMaxLen=0,this.bias=v};Ce.prototype=Object.create(Te.prototype),Ce.prototype.preStep=function(t){var e=this.a,i=this.b;this.r1=O(this.anchr1,e.rot),this.r2=O(this.anchr2,i.rot),ge(e,i,this.r1,this.r2,this.k1,this.k2),this.jMaxLen=this.maxForce*t;var n=b(E(i.p,this.r2),E(e.p,this.r1));this.bias=W(A(n,-ve(this.errorBias,t)/t),this.maxBias)},Ce.prototype.applyCachedImpulse=function(t){_e(this.a,this.b,this.r1,this.r2,this.jAcc.x*t,this.jAcc.y*t)},Ce.prototype.applyImpulse=function(){var t=this.a,e=this.b,i=this.r1,n=this.r2,r=he(t,e,i,n),c=me(b(this.bias,r),this.k1,this.k2),o=this.jAcc;this.jAcc=W(E(this.jAcc,c),this.jMaxLen),_e(t,e,this.r1,this.r2,this.jAcc.x-o.x,this.jAcc.y-o.y)},Ce.prototype.getImpulse=function(){return S(this.jAcc)};var Ee=t.GrooveJoint=function(t,e,i,n,r){Te.call(this,t,e),this.grv_a=i,this.grv_b=n,this.grv_n=I(B(b(n,i))),this.anchr2=r,this.grv_tn=null,this.clamp=0,this.r1=this.r2=null,this.k1=new m(0,0),this.k2=new m(0,0),this.jAcc=v,this.jMaxLen=0,this.bias=null};Ee.prototype=Object.create(Te.prototype),Ee.prototype.preStep=function(t){var e=this.a,i=this.b,n=e.local2World(this.grv_a),r=e.local2World(this.grv_b),c=O(this.grv_n,e.rot),o=T(n,c);this.grv_tn=c,this.r2=O(this.anchr2,i.rot);var s=R(E(i.p,this.r2),c);s<=R(n,c)?(this.clamp=1,this.r1=b(n,e.p)):s>=R(r,c)?(this.clamp=-1,this.r1=b(r,e.p)):(this.clamp=0,this.r1=b(E(A(I(c),-s),A(c,o)),e.p)),ge(e,i,this.r1,this.r2,this.k1,this.k2),this.jMaxLen=this.maxForce*t;var a=b(E(i.p,this.r2),E(e.p,this.r1));this.bias=W(A(a,-ve(this.errorBias,t)/t),this.maxBias)},Ee.prototype.applyCachedImpulse=function(t){_e(this.a,this.b,this.r1,this.r2,this.jAcc.x*t,this.jAcc.y*t)},Ee.prototype.grooveConstrain=function(t){var e=this.grv_tn,i=this.clamp*R(t,e)>0?t:L(t,e);return W(i,this.jMaxLen)},Ee.prototype.applyImpulse=function(){var t=this.a,e=this.b,i=this.r1,n=this.r2,r=he(t,e,i,n),c=me(b(this.bias,r),this.k1,this.k2),o=this.jAcc;this.jAcc=this.grooveConstrain(E(o,c)),_e(t,e,this.r1,this.r2,this.jAcc.x-o.x,this.jAcc.y-o.y)},Ee.prototype.getImpulse=function(){return S(this.jAcc)},Ee.prototype.setGrooveA=function(t){this.grv_a=t,this.grv_n=I(B(b(this.grv_b,t))),this.activateBodies()},Ee.prototype.setGrooveB=function(t){this.grv_b=t,this.grv_n=I(B(b(t,this.grv_a))),this.activateBodies()};var be=function(t,e){return(t.restLength-e)*t.stiffness},xe=t.DampedSpring=function(t,e,i,n,r,c,o){Te.call(this,t,e),this.anchr1=i,this.anchr2=n,this.restLength=r,this.stiffness=c,this.damping=o,this.springForceFunc=be,this.target_vrn=this.v_coef=0,this.r1=this.r2=null,this.nMass=0,this.n=null};xe.prototype=Object.create(Te.prototype),xe.prototype.preStep=function(t){var e=this.a,i=this.b;this.r1=O(this.anchr1,e.rot),this.r2=O(this.anchr2,i.rot);var n=b(E(i.p,this.r2),E(e.p,this.r1)),c=S(n);this.n=A(n,1/(c?c:1/0));var o=pe(e,i,this.r1,this.r2,this.n);r(0!==o,"Unsolvable this."),this.nMass=1/o,this.target_vrn=0,this.v_coef=1-Math.exp(-this.damping*t*o);var s=this.springForceFunc(this,c);_e(e,i,this.r1,this.r2,this.n.x*s*t,this.n.y*s*t)},xe.prototype.applyCachedImpulse=function(t){},xe.prototype.applyImpulse=function(){var t=this.a,e=this.b,i=this.n,n=this.r1,r=this.r2,c=le(t,e,n,r,i),o=(this.target_vrn-c)*this.v_coef;this.target_vrn=c+o,o*=this.nMass,_e(t,e,this.r1,this.r2,this.n.x*o,this.n.y*o)},xe.prototype.getImpulse=function(){return 0};var Ae=function(t,e){return(e-t.restAngle)*t.stiffness},Re=t.DampedRotarySpring=function(t,e,i,n,r){Te.call(this,t,e),this.restAngle=i,this.stiffness=n,this.damping=r,this.springTorqueFunc=Ae,this.target_wrn=0,this.w_coef=0,this.iSum=0};Re.prototype=Object.create(Te.prototype),Re.prototype.preStep=function(t){var e=this.a,i=this.b,n=e.i_inv+i.i_inv;r(0!==n,"Unsolvable spring."),this.iSum=1/n,this.w_coef=1-Math.exp(-this.damping*t*n),this.target_wrn=0;var c=this.springTorqueFunc(this,e.a-i.a)*t;e.w-=c*e.i_inv,i.w+=c*i.i_inv},Re.prototype.applyImpulse=function(){var t=this.a,e=this.b,i=t.w-e.w,n=(this.target_wrn-i)*this.w_coef;this.target_wrn=i+n;var r=n*this.iSum;t.w+=r*t.i_inv,e.w-=r*e.i_inv};var we=t.RotaryLimitJoint=function(t,e,i,n){Te.call(this,t,e),this.min=i,this.max=n,this.jAcc=0,this.iSum=this.bias=this.jMax=0};we.prototype=Object.create(Te.prototype),we.prototype.preStep=function(t){var e=this.a,i=this.b,n=i.a-e.a,r=0;n>this.max?r=this.max-n:n<this.min&&(r=this.min-n),this.iSum=1/(1/e.i+1/i.i);var c=this.maxBias;this.bias=p(-ve(this.errorBias,t)*r/t,-c,c),this.jMax=this.maxForce*t,this.bias||(this.jAcc=0)},we.prototype.applyCachedImpulse=function(t){var e=this.a,i=this.b,n=this.jAcc*t;e.w-=n*e.i_inv,i.w+=n*i.i_inv},we.prototype.applyImpulse=function(){if(this.bias){var t=this.a,e=this.b,i=e.w-t.w,n=-(this.bias+i)*this.iSum,r=this.jAcc;this.bias<0?this.jAcc=p(r+n,0,this.jMax):this.jAcc=p(r+n,-this.jMax,0),n=this.jAcc-r,t.w-=n*t.i_inv,e.w+=n*e.i_inv}},we.prototype.getImpulse=function(){return Math.abs(joint.jAcc)};var Ie=t.RatchetJoint=function(t,e,i,n){Te.call(this,t,e),this.angle=0,this.phase=i,this.ratchet=n,this.angle=(e?e.a:0)-(t?t.a:0),this.iSum=this.bias=this.jAcc=this.jMax=0};Ie.prototype=Object.create(Te.prototype),Ie.prototype.preStep=function(t){var e=this.a,i=this.b,n=this.angle,r=this.phase,c=this.ratchet,o=i.a-e.a,s=n-o,a=0;s*c>0?a=s:this.angle=Math.floor((o-r)/c)*c+r,this.iSum=1/(e.i_inv+i.i_inv);var h=this.maxBias;this.bias=p(-ve(this.errorBias,t)*a/t,-h,h),this.jMax=this.maxForce*t,this.bias||(this.jAcc=0)},Ie.prototype.applyCachedImpulse=function(t){var e=this.a,i=this.b,n=this.jAcc*t;e.w-=n*e.i_inv,i.w+=n*i.i_inv},Ie.prototype.applyImpulse=function(){if(this.bias){var t=this.a,e=this.b,i=e.w-t.w,n=this.ratchet,r=-(this.bias+i)*this.iSum,c=this.jAcc;this.jAcc=p((c+r)*n,0,this.jMax*Math.abs(n))/n,r=this.jAcc-c,t.w-=r*t.i_inv,e.w+=r*e.i_inv}},Ie.prototype.getImpulse=function(t){return Math.abs(t.jAcc)};var Le=t.GearJoint=function(t,e,i,n){Te.call(this,t,e),this.phase=i,this.ratio=n,this.ratio_inv=1/n,this.jAcc=0,this.iSum=this.bias=this.jMax=0};Le.prototype=Object.create(Te.prototype),Le.prototype.preStep=function(t){var e=this.a,i=this.b;this.iSum=1/(e.i_inv*this.ratio_inv+this.ratio*i.i_inv);var n=this.maxBias;this.bias=p(-ve(this.errorBias,t)*(i.a*this.ratio-e.a-this.phase)/t,-n,n),this.jMax=this.maxForce*t},Le.prototype.applyCachedImpulse=function(t){var e=this.a,i=this.b,n=this.jAcc*t;e.w-=n*e.i_inv*this.ratio_inv,i.w+=n*i.i_inv},Le.prototype.applyImpulse=function(){var t=this.a,e=this.b,i=e.w*this.ratio-t.w,n=(this.bias-i)*this.iSum,r=this.jAcc;this.jAcc=p(r+n,-this.jMax,this.jMax),n=this.jAcc-r,t.w-=n*t.i_inv*this.ratio_inv,e.w+=n*e.i_inv},Le.prototype.getImpulse=function(){return Math.abs(this.jAcc)},Le.prototype.setRatio=function(t){this.ratio=t,this.ratio_inv=1/t,this.activateBodies()};var Oe=t.SimpleMotor=function(t,e,i){Te.call(this,t,e),this.rate=i,this.jAcc=0,this.iSum=this.jMax=0};Oe.prototype=Object.create(Te.prototype),Oe.prototype.preStep=function(t){this.iSum=1/(this.a.i_inv+this.b.i_inv),this.jMax=this.maxForce*t},Oe.prototype.applyCachedImpulse=function(t){var e=this.a,i=this.b,n=this.jAcc*t;e.w-=n*e.i_inv,i.w+=n*i.i_inv},Oe.prototype.applyImpulse=function(){var t=this.a,e=this.b,i=e.w-t.w+this.rate,n=-i*this.iSum,r=this.jAcc;this.jAcc=p(r+n,-this.jMax,this.jMax),n=this.jAcc-r,t.w-=n*t.i_inv,e.w+=n*e.i_inv},Oe.prototype.getImpulse=function(){return Math.abs(this.jAcc)}}(),define("chipmunk",function(t){return function(){var e;return e||t.cp}}(this)),define("layers/titleLayer",["cocos"],function(t){return t.Layer.extend({ctor:function(){this._super(),this.titleImage=new t.Sprite("dist/images/title.png"),this.titleImage.setPosition(t.visibleRect.width/2,.75*t.visibleRect.height),this.addChild(this.titleImage)}})}),define("sprites/ball",["cocos","chipmunk"],function(t,e){return t.PhysicsSprite.extend({friction:1,frictionSQ:1,rotateFriction:2*Math.PI/360,ctor:function(t){this._super(t);var i=this.getContentSize().width/2;this.body=new e.Body(1,e.momentForCircle(1,0,i,e.vzero)),this.body.sprite=this,this.setBody(this.body),this.shape=new e.CircleShape(this.body,i,e.vzero),this.shape.setElasticity(1),this.shape.setFriction(.3)}})}),define("sprites/ballAnimate",["cocos","sprites/ball"],function(t,e){var i,n,r,c,o,s=7,a=function(){var e,a,h,l;for(i=t.textureCache.addImage("dist/images/ball-animate-sprite.png"),n=[],r=i.pixelsWidth/s,c=i.pixelsHeight/r,o=r*Math.PI*.5/7,e=0;e<c;e++){for(h=[],a=0;a<s;a++)l=new t.SpriteFrame(i,t.rect(a*r,e*r,r,r)),h.push(l);n.push(h)}};return e.extend({ballId:0,frames:null,curFrame:3,curFrameTime:0,nextFrameTime:1,isStatic:!0,ctor:function(t){i||a(),this.ballId=t,this.frames=n[t]||n[0],this._super(this.frames[this.curFrame]),this.setIgnoreBodyRotation(!0)},onEnter:function(){this._super(),this.scheduleUpdate()},onExit:function(){this.unscheduleUpdate(),this._super()},nextFrame:function(){this.curFrame++,this.curFrame>=s&&(this.curFrame=0),this.setDisplayFrame(this.frames[this.curFrame]),this.updateRotation()},calcVel:function(){var t=this.body.getVel();return Math.sqrt(t.x*t.x+t.y*t.y)},calcDirection:function(){var e=this.body.getVel(),i=Math.atan2(e.y,e.x);return 0-t.radiansToDegrees(i)},updateNextFrameTime:function(){var t=this.calcVel();t<=1e-4?this.isStatic=!0:(this.isStatic=!1,this.nextFrameTime=o/t)},updateRotation:function(){if(!this.isStatic){var t=this.calcDirection();this.setRotation(t)}},update:function(t){if(this.curFrameTime+=t,this.updateNextFrameTime(),!this.isStatic)for(;this.curFrameTime>=this.nextFrameTime;)this.nextFrame(),this.curFrameTime-=this.nextFrameTime}})}),define("sprites/ballCursor",["cocos"],function(t){return t.DrawNode.extend({ctor:function(e){this._super(),e=e||40,this.setContentSize(2*e,2*e),this.setAnchorPoint(.5,.5),this.ignoreAnchorPointForPosition(!1),this.drawCircle(t.p(e,e),e-1,0,4*e,!1,2,t.color(255,255,255)),this.drawSegment(t.p(e-5,e),t.p(e+5,e),1,t.color(255,255,255)),this.drawSegment(t.p(e,e-5),t.p(e,e+5),1,t.color(255,255,255)),this.theCanvas=document.getElementById(t.game.config.id),this.setVisible(!1)},setVisible:function(t){this._super(t),this.theCanvas.style.cursor=t?"none":"default"}})}),function(){var t,e=window.AudioContext||window.webkitAudioContext||window.mozAudioContext;if(e){var i=new e,n={},r=1,c=[],o={},s=i.createGain(),a=i.createDynamicsCompressor();a.connect(s),s.connect(i.destination),s.gain.value=1;var h=a,l=!1,u=1,_=function(t){var e=new Float32Array(0),r=!1,c=[];n[t]=this;var o=function(){var n=new XMLHttpRequest;n.open("GET",t,!0),n.responseType="arraybuffer",n.onload=function(){i.decodeAudioData(n.response,function(t){e=t,r=!0;for(var i=0,n=c.length;i<n;i++){var o=c[i];"function"==typeof o&&o()}},function(){r=!0;for(var t=0,e=c.length;t<e;t++){var i=c[t];"function"==typeof i&&i()}})}.bind(this),n.send()}.bind(this);o(),this.onload=function(t){r?t():c.push(t)},this.getBuffer=function(){return e}},d=function(t,e,s){var a=function(){o[d]&&(c.push(d),delete o[d])};if(this.play=function(){a()},this.pause=function(){},this.stop=function(){},!l||s){var u=null,_=n[t];if(_&&(u=_.getBuffer()),u){var d;d=c.length?c.shift():r++,o[d]=this;var f,p=0,g=0,m=!0,v=function(){var t=i.createBufferSource();return t.buffer=u,t.connect(h),t.onended=function(){m||a()},s&&(t.loop=!0,t.loopStart=e,t.loopEnd=s),t};this.play=function(){return f&&!m?d:(m=!1,f=v(),p=i.currentTime-g,f.start?f.start(0,g):f.noteGrainOn?f.noteGrainOn(0,g):f.noteOn(0,g),d)},this.pause=function(){g=i.currentTime-p,m=!0,f&&f.stop()},this.stop=function(){m=!1,f&&f.stop(),a()}}}};t={support:function(){return!0},load:function(t,e){t instanceof Array||(t=[t]);var i,n,r=t.length,c=0;for(i=0;i<r;i++)n=new _(t[i]),n.onload(function(){c++,c>=r&&"function"==typeof e&&e()})},unload:function(t){t instanceof Array||(t=[t]);var e,i=t.length;for(e=0;e<i;e++)n[t[e]]&&delete n[t[e]]},play:function(t,e,i){var n=new d(t,e,i);return n.play()},pause:function(t){o[t]&&o[t].pause()},resume:function(t){o[t]&&o[t].play()},stop:function(t){o[t]&&o[t].stop()},setVolume:function(t){l||(s.gain.value=t),u=t},getVolume:function(){return u},setMuted:function(t){l=t,t?s.gain.value=0:s.gain.value=u},getMuted:function(){return l},pauseAll:function(){for(var t in o)o.hasOwnProperty(t)&&o[t].pause&&o[t].pause()},stopAll:function(){for(var t in o)o.hasOwnProperty(t)&&o[t].stop&&o[t].stop()}}}else{var f=function(){};t={support:function(){return!1},load:f,unload:f,play:f,pause:f,stop:f,setVolume:f,setMuted:f,getMuted:function(){return!0},pauseAll:f,stopAll:f}}"undefined"!=typeof module&&"object"==typeof exports?module.exports=t:"function"==typeof define&&define.amd?define("benzAudioEngine",[],function(){return t}):this.benzAudioEngine=t}.call(this||("undefined"!=typeof window?window:global)),define("layers/tableLayer",["cocos","chipmunk","sprites/ball","sprites/ballAnimate","sprites/ballCursor","benzAudioEngine"],function(t,e,i,n,r,c){var o=(2*Math.PI/360,1e3),s=1402,a=777,h=31,l=12,u=s-2*h,_=a-2*l,d=t.color(51,153,0),f=[[123,77,663,77,672,33,46,0],[741,77,1279,77,1356,0,732,33],[46,777,672,733,663,700,123,700],[732,733,1356,777,1279,700,741,700],[0,46,0,731,77,654,77,123],[1325,123,1325,654,1402,731,1402,46]],p=30,g=[[64,64],[64,713],[1338,64],[1338,713],[701,46],[701,731]],m=20,v=[3*s/4,a/2],T=[s/4,a/2],y=function(){var t,e,i,n,r=[[0,0]],c=m+1,o=0-Math.sqrt(c*c*3);for(n=o,t=1;t<5;t++){for(t%2===0?(r.push([n,0]),i=2*c):i=c,e=0;e<t/2;e++)r.push([n,i]),r.push([n,0-i]),i+=2*c;n+=o}return r}();t.sys.isMobile&&!function(){var t,e,i;for(e=s,s=a,a=e,t=0;t<f.length;t++)f[t]=f[t].reverse();for(t=0;t<g.length;t++)i=g[t],e=i[0],i[0]=i[1],i[1]=e;for(e=v[0],v[0]=v[1],v[1]=a-e,e=T[0],T[0]=T[1],T[1]=a-e,t=0;t<y.length;t++)i=y[t],e=i[0],i[0]=i[1],i[1]=0-e;e=h,h=l,l=e,e=u,u=_,_=e}();var S=0,C=1,E=2,b=10,x=t.Layer.extend({masterBall:null,shoot:{shooting:!1,force:0,cursor:{x:0,y:0}},balls:[],ballCursor:null,ballLine:null,status:C,ballCount:0,runningBit:0,goalBallsNumber:[],turns:0,goalBallsNumberOneTurn:[],isMasterGoal:!1,combo:0,maxCombo:0,mute:!1,ctor:function(){this._super(),this.setContentSize(s,a),this.space=new e.Space,this.initSpace(),this.balls=[];for(var i=0;i<10;i++){var n=this.addBallAnimate(i);n.body.number=i,this.balls.push(n)}this.ballCursor=new r(m),this.ballLine=new t.DrawNode,this.addChild(this.ballLine,11),this.addChild(this.ballCursor,12),this.masterBall=this.addBall("dist/images/masterball.png"),this.masterBall.isMaster=!0,this.masterBall.body.number=10,this.loadTableStateFromLocalStorage(),this.scheduleUpdate()},initSpace:function(){var i,n,r,c=this.space,o=c.staticBody;c.gravity=e.v(0,0);var v=new e.BoxShape2(o,new e.BB(0,0,s,a));for(v.setElasticity(0),v.setFriction(0),v.setSensor(!0),v.setCollisionType(1),c.addStaticShape(v),i=0;i<f.length;i++)n=new e.PolyShape(o,f[i],e.vzero),n.setElasticity(1),n.setFriction(.1),n.setCollisionType(3),c.addStaticShape(n);var T=p-m;for(i=0;i<g.length;i++)r=new e.CircleShape(o,T,e.v(g[i][0],g[i][1])),r.setElasticity(0),r.setFriction(0),r.setSensor(!0),r.setCollisionType(2),c.addStaticShape(r);this.tableBg=new t.LayerColor(d,u,_),this.tableBg.setPosition(h,l),this.addChild(this.tableBg,0),this.tableBorder=new t.Sprite("dist/images/table.png"),t.sys.isMobile&&this.tableBorder.setRotation(-90),this.tableBorder.setPosition(s/2,a/2),this.addChild(this.tableBorder,1)},desktopPreSolve:function(t,e){var i=t.getShapes(),n=i[1],r=n.getBody(),c=r.vx,o=r.vy,s=r.w;if(0===c&&0===o&&0===s)return this.setRunning(r.number,!1),!1;this.setRunning(r.number,!0);var a=r.sprite.frictionSQ,h=a/(c*c+o*o),l=Math.sqrt(h);l>1?(r.vx=0,r.vy=0):(r.vx=c-l*c,r.vy=o-l*o);var u=r.sprite.rotateFriction;return Math.abs(s)>u?s>0?r.w-=u:r.w+=u:r.w=0,!1},pocketCollisionBegan:function(t,e){var i=t.getShapes(),n=i[1],r=n.getBody(),c=r.sprite;return c.isMaster?(this.isMasterGoal=!0,this.playEffect("dist/sounds/lost-master.mp3")):(this.goalBallsNumberOneTurn.push(r.number),this.goalBallsNumber.push(r.number),this.playEffect("dist/sounds/goal.mp3")),e.addPostStepCallback(function(){this.removeBall(c)}.bind(this)),!1},wallCollisionBegan:function(){return this.playEffect("dist/sounds/hit-wall.mp3"),!0},ballCollisionBegan:function(){return this.playEffect("dist/sounds/hit-ball.mp3"),!0},onEnter:function(){this._super(),this.space.addCollisionHandler(1,0,null,this.desktopPreSolve.bind(this),null,null),this.space.addCollisionHandler(2,0,this.pocketCollisionBegan.bind(this),null,null,null),this.space.addCollisionHandler(3,0,this.wallCollisionBegan.bind(this),null,null,null),this.space.addCollisionHandler(0,0,this.ballCollisionBegan.bind(this),null,null,null)},onExit:function(){this.space.removeCollisionHandler(1,0),this.space.removeCollisionHandler(2,0),this.space.removeCollisionHandler(3,0),this.space.removeCollisionHandler(0,0),this._super()},pause:function(){this.pauseBallAnimate(),this._super()},resume:function(){this._super(),this.resumeBallAnimate()},addBall:function(t){return t=t||"dist/images/ball.png",new i(t)},addBallAnimate:function(t){return new n(t)},pauseBallAnimate:function(){for(var t=0,e=this.balls.length;t<e;t++)this.balls[t].pause()},resumeBallAnimate:function(){for(var t=0,e=this.balls.length;t<e;t++)this.balls[t].resume()},removeBall:function(t){var e=t.body,i=t.shape;e.isRogue()||(this.space.removeBody(e),this.space.removeShape(i),t.removeFromParent(!0),this.ballCount--,this.setRunning(e.number,!1))},resetBall:function(t,i){t.setPosition(i),t.body.setVel(e.vzero),t.body.setAngVel(0),t.body.isRogue()&&(this.ballCount++,this.space.addBody(t.body),this.space.addShape(t.shape),this.addChild(t,5))},resetMasterBall:function(){this.resetBall(this.masterBall,t.p(v[0],v[1])),this.setAimLine(this.ballCursor.getPosition())},posInTable:function(e){var i=t.rect(m,m,s-2*m,a-2*m);return t.rectContainsPoint(i,e)},showAimLine:function(){this.ballCursor.setVisible(!0),this.ballLine.setVisible(!0)},hideAimLine:function(){this.ballCursor.setVisible(!1),this.ballLine.setVisible(!1)},setAimLine:function(e){this.posInTable(e)?(this.ballCursor.setPosition(e),this.ballLine.clear(),this.ballLine.drawSegment(this.masterBall.getPosition(),e,1,t.color(255,255,255)),this.ballCursor.isVisible()||this.showAimLine()):this.ballCursor.isVisible()&&this.hideAimLine()},shootMasterBall:function(t,i){var n=this.masterBall.getPosition();i=i||this.ballCursor.getPosition(),t=t||1;var r=i.x-n.x,c=i.y-n.y;if(0!==r||0!==c){var s=o*o/(r*r+c*c),a=Math.sqrt(s),h=new e.Vect(a*r*t,a*c*t);this.hideAimLine(),this.setStatus(E),this.shoot.shooting=!0,this.shoot.force=t,this.shoot.cursor.x=i.x,this.shoot.cursor.y=i.y,this.saveTableStateToLocalStorage(),setTimeout(function(){this.masterBall.body.setVel(h),this.setRunning(this.masterBall.body.number,!0),this.playEffect("dist/sounds/shoot.mp3")}.bind(this),450)}},resetTable:function(){this.resetMasterBall();for(var e=0,i=this.balls.length;e<i;e++){var n=T[0]+y[e][0],r=T[1]+y[e][1];this.resetBall(this.balls[e],t.p(n,r))}this.goalBallsNumber=[],this.turns=0,this.isMasterGoal=!1,this.goalBallsNumberOneTurn=[],this.combo=0,this.maxCombo=0,this.shoot.shooting=!1,this.setStatus(S),this.turns=0,this.saveTableStateToLocalStorage(),t.eventManager.dispatchCustomEvent("table:reset")},setRunning:function(t,e){var i=1<<t;e?(this.runningBit=this.runningBit|i,this.setStatus(C)):this.runningBit=this.runningBit&~i},setStatus:function(e){if(e!==this.status){var i=this.status;this.status=e,e===C?t.eventManager.dispatchCustomEvent("table:status_running"):e===S?this.space.locked?this.space.addPostStepCallback(function(){this.checkOneTurn(),1!==this.ballCount&&(t.eventManager.dispatchCustomEvent("table:status_ready"),this.saveTableStateToLocalStorage())}.bind(this)):(this.checkOneTurn(),1!==this.ballCount&&(t.eventManager.dispatchCustomEvent("table:status_ready"),this.saveTableStateToLocalStorage())):e===b?(t.eventManager.dispatchCustomEvent("table:status_clear",{turns:this.turns,maxCombo:this.maxCombo}),this.removeTableStateFromLocalStorage()):e===E&&t.eventManager.dispatchCustomEvent("table:status_wait"),t.eventManager.dispatchCustomEvent("table:status_change",{old:i,new:e})}},checkOneTurn:function(){var e,i,n=!1;if(this.turns++,this.isMasterGoal){for(e=0,i=this.goalBallsNumberOneTurn.length;e<i;e++)this.resetBall(this.balls[this.goalBallsNumberOneTurn[e]],t.p(T[0]+y[e][0],T[1]+y[e][1])),this.goalBallsNumber.pop();this.resetMasterBall(),this.combo=0,this.turns++,t.eventManager.dispatchCustomEvent("table:master_goal")}else this.goalBallsNumberOneTurn.length>0?(this.combo++,this.maxCombo=Math.max(this.combo,this.maxCombo),t.eventManager.dispatchCustomEvent("table:goal",{goals:this.goalBallsNumberOneTurn,turns:this.turns,combo:this.combo}),1===this.ballCount&&(n=!0)):(this.combo=0,t.eventManager.dispatchCustomEvent("table:no_goal"));t.eventManager.dispatchCustomEvent("table:one_turn"),n&&this.setStatus(b),this.isMasterGoal=!1,this.goalBallsNumberOneTurn=[],this.shoot.shooting=!1},getTableStateJSON:function(){var t,e,i={masterBall:{x:this.masterBall.getPositionX(),y:this.masterBall.getPositionY(),shooting:this.shoot.shooting,force:this.shoot.force,cursor:{x:this.shoot.cursor.x,y:this.shoot.cursor.y}},balls:[],turns:this.turns,combo:this.combo,maxCombo:this.maxCombo,goalBallsNumber:this.goalBallsNumber.slice(0)},n={};for(t=0,e=i.goalBallsNumber.length;t<e;t++)n[i.goalBallsNumber[t]]=!0;for(t=0,e=this.balls.length;t<e;t++)i.balls.push({x:this.balls[t].getPositionX(),y:this.balls[t].getPositionY(),isGoal:!!n[t]});return i},loadTableStateByJSON:function(e){var i,n,r,c;for(r=t.p(e.masterBall.x,e.masterBall.y),this.resetBall(this.masterBall,r),i=0,n=this.balls.length;i<n;i++)c=e.balls[i],r=t.p(c.x,c.y),c.isGoal?this.removeBall(this.balls[i]):this.resetBall(this.balls[i],r);this.turns=e.turns,this.combo=e.combo,this.maxCombo=e.maxCombo,this.goalBallsNumber=e.goalBallsNumber,this.setStatus(S),this.turns=e.turns,this.combo=e.combo,this.maxCombo=e.maxCombo,this.goalBallsNumber=e.goalBallsNumber,e.masterBall.shooting&&(r=t.p(e.masterBall.cursor.x,e.masterBall.cursor.y),this.shootMasterBall(e.masterBall.force,r))},saveTableStateToLocalStorage:function(){if(!(this.ballCount<=1||this.turns<2)){var e=this.getTableStateJSON(),i=JSON.stringify(e);t.sys.localStorage.setItem("tableState",i)}},loadTableStateFromLocalStorage:function(){var e=t.sys.localStorage.getItem("tableState");if(e){var i=JSON.parse(e);this.loadTableStateByJSON(i)}else this.resetTable()},removeTableStateFromLocalStorage:function(){t.sys.localStorage.removeItem("tableState")},playEffect:function(t){this.mute||c.play(t)},setTableColor:function(t){this.tableBg.setColor(t)},resetTableColor:function(){this.tableBg.setColor(d)},update:function(t){if(this._super(t),this.status===C){var e=Math.round(60/(1/t));e<1&&(e=1);for(var i=0;i<e;i++)this.space.step(1/60),this.runningBit||this.setStatus(S)}else this.space.step(1/60)}});return x.TABLE_WIDTH=s,x.TABLE_HEIGHT=a,x.POCKET_RADIUS=p,x.BALL_RADIUS=m,x.STATUS_READY=S,x.STATUS_WAIT=E,x.STATUS_RUNNING=C,x.STATUS_CLEAR=b,x}),define("layers/zoomTableLayer",["cocos","layers/tableLayer"],function(t,e){return t.Layer.extend({tableScale:1,tablePos:t.p(0,0),ctor:function(){this._super(),this.tableLayer=new e,this.tableLayer.ignoreAnchorPointForPosition(!1),this.tableLayer.setAnchorPoint(0,0),this.addChild(this.tableLayer),this.initTouch()},initTouch:function(){var i=t.EventListener.create({event:t.EventListener.TOUCH_ALL_AT_ONCE,onTouchesMoved:function(i,n){var r=n.getCurrentTarget(),c=r.tableLayer;if(!(i.length>1)){if(c.status!==e.STATUS_READY)return!1;var o=i[0],s=o.getDelta(),a=c.ballCursor.getPosition(),h=t.rect(e.BALL_RADIUS,e.BALL_RADIUS,e.TABLE_WIDTH-e.BALL_RADIUS,e.TABLE_HEIGHT-e.BALL_RADIUS);return s=t.pMult(s,.5/r.tableScale),a=t.pAdd(a,s),a=t.pClamp(a,t.p(h.x,h.y),t.p(h.width,h.height)),c.setAimLine(a),!0}var l=i[0],u=i[1],_=r.convertToNodeSpace(l.getLocation()),d=r.convertToNodeSpace(u.getLocation()),f=r.convertToNodeSpace(l.getPreviousLocation()),p=r.convertToNodeSpace(u.getPreviousLocation()),g=l.getDelta(),m=u.getDelta(),v=t.pMidpoint(_,d),T=t.pMidpoint(g,m),y=t.pDistance(_,d),S=t.pDistance(f,p),C=y/S;r.moveTableDelta(T),r.zoomTableDelta(C,v)},onTouchesEnded:function(i,n){var r=n.getCurrentTarget(),c=r.getContentSize();r.tableScale<.5&&r.zoomTable(.5,t.p(c.width,c.height),!0),r.tableScale>3.5&&r.zoomTable(3.5,t.p(c.width,c.height),!0);var o=t.p(.5*c.width,.5*c.height),s=t.p(e.TABLE_WIDTH*r.tableScale,e.TABLE_HEIGHT*r.tableScale);s=t.pSub(o,s);var a=t.pClamp(r.tablePos,s,o);t.pointEqualToPoint(r.tablePos,a)||r.moveTable(a,!0)}});t.eventManager.setPriority(i,10),t.eventManager.addListener(i,this),this.tableLayer.setAimLine(t.p(e.TABLE_WIDTH/2,e.TABLE_HEIGHT/2)),t.eventManager.addCustomListener("table:status_ready",function(){this.tableLayer.setAimLine(this.tableLayer.ballCursor.getPosition())}.bind(this)),t.eventManager.addCustomListener("table:status_running",function(){this.tableLayer.hideAimLine()}.bind(this))},zoomTable:function(e,i,n){var r=t.pSub(i,this.tablePos),c=t.pMult(r,e/this.tableScale),o=t.pSub(r,c);if(this.tableScale=e,n){var s=t.pAdd(this.tablePos,o);this.moveTable(s,!0),this.tableLayer.runAction(t.scaleTo(.3,e).easing(t.easeSineInOut()))}else this.moveTableDelta(o),this.tableLayer.setScale(e)},zoomTableDelta:function(t,e){var i=this.tableScale*t;this.zoomTable(i,e)},moveTable:function(e,i){this.tablePos=e,i?this.tableLayer.runAction(t.moveTo(.3,e).easing(t.easeSineInOut())):this.tableLayer.setPosition(e)},moveTableDelta:function(e){var i=t.pAdd(this.tablePos,e);this.moveTable(i)},moveAndZoomTable:function(e,i,n){this.tablePos=e,this.tableScale=i,n?(this.tableLayer.runAction(t.moveTo(.3,e).easing(t.easeExponentialInOut())),this.tableLayer.runAction(t.scaleTo(.3,i).easing(t.easeExponentialInOut()))):(this.tableLayer.setPosition(e),this.tableLayer.setScale(i))},resetTable:function(i){var n=this.getContentSize(),r=(n.width-50)/e.TABLE_WIDTH,c=(n.height-50)/e.TABLE_HEIGHT,o=Math.min(r,c),s=t.p((n.width-e.TABLE_WIDTH*o)/2,(n.height-e.TABLE_HEIGHT*o)/2);this.moveAndZoomTable(s,o,i)},onEnter:function(){this._super(),this.resetTable()}})}),define("i18n/localeList",{"zh-cn":"",en:"English"}),define("i18n/i18n",["cocos","i18n/localeList"],function(t,e){var i={},n={},r=function(t){return n.hasOwnProperty(t)?n[t]:t};r.defaultFont=t.sys.isMobile?"Helvetica Neue":"Microsoft Yahei",r.getLanguageList=function(){return e},r.setLanguage=function(c,o){c=c.toLowerCase();var s=c.substr(0,2),a=function(e){i=e,n=e.dictionary,r.defaultFont=e.defaultFont,e.defaultFontMobile&&t.sys.isMobile&&(r.defaultFont=e.defaultFontMobile),"function"==typeof o&&o()};if(e[c])require(["../locale/"+c],a);else{if(!e[s])return!1;require(["../locale/"+s],a)}return!0};var c=navigator.language;return r.setLanguage(c),r}),define("layers/middleMsgLayer",["cocos","i18n/i18n"],function(t,e){return t.Layer.extend({ctor:function(){this._super();var e=t.visibleRect;this.setContentSize(e.width,e.height),this.initGoalMsg(),this.initComboMsg()},initGoalMsg:function(){var i=t.visibleRect;this.goalLabel=new t.LabelTTF(e(""),e.defaultFont,96),this.goalLabel.setColor(t.color(255,255,255)),this.goalNumberLabel=new t.LabelTTF("x2",e.defaultFont,96),this.goalNumberLabel.setColor(t.color(0,255,0)),this.goalNumberLabel.enableStroke(new t.Color(0,128,0),5);var n=this.goalLabel.getContentSize(),r=this.goalNumberLabel.getContentSize();this.goalLabel.setPosition((i.width-r.width)/2-16,i.height/2+140),this.goalNumberLabel.setPosition((i.width+n.width)/2+16,i.height/2+140),this.goalLabel.setVisible(!1),this.goalNumberLabel.setVisible(!1),this.addChild(this.goalLabel),this.addChild(this.goalNumberLabel),t.eventManager.addCustomListener("table:goal",function(e){var i=e.getUserData().goals,n=i.length;n<2||(this.goalNumberLabel.setString("x"+n),this.goalNumberLabel.setScale(2),this.goalNumberLabel.setOpacity(255),this.goalLabel.setOpacity(255),this.goalNumberLabel.runAction(t.sequence([t.show(),t.scaleTo(.4,1),t.delayTime(1),t.fadeOut(.4),t.hide()])),this.goalLabel.runAction(t.sequence([t.show(),t.delayTime(1.4),t.fadeOut(.4),t.hide()])))}.bind(this))},initComboMsg:function(){var i=t.visibleRect;this.comboLabel=new t.LabelTTF(e(""),e.defaultFont,96),this.comboLabel.setColor(t.color(255,255,255)),this.comboNumberLabel=new t.LabelTTF("3",e.defaultFont,112),this.comboNumberLabel.setColor(t.color(255,255,0)),this.comboNumberLabel.enableStroke(new t.Color(255,128,0),5);var n=this.comboLabel.getContentSize(),r=this.comboNumberLabel.getContentSize();this.comboLabel.setPosition((i.width+r.width)/2+16,i.height/2),this.comboNumberLabel.setPosition((i.width-n.width)/2-16,i.height/2+8),this.comboLabel.setVisible(!1),this.comboNumberLabel.setVisible(!1),this.addChild(this.comboLabel),this.addChild(this.comboNumberLabel),t.eventManager.addCustomListener("table:goal",function(e){var i=e.getUserData().combo;i<2||(this.comboNumberLabel.setString(i),this.comboNumberLabel.setScale(2),this.comboNumberLabel.setOpacity(255),this.comboLabel.setOpacity(255),this.comboNumberLabel.runAction(t.sequence([t.show(),t.scaleTo(.4,1),t.delayTime(1),t.fadeOut(.4),t.hide()])),this.comboLabel.runAction(t.sequence([t.show(),t.delayTime(1.4),t.fadeOut(.4),t.hide()])))}.bind(this))}})}),define("sprites/shootButton",["cocos","i18n/i18n"],function(t,e){return t.ControlButton.extend({ctor:function(){this.bgSprite=new t.Sprite("dist/images/btn-shoot.png"),this.bgSpriteForDisabled=new t.Sprite("dist/images/btn-shoot-disabled.png");var i=this.bgSprite.getContentSize();this.bgSprite.getPreferredSize=this.bgSpriteForDisabled.getPreferredSize=function(){return i},this.titleLabel=new t.LabelTTF(e("!"),e.defaultFont,48),this._super(this.titleLabel,this.bgSprite),this.setAdjustBackgroundImage(!1),this.setBackgroundSpriteForState(this.bgSpriteForDisabled,t.CONTROL_STATE_DISABLED)}})}),define("sprites/forceButton",["cocos","i18n/i18n"],function(t,e){return t.ControlButton.extend({ctor:function(){this.bgSprite=new t.Sprite("dist/images/btn-force.png"),this.bgSpriteForDisabled=new t.Sprite("dist/images/btn-force-disabled.png");var i=this.bgSprite.getContentSize();this.bgSprite.getPreferredSize=this.bgSpriteForDisabled.getPreferredSize=function(){return i},this.titleLabel=new t.LabelTTF(e("")+" 100",e.defaultFont,48),this._super(this.titleLabel,this.bgSprite),
this.setAdjustBackgroundImage(!1),this.setBackgroundSpriteForState(this.bgSpriteForDisabled,t.CONTROL_STATE_DISABLED)},setForceNumber:function(i){i=Math.round(i),this.setTitleForState(e("")+" "+i,t.CONTROL_STATE_NORMAL),this.setTitleForState(e("")+" "+i,t.CONTROL_STATE_HIGHLIGHTED),this.setTitleForState(e("")+" "+i,t.CONTROL_STATE_DISABLED),this.setTitleForState(e("")+" "+i,t.CONTROL_STATE_SELECTED)}})}),define("sprites/menuButton",["cocos"],function(t){return t.ControlButton.extend({ctor:function(){this.bgSprite=new t.Sprite("dist/images/btn-menu.png");var e=this.bgSprite.getContentSize();this.bgSprite.getPreferredSize=function(){return e},this._super(this.bgSprite),this.setAdjustBackgroundImage(!1),this.theCanvas=document.getElementById(t.game.config.id),this.mouseListener=t.EventListener.create({event:t.EventListener.MOUSE,isInside:!1,onMouseDown:function(t){var e=t.getCurrentTarget();e.onTouchBegan(t,t)},onMouseMove:function(t){var e=t.getCurrentTarget();e.isTouchInside(t)&&e.isEnabled()&&e.isVisible()&&e.hasVisibleParents()?this.isInside||(this.isInside=!0,e.theCanvas.style.cursor="pointer"):this.isInside&&(this.isInside=!1,e.theCanvas.style.cursor="default"),e.onTouchMoved(t,t)},onMouseUp:function(t){var e=t.getCurrentTarget();e.onTouchEnded(t,t)}})},onEnter:function(){this._super(),t.eventManager.addListener(this.mouseListener,this)}})}),define("sprites/forceSlider",["cocos"],function(t){return t.ControlSlider.extend({ctor:function(){this._super("dist/images/slider-background.png","dist/images/slider-progress.png","dist/images/slider-thumb.png"),this.setMinimumValue(10),this.setMaximumValue(100),this.setValue(100),this.isAllowTouch=!0},setAllowTouch:function(t){this.isAllowTouch=t},isTouchInside:function(t){return!!this.isAllowTouch&&this._super(t)}})}),define("scenes/gameScene",["cocos","layers/tableLayer","layers/zoomTableLayer","layers/middleMsgLayer","sprites/shootButton","sprites/forceButton","sprites/menuButton","sprites/forceSlider","benzAudioEngine","i18n/i18n"],function(t,e,i,n,r,c,o,s,a,h){var l=220,u=98;return t.Scene.extend({ctor:function(){this._super(),this.fixedLayer=new t.LayerColor(t.color(0,0,0)),t.sys.isMobile&&t._renderType===t.game.RENDER_TYPE_CANVAS&&(this.fixedLayer.setPosition(t.visibleRect.bottomLeft),this.fixedLayer.setContentSize(t.visibleRect.width,t.visibleRect.height)),this.addChild(this.fixedLayer),t.sys.capabilities.touches?(this.zoomTableLayer=new i,this.tableLayer=this.zoomTableLayer.tableLayer,this.zoomTableLayer.setPosition(0,l),this.zoomTableLayer.setContentSize(t.visibleRect.width,t.visibleRect.height-l-u),this.fixedLayer.addChild(this.zoomTableLayer,1),this.initTouch()):(this.tableLayer=new e,this.tableLayer.setPosition((t.visibleRect.width-e.TABLE_WIDTH)/2,(t.visibleRect.height-e.TABLE_HEIGHT)/3),this.fixedLayer.addChild(this.tableLayer,1),this.initMouse()),this.force=100,this.middleMsgLayer=new n,this.fixedLayer.addChild(this.middleMsgLayer,2),this.initScoreBar(),this.initTableClear(),this.isPaused=!1},onEnter:function(){this._super(),this.enableMusic&&this.playBgm()},onExit:function(){this.stopBgm(),this._super()},initMouse:function(){this.initDesktopControl();var i=t.EventListener.create({event:t.EventListener.MOUSE,holding:!1,holdingDelayIdx:0,onMouseDown:function(i){var n=i.getCurrentTarget();if(n.tableLayer.status!==e.STATUS_READY)return!1;var r=n.tableLayer.convertToNodeSpace(i.getLocation());return!n.tableLayer.posInTable(r)||void(n.isPaused||i.getButton()!=t.EventMouse.BUTTON_LEFT||(n.forceSlider.setValue(100),n.showForceCtrl(),this.holding=!0))},onMouseMove:function(t){var i=t.getCurrentTarget();if(i.tableLayer.status!==e.STATUS_READY)return!1;if(this.holding){var n=t.getDelta();i.force+=n.x/10,i.forceSlider.setValue(i.force)}else{var r=i.tableLayer.convertToNodeSpace(t.getLocation());i.isPaused||i.tableLayer.setAimLine(r)}},onMouseUp:function(i){var n=i.getCurrentTarget();return n.tableLayer.status===e.STATUS_READY&&void(!n.isPaused&&this.holding&&i.getButton()==t.EventMouse.BUTTON_LEFT&&(n.hideForceCtrl(),this.holding=!1,n.tableLayer.shootMasterBall(n.force/100)))}});t.eventManager.addListener(i,this),t.eventManager.addCustomListener("table:status_ready",function(){}.bind(this))},initTouch:function(){this.initMobileControlBar(),this.tableLayer.setAimLine(t.p(e.TABLE_WIDTH/2,e.TABLE_HEIGHT/2)),t.eventManager.addCustomListener("table:status_ready",function(){this.tableLayer.setAimLine(this.tableLayer.ballCursor.getPosition()),this.forceSlider.setValue(100)}.bind(this)),this.initTouchTips()},initScoreBar:function(){this.scoreBarBg=new t.LayerColor(t.color(0,0,0,128),t.visibleRect.width,u),this.scoreBarBg.setPosition(0,t.visibleRect.height-u),this.fixedLayer.addChild(this.scoreBarBg,2),this.turnsLabel=new t.LabelTTF(h(" %d").replace("%d",this.tableLayer.turns+1),h.defaultFont,48),this.turnsLabel.setColor(t.color(0,255,0)),this.turnsLabel.setPosition(t.visibleRect.width/2,u/2),this.scoreBarBg.addChild(this.turnsLabel),t.eventManager.addCustomListener("table:status_ready",function(){this.turnsLabel.setString(h(" %d").replace("%d",this.tableLayer.turns+1))}.bind(this)),t.eventManager.addCustomListener("table:reset",function(){this.turnsLabel.setString(h(" %d").replace("%d",1))}.bind(this))},initDesktopControl:function(){this.menuButton=new o;var e=this.menuButton.getContentSize(),i=t.visibleRect;this.menuButton.setPosition(i.width-e.width/2-32,i.height-e.height/2-25),this.fixedLayer.addChild(this.menuButton,3),this.menuButton.addTargetWithActionForControlEvents(this,function(){this.showMenu()},t.CONTROL_EVENT_TOUCH_UP_INSIDE),this.forceSlider=new s,this.forceSlider.setAllowTouch(!1);var n=this.forceSlider.getContentSize(),r=t.size(n.width+100,n.height+24+48+13);this.forceSlider.setPosition(r.width/2,n.height/2+12),this.forceLabel=new t.LabelTTF(h("")+" 100",h.defaultFont,48),this.forceLabel.setColor(t.color(255,255,255)),this.forceLabel.setPosition(r.width/2,n.height+36),this.forceSliderBg=new t.LayerColor(t.color(0,0,0,128),r.width,r.height),this.forceSliderBg.setPosition(t.visibleRect.width/2,t.visibleRect.height/2),this.forceSliderBg.ignoreAnchorPointForPosition(!1),this.forceSliderBg.setAnchorPoint(.5,.5),this.forceSliderBg.setVisible(!1),this.forceSliderBg.addChild(this.forceSlider),this.forceSliderBg.addChild(this.forceLabel),this.fixedLayer.addChild(this.forceSliderBg,2),this.forceSlider.addTargetWithActionForControlEvents(this,function(){this.force=this.forceSlider.getValue(),this.forceLabel.setString(h("")+" "+Math.round(this.force))}.bind(this),t.CONTROL_EVENT_VALUECHANGED),this.force=100*this.tableLayer.shoot.force||100,this.initMenu()},initMobileControlBar:function(){this.controlBarBg=new t.LayerColor(t.color(0,0,0,128),t.visibleRect.width,l),this.fixedLayer.addChild(this.controlBarBg,2),this.shootButton=new r;var i=this.shootButton.getContentSize();this.shootButton.setPosition(t.visibleRect.width-32-i.width/2,50+i.height/2),this.controlBarBg.addChild(this.shootButton,3),this.shootButton.addTargetWithActionForControlEvents(this,function(){this.tableLayer.status===e.STATUS_READY&&(this.zoomTableLayer.resetTable(!0),this.tableLayer.shootMasterBall(this.force/100),this.hideForceCtrl())},t.CONTROL_EVENT_TOUCH_UP_INSIDE),this.forceButton=new c;var n=this.forceButton.getContentSize();this.forceButton.setPosition(this.shootButton.getBoundingBox().x-30-n.width/2,50+i.height/2),this.controlBarBg.addChild(this.forceButton,3),this.forceSlider=new s;var a=this.forceSlider.getContentSize();this.forceSlider.setPosition(t.visibleRect.width/2,a.height/2),this.forceSliderBg=new t.LayerColor(t.color(0,0,0,128),t.visibleRect.width,a.height+25),this.forceSliderBg.setPosition(t.visibleRect.width/2,l+(a.height+25)/2),this.forceSliderBg.ignoreAnchorPointForPosition(!1),this.forceSliderBg.setAnchorPoint(.5,.5),this.forceSlider.setVisible(!1),this.forceSliderBg.setVisible(!1),this.forceSliderBg.addChild(this.forceSlider),this.fixedLayer.addChild(this.forceSliderBg,2),this.forceButton.addTargetWithActionForControlEvents(this,function(){this.tableLayer.status===e.STATUS_READY&&(this.forceSliderBg.isVisible()?this.hideForceCtrl():this.showForceCtrl())},t.CONTROL_EVENT_TOUCH_UP_INSIDE),this.forceSlider.addTargetWithActionForControlEvents(this,function(){this.force=this.forceSlider.getValue(),this.forceButton.setForceNumber(this.force)},t.CONTROL_EVENT_VALUECHANGED),this.force=100*this.tableLayer.shoot.force||100,this.forceSlider.setValue(this.force),t.eventManager.addCustomListener("table:reset",function(){this.force=100,this.forceSlider.setValue(100)}.bind(this)),t.eventManager.addCustomListener("table:status_change",function(t){var i=t.getUserData(),n=i.new;n===e.STATUS_READY?(this.shootButton.setEnabled(!0),this.forceButton.setEnabled(!0)):(this.shootButton.setEnabled(!1),this.forceButton.setEnabled(!1))}.bind(this)),this.menuButton=new o;var h=this.menuButton.getContentSize();this.menuButton.setPosition(32+h.width/2,50+h.height/2),this.controlBarBg.addChild(this.menuButton,3),this.menuButton.addTargetWithActionForControlEvents(this,function(){this.showMenu()},t.CONTROL_EVENT_TOUCH_UP_INSIDE),this.initMenu()},showForceCtrl:function(){this.forceSliderBg.setVisible(!0),this.forceSlider.setVisible(!0)},hideForceCtrl:function(){this.forceSlider.setVisible(!1),this.forceSliderBg.setVisible(!1)},initMenu:function(){var e=t.sys.isMobile?72:50,i=new t.Color(0,255,0),n=new t.LabelTTF(h(""),h.defaultFont,e);n.setColor(i);var r=new t.MenuItemLabel(n,this.hideMenu.bind(this),this),c=new t.LabelTTF(h(""),h.defaultFont,e);c.setColor(i);var o=new t.MenuItemLabel(c,this.restartGame.bind(this),this);this.enableSound=!!parseInt(t.sys.localStorage.getItem("enableSfx"),10);var s=new t.LabelTTF(h(this.enableSound?"":""),h.defaultFont,e);s.setColor(i);var l=new t.MenuItemLabel(s,function(){this.enableSound?(l.setString(h("")),this.enableSound=!1,this.tableLayer.mute=!0,t.sys.localStorage.setItem("enableSfx",0)):(l.setString(h("")),this.enableSound=!0,this.tableLayer.mute=!1,t.sys.localStorage.setItem("enableSfx",1),a.play("dist/sounds/hit-ball.mp3"))}.bind(this),this);this.tableLayer.mute=!this.enableSound,this.enableMusic=!!parseInt(t.sys.localStorage.getItem("enableBgm"),10);var u=new t.LabelTTF(h(this.enableMusic?"":""),h.defaultFont,e);u.setColor(i);var _=new t.MenuItemLabel(u,function(){this.enableMusic?(_.setString(h("")),this.enableMusic=!1,t.sys.localStorage.setItem("enableBgm",0),this.stopBgm()):(_.setString(h("")),this.enableMusic=!0,t.sys.localStorage.setItem("enableBgm",1),this.playBgm())}.bind(this),this),d=new t.LabelTTF(h(""),h.defaultFont,e);d.setColor(i);var f=new t.MenuItemLabel(d,function(){this.hideMenu(),this.showControlTips()}.bind(this),this),p=new t.LabelTTF(h(""),h.defaultFont,e);p.setColor(new t.Color(0,255,0));var g=new t.MenuItemLabel(p,this.exitGame.bind(this),this);this.pauseMenuLayer=new t.LayerColor(t.color(0,0,0,128)),this.pauseMenuLayer.setContentSize(this.fixedLayer.getContentSize()),this.pauseMenuLayer.setVisible(!1);var m=[r,o];a.support()&&m.push(l,_),t.sys.isMobile&&m.push(f),m.push(g),this.pauseMenu=new t.Menu(m),this.pauseMenu.setPosition(t.visibleRect.width/2,t.visibleRect.height/2),this.pauseMenu.alignItemsVerticallyWithPadding(30),this.pauseMenuLayer.addChild(this.pauseMenu),this.fixedLayer.addChild(this.pauseMenuLayer,10)},showMenu:function(){this.pauseMenuLayer.setVisible(!0),this.pauseGame()},hideMenu:function(){this.pauseMenuLayer.setVisible(!1),this.resumeGame()},pauseGame:function(){this.tableLayer.pause(),this.zoomTableLayer&&this.zoomTableLayer.pause(),this.controlBarBg&&this.controlBarBg.setVisible(!1),this.isPaused=!0},resumeGame:function(){this.controlBarBg&&this.controlBarBg.setVisible(!0),this.zoomTableLayer&&this.zoomTableLayer.resume(),this.tableLayer.resume(),this.isPaused=!1},restartGame:function(){this.tableLayer.turns>2&&!confirm(h(""))||(this.hideMenu(),this.tableLayer.resetTable())},playBgm:function(){this.enableMusic&&(this.bgmId=a.play("dist/sounds/bgm.mp3",.55,31.251))},stopBgm:function(){void 0!==this.bgmId&&a.stop(this.bgmId)},playClearBgm:function(){this.enableMusic&&(this.stopBgm(),a.play("dist/sounds/clear.mp3"))},initTableClear:function(){var e=t.visibleRect;this.clearLayer=new t.LayerColor(t.color(0,0,0,128),e.width,e.height),this.clearLayer.setVisible(!1),this.fixedLayer.addChild(this.clearLayer,3),this.gameOverLabel=new t.LabelTTF(h("!"),h.defaultFont,128),this.gameOverLabel.setPosition(e.width/2,e.height/2+280),this.gameOverLabel.setColor(new t.Color(128,255,128)),this.clearLayer.addChild(this.gameOverLabel,1),this.finalScoreLabel=new t.LabelTTF(h(" %d ").replace("%d",this.tableLayer.turns),h.defaultFont,96),this.finalScoreLabel.setPosition(e.width/2,e.height/2+128),this.finalScoreLabel.setColor(new t.Color(255,255,255)),this.clearLayer.addChild(this.finalScoreLabel,1),this.maxComboLabel=new t.LabelTTF(h("%d").replace("%d",this.tableLayer.maxCombo),h.defaultFont,72),this.maxComboLabel.setPosition(e.width/2,e.height/2),this.maxComboLabel.setColor(new t.Color(255,255,0)),this.clearLayer.addChild(this.maxComboLabel,1);var i=t.sys.isMobile?72:50,n=new t.LabelTTF(h(""),h.defaultFont,i);n.setColor(new t.Color(0,255,0)),n.enableStroke(new t.Color(10,10,10),2);var r=new t.MenuItemLabel(n,function(){this.resumeGame(),this.tableLayer.resetTable(),this.clearLayer.setVisible(!1),this.playBgm()},this),c=new t.LabelTTF(h(""),h.defaultFont,i);c.setColor(new t.Color(0,255,0)),c.enableStroke(new t.Color(10,10,10),2);var o=new t.MenuItemLabel(c,this.exitGame.bind(this),this);this.replayMenu=new t.Menu(r,o),this.replayMenu.setPosition(e.width/2,.325*e.height),this.replayMenu.alignItemsVerticallyWithPadding(30),this.clearLayer.addChild(this.replayMenu,2);var s=new t.Sprite("dist/images/qrcode.png");s.setPosition(e.width/2,125),this.clearLayer.addChild(s,1),t.eventManager.addCustomListener("table:status_clear",function(e){var i=e.getUserData(),n=i.turns,r=i.maxCombo;this.finalScoreLabel.setString(h(" %d ").replace("%d",n)),this.maxComboLabel.setString(h("%d").replace("%d",r)),this.pauseGame(),document.title=h("%d!").replace("%d",n+""),this.playClearBgm(),this.runAction(t.sequence([t.repeat(t.sequence([t.callFunc(function(){this.tableLayer.setTableColor(t.color(255,255,255))},this),t.delayTime(.05),t.callFunc(function(){this.tableLayer.resetTableColor()},this),t.delayTime(.05)]),5),t.delayTime(.5),t.callFunc(function(){this.clearLayer.setVisible(!0)},this)])),window._hmt&&window._hmt.push(["_trackEvent","funnyBillards_"+(t.sys.isMobile?"Mobile":"Desktop"),"clear",n+""])}.bind(this))},initTouchTips:function(){this.tipsLayer=new t.LayerColor(t.color(0,0,0,192),t.visibleRect.width,t.visibleRect.height);var e=t.textureCache.addImage("dist/images/fingers.png"),i=new t.SpriteFrame(e,t.rect(0,0,e.pixelsWidth/3,e.pixelsHeight));i=new t.Sprite(i),i.setPosition(t.visibleRect.width/2,t.visibleRect.height/2+450);var n=new t.SpriteFrame(e,t.rect(e.pixelsWidth/3,0,e.pixelsWidth/3,e.pixelsHeight));n=new t.Sprite(n),n.setPosition(t.visibleRect.width/2,t.visibleRect.height/2+100);var r=new t.SpriteFrame(e,t.rect(e.pixelsWidth/3*2,0,e.pixelsWidth/3,e.pixelsHeight));r=new t.Sprite(r),r.setPosition(t.visibleRect.width/2,t.visibleRect.height/2-250);var c=new t.LabelTTF(h(""),h.defaultFont,50);c.setColor(t.color(255,255,255)),c.setPosition(t.visibleRect.width/2,t.visibleRect.height/2+300);var o=new t.LabelTTF(h(""),h.defaultFont,50);o.setColor(t.color(255,255,255)),o.setPosition(t.visibleRect.width/2,t.visibleRect.height/2-50);var s=new t.LabelTTF(h(""),h.defaultFont,50,t.size(t.visibleRect.width-100,0),t.TEXT_ALIGNMENT_CENTER);s.setColor(t.color(255,255,255)),s.setPosition(t.visibleRect.width/2,t.visibleRect.height/2-400),this.tipsLayer.addChild(i),this.tipsLayer.addChild(c),this.tipsLayer.addChild(n),this.tipsLayer.addChild(o),this.tipsLayer.addChild(r),this.tipsLayer.addChild(s),this.tipsLayer.setVisible(!1),this.fixedLayer.addChild(this.tipsLayer,20),t.sys.localStorage.getItem("firstControlTips")||(this.showControlTips(),t.sys.localStorage.setItem("firstControlTips",1))},showControlTips:function(){this.tipsLayer.setVisible(!0),this.pauseGame();var e=t.EventListener.create({event:t.EventListener.TOUCH_ALL_AT_ONCE,onTouchesBegan:function(i,n){var r=n.getCurrentTarget();return r.resumeGame(),r.tipsLayer.setVisible(!1),t.eventManager.removeListener(e),!0}});t.eventManager.addListener(e,this)},exitGame:function(){this.enableSound&&a.play("dist/sounds/lost-master.mp3"),require(["scenes/titleScene"],function(e){t.director.runScene(new t.TransitionFade(.5,new e))})}})}),define("scenes/languageScene",["cocos","i18n/i18n"],function(t,e){return t.Scene.extend({ctor:function(){this._super();var i=new t.LayerColor(t.color.BLACK);this.addChild(i,1);var n,r,c,o=t.director.getWinSize(),s=72,a=new t.Color(128,128,128),h="Helvetica Neue",l=[],u=e.getLanguageList();for(c in u)u.hasOwnProperty(c)&&(n=new t.LabelTTF(u[c],h,s),n.setColor(a),r=new t.MenuItemLabel(n,function(i){return function(){e.setLanguage(i,function(){require(["scenes/titleScene"],function(e){t.director.runScene(new e)})})}}(c)),l.push(r));var _=new t.Menu(l);_.setContentSize(o.width/2,o.height/2),_.setPosition(o.width/2,o.height/2),_.alignItemsVerticallyWithPadding(15),i.addChild(_)}})}),define("scenes/aboutScene",["cocos","i18n/i18n"],function(t,e){return t.Scene.extend({ctor:function(){this._super(),this.fixedLayer=new t.LayerColor(t.color(0,0,0)),t.sys.isMobile&&t._renderType===t.game.RENDER_TYPE_CANVAS&&(this.fixedLayer.setPosition(t.visibleRect.bottomLeft),this.fixedLayer.setContentSize(t.visibleRect.width,t.visibleRect.height)),this.addChild(this.fixedLayer);var i=t.visibleRect,n=t.sys.isMobile?60:40,r=t.sys.isMobile?t.visibleRect.width-100:t.visibleRect.width/2,c=new t.LabelTTF(e(" cocos2d-js  chipmunk  Web Audio API\n\n cocos "),e.defaultFont,n,t.size(r,0),t.TEXT_ALIGNMENT_LEFT);c.setPosition(i.width/2,.6875*i.height),c.setColor(new t.Color(192,192,192,1)),this.fixedLayer.addChild(c,1);var o=t.sys.isMobile?72:50,s=new t.Color(0,255,0),a=new t.LabelTTF(e(" Github"),e.defaultFont,o);a.setColor(s);var h=new t.MenuItemLabel(a,function(){window.open("https://github.com/BenzLeung")}),l=new t.LabelTTF(e(""),e.defaultFont,o);l.setColor(s);var u=new t.MenuItemLabel(l,function(){window.open("https://github.com/BenzLeung/funny-billards")}),_=new t.LabelTTF(e("<< "),e.defaultFont,o);_.setColor(s);var d=new t.MenuItemLabel(_,function(){t.director.popScene()}),f=new t.Menu(u,h,d);f.setContentSize(i.width/2,i.height/2),f.setPosition(i.width/2,i.height/4),f.alignItemsVerticallyWithPadding(15),this.fixedLayer.addChild(f)}})}),define("layers/startMenu",["cocos","scenes/gameScene","scenes/languageScene","scenes/aboutScene","benzAudioEngine","i18n/i18n"],function(t,e,i,n,r,c){var o={gameScene:["dist/images/masterball.png","dist/images/ball-animate-sprite.png","dist/images/table.png","dist/images/fingers.png","dist/images/slider-background.png","dist/images/slider-progress.png","dist/images/slider-thumb.png","dist/images/btn-menu.png","dist/images/btn-force.png","dist/images/btn-force-disabled.png","dist/images/btn-shoot.png","dist/images/btn-shoot-disabled.png","dist/images/qrcode.png"]},s={gameScene:["dist/sounds/goal.mp3","dist/sounds/hit-ball.mp3","dist/sounds/hit-wall.mp3","dist/sounds/lost-master.mp3","dist/sounds/shoot.mp3","dist/sounds/bgm.mp3","dist/sounds/clear.mp3"]};return t.Menu.extend({ctor:function(){var e=t.sys.isMobile?72:50,i=new t.Color(0,255,0),n=new t.Color(128,128,128),r=new t.LabelTTF(c(""),c.defaultFont,e);r.setColor(i);var o=new t.MenuItemLabel(r,this.doContinueGame,this);o.setDisabledColor(n),t.sys.localStorage.getItem("tableState")||o.setEnabled(!1);var s=new t.LabelTTF(c(""),c.defaultFont,e);s.setColor(i);var a=new t.MenuItemLabel(s,this.doStartGame,this),h=new t.LabelTTF(c(""),c.defaultFont,e);h.setColor(i),this.soundMenuItem=new t.MenuItemLabel(h,this.doSoundFlag,this),this.soundMenuItem.setDisabledColor(n),this.initSoundFlag();var l=new t.LabelTTF(c(" (Language)"),c.defaultFont,e);l.setColor(i);var u=new t.MenuItemLabel(l,this.doLanguage,this),_=new t.LabelTTF(c(""),c.defaultFont,e);_.setColor(i);var d=new t.MenuItemLabel(_,this.doAbout,this);this._super(o,a,this.soundMenuItem,u,d),this.setContentSize(t.visibleRect.width/2,.375*t.visibleRect.height),this.setPosition(t.visibleRect.width/2,.3125*t.visibleRect.height),this.alignItemsVerticallyWithPadding(15)},doContinueGame:function(){1&this.soundFlag&&r.play("dist/sounds/selected.mp3"),t.LoaderScene.preload(o.gameScene,function(){r.load(s.gameScene,function(){t.director.runScene(new e)})},this)},doStartGame:function(){var e=t.sys.localStorage.getItem("tableState");e?confirm(c(""))&&(t.sys.localStorage.removeItem("tableState"),this.doContinueGame()):this.doContinueGame()},getSoundFlagText:function(){switch(this.soundFlag){case 0:return c("");case 1:return c("");case 2:return c("");case 3:return c("")}},initSoundFlag:function(){var e=parseInt(t.sys.localStorage.getItem("enableBgm"),10),i=parseInt(t.sys.localStorage.getItem("enableSfx"),10);isNaN(e)&&(e=1,t.sys.localStorage.setItem("enableBgm",1)),isNaN(i)&&(i=1,t.sys.localStorage.setItem("enableSfx",1)),this.soundFlag=e<<1|i,r.support()?this.soundMenuItem.setString(this.getSoundFlagText()):(this.soundMenuItem.setString(c("")),this.soundMenuItem.setEnabled(!1))},doSoundFlag:function(){this.soundFlag++,this.soundFlag=3&this.soundFlag;var e=(2&this.soundFlag)>>1,i=1&this.soundFlag;t.sys.localStorage.setItem("enableBgm",e),t.sys.localStorage.setItem("enableSfx",i),this.soundMenuItem.setString(this.getSoundFlagText()),this.soundFlag&&r.play("dist/sounds/hit-ball.mp3")},doLanguage:function(){t.director.runScene(new i)},doAbout:function(){t.director.pushScene(new n)}})}),define("scenes/titleScene",["cocos","layers/titleLayer","layers/startMenu"],function(t,e,i){return t.Scene.extend({ctor:function(){this._super(),this.fixedLayer=new t.LayerColor(t.color(0,0,0)),t.sys.isMobile&&t._renderType===t.game.RENDER_TYPE_CANVAS&&(this.fixedLayer.setPosition(t.visibleRect.bottomLeft),this.fixedLayer.setContentSize(t.visibleRect.width,t.visibleRect.height)),this.addChild(this.fixedLayer);var n=new e;this.fixedLayer.addChild(n,3);var r=new i;this.fixedLayer.addChild(r,5);var c=new t.LabelTTF("Benz Leung (https://github.com/BenzLeung)","Tahoma",45);c.setColor(new t.Color(128,128,128,1)),c.setPosition(t.visibleRect.width/2,60),this.fixedLayer.addChild(c,3)}})}),require(["cocos","scenes/titleScene","benzAudioEngine"],function(t,e,i){window.DEBUG_MODE=0,t.game.config={debugMode:DEBUG_MODE,frameRate:60,showFPS:!!DEBUG_MODE,id:"gameCanvas",renderMode:1};var n={titleScene:["dist/images/title.png"]},r={titleScene:["dist/sounds/selected.mp3","dist/sounds/hit-ball.mp3"]};t.game.onStart=function(){t.sys.isMobile?t.view.setDesignResolutionSize(1080,1920,t.ResolutionPolicy.NO_BORDER):t.view.setDesignResolutionSize(1920,1080,t.ResolutionPolicy.SHOW_ALL),t.view.setOrientation(t.ORIENTATION_PORTRAIT),t.view.resizeWithBrowserSize(!0),t.LoaderScene.preload(n.titleScene,function(){i.load(r.titleScene,function(){t.director.runScene(new e)})},this)},t.game.run("gameCanvas"),document.getElementById("gameCanvas").focus()}),define("cocosMain",function(){}),require.config({baseUrl:"dist/js",paths:{cocos:"../lib/cocos2d-js-v3.13-custom",chipmunk:"../lib/chipmunk"},shim:{cocos:{exports:"cc"},chipmunk:{exports:"cp"}}}),require(["cocos","chipmunk","cocosMain"]),define("requireMain",function(){});